---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html">Partial evaluation of a file</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="277212980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277212980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277212980">(Mar 30 2022 at 22:50)</a>:</h4>
<p>I'm having a hard time working with a file with some heavy computations. I have few questions regarding this:</p>
<ol>
<li>
<p>Is it possible to evaluate file only up to the cursor position? I do not want to waste computation on recomputing all the heavy computations that I'm not currently working. In Coq(Proof General mode in emacs) you can 'confirm' line by line, this way you have a bit more control when stuff gets evaluated.</p>
</li>
<li>
<p>When I modify a proof, is it evaluated from scratch or from the last valid non modified point?</p>
</li>
</ol>
<p>I have mwe for this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">A</span> <span class="o">(</span><span class="n">n</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span>

<span class="kd">instance</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">A</span> <span class="mi">0</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:=</span> <span class="o">⟨⟩</span>
<span class="kd">instance</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">[</span><span class="n">A</span> <span class="n">n</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span> <span class="o">:</span> <span class="n">A</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:=</span> <span class="o">⟨⟩</span>

<span class="kd">theorem</span> <span class="n">foo</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">[</span><span class="n">A</span> <span class="mi">4000</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">set_option</span> <span class="n">synthInstance.maxHeartbeats</span> <span class="mi">500000</span>
<span class="kd">set_option</span> <span class="n">synthInstance.maxSize</span> <span class="mi">100000</span>
<span class="kd">set_option</span> <span class="n">maxRecDepth</span> <span class="mi">10000</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">4</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">by</span>
  <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">conv</span> <span class="bp">=&gt;</span>
    <span class="n">lhs</span>
    <span class="n">enter</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
  <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">done</span>
</code></pre></div>
<p>When you modify <code>enter [1]</code> to <code>enter [1,1]</code> the goal should changes from <code>(1 + 1) * n + 1 * n</code> to <code>(1 + 1) * n</code> and I would expect this to happen immediately as it is just traversing an expression. However, it looks like that each time you modify anything <code>rw[foo]</code> gets reevaluated  and that takes a long time :( </p>
<p>Are there some editor options on how a file is evaluated?</p>



<a name="277213362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277213362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277213362">(Mar 30 2022 at 22:56)</a>:</h4>
<blockquote>
<p>Is it possible to evaluate file only up to the cursor position?</p>
</blockquote>
<p>Simple workaround: put an <code>#exit</code>command at the place you want Lean to stop. It helps for files with a bunch of theorems/definitions. It will not help in the example above.</p>
<blockquote>
<p>When I modify a proof, is it evaluated from scratch or from the last valid non modified point?</p>
</blockquote>
<p>Lean starts from the last checkpoint (i.e., at the beginning of the current command).</p>



<a name="277213668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277213668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277213668">(Mar 30 2022 at 23:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112857">Leonardo de Moura</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277213362">said</a>:</p>
<blockquote>
<p>Lean starts from the last checkpoint (i.e., at the beginning of the current command).</p>
</blockquote>
<p>That is odd, because even if the code looks like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span>  <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span>
<span class="kd">by</span>
  <span class="n">conv</span> <span class="bp">=&gt;</span>
    <span class="n">enter</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
  <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">done</span>
</code></pre></div>
<p>When changing <code>enter [1]</code> to <code>enter [1,1]</code>, it takes quite time for the goal to update from <code>1 * n + 1 * n</code> to <code>1 * n</code>. It looks like that the goal view is updated only once the whole proof is traversed. (This might be a problem with emacs, I didn't test it in VS Code)</p>



<a name="277213988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277213988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277213988">(Mar 30 2022 at 23:04)</a>:</h4>
<p>The checkpoint is at the beginning of the <code>example</code> command. Every modification on this command will force Lean to re-elaborate the command from the beginning. The <code>rw [foo]</code> step is quite expensive because Lean needs to synthesize <code>[A 4000 a b]</code>.</p>



<a name="277214063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277214063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277214063">(Mar 30 2022 at 23:05)</a>:</h4>
<p>I am using Emacs, and it seems to be working as expected. For every modification I make at <code>example</code>, I get the orange bar only at this command.</p>



<a name="277214210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277214210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277214210">(Mar 30 2022 at 23:08)</a>:</h4>
<p>My use case is that I'm working with a quite complicated expression that I simplify with quite expensive <code>simp</code> call. Then I need to navigate to its subexpression with <code>conv</code> to modify it to desired final form. Figuring out the desired <code>enter [??]</code> to navigate to the correct subexpression is difficult without interactivity.</p>



<a name="277214403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277214403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277214403">(Mar 30 2022 at 23:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112857">Leonardo de Moura</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277214063">said</a>:</p>
<blockquote>
<p>I am using Emacs, and it seems to be working as expected. For every modification I make at <code>example</code>, I get the orange bar only at this command.</p>
</blockquote>
<p>I'm having the same behavior. I just didn't know that checkpoints are only at commands. A long time ago when I was playing with Coq, it had checkpoints after every tactic call and I was hoping that Lean would have that too.</p>



<a name="277214468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277214468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277214468">(Mar 30 2022 at 23:11)</a>:</h4>
<p>It is difficult to integrate this with lean's elaboration mechanism since tactics can appear in subterms and generally trade off elaboration with other tactic blocks or subterms</p>



<a name="277214516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277214516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277214516">(Mar 30 2022 at 23:12)</a>:</h4>
<p>it wouldn't even be syntactically correct to just stop in the middle of a tactic proof and then pick it up later</p>



<a name="277214601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277214601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277214601">(Mar 30 2022 at 23:13)</a>:</h4>
<p>How do people write complicated proofs if every modification to it makes it re-evaluate?</p>



<a name="277214837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277214837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277214837">(Mar 30 2022 at 23:16)</a>:</h4>
<p>they use more lemmas</p>



<a name="277214848"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277214848" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277214848">(Mar 30 2022 at 23:17)</a>:</h4>
<p>or use <code>sorry { ... }</code> to stub out subproofs</p>



<a name="277214928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277214928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277214928">(Mar 30 2022 at 23:18)</a>:</h4>
<p>very large proofs are a bad idea for several reasons so it doesn't bother me so much that this live response slowdown gently prods people to break up big proofs into smaller pieces</p>



<a name="277215172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215172">(Mar 30 2022 at 23:22)</a>:</h4>
<p><span aria-label="cry" class="emoji emoji-1f622" role="img" title="cry">:cry:</span>  I'm sad about this. I want to use tactic mode to do something like what computer algebra systems do where you step by step modify an expression to a desired form. Some manipulations can be quite expensive and you do not know the intermediate forms to break it up to several pieces.</p>



<a name="277215195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215195">(Mar 30 2022 at 23:23)</a>:</h4>
<p>Would it be possible to have a tactic <code>checkpoint</code>? That would cache the state?</p>



<a name="277215216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215216">(Mar 30 2022 at 23:23)</a>:</h4>
<p>in your example, you can work around this by writing the intermediate form after the expensive <code>simp [...]</code>, and then do <code>suffices : ... by sorry</code> in place of the <code>simp</code></p>



<a name="277215287"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215287" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215287">(Mar 30 2022 at 23:24)</a>:</h4>
<p>There have been talks about plans to checkpoint between tactics this but I don't know what stage they are in</p>



<a name="277215307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215307">(Mar 30 2022 at 23:25)</a>:</h4>
<p>I would guess it's not a very high priority</p>



<a name="277215407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215407">(Mar 30 2022 at 23:26)</a>:</h4>
<p>I wonder whether it is possible to write such a tactic in userland using <code>IO</code> references</p>



<a name="277215433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215433">(Mar 30 2022 at 23:26)</a>:</h4>
<p>which IIUC are not rolled back along with the environment</p>



<a name="277215437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215437">(Mar 30 2022 at 23:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277215216">said</a>:</p>
<blockquote>
<p>in your example, you can work around this by writing the intermediate form after the expensive <code>simp [...]</code>, and then do <code>suffices : ... by sorry</code> in place of the <code>simp</code></p>
</blockquote>
<p>The problem is that the intermediate form is often quite complicated and just copy pasting it does not work as it is quite often missing some type anotations.</p>



<a name="277215465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215465">(Mar 30 2022 at 23:27)</a>:</h4>
<p>my impression was that lean 4 is better at pp roundtripping, but <code>pp.all</code> is a hammer to solve the problem</p>



<a name="277215582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215582">(Mar 30 2022 at 23:29)</a>:</h4>
<p>Yay the expression I'm working with is 570 lines of code with <code>pp.all</code> <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span></p>



<a name="277215679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277215679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277215679">(Mar 30 2022 at 23:30)</a>:</h4>
<p>maybe unfolding everything wasn't a good idea...?</p>



<a name="277216085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277216085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277216085">(Mar 30 2022 at 23:37)</a>:</h4>
<p>It is just a complicated algebraic expression where every operation contains the projection e.g. from <code>VectorSpace</code> to <code>AddCommGroup</code> to <code>AddGroup</code> to <code>SubNegMonoid</code> to <code>Sub</code>. That totally explodes the expression.</p>



<a name="277216584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277216584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277216584">(Mar 30 2022 at 23:44)</a>:</h4>
<p>turning off implicits should help with that. Those subterms are shared anyway</p>



<a name="277217215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277217215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277217215">(Mar 30 2022 at 23:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277215407">said</a>:</p>
<blockquote>
<p>I wonder whether it is possible to write such a tactic in userland using <code>IO</code> references</p>
</blockquote>
<p>Not sure how to do <code>checkpoint</code> but maybe something like <code>cached simp</code> would be possible. It would store the state before and after you execute <code>simp</code>. The next time it gets evaluated you first check if the state corresponds to the cached one and just load the state after.</p>



<a name="277217259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277217259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277217259">(Mar 30 2022 at 23:55)</a>:</h4>
<p>that's what I'm trying now. the hard part is that the state is completely different with regard to metavariable and local variable unique names</p>



<a name="277217269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277217269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277217269">(Mar 30 2022 at 23:55)</a>:</h4>
<p>you can't just use the old expression</p>



<a name="277217347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277217347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277217347">(Mar 30 2022 at 23:56)</a>:</h4>
<p>Step ahead :) yeah that is indeed a problem</p>



<a name="277217700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277217700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277217700">(Mar 31 2022 at 00:00)</a>:</h4>
<p>What would be sufficient for me it to cache only <code>conv</code> commands. If I understand it right, it would be enough to store the final form and equality to the original after a rewrite. This should get rid off metavariables. The problem with local variables stays.</p>



<a name="277217763"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277217763" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277217763">(Mar 31 2022 at 00:01)</a>:</h4>
<p>my plan is to support <code>macro "checkpoint" " =&gt; " tacs:tacticSeq : tactic =&gt; ...</code></p>



<a name="277217820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277217820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277217820">(Mar 31 2022 at 00:02)</a>:</h4>
<p>which works like what you said about <code>cached</code></p>



<a name="277217829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277217829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277217829">(Mar 31 2022 at 00:02)</a>:</h4>
<p>you could have a version of this for conv too</p>



<a name="277217839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277217839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277217839">(Mar 31 2022 at 00:02)</a>:</h4>
<p>Having that would be really great!</p>



<a name="277237193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277237193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277237193">(Mar 31 2022 at 06:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277214928">said</a>:</p>
<blockquote>
<p>very large proofs are a bad idea for several reasons so it doesn't bother me so much that this live response slowdown gently prods people to break up big proofs into smaller pieces</p>
</blockquote>
<p>I think this opinion comes from the fact that most of mathlib is still laying down very elementary foundations. In real mathematics most proofs simply can't be broken up like this. I consider this a major issue of Lean 3. Of course this isn't blocking mathport so it isn't a priority in Lean 4, but it could very well be the very top priority from a user perspective after the port.</p>



<a name="277237276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277237276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277237276">(Mar 31 2022 at 06:12)</a>:</h4>
<p>I used to laugh at Coq's curtain going up and down the file, but nowadays I really wish I could have this in Lean so that I would get an immediate tactic state update when typing.</p>



<a name="277237576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277237576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277237576">(Mar 31 2022 at 06:17)</a>:</h4>
<p>The reasons to break up proofs also have to do with readability to other people, not just lean. These huge proofs are really not desirable in any sense. Of course we should try to address these issues with tooling support where possible, but it's papering over the issue. I am reminded of an adage I learned from who knows where: if you hit a system limit like a timeout or stack overflow, you should first consider whether you are doing something wrong before increasing the limit</p>



<a name="277237793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277237793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277237793">(Mar 31 2022 at 06:20)</a>:</h4>
<p>The "elementarity" of the proof has nothing at all to do with it. You can have large proofs and modular proofs at the high level and the low level equally well</p>



<a name="277237985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277237985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277237985">(Mar 31 2022 at 06:23)</a>:</h4>
<p>in CS, a common rule of thumb is to not let your functions get too large or too deeply nested. Saying "it's okay because I'm building on a big framework" is not an excuse, and the rule is not related to the effectiveness of the compiler on your code (although if you let it get really bad then you might hit a compiler limit).</p>



<a name="277238915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277238915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277238915">(Mar 31 2022 at 06:38)</a>:</h4>
<p>Having abstract principles like this sounds nice, but math simply doesn't work like this.</p>



<a name="277238989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277238989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277238989">(Mar 31 2022 at 06:40)</a>:</h4>
<p>And cutting a proof into ten lemmas that have the same assumptions and are used only once doesn't increase readability.</p>



<a name="277239127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277239127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277239127">(Mar 31 2022 at 06:42)</a>:</h4>
<p>it's difficult to get concrete in absence of an example, but I have done plenty of big proofs enough to say that it's possible to have discipline to use definitions when needed to break proofs into parts, even if some of the lemmas have no reasonable names</p>



<a name="277239139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277239139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277239139">(Mar 31 2022 at 06:42)</a>:</h4>
<p>they at least give you a place to hang documentation</p>



<a name="277239272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277239272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277239272">(Mar 31 2022 at 06:44)</a>:</h4>
<p>Another way to phrase what I'm doing. I write down a program specification as a goal and then use bunch of tactics to generate executable code. </p>
<p>The whole point is that user can write down a simple, short specification that is guaranteed to be correct/exactly what user wants. And lean helps you to build the program you want. </p>
<p>Breaking it down to multiple steps kind of defeats the purpose.</p>
<p>Loosing interactivity after few steps of program synthesis is a major problem here.</p>



<a name="277239304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277239304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277239304">(Mar 31 2022 at 06:45)</a>:</h4>
<blockquote>
<p>Another way to phrase what I'm doing. I write down a program specification as a goal and then use bunch of tactics to generate executable code. </p>
</blockquote>
<p>I had a feeling that this was the reason for your code (which was why the claim that it was about algebra was surprising to me)</p>



<a name="277239441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277239441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277239441">(Mar 31 2022 at 06:47)</a>:</h4>
<p>I am probably incurably of the opinion that anything that takes more than a few seconds to check is Doing It Wrong but I am clearly biased by my experiences with metamath and MM0</p>



<a name="277239515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277239515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277239515">(Mar 31 2022 at 06:48)</a>:</h4>
<p>I'm building ode solver right now, and the simp tactic was doing complicated gradient computation of an energy function.</p>
<p>After the differentiation I want to massage the resulting gradient to a form that is fast to execute.</p>



<a name="277239520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277239520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277239520">(Mar 31 2022 at 06:48)</a>:</h4>
<p>Surely that can be done without <code>simp</code></p>



<a name="277239578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277239578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277239578">(Mar 31 2022 at 06:49)</a>:</h4>
<p>if it is based on syntactically matching the input then it should be doable in ~linear time (aka very fast) using lemma applications</p>



<a name="277239643"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277239643" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277239643">(Mar 31 2022 at 06:50)</a>:</h4>
<p>and that's including the <code>conv</code> bits afterward</p>



<a name="277240074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277240074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277240074">(Mar 31 2022 at 06:55)</a>:</h4>
<p>Not sure what 'syntactic matching' is, but I don't think it is that simple. In particular, I'm taking a differential w.r.t to a function(not a simple variable) and then compute an adjoint of the resulting differential(a linear function) to obtain gradient.</p>



<a name="277240283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277240283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277240283">(Mar 31 2022 at 06:58)</a>:</h4>
<p>Some rewrite steps need proofs that certain functions are linear. Or expressions with sums and Kronecker deltas appear and to eliminate them I need proofs that certain functions are invertible so that the sum can be reindexed and Kronecker's delta eliminated.</p>



<a name="277240291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277240291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277240291">(Mar 31 2022 at 06:58)</a>:</h4>
<p>By syntactic matching, I mean that the form of the output is a function of the syntax that you are given on input (i.e you recurse on the structure of the term). Most things that can be done with typeclasses have this form</p>



<a name="277240343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277240343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277240343">(Mar 31 2022 at 06:59)</a>:</h4>
<p>all of those things can be handled, especially if you have a closed set of things to handle</p>



<a name="277240354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277240354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277240354">(Mar 31 2022 at 06:59)</a>:</h4>
<p>even if you don't you can use an attribute</p>



<a name="277240721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277240721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277240721">(Mar 31 2022 at 07:03)</a>:</h4>
<p>I have bunch of theorems as rewrite rules that I want to apply. So what am I supposed to use if not simp to apply these theorems?</p>



<a name="277240852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277240852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277240852">(Mar 31 2022 at 07:04)</a>:</h4>
<p><code>norm_num</code> is written like this BTW. You match on the input syntax, and in each case you know exactly which rule you want to apply</p>



<a name="277240889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277240889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277240889">(Mar 31 2022 at 07:05)</a>:</h4>
<p>so it's not really just throwing a bag of rewrites at the term until things stop changing</p>



<a name="277241043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277241043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277241043">(Mar 31 2022 at 07:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277214928">said</a>:</p>
<blockquote>
<p>very large proofs are a bad idea for several reasons so it doesn't bother me so much that this live response slowdown gently prods people to break up big proofs into smaller pieces</p>
</blockquote>
<p>As a data point, in my paper on the formalization of the Morse lemma in hyperbolic geometry in Isabelle, the proof of the main lemma (after having isolated everything that could reasonably be split off) is more than 1000 lines long -- it is an intricate double-induction, which it wouldn't make any sense to break into separate lemmas. In Isabelle, it works very smoothly because the system doesn't recompile the whole proof every time, it caches everything until your first modification.</p>



<a name="277241192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277241192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277241192">(Mar 31 2022 at 07:09)</a>:</h4>
<p>I would actually have just the double-induction framework in the main theorem and break the body into a separate lemma</p>



<a name="277241207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277241207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277241207">(Mar 31 2022 at 07:09)</a>:</h4>
<p>that's a pretty clear split point</p>



<a name="277241314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277241314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277241314">(Mar 31 2022 at 07:10)</a>:</h4>
<p>aka: I'm glad your compiler can handle 8 levels of nested brackets but I sure can't</p>



<a name="277241500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277241500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277241500">(Mar 31 2022 at 07:13)</a>:</h4>
<p>the Con-NF proof also contains a really huge transfinite induction, which spans most of the paper. In the <a href="#narrow/stream/116395-maths/topic/The.20consistency.20of.20NF/near/271940213">lean version</a> this is broken out into a bunch of definitions and theorems, with only a single line definition to tie the knot at the end</p>



<a name="277242201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277242201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277242201">(Mar 31 2022 at 07:21)</a>:</h4>
<blockquote>
<p><code>norm_num</code> is written like this BTW. You match on the input syntax, and in each case you know exactly which rule you want to apply</p>
</blockquote>
<p>Once I know the set of rules I want to use, I might implement it like <code>norm_num</code> but right now I'm still figuring out the set of rewrite rules, their order and priorities.</p>



<a name="277242374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277242374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277242374">(Mar 31 2022 at 07:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277241192">said</a>:</p>
<blockquote>
<p>I would actually have just the double-induction framework in the main theorem and break the body into a separate lemma</p>
</blockquote>
<p>I'm not sure that's a reasonable course of action when the induction assumptions would be like 80 lines.</p>



<a name="277242398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277242398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277242398">(Mar 31 2022 at 07:23)</a>:</h4>
<p>you would put the assumptions in a definition in that case</p>



<a name="277242486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277242486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277242486">(Mar 31 2022 at 07:24)</a>:</h4>
<p>It's not one definition, it's literally 80 lines of properties. Or build up an 80 lines definition, but I'm not sure it's a big gain.</p>



<a name="277242523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277242523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277242523">(Mar 31 2022 at 07:24)</a>:</h4>
<p>I mean an 80 lines definition, or possibly multiple levels of definition if it's that bad</p>



<a name="277242577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277242577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277242577">(Mar 31 2022 at 07:25)</a>:</h4>
<p>the idea is to limit what has to stick around in the reader's head all at once</p>



<a name="277249173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277249173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277249173">(Mar 31 2022 at 08:38)</a>:</h4>
<p>Mario I think that what's happening here is that the kind of maths you've seen formalised is of a different nature to the kind of maths Patrick and Sebastien are talking about.</p>



<a name="277250504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277250504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277250504">(Mar 31 2022 at 08:50)</a>:</h4>
<p>Perhaps. The proof of the prime number theorem was on similar levels of hairy though, so I'm not really convinced</p>



<a name="277251091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277251091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277251091">(Mar 31 2022 at 08:55)</a>:</h4>
<p>The prime number theorem is undergraduate mathematics (at my university).</p>



<a name="277251159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277251159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277251159">(Mar 31 2022 at 08:56)</a>:</h4>
<p>yes, it's "elementary"</p>



<a name="277251169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277251169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277251169">(Mar 31 2022 at 08:56)</a>:</h4>
<p>doesn't make it a small proof though</p>



<a name="277251225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277251225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277251225">(Mar 31 2022 at 08:57)</a>:</h4>
<p>it ended up as something like 23 numbered lemmas in order with ~20 hypotheses in most of them</p>



<a name="277258710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277258710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277258710">(Mar 31 2022 at 10:11)</a>:</h4>
<p>I agree it doesn't make it a small proof. But it might make it a conceptually simpler proof somehow. I think this is a very interesting question. I finished my course with a proof of the Hilbert Basis Theorem and, just like Sebastien was saying, beyond some point it's extremely difficult to start factoring out sublemmas; you could I guess just do <code>extract_goal</code> at some arbitrary point but then you will end up with single-use very ugly lemmas; beyond some point in history, delicate and complex arguments became more commonplace. Whether or not things scale is something we'll find out soon enough, I suspect.</p>



<a name="277259485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277259485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277259485">(Mar 31 2022 at 10:20)</a>:</h4>
<p>It's not even clear it scales for mathematicians. I mean, papers of 100 pages doing one single proof are not uncommon today, and essentially no-one can check these seriously.</p>



<a name="277259750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277259750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277259750">(Mar 31 2022 at 10:23)</a>:</h4>
<p>I had a good experience with CoqIDE's curtain, as Patrick called it. It felt particularly good when I was reading a Coq book (from the Software Foundations series) in it because it helped me with a sense of progression. The only problem was that it didn't save my progress and then I had to remember where I was and re-run it everytime I closed CoqIDE, so I ended up leaving it open (and idle) for several hours.</p>
<p>I think the best solution would aggregate the best of both worlds in a on/off toggle fashion. For common programming tasks I prefer Lean to just eat up the entire file everytime I change something. But for heavy typechecking tasks, such as advanced mathematics, there might exist advantages of having cached states in between tactics so Lean doesn't have to compile the same thing over and over.</p>



<a name="277259903"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277259903" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277259903">(Mar 31 2022 at 10:25)</a>:</h4>
<p>I think that even if the best you can do is <code>extract_goal</code> this is still useful in the sense that it keeps the context bounded in size and you can choose optimal cut-points to keep things manageable</p>



<a name="277259920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277259920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277259920">(Mar 31 2022 at 10:25)</a>:</h4>
<p>the lemma might have no useful name, that's okay</p>



<a name="277260038"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277260038" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277260038">(Mar 31 2022 at 10:26)</a>:</h4>
<p>I mean, if the process of making definitions for groups of stuff helps you discover a new concept, great, but it's a useful exercise even if it's just <code>lemma_1, foo.aux_2</code> stuff</p>



<a name="277260058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277260058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277260058">(Mar 31 2022 at 10:27)</a>:</h4>
<p>I was getting odd sense of satisfaction for every line that turned green in Coq and I was missing that when I switched to Lean :)</p>



<a name="277260171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277260171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277260171">(Mar 31 2022 at 10:28)</a>:</h4>
<p>And to be clear, I am not at all against checkpointing within a proof, if we can find a way around the technical hurdles. That's a straight win. But it is in service of proofs I would not consider "good"</p>



<a name="277260240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277260240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277260240">(Mar 31 2022 at 10:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277259903">said</a>:</p>
<blockquote>
<p>I think that even if the best you can do is <code>extract_goal</code> this is still useful in the sense that it keeps the context bounded in size and you can choose optimal cut-points to keep things manageable</p>
</blockquote>
<p>Might have been my lack of skill, but I've had troubles with <code>extract_goal</code> when there were metavariables involved</p>



<a name="277260279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277260279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277260279">(Mar 31 2022 at 10:29)</a>:</h4>
<p>yes, checkpointing has the same issues</p>



<a name="277260296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277260296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277260296">(Mar 31 2022 at 10:29)</a>:</h4>
<p>if you want to be able to checkpoint at an arbitrary position, at least</p>



<a name="277260421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277260421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277260421">(Mar 31 2022 at 10:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277259750">said</a>:</p>
<blockquote>
<p>I think the best solution would aggregate the best of both worlds. For common programming tasks I prefer Lean to just eat up the entire file everytime I change something. But for heavy typechecking tasks, such as advanced mathematics, there might exist advantages of having cached states in between tactics so Lean doesn't have to compile the same thing over and over.</p>
</blockquote>
<p>I'm not sure I understand your distinction. "Should we check the entirety of the remaining file on each change" (which is the only mode in Lean 4 mainly because of limitations in editor implementations of LSP) and "can we restore a tactic's state when the change is strictly below it" are essentially orthogonal issues.</p>



<a name="277260503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277260503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277260503">(Mar 31 2022 at 10:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="346070">Tomas Skrivan</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277260058">said</a>:</p>
<blockquote>
<p>I was getting odd sense of satisfaction for every line that turned green in Coq and I was missing that when I switched to Lean :)</p>
</blockquote>
<p>Moving from an orange bar for the non-processed parts to a green bar for the processed parts would be a comparatively trivial change :) . IIRC Isabelle/jEdit does this?</p>



<a name="277260727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277260727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277260727">(Mar 31 2022 at 10:34)</a>:</h4>
<p>I see. Let me rephrase it: I think it would be nice to have an option to toggle the automatic processing on and off. But I didn't know it was a limitation of VS Code.</p>



<a name="277261047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277261047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277261047">(Mar 31 2022 at 10:38)</a>:</h4>
<p>Yeah, this would unfortunately mean that the semantic highlighting and other metadata would never update</p>



<a name="277261210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277261210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277261210">(Mar 31 2022 at 10:40)</a>:</h4>
<p>I wish it wasn't so laboriously boring to develop our own IDE <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="277368250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277368250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277368250">(Apr 01 2022 at 03:57)</a>:</h4>
<p>We pushed the <code>checkpoint</code> tactic, but it is very experimental, and we don't have an infrastructure for testing it in the CI yet. <br>
The test file based on <span class="user-mention" data-user-id="346070">@Tomas Skrivan</span>'s example looks more responsive now</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">A</span> <span class="o">(</span><span class="n">n</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span>
<span class="kd">instance</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">A</span> <span class="mi">0</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:=</span> <span class="o">⟨⟩</span>
<span class="kd">instance</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">[</span><span class="n">A</span> <span class="n">n</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span> <span class="o">:</span> <span class="n">A</span> <span class="o">(</span><span class="n">n</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:=</span> <span class="o">⟨⟩</span>
<span class="kd">theorem</span> <span class="n">foo</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">[</span><span class="n">A</span> <span class="mi">4000</span> <span class="n">a</span> <span class="n">b</span><span class="o">]</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">set_option</span> <span class="n">synthInstance.maxHeartbeats</span> <span class="mi">500000</span>
<span class="kd">set_option</span> <span class="n">synthInstance.maxSize</span> <span class="mi">100000</span>
<span class="kd">set_option</span> <span class="n">maxRecDepth</span> <span class="mi">10000</span>

<span class="kd">set_option</span> <span class="n">trace.Meta.debug</span> <span class="n">true</span>
<span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">4</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">checkpoint</span>
    <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">checkpoint</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">trace</span> <span class="s2">"hello world"</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">Nat.add_comm</span><span class="o">]</span>
</code></pre></div>



<a name="277387997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277387997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277387997">(Apr 01 2022 at 09:02)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span>  Really cool, it works! Unfortunately it is a bit inconsistent. When you modify the string in the example to <code>"hello world123456789"</code> one character at a time you get quick response on odd numbers but slow on even numbers.</p>



<a name="277402464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277402464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277402464">(Apr 01 2022 at 11:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112857">Leonardo de Moura</span> <a href="#narrow/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file/near/277368250">said</a>:</p>
<blockquote>
<p>We pushed the <code>checkpoint</code> tactic, but it is very experimental</p>
</blockquote>
<p>Oh wow! This is a biggie IMO <span aria-label="heart" class="emoji emoji-2764" role="img" title="heart">:heart:</span></p>



<a name="277412804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277412804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277412804">(Apr 01 2022 at 12:55)</a>:</h4>
<p><span class="user-mention" data-user-id="346070">@Tomas Skrivan</span> I pushed a fix. Could you please try again?</p>



<a name="277417075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277417075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277417075">(Apr 01 2022 at 13:26)</a>:</h4>
<p><span class="user-mention" data-user-id="112857">@Leonardo de Moura</span>  Great! works as expected now!</p>
<p>Few problems when you modify in between checkpoints. This might be important when you have already complicated proof done, but you have to modify it due to some changes above.</p>
<p>Here the tracing message does not update when you modify it. (probably because tracing does not change the state)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">4</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">checkpoint</span>
    <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">trace</span> <span class="s2">"hello world123456789"</span>
  <span class="n">checkpoint</span>
    <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">Nat.add_comm</span><span class="o">]</span>
</code></pre></div>
<p>Something that changes state has to wait until all the following tactics are finished. Here modifying <code>enter [1]</code> has to wait for the second <code>rw[foo]</code></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">4</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">checkpoint</span>
    <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">conv</span> <span class="bp">=&gt;</span>
    <span class="n">enter</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">]</span>
  <span class="n">checkpoint</span>
    <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">Nat.add_comm</span><span class="o">]</span>
</code></pre></div>
<p>Of course, the solution is to comment out the rest. Is this a limitation of LSP, the state can't be updated until the whole command is processed?</p>



<a name="277418086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277418086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Leonardo de Moura <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277418086">(Apr 01 2022 at 13:33)</a>:</h4>
<p>What about the following hack?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">macro</span> <span class="s2">"stop"</span> <span class="n">s</span><span class="o">:</span><span class="n">tacticSeq</span> <span class="o">:</span> <span class="n">tactic</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">repeat</span> <span class="gr">sorry</span><span class="o">)</span>
</code></pre></div>
<p>Then, you put the <code>stop</code> before the second <code>checkpoint</code>.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">*</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">4</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">checkpoint</span>
    <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">conv</span> <span class="bp">=&gt;</span>
    <span class="n">enter</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">]</span>
  <span class="n">stop</span>
  <span class="n">checkpoint</span>
    <span class="n">rw</span><span class="o">[</span><span class="n">foo</span><span class="o">]</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">Nat.add_comm</span><span class="o">]</span>
</code></pre></div>



<a name="277453225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partial%20evaluation%20of%20a%20file/near/277453225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Tomas Skrivan <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partial.20evaluation.20of.20a.20file.html#277453225">(Apr 01 2022 at 17:36)</a>:</h4>
<p>Using <code>stop</code> is a lot less messy then commenting and uncommenting the remainder of the proof. I will play around with it see how comfortable it is to use.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>