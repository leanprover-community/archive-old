---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html">[RFC] Line Comment Change</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="258221021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258221021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258221021">(Oct 19 2021 at 15:58)</a>:</h4>
<p>I would like to propose the Lean 4 change the token used to start line comments from <code>--</code> to something else. I would suggest <code>#-</code> or <code>#/</code>, and I would lean towards the former. I know this would be  a somewhat radical change, so I can understand if it is rejected quickly. However, despite it being a rather fundamental change, it would still be rather easy to migrate to (e.g., just Find/Replace <code>--</code> to <code>#-</code>).</p>
<p>I have to big reasons for suggesting this:</p>
<ul>
<li>To allow the use of <code>--</code> for <code>Nat.sub</code>(paralleling <code>//</code> for integer division) -- see <a href="https://github.com/leanprover/lean4/issues/433">#433</a></li>
<li>To allow the use of <code>--</code> in DSLs that need it (e.g., a  CLI DSL that uses <code>--</code> for options)</li>
</ul>
<p>What do people think of this idea / proposal?</p>



<a name="258221708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258221708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258221708">(Oct 19 2021 at 16:01)</a>:</h4>
<p>For me it is more important that <code>--</code> (the comment) is easy to type.  For <code>Nat.sub</code>, we could use <code>∸</code> or <code>.-</code>.  Command-line argument parser DSLs are really a niche use case.</p>



<a name="258222242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258222242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258222242">(Oct 19 2021 at 16:04)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> is <code>#-</code> really that much harder to type? I mean the two other most common line comment sequences are <code>#</code> and <code>//</code> which are not much different.</p>



<a name="258222455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258222455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258222455">(Oct 19 2021 at 16:05)</a>:</h4>
<p>Yes, significantly.  At least on a qwerty keyboard (and no I'm not going to learn a new keyboard layout for Lean....).<br>
<code>--</code> is two taps, on the same key<br>
<code>#-</code> is three taps, with two hands, on three different keys</p>



<a name="258222749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258222749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258222749">(Oct 19 2021 at 16:07)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> the CLI DSL is an example from an actual use case (Lake) where I would like tto do things like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">sys</span><span class="bp">%</span> <span class="n">git</span> <span class="n">submodule</span> <span class="n">update</span> <span class="c1">--init src/lake</span>
</code></pre></div>
<p>in scripts to run external processes.</p>



<a name="258222928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258222928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258222928">(Oct 19 2021 at 16:08)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change/near/258222455">said</a>:</p>
<blockquote>
<p>Yes, significantly.  At least on a qwerty keyboard (and no I'm not going to learn a new keyboard layout for Lean....).<br>
<code>--</code> is two taps, on the same key<br>
<code>#-</code> is three taps, with two hands, on three different keys</p>
</blockquote>
<p>What about <code>#</code> and <code>//</code> though (the by far more common line comment starters):<br>
<code>#</code>: two taps, two hands, two different keys<br>
<code>//</code>: four taps,  one hand, two different keys</p>



<a name="258223005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258223005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258223005">(Oct 19 2021 at 16:08)</a>:</h4>
<p>You could also write this as <code>sys"git submodule update --init src/lake"</code>.</p>



<a name="258223037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258223037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258223037">(Oct 19 2021 at 16:08)</a>:</h4>
<p>Huh? <code>/</code> is a single keypress on qwerty.</p>



<a name="258223053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258223053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258223053">(Oct 19 2021 at 16:09)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> the point is to parse the command....</p>



<a name="258223146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258223146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258223146">(Oct 19 2021 at 16:09)</a>:</h4>
<p>I'm not sure I understand.  Is <code>git</code> a variable?</p>



<a name="258223178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258223178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258223178">(Oct 19 2021 at 16:09)</a>:</h4>
<p>That way I can do things like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">cd</span> <span class="n">sources</span><span class="bp">/</span><span class="n">lean4</span> <span class="bp">&amp;&amp;</span> <span class="n">rm</span> <span class="bp">-</span><span class="n">rf</span> <span class="n">build</span> <span class="bp">&amp;&amp;</span> <span class="n">mkdir</span> <span class="bp">-</span><span class="n">p</span> <span class="n">build</span><span class="bp">/</span><span class="n">release</span> <span class="bp">&amp;&amp;</span> <span class="n">cd</span> <span class="n">build</span><span class="bp">/</span><span class="n">release</span>
</code></pre></div>
<p>and have it uses Lean utilities for <code>cd</code>, <code>rm</code>, and <code>mkdir</code> (and perform the commands in sequence)</p>



<a name="258223320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258223320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258223320">(Oct 19 2021 at 16:10)</a>:</h4>
<p>Reusing Lean's tokenizer for DSLs is fundamentally flawed. Fixing that is however not trivial.</p>



<a name="258223454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258223454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258223454">(Oct 19 2021 at 16:11)</a>:</h4>
<p>If you want to reuse the tokenizer, you could do windows-style</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">cd</span> <span class="n">sources</span><span class="bp">/</span><span class="n">lean4</span> <span class="bp">&amp;&amp;</span> <span class="n">rm</span> <span class="bp">/</span><span class="n">rf</span> <span class="n">build</span> <span class="bp">&amp;&amp;</span> <span class="n">mkdir</span> <span class="bp">/</span><span class="n">p</span> <span class="n">build</span><span class="bp">/</span><span class="n">release</span> <span class="bp">&amp;&amp;</span> <span class="n">cd</span> <span class="n">build</span><span class="bp">/</span><span class="n">release</span>
</code></pre></div>



<a name="258223531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258223531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258223531">(Oct 19 2021 at 16:11)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> lol, true, but I would kind of like to keep Unix syntax (since that is what everyone likes)</p>



<a name="258223803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258223803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258223803">(Oct 19 2021 at 16:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change/near/258223037">said</a>:</p>
<blockquote>
<p>Huh? <code>/</code> is a single keypress on qwerty.</p>
</blockquote>
<p>oops, for some reason, despite looking at my key, I was stuck with the belief it needed two keys. I think it may be due to the fact that I usually use <code>Ctrl+/</code> for comments in editors.</p>



<a name="258224263"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258224263" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258224263">(Oct 19 2021 at 16:15)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> I still also confused why the line comment needs to be especially quick to enter -- what is the use case there?</p>



<a name="258224378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258224378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258224378">(Oct 19 2021 at 16:16)</a>:</h4>
<p>I'm typing it more often than command-line arguments, that's all.</p>



<a name="258224647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258224647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258224647">(Oct 19 2021 at 16:17)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>  I would think the the comments starts would be token sequence you want to be a bit obscure in a language with flexible syntax as eats up any possibility of using that sequence in DSLs / general notation.</p>



<a name="258224909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258224909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258224909">(Oct 19 2021 at 16:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change/near/258223320">said</a>:</p>
<blockquote>
<p>Reusing Lean's tokenizer for DSLs is fundamentally flawed. Fixing that is however not trivial.</p>
</blockquote>
<p>Is there any other way to (feasibly) do it in the current setup?</p>



<a name="258225753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258225753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258225753">(Oct 19 2021 at 16:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change/near/258222455">said</a>:</p>
<blockquote>
<p><code>--</code> is two taps, on the same key</p>
</blockquote>
<p>An alternative sequence that could keep this property and also still be a bit obscure (i.e., unlikely to be used elsewhere) is <code>;;</code> (or , to a lesser extent,<code>[[</code>).</p>



<a name="258226856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258226856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258226856">(Oct 19 2021 at 16:30)</a>:</h4>
<p>No matter how we change the lexical syntax of the comments, it will always clash with some potential application.  There is no way around that.  Changing the comment syntax won't solve the problem, it will just shift it with a lot of churn.</p>



<a name="258226864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258226864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258226864">(Oct 19 2021 at 16:30)</a>:</h4>
<p>In this case, the nicest and cleanest solution would be if we could plug in a custom parser that doesn't strip comments.  This is useful for a lot of DSLs where you want to copy&amp;paste code from another language into a lean file (<code>--</code> clashes with HTML, <code>;;</code> clashes with c, <code>[[</code> clashes with lua, <code>#/</code> clashes with javascript, <code>#-</code> clashes with lisp, ...)</p>



<a name="258227027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258227027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258227027">(Oct 19 2021 at 16:31)</a>:</h4>
<p>Another productive suggestion would be to use the power of Unicode to switch to different dashes: ‒, –, —, ―<br>
We use this technique extensively in mathlib (we run out of arrows all the time).</p>



<a name="258227297"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258227297" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258227297">(Oct 19 2021 at 16:32)</a>:</h4>
<p>It might be sufficient to move <code>Lean.Parser.whitespace</code> into the parser context for some initial customizability. But I don't really want to think about it right now...</p>



<a name="258227607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258227607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258227607">(Oct 19 2021 at 16:34)</a>:</h4>
<p>BTW: for those of you who didn't get the reference: <a href="https://wiki.haskell.org/Wadler%27s_Law">https://wiki.haskell.org/Wadler%27s_Law</a></p>



<a name="258229451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258229451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258229451">(Oct 19 2021 at 16:45)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> lol. I would argue that the hierarchy  is probably derived from the level of control a user has to customize those elements to their preferences. In most languages, semantics are easily customizable, syntax less so, lexical syntax even less so, and  comments generally not at all.</p>



<a name="258229729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%5BRFC%5D%20Line%20Comment%20Change/near/258229729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.5BRFC.5D.20Line.20Comment.20Change.html#258229729">(Oct 19 2021 at 16:46)</a>:</h4>
<p>Lean currently does a very good job of making both semantics and syntax highly customizable, but still has a number of limits on lexical syntax and comments. Your suggestion would potential alleviate some of the later though.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>