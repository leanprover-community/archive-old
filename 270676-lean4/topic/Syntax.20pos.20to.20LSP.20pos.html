---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html">Syntax pos to LSP pos</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="310623959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310623959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310623959">(Nov 17 2022 at 14:49)</a>:</h4>
<p>Hmm, I am still banging my head against using the <code>EditorApi</code>for what I want to do; mostly about generating <code>insertText()</code>’s third parameter   of type  <code>TextDocumentPositionParams</code>. Currently I am using this code in lean to get my hands on a LSP-compatible position and pass it to JS</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">#</span><span class="n">edit</span> <span class="bp">$</span><span class="n">tm</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="k">do</span>
    <span class="k">let</span> <span class="n">s</span> <span class="bp">←</span> <span class="k">match</span> <span class="n">Lean.Syntax.reprint</span> <span class="n">tm</span> <span class="k">with</span>
      <span class="bp">|</span> <span class="n">some</span> <span class="n">s</span> <span class="bp">=&gt;</span> <span class="n">pure</span> <span class="n">s</span>
      <span class="bp">|</span> <span class="n">none</span> <span class="bp">=&gt;</span> <span class="n">throwUnsupportedSyntax</span>
    <span class="k">let</span> <span class="n">r</span> <span class="bp">←</span> <span class="k">match</span> <span class="n">Lean.Syntax.getRange</span><span class="bp">?</span> <span class="n">tm</span> <span class="k">with</span>
      <span class="bp">|</span> <span class="n">some</span> <span class="n">r</span> <span class="bp">=&gt;</span> <span class="n">pure</span> <span class="n">r</span>
      <span class="bp">|</span> <span class="n">none</span> <span class="bp">=&gt;</span> <span class="n">throwUnsupportedSyntax</span>
    <span class="k">let</span> <span class="n">fm</span> <span class="o">:=</span> <span class="n">s.toFileMap</span>
    <span class="k">let</span> <span class="n">lp</span> <span class="o">:=</span> <span class="n">String.Range.toLspRange</span> <span class="n">fm</span> <span class="n">r</span>
    <span class="n">dbg_trace</span> <span class="s2">"lp: {toJson lp.start}"</span>
    <span class="n">saveWidgetInfo</span> <span class="bp">`</span><span class="n">insertTextWidget</span> <span class="o">(</span><span class="n">Json.mkObj</span> <span class="o">[(</span><span class="s2">"pos"</span><span class="o">,</span> <span class="n">toJson</span> <span class="n">lp.start</span><span class="o">)])</span> <span class="n">tm</span>
</code></pre></div>
<p>but there are two problems</p>
<ul>
<li><code>TextDocumentPositionParams</code> needs a <code>uri</code>. For a while I thought this <code>pos</code> actually included and <code>uri</code> field, but it somehow disappeared later… so not sure about that</li>
<li>The <code>toLspRange</code> produces <code>{"line": 1, "character": 1255}</code>, i.e. does not take line counts into account, which is not really correct (i.e. if I manually specify the <code>uri</code> in the JS side of things, it does insert things but in the second column)</li>
</ul>
<p>Is there a more principled way to connect lean’s <code>Syntax</code> markers with LSP’s <code>TextDocumentPositionParams</code>?<br>
Or maybe easier to do it all from lean somehow, once there are functions exposed to the lean world that allow me to edit the text? (Pinging <span class="user-mention" data-user-id="121918">@Edward Ayers</span> again if that's ok)</p>



<a name="310627554"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310627554" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310627554">(Nov 17 2022 at 15:07)</a>:</h4>
<p>Answering the parts I know about (i.e. nothing about widgets per se):</p>
<ul>
<li>The elaborator doesn't know about the document URI, yes. This information only exists in the server data structures. I'm not aware of a way to access it from an elaborator (which generally is oblivious to the potential existence of a server).</li>
<li>You can however hackishly recover the document contents via</li>
</ul>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="k">let</span> <span class="bp">.</span><span class="n">original</span> <span class="n">pre</span> <span class="bp">..</span> <span class="o">:=</span> <span class="n">stx.getHeadInfo</span> <span class="bp">|</span> <span class="n">panic</span><span class="bp">!</span> <span class="s2">"expected input syntax"</span>
  <span class="k">let</span> <span class="n">s</span> <span class="o">:=</span> <span class="n">pre.str</span>
</code></pre></div>
<p>This should give you correct output for <code>toLspRange</code> in contrast to <code>reprint</code></p>



<a name="310627828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310627828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310627828">(Nov 17 2022 at 15:08)</a>:</h4>
<p>Doing anything document-related in a server handler would definitely be better, yeah</p>



<a name="310628122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310628122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310628122">(Nov 17 2022 at 15:10)</a>:</h4>
<p>Is “replace a range in the document with a given string” already a kind of “anything” that one can do from the server?</p>



<a name="310628867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310628867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310628867">(Nov 17 2022 at 15:13)</a>:</h4>
<p>Thanks for the code! Indeed now I get the right coordinates.</p>



<a name="310629406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310629406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310629406">(Nov 17 2022 at 15:16)</a>:</h4>
<p>You can do that from the server by making an LSP request to <a href="https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#workspace_applyEdit"><code>workspace/applyEdit</code></a>. The problem is that at the moment there is no api in Lean for making server → client editor requests.</p>



<a name="310629524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310629524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310629524">(Nov 17 2022 at 15:17)</a>:</h4>
<p>So in order to do a text edit from a server you need to muck around piping lsp requests to an IO stream.</p>



<a name="310629553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310629553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310629553">(Nov 17 2022 at 15:17)</a>:</h4>
<p>Also /cc <span class="user-mention" data-user-id="110789">@Jakob von Raumer</span> who just had a student working on that topic (<del>but using client-side edits afair</del>)</p>



<a name="310630003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310630003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310630003">(Nov 17 2022 at 15:20)</a>:</h4>
<p>I feel slightly crazy. I am very certain that with an earlier version of the code, I saw an <code>uri</code> argument in the data that I somehow extracted from the <code>Syntax</code>, but it disappeared.</p>



<a name="310630374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310630374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310630374">(Nov 17 2022 at 15:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="121918">Edward Ayers</span> <a href="#narrow/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos/near/310629524">said</a>:</p>
<blockquote>
<p>So in order to do a text edit from a server you need to muck around piping lsp requests to an IO stream.</p>
</blockquote>
<p><code>writeLspRequest</code> should just work from the server side as well, no? The server will crash on receiving unexpected responses from the client, but for a prototype I guess we can just discard them instead...</p>



<a name="310630650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310630650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310630650">(Nov 17 2022 at 15:23)</a>:</h4>
<p>/cc <span class="user-mention" data-user-id="497000">@Robin Böhne</span></p>



<a name="310630678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310630678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310630678">(Nov 17 2022 at 15:23)</a>:</h4>
<p>This is the code Robin wrote: <a href="https://github.com/leanprover/lean4/compare/master...KaseQuark:lean4:master">https://github.com/leanprover/lean4/compare/master...KaseQuark:lean4:master</a></p>



<a name="310633043"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310633043" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310633043">(Nov 17 2022 at 15:25)</a>:</h4>
<p>Is that an interactive <code>conv</code> mode tatic assembler  UI? Neat!</p>
<p>It looks like that needs a similar infrastructure than what I want to build right now. So if that still needs extra plumbing, maybe I’ll wait for that code to be merged and then build on top of that :-)</p>



<a name="310634859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310634859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310634859">(Nov 17 2022 at 15:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="470149">Joachim Breitner</span> <a href="#narrow/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos/near/310633043">said</a>:</p>
<blockquote>
<p>Is that an interactive <code>conv</code> mode tatic assembler  UI? Neat!</p>
</blockquote>
<p>Yes! It's working perfectly, just needs a bit of clean-up and to be PRed</p>



<a name="310642955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310642955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310642955">(Nov 17 2022 at 16:09)</a>:</h4>
<p><span class="user-mention" data-user-id="121918">@Edward Ayers</span>  Trying to use [<code>applyEdit</code>](<a href="https://github.com/leanprover/vscode-lean4/blob/1edd92230c7630627f18dbe76cd139903a4cbcee/lean4-infoview-api/src/infoviewApi.ts#L55]">https://github.com/leanprover/vscode-lean4/blob/1edd92230c7630627f18dbe76cd139903a4cbcee/lean4-infoview-api/src/infoviewApi.ts#L55]</a> instead of <code>insertText</code> now, but I get <code>this.methods[i] is not a function</code> with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">TypeError</span><span class="o">:</span> <span class="n">this.methods</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="n">is</span> <span class="n">not</span> <span class="n">a</span> <span class="n">function</span>
    <span class="n">at</span> <span class="n">t.Rpc.</span><span class="bp">&lt;</span><span class="n">anonymous</span><span class="bp">&gt;</span> <span class="o">(</span><span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">jojo</span><span class="bp">/.</span><span class="n">vscode</span><span class="bp">/</span><span class="n">extensions</span><span class="bp">/</span><span class="n">leanprover.lean4</span><span class="bp">-</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">95</span><span class="bp">/</span><span class="n">dist</span><span class="bp">/</span><span class="n">extension.js</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">497315</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Generator.next</span> <span class="o">(</span><span class="bp">&lt;</span><span class="n">anonymous</span><span class="bp">&gt;</span><span class="o">)</span>
    <span class="n">at</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">jojo</span><span class="bp">/.</span><span class="n">vscode</span><span class="bp">/</span><span class="n">extensions</span><span class="bp">/</span><span class="n">leanprover.lean4</span><span class="bp">-</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">95</span><span class="bp">/</span><span class="n">dist</span><span class="bp">/</span><span class="n">extension.js</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">496341</span>
    <span class="n">at</span> <span class="n">new</span> <span class="n">Promise</span> <span class="o">(</span><span class="bp">&lt;</span><span class="n">anonymous</span><span class="bp">&gt;</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">n</span> <span class="o">(</span><span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">jojo</span><span class="bp">/.</span><span class="n">vscode</span><span class="bp">/</span><span class="n">extensions</span><span class="bp">/</span><span class="n">leanprover.lean4</span><span class="bp">-</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">95</span><span class="bp">/</span><span class="n">dist</span><span class="bp">/</span><span class="n">extension.js</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">496086</span><span class="o">)</span>
    <span class="n">at</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">jojo</span><span class="bp">/.</span><span class="n">vscode</span><span class="bp">/</span><span class="n">extensions</span><span class="bp">/</span><span class="n">leanprover.lean4</span><span class="bp">-</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">95</span><span class="bp">/</span><span class="n">dist</span><span class="bp">/</span><span class="n">extension.js</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">497222</span>
    <span class="n">at</span> <span class="n">t.Rpc.messageReceived</span> <span class="o">(</span><span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">jojo</span><span class="bp">/.</span><span class="n">vscode</span><span class="bp">/</span><span class="n">extensions</span><span class="bp">/</span><span class="n">leanprover.lean4</span><span class="bp">-</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">95</span><span class="bp">/</span><span class="n">dist</span><span class="bp">/</span><span class="n">extension.js</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">497382</span><span class="o">)</span>
    <span class="n">at</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">jojo</span><span class="bp">/.</span><span class="n">vscode</span><span class="bp">/</span><span class="n">extensions</span><span class="bp">/</span><span class="n">leanprover.lean4</span><span class="bp">-</span><span class="mi">0</span><span class="bp">.</span><span class="mi">0</span><span class="bp">.</span><span class="mi">95</span><span class="bp">/</span><span class="n">dist</span><span class="bp">/</span><span class="n">extension.js</span><span class="o">:</span><span class="mi">2</span><span class="o">:</span><span class="mi">479116</span>
    <span class="n">at</span> <span class="n">w.invoke</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">145</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">v.deliver</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">2266</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">p.fire</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">1844</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">d.</span><span class="bp">$</span><span class="n">onMessage</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">87</span><span class="o">:</span><span class="mi">186534</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">s._doInvokeHandler</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">95</span><span class="o">:</span><span class="mi">13708</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">s._invokeHandler</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">95</span><span class="o">:</span><span class="mi">13390</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">s._receiveRequest</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">95</span><span class="o">:</span><span class="mi">12159</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">s._receiveOneMessage</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">95</span><span class="o">:</span><span class="mi">11056</span><span class="o">)</span>
    <span class="n">at</span> <span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">95</span><span class="o">:</span><span class="mi">8957</span>
    <span class="n">at</span> <span class="n">w.invoke</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">145</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">v.deliver</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">2266</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">p.fire</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">1844</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">a.fire</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">69</span><span class="o">:</span><span class="mi">18976</span><span class="o">)</span>
    <span class="n">at</span> <span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">111</span><span class="o">:</span><span class="mi">34679</span>
    <span class="n">at</span> <span class="n">w.invoke</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">145</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">v.deliver</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">2266</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">p.fire</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">1844</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">a.fire</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">69</span><span class="o">:</span><span class="mi">18976</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">r._receiveMessage</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">69</span><span class="o">:</span><span class="mi">23563</span><span class="o">)</span>
    <span class="n">at</span> <span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">69</span><span class="o">:</span><span class="mi">21097</span>
    <span class="n">at</span> <span class="n">w.invoke</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">145</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">v.deliver</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">2266</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">p.fire</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">61</span><span class="o">:</span><span class="mi">1844</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">p.acceptChunk</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">69</span><span class="o">:</span><span class="mi">15807</span><span class="o">)</span>
    <span class="n">at</span> <span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">69</span><span class="o">:</span><span class="mi">14937</span>
    <span class="n">at</span> <span class="n">Socket.R</span> <span class="o">(</span><span class="bp">/</span><span class="n">nix</span><span class="bp">/</span><span class="n">store</span><span class="bp">/</span><span class="mi">8</span><span class="n">ybggqbzhpmj6ax299x7kz9b53861frx</span><span class="bp">-</span><span class="n">vscode</span><span class="bp">-</span><span class="mi">1</span><span class="bp">.</span><span class="mi">69</span><span class="bp">.</span><span class="mi">2</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">vscode</span><span class="bp">/</span><span class="n">resources</span><span class="bp">/</span><span class="n">app</span><span class="bp">/</span><span class="n">out</span><span class="bp">/</span><span class="n">vs</span><span class="bp">/</span><span class="n">workbench</span><span class="bp">/</span><span class="n">api</span><span class="bp">/</span><span class="n">node</span><span class="bp">/</span><span class="n">extensionHostProcess.js</span><span class="o">:</span><span class="mi">111</span><span class="o">:</span><span class="mi">13763</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Socket.emit</span> <span class="o">(</span><span class="n">node</span><span class="o">:</span><span class="n">events</span><span class="o">:</span><span class="mi">390</span><span class="o">:</span><span class="mi">28</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">addChunk</span> <span class="o">(</span><span class="n">node</span><span class="o">:</span><span class="n">internal</span><span class="bp">/</span><span class="n">streams</span><span class="bp">/</span><span class="n">readable</span><span class="o">:</span><span class="mi">315</span><span class="o">:</span><span class="mi">12</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">readableAddChunk</span> <span class="o">(</span><span class="n">node</span><span class="o">:</span><span class="n">internal</span><span class="bp">/</span><span class="n">streams</span><span class="bp">/</span><span class="n">readable</span><span class="o">:</span><span class="mi">289</span><span class="o">:</span><span class="mi">9</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Socket.Readable.push</span> <span class="o">(</span><span class="n">node</span><span class="o">:</span><span class="n">internal</span><span class="bp">/</span><span class="n">streams</span><span class="bp">/</span><span class="n">readable</span><span class="o">:</span><span class="mi">228</span><span class="o">:</span><span class="mi">10</span><span class="o">)</span>
    <span class="n">at</span> <span class="n">Pipe.onStreamRead</span> <span class="o">(</span><span class="n">node</span><span class="o">:</span><span class="n">internal</span><span class="bp">/</span><span class="n">stream_base_commons</span><span class="o">:</span><span class="mi">199</span><span class="o">:</span><span class="mi">23</span><span class="o">)</span>
</code></pre></div>
<p>so does this mean that this function isn’t fully implemented yet, or am I doing something stupid?</p>



<a name="310643257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310643257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310643257">(Nov 17 2022 at 16:10)</a>:</h4>
<p><span class="user-mention" data-user-id="470149">@Joachim Breitner</span> could you by any chance share your widget code?</p>



<a name="310643427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310643427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310643427">(Nov 17 2022 at 16:11)</a>:</h4>
<p>Let me create a repo…</p>



<a name="310643774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310643774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310643774">(Nov 17 2022 at 16:13)</a>:</h4>
<p><a href="https://github.com/nomeata/lean4-interactive-tactic">https://github.com/nomeata/lean4-interactive-tactic</a></p>



<a name="310643946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310643946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310643946">(Nov 17 2022 at 16:13)</a>:</h4>
<p>The URL to the edited file is hardcoded in the <code>.ts</code> code :-)</p>



<a name="310644236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310644236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310644236">(Nov 17 2022 at 16:15)</a>:</h4>
<p>Give me a few minutes, i will try to reproduce the error</p>



<a name="310645726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310645726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310645726">(Nov 17 2022 at 16:22)</a>:</h4>
<p><a href="https://github.com/leanprover/lean4/pull/1846">https://github.com/leanprover/lean4/pull/1846</a></p>



<a name="310650402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310650402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310650402">(Nov 17 2022 at 16:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="470149">Joachim Breitner</span> <a href="#narrow/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos/near/310643774">said</a>:</p>
<blockquote>
<p><a href="https://github.com/nomeata/lean4-interactive-tactic">https://github.com/nomeata/lean4-interactive-tactic</a></p>
</blockquote>
<p>(The pushed version might be missing <code>rollup.config.js</code>)</p>



<a name="310651272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310651272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310651272">(Nov 17 2022 at 16:49)</a>:</h4>
<p><span class="user-mention" data-user-id="470149">@Joachim Breitner</span> aha, I see what happened. Your link to <code>applyEdit</code> is for the current master branch of the infoview api, but it had not been published yet. If you look at the <code>.d.ts</code> that TypeScript gives you for <code>EditorApi</code>, that function is not there. We will need to make a new API release very soon, which will include this.</p>



<a name="310654703"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310654703" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310654703">(Nov 17 2022 at 17:04)</a>:</h4>
<p><span class="user-mention" data-user-id="470149">@Joachim Breitner</span> okay, while the <code>applyEdit</code> interface not-yet-having-been-published does result in type errors, secretly you <em>can</em> still use it because the <code>vscode-lean4</code> already includes the new code. The reason for that error was not a missing interface, it was a type error in your <code>changes</code> code :) Here is a version that works for me:</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">te</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">TextEdit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">range</span><span class="o">:</span><span class="w"> </span><span class="kt">props.range</span><span class="p">,</span><span class="w"> </span><span class="nx">newText</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">"hello"</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">changes</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">_</span><span class="o">:</span><span class="w"> </span><span class="kt">DocumentUri</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="nx">TextEdit</span><span class="p">[]</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span><span class="w"></span>
<span class="w">    </span><span class="nx">changes</span><span class="p">[</span><span class="nx">uri</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="nx">te</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">we</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">WorkspaceEdit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">changes</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>



<a name="310654782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310654782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310654782">(Nov 17 2022 at 17:04)</a>:</h4>
<p>And we can write</p>
<div class="codehilite" data-code-language="TypeScript"><pre><span></span><code><span class="w">    </span><span class="c1">// @ts-ignore</span><span class="w"></span>
<span class="w">    </span><span class="nx">editorConnection</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">applyEdit</span><span class="p">(</span><span class="nx">we</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>to ignore the type error.</p>



<a name="310674169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310674169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310674169">(Nov 17 2022 at 18:41)</a>:</h4>
<p>I should probably figure out how to use a git version of the infoview.<br>
I assume I need it both in <code>~/.vscode</code> somewhere, and also in my projects <code>package.json</code> so that TypeScript can typecheck it (which somehow didn’t work here)</p>



<a name="310674264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310674264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310674264">(Nov 17 2022 at 18:42)</a>:</h4>
<blockquote>
<p>(The pushed version might be missing rollup.config.js)</p>
</blockquote>
<p>Fixed, sorry.</p>



<a name="310685464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310685464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310685464">(Nov 17 2022 at 19:40)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> , trying your PR, but I am unsure how to call <code>applyWorkspaceEdit</code> from a <code>RequestM</code> (or if that’s even what I should do)<br>
(Can wait until tomorrow of course :-))</p>



<a name="310685818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310685818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310685818">(Nov 17 2022 at 19:42)</a>:</h4>
<p>The example I posted in the PR was inside RequestM afair</p>



<a name="310686328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310686328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310686328">(Nov 17 2022 at 19:45)</a>:</h4>
<p>Ah, I was thrown off by the <code>IO</code> type and the error message</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">type</span> <span class="n">mismatch</span>
  <span class="n">applyWorkspaceEdit</span> <span class="o">{</span> <span class="n">label</span><span class="bp">?</span> <span class="o">:=</span> <span class="n">none</span><span class="o">,</span> <span class="n">edit</span> <span class="o">:=</span> <span class="bp">?</span><span class="n">m.1743</span> <span class="o">}</span> <span class="n">ctxt.hOut</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">IO</span> <span class="n">Unit</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="n">RequestM</span> <span class="n">unit</span> <span class="o">:</span> <span class="kt">Type</span>
</code></pre></div>
<p>Lean beginner here :-)</p>



<a name="310687348"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310687348" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310687348">(Nov 17 2022 at 19:51)</a>:</h4>
<p><code>unit</code> looks suspicious :)</p>



<a name="310693835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310693835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310693835">(Nov 17 2022 at 20:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="470149">Joachim Breitner</span> <a href="#narrow/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos/near/310674169">said</a>:</p>
<blockquote>
<p>I should probably figure out how to use a git version of the infoview.<br>
I assume I need it both in <code>~/.vscode</code> somewhere, and also in my projects <code>package.json</code> so that TypeScript can typecheck it (which somehow didn’t work here)</p>
</blockquote>
<p>Do you mean using the a local copy of <code>@leanprover/infoview</code>? That would give you types for the new API but not much else, in particular it is unlikely to solve any TypeScript-not-compiling woes. I'm not sure what you mean about <code>~/.vscode</code>, but you shouldn't have to mess with that directory pretty much ever.</p>



<a name="310778137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310778137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310778137">(Nov 18 2022 at 09:29)</a>:</h4>
<blockquote>
<p>I'm not sure what you mean about ~/.vscode, but you shouldn't have to mess with that directory pretty much ever.</p>
</blockquote>
<p>What about <code>~/.vscode/extensions/leanprover.lean4-0.0.95/</code>? Is there no logic there that may be too old for some of these things we are trying to do here?</p>



<a name="310779817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310779817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310779817">(Nov 18 2022 at 09:39)</a>:</h4>
<p>Yay, I just updated a piece of source code from the InfoView! (still hard-coded file uri, but hey :-))</p>



<a name="310789772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310789772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310789772">(Nov 18 2022 at 10:37)</a>:</h4>
<p>Ok, next issue is that I kinda need to define a React component and pass it to the JS world. I am trying the very naive thing of passing JS code in the props to a generic widget, that tries to instantiate it, cargo-culting your code in<br>
<a href="https://github.com/nomeata/lean4-interactive-tactic/blob/30c7377899b1b0d4ce6e6203964db85f245ce65b/widget/src/widget.tsx#L17-L24">https://github.com/nomeata/lean4-interactive-tactic/blob/30c7377899b1b0d4ce6e6203964db85f245ce65b/widget/src/widget.tsx#L17-L24</a><br>
(but no caching etc.)<br>
I get errors, though, in the <code>import</code> line, namely</p>
<ul>
<li><a href="https://reactjs.org/docs/error-decoder.html/?invariant=31&amp;args[]=%5Bobject%20Promise%5D">https://reactjs.org/docs/error-decoder.html/?invariant=31&amp;args[]=%5Bobject%20Promise%5D</a></li>
<li><a href="https://reactjs.org/docs/error-decoder.html/?invariant=321">https://reactjs.org/docs/error-decoder.html/?invariant=321</a><br>
although I do get a module out it seems.</li>
</ul>
<p>Any hint what I might be doing wrong here?</p>



<a name="310789908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310789908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310789908">(Nov 18 2022 at 10:38)</a>:</h4>
<p>And is there an easy way to run the widget code (or all of code?) with a non-minimized React?</p>



<a name="310790376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310790376" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310790376">(Nov 18 2022 at 10:41)</a>:</h4>
<p>Can you try replacing <code>fun({})</code> with <code>e(fun, {})</code>?</p>



<a name="310790448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310790448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310790448">(Nov 18 2022 at 10:41)</a>:</h4>
<p>Also you can't have a react component be an async function</p>



<a name="310790588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310790588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310790588">(Nov 18 2022 at 10:42)</a>:</h4>
<p>Tried <code>e(</code>… but the errors already happen at <code>import </code>time.<br>
Ah, that’s useful information. I’ll try to not do that.</p>



<a name="310790635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310790635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310790635">(Nov 18 2022 at 10:42)</a>:</h4>
<p>You should wrap the async importing code in a React.lazy <a href="https://reactjs.org/docs/code-splitting.html#reactlazy">https://reactjs.org/docs/code-splitting.html#reactlazy</a></p>



<a name="310790978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310790978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310790978">(Nov 18 2022 at 10:44)</a>:</h4>
<p>Something like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">function</span> <span class="n">myLazyCode</span><span class="o">(</span><span class="n">code</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">return</span> <span class="n">React.lazy</span><span class="o">(</span><span class="n">async</span> <span class="o">()</span> <span class="bp">⇒</span> <span class="o">{</span>
    <span class="n">const</span> <span class="n">file</span> <span class="bp">=</span> <span class="bp">...</span>
    <span class="bp">...</span>
    <span class="n">return</span> <span class="n">module.default</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>But then probably also memoise <code>myLazyCode</code>.</p>



<a name="310791030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310791030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310791030">(Nov 18 2022 at 10:45)</a>:</h4>
<p><code>React.lazy</code> works, yay!</p>



<a name="310791165"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310791165" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310791165">(Nov 18 2022 at 10:46)</a>:</h4>
<p>I’ll worry about memoisation etc. at some later point, I first want to get to a state where I can show how great this all is (once someone reimplements it properly ;-))</p>



<a name="310791247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310791247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310791247">(Nov 18 2022 at 10:46)</a>:</h4>
<p>the memoising is important so that it only loads the module once and you don't get multiple copies of the same component</p>



<a name="310791579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310791579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Edward Ayers <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310791579">(Nov 18 2022 at 10:49)</a>:</h4>
<p>Maybe we should expose the dynamic component loading stuff in <code>@leanprover/infoview</code></p>



<a name="310878360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310878360" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310878360">(Nov 18 2022 at 17:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="470149">Joachim Breitner</span> <a href="#narrow/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos/near/310789772">said</a>:</p>
<blockquote>
<p>Ok, next issue is that I kinda need to define a React component and pass it to the JS world. I am trying the very naive thing of passing JS code in the props to a generic widget, that tries to instantiate it, cargo-culting your code in<br>
<a href="https://github.com/nomeata/lean4-interactive-tactic/blob/30c7377899b1b0d4ce6e6203964db85f245ce65b/widget/src/widget.tsx#L17-L24">https://github.com/nomeata/lean4-interactive-tactic/blob/30c7377899b1b0d4ce6e6203964db85f245ce65b/widget/src/widget.tsx#L17-L24</a><br>
(but no caching etc.)<br>
I get errors, though, in the <code>import</code> line, namely</p>
<ul>
<li><a href="https://reactjs.org/docs/error-decoder.html/?invariant=31&amp;args[]=%5Bobject%20Promise%5D">https://reactjs.org/docs/error-decoder.html/?invariant=31&amp;args[]=%5Bobject%20Promise%5D</a></li>
<li><a href="https://reactjs.org/docs/error-decoder.html/?invariant=321">https://reactjs.org/docs/error-decoder.html/?invariant=321</a><br>
although I do get a module out it seems.</li>
</ul>
<p>Any hint what I might be doing wrong here?</p>
</blockquote>
<p>I think this is a bit of an <a href="https://en.wikipedia.org/wiki/XY_problem">#xy</a> problem. I would hope that you wouldn't actually need to do any of the dynamic <code>import</code> tricks. Looking at your other thread, it sounds like you want a widget per instance of <code>Interactive α</code>. Why not associate a <code>UserWidgetDefinition</code> with <em>each</em> such instance and then make the <code>interactive</code> tactic store the ID of the particular widget found by instance resolution in the infotree?</p>



<a name="310883758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Syntax%20pos%20to%20LSP%20pos/near/310883758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joachim Breitner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Syntax.20pos.20to.20LSP.20pos.html#310883758">(Nov 18 2022 at 18:25)</a>:</h4>
<p>That's what I tried, butI didn't immediately see how to look up the widget code by Id from JavaScript. (I need to wrap them with some common code!). So instead o cargo culted what the user widget code is doing.</p>
<p>But this was just the path of least resistance, and cleanup is still needed. I'm calling it a day for now, but PRs are welcome :-)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>