---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html">VS Code lean server crash</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="282417232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20lean%20server%20crash/near/282417232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Gilchrist <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html#282417232">(May 15 2022 at 16:38)</a>:</h4>
<p>Hi - am new to Lean so apologies if this is a dumb question. I am trying to us Visual Studio Code to write and run a Lean 4 sample file. However, the InfoView window reports that the Lean server crashes:</p>
<p>Lean (version 4.0.0-nightly-2022-05-08, commit 0fd47fd817eb, Release)<br>
Lean (version 4.0.0-nightly-2022-05-08, commit 0fd47fd817eb, Release)<br>
[Info  - 9:21:18 AM] Connection to server got closed. Server will restart.<br>
[Info  - 9:21:24 AM] Connection to server got closed. Server will restart.<br>
[Info  - 9:21:30 AM] Connection to server got closed. Server will restart.<br>
[Info  - 9:21:35 AM] Connection to server got closed. Server will restart.<br>
[Error - 9:21:41 AM] The Lean 4 server crashed 5 times in the last 3 minutes. The server will not be restarted. See the output for more information.<br>
Error: Connection to server got closed. Server will not be restarted.</p>
<p>Here's info about my environment:</p>
<p>Windows 10<br>
Visual Studio Code 1.67.1 (April 2022)<br>
Lean version 4.0.0-nightly-2022-05-08<br>
lean4 extension installed v0.0.72</p>
<p>Thanks in advance for any help! Martin</p>



<a name="282482954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20lean%20server%20crash/near/282482954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html#282482954">(May 16 2022 at 11:41)</a>:</h4>
<p>Hello <span class="user-mention" data-user-id="500714">@Martin Gilchrist</span>,<br>
Can you post the code you're trying to run?</p>



<a name="282566317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20lean%20server%20crash/near/282566317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Gilchrist <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html#282566317">(May 16 2022 at 21:58)</a>:</h4>
<p>Hi - it's the example file Foo.lean when you run the lake init foo command. So the contents of the Foo.lean file are:<br>
def hello := "world"</p>
<p>I'll include a screenshot to help give an idea of what I see.</p>
<p><a href="/user_uploads/3121/CKqu1dGQ3fp5x4UZcrOcLTRr/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/CKqu1dGQ3fp5x4UZcrOcLTRr/image.png" title="image.png"><img src="/user_uploads/3121/CKqu1dGQ3fp5x4UZcrOcLTRr/image.png"></a></div>



<a name="282566611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20lean%20server%20crash/near/282566611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Gilchrist <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html#282566611">(May 16 2022 at 22:00)</a>:</h4>
<p>I think that this is also relevant: the Windows Event Viewer reports an error:</p>
<p>Faulting application name: lake.exe, version: 0.0.0.0, time stamp: 0x62777050<br>
Faulting module name: libleanshared.dll, version: 0.0.0.0, time stamp: 0x62777026<br>
Exception code: 0xc0000005<br>
Fault offset: 0x0000000000271fb1<br>
Faulting process id: 0x31fc<br>
Faulting application start time: 0x01d868dd8b4a5778<br>
Faulting application path: C:\Users\martinpg\.elan\toolchains\leanprover--lean4---nightly\bin\lake.exe<br>
Faulting module path: C:\Users\martinpg\.elan\toolchains\leanprover--lean4---nightly\bin\libleanshared.dll<br>
Report Id: c8907e50-32a6-4f37-a803-f6a0ef7e774f<br>
Faulting package full name: <br>
Faulting package-relative application ID:</p>



<a name="282574583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20lean%20server%20crash/near/282574583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html#282574583">(May 16 2022 at 23:37)</a>:</h4>
<p>I just tried installing the <code>leanprover--lean4---nightly</code> on windows and it works fine, does your install directory look like this? </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code> <span class="n">Directory</span> <span class="n">of</span> <span class="n">C</span><span class="o">:</span><span class="bp">\</span><span class="n">Users</span><span class="bp">\</span><span class="n">clovett</span><span class="bp">\.</span><span class="n">elan</span><span class="bp">\</span><span class="n">toolchains</span><span class="bp">\</span><span class="n">leanprover</span><span class="c1">--lean4---nightly\bin</span>

<span class="mi">05</span><span class="bp">/</span><span class="mi">16</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">04</span><span class="o">:</span><span class="mi">36</span> <span class="n">PM</span>    <span class="bp">&lt;</span><span class="n">DIR</span><span class="bp">&gt;</span>          <span class="bp">.</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">16</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">04</span><span class="o">:</span><span class="mi">36</span> <span class="n">PM</span>    <span class="bp">&lt;</span><span class="n">DIR</span><span class="bp">&gt;</span>          <span class="bp">..</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">13</span> <span class="n">AM</span>           <span class="mi">231</span><span class="o">,</span><span class="mi">936</span> <span class="n">clang.exe</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">35</span> <span class="n">AM</span>         <span class="mi">1</span><span class="o">,</span><span class="mi">526</span><span class="o">,</span><span class="mi">272</span> <span class="n">lake.exe</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">13</span> <span class="n">AM</span>         <span class="mi">7</span><span class="o">,</span><span class="mi">415</span><span class="o">,</span><span class="mi">296</span> <span class="n">ld.lld.exe</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">34</span> <span class="n">AM</span>            <span class="mi">77</span><span class="o">,</span><span class="mi">312</span> <span class="n">lean.exe</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">34</span> <span class="n">AM</span>            <span class="mi">97</span><span class="o">,</span><span class="mi">280</span> <span class="n">leanc.exe</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">11</span> <span class="n">AM</span>               <span class="mi">860</span> <span class="n">leanmake</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">13</span> <span class="n">AM</span>         <span class="mi">1</span><span class="o">,</span><span class="mi">274</span><span class="o">,</span><span class="mi">880</span> <span class="n">libc</span><span class="bp">++.</span><span class="n">dll</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">13</span> <span class="n">AM</span>        <span class="mi">99</span><span class="o">,</span><span class="mi">091</span><span class="o">,</span><span class="mi">456</span> <span class="n">libclang</span><span class="bp">-</span><span class="n">cpp.dll</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">34</span> <span class="n">AM</span>        <span class="mi">51</span><span class="o">,</span><span class="mi">060</span><span class="o">,</span><span class="mi">736</span> <span class="n">libleanshared.dll</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">13</span> <span class="n">AM</span>        <span class="mi">95</span><span class="o">,</span><span class="mi">203</span><span class="o">,</span><span class="mi">328</span> <span class="n">libLLVM</span><span class="bp">-</span><span class="mi">14</span><span class="bp">.</span><span class="n">dll</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">13</span> <span class="n">AM</span>           <span class="mi">103</span><span class="o">,</span><span class="mi">936</span> <span class="n">libunwind.dll</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">13</span> <span class="n">AM</span>         <span class="mi">7</span><span class="o">,</span><span class="mi">415</span><span class="o">,</span><span class="mi">296</span> <span class="n">lld.exe</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">13</span> <span class="n">AM</span>           <span class="mi">167</span><span class="o">,</span><span class="mi">424</span> <span class="n">llvm</span><span class="bp">-</span><span class="n">ar.exe</span>
<span class="mi">05</span><span class="bp">/</span><span class="mi">14</span><span class="bp">/</span><span class="mi">2022</span>  <span class="mi">12</span><span class="o">:</span><span class="mi">13</span> <span class="n">AM</span>           <span class="mi">105</span><span class="o">,</span><span class="mi">984</span> <span class="n">zlib1.dll</span>
</code></pre></div>
<p>and can you print out the following environment variables?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">PROCESSOR_ARCHITECTURE</span><span class="bp">=</span><span class="n">AMD64</span>
<span class="n">PROCESSOR_IDENTIFIER</span><span class="bp">=</span><span class="n">AMD64</span> <span class="n">Family</span> <span class="mi">23</span> <span class="n">Model</span> <span class="mi">113</span> <span class="n">Stepping</span> <span class="mi">0</span><span class="o">,</span> <span class="n">AuthenticAMD</span>
<span class="n">PROCESSOR_LEVEL</span><span class="bp">=</span><span class="mi">23</span>
<span class="n">PROCESSOR_REVISION</span><span class="bp">=</span><span class="mi">7100</span>
</code></pre></div>



<a name="282583096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20lean%20server%20crash/near/282583096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Gilchrist <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html#282583096">(May 17 2022 at 01:44)</a>:</h4>
<p>Here is my install directory:<br>
C:\Users\martinpg\.elan\toolchains\leanprover--lean4---nightly\bin&gt;dir<br>
 Volume in drive C has no label.<br>
 Volume Serial Number is 184C-2440</p>
<p>Directory of C:\Users\martinpg\.elan\toolchains\leanprover--lean4---nightly\bin</p>
<p>05/08/2022  05:44 AM    &lt;DIR&gt;          .<br>
05/08/2022  05:44 AM    &lt;DIR&gt;          ..<br>
05/08/2022  12:08 AM           231,936 clang.exe<br>
05/08/2022  12:25 AM         1,526,272 lake.exe<br>
05/08/2022  12:08 AM         7,415,296 ld.lld.exe<br>
05/08/2022  12:24 AM            77,312 lean.exe<br>
05/08/2022  12:24 AM            97,280 leanc.exe<br>
05/08/2022  12:06 AM               860 leanmake<br>
05/08/2022  12:08 AM         1,274,880 libc++.dll<br>
05/08/2022  12:08 AM        99,091,456 libclang-cpp.dll<br>
05/08/2022  12:24 AM        51,346,432 libleanshared.dll<br>
05/08/2022  12:08 AM        95,203,328 libLLVM-14.dll<br>
05/08/2022  12:08 AM           103,936 libunwind.dll<br>
05/08/2022  12:08 AM         7,415,296 lld.exe<br>
05/08/2022  12:08 AM           167,424 llvm-ar.exe<br>
05/08/2022  12:08 AM           105,984 zlib1.dll<br>
              14 File(s)    264,057,692 bytes<br>
               2 Dir(s)  705,302,437,888 bytes free</p>
<p>and here are my PROCESSOR environment variables:</p>
<p>PROCESSOR_ARCHITECTURE=AMD64<br>
PROCESSOR_IDENTIFIER=Intel64 Family 6 Model 37 Stepping 2, GenuineIntel<br>
PROCESSOR_LEVEL=6<br>
PROCESSOR_REVISION=2502</p>



<a name="282607392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20lean%20server%20crash/near/282607392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html#282607392">(May 17 2022 at 08:29)</a>:</h4>
<p>You can use <a href="https://github.com/leanprover-community/mathlib/wiki/Code-in-backticks">#backticks</a> for code</p>



<a name="284808203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20lean%20server%20crash/near/284808203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html#284808203">(Jun 02 2022 at 21:35)</a>:</h4>
<p><span class="user-mention" data-user-id="500714">@Martin Gilchrist</span> can you try and wipe C:\Users\martinpg\.elan then restart VS code and follow the prompts as per <a href="https://leanprover.github.io/lean4/doc/quickstart.html">https://leanprover.github.io/lean4/doc/quickstart.html</a> and let me know what happens?</p>



<a name="285333912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20lean%20server%20crash/near/285333912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Martin Gilchrist <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html#285333912">(Jun 08 2022 at 01:17)</a>:</h4>
<p><span class="user-mention" data-user-id="434989">@Chris Lovett</span> Thank you,  I think that has fixed my problem. I now have a relatively simple project and Lean infoview window which is not complaining about server crashes! That said, I now cannot work out how to create a project that references mathlib4, but will try a different thread for that.</p>



<a name="285460781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VS%20Code%20lean%20server%20crash/near/285460781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Lovett <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VS.20Code.20lean.20server.20crash.html#285460781">(Jun 08 2022 at 22:21)</a>:</h4>
<p>Something like this should work in your <code>lakefile.lean</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake</span>
<span class="kn">open</span> <span class="n">Lake</span> <span class="n">DSL</span>

<span class="n">package</span> <span class="n">MathTest</span> <span class="o">{</span>
  <span class="c1">-- add configuration options here</span>
  <span class="n">dependencies</span> <span class="o">:=</span> <span class="bp">#</span><span class="o">[</span>
    <span class="o">{</span>
      <span class="n">name</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">mathlib</span>
      <span class="n">src</span> <span class="o">:=</span> <span class="n">Source.git</span> <span class="s2">"https://github.com/leanprover-community/mathlib4.git"</span> <span class="s2">"6895646674b04c0d7bcd085b4da3f7bb354ceaa9"</span>
    <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre></div>
<p>Then your Main.lean can do some mathlib magic:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Data.Nat.Gcd</span>
<span class="k">#eval</span> <span class="n">Nat.gcd</span> <span class="mi">12</span> <span class="mi">15</span> <span class="c1">-- 3</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>