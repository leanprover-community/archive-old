---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html">Kinds of goals closed by rw/simp only/simp</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="237337942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237337942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237337942">(May 04 2021 at 14:53)</a>:</h4>
<p>We taught our students the tactics mentioned in the title among others today, and there was some confusion over which tactic closes which kind of goal implicitly. Intuitively we might think "<code>rw</code> is weaker than <code>simp only</code> is weaker than <code>simp</code>", but this is not true in that regard:</p>
<ul>
<li><code>rw</code> uses "cheap refl" in the end, that is, <code>try (withReducible rfl)</code></li>
<li><code>simp only</code> tries <code>True.intro</code></li>
<li><code>simp</code> also tries <code>True.intro</code> only, but since there is a refl-like <code>[simp]</code> theorem, it can close as much as <code>rw</code></li>
</ul>
<p>If we want to present <code>rw</code> as a "manual <code>simp</code>", in particular as a safe non-terminal tactic, it seems like it should not have this automatic final step. What do you think? Would it be bothersome in your experience to add an extra <code>rfl</code> below a terminal <code>rw</code>?</p>



<a name="237338976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237338976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Markus Himmel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237338976">(May 04 2021 at 14:57)</a>:</h4>
<p>Maybe one could have <code>rwr</code> which is like Lean 3 <code>rwa</code> except that it does <code>rfl</code> instead of <code>assumption</code>?</p>



<a name="237339545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237339545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237339545">(May 04 2021 at 15:00)</a>:</h4>
<p>But <code>rfl</code> is so much shorter to write out than <code>asssumption</code>... :)</p>



<a name="237343201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237343201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237343201">(May 04 2021 at 15:11)</a>:</h4>
<p>I think Kevin disabled the <code>rfl</code> at the end of a rewrite in his number theory game because his students could not understand what was going on. I agree that it is reasonable.</p>



<a name="237343571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237343571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237343571">(May 04 2021 at 15:13)</a>:</h4>
<p>Sebastian, is the <code>refl</code> tactic renamed <code>rfl</code> in Lean4?</p>



<a name="237343671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237343671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237343671">(May 04 2021 at 15:13)</a>:</h4>
<p>(I just want to be sure we're talking about the same thing).</p>



<a name="237344856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237344856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237344856">(May 04 2021 at 15:19)</a>:</h4>
<p>Ah, yes, it is. This one is not extensible (yet).</p>



<a name="237349113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237349113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237349113">(May 04 2021 at 15:45)</a>:</h4>
<p>Lean 3's <code>refl</code> tactic also closes <code>P &lt;-&gt; P</code> goals, which Lean 4's <code>rfl</code> doesn't. I disabled cheap rfl after rw in NNG not because I was against it, but because I made an active decision not to talk about definitional equality, so <code>x + 0 = x</code> isn't refl in the eyes of the user (in fact we get occasional bug reports complaining that refl closes this when it shouldn't). I really like cheap refl after rw when I'm actually coding, but I would be just as happy to have rwr doing this (in fact perhaps rwr could try harder with refl if we go down this route, because I sometimes have to do rw, refl in Lean 3).</p>



<a name="237439759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237439759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237439759">(May 05 2021 at 04:38)</a>:</h4>
<p>I don't think <code>rw</code> should lose the "cheap refl" at the end, or that it should be renamed to <code>rwr</code>. But changing it to not do the cheap refl for educational purposes, like Kevin's NNG <code>rw</code>, seems fine</p>



<a name="237450762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237450762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237450762">(May 05 2021 at 07:13)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I'm not sure I fully understood you, do you mean a different <code>rw</code> should be used in teaching?</p>



<a name="237450784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237450784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237450784">(May 05 2021 at 07:13)</a>:</h4>
<p>yes, that's what NNG does</p>



<a name="237450888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237450888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237450888">(May 05 2021 at 07:14)</a>:</h4>
<p>once you think the students are comfortable with <code>rw</code> enough that having implicit extra behavior isn't too magical you can take off the training wheels</p>



<a name="237451045"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237451045" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237451045">(May 05 2021 at 07:16)</a>:</h4>
<p>In fact I think the general technique of using curated and possibly simplified versions of lean tactics for the purposes of teaching is a very good idea. Lean is really complicated if you have to tackle all of it at once</p>



<a name="237451668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237451668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237451668">(May 05 2021 at 07:22)</a>:</h4>
<p>Yes, but ideally I would hope that can be achieved by simply not introducing the advanced tactics, or advances versions such as pattern <code>intro</code>, in the beginning. I still think a clear "power hierarchy" of rw/simp only/simp would be a good design beneficial to both beginners and advanced users.</p>



<a name="237451740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237451740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237451740">(May 05 2021 at 07:23)</a>:</h4>
<p>In that case, perhaps <code>simp only</code> should support cheap <code>rfl</code></p>



<a name="237451802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237451802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237451802">(May 05 2021 at 07:24)</a>:</h4>
<p>it is a bit annoying to have to add <code>eq_self_iff_true</code> anyway</p>



<a name="237451873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237451873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237451873">(May 05 2021 at 07:25)</a>:</h4>
<p>which has become more visible in mathlib since we started squeezing our simps</p>



<a name="237452042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237452042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237452042">(May 05 2021 at 07:26)</a>:</h4>
<p>Yes, that would also work. I think it would be fine for education.</p>



<a name="237452044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237452044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237452044">(May 05 2021 at 07:26)</a>:</h4>
<p>We could have <code>simp ONLY!! [foo, bar]</code> for the very restrictive version (-;<br>
In case someone really doesn't want <code>eq_self_iff_true</code> by default.</p>



<a name="237452266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237452266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237452266">(May 05 2021 at 07:29)</a>:</h4>
<p><a href="/user_uploads/3121/f9nLKG9ouEHTLWQqL52wATad/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/f9nLKG9ouEHTLWQqL52wATad/image.png" title="image.png"><img src="/user_uploads/3121/f9nLKG9ouEHTLWQqL52wATad/image.png"></a></div>



<a name="237453884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237453884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237453884">(May 05 2021 at 07:44)</a>:</h4>
<p>We noticed that people were confused by <code>rw</code> not closing <code>refl</code> goals in NNG and then when they switched to real Lean suddenly it was, and at the time this was flagged as a potential downside of my rw hack. However NNG came from about a year of experimenting on mathematics undergraduates (<a href="https://xenaproject.wordpress.com/2017/10/31/building-the-non-negative-integers-from-scratch/">this</a> was the original version, and I watched a lot of people working through that stuff) and finding out what worked best for them, and the approach of hiding definitional equality seemed to win out. </p>
<p>The other hack in NNG tactics was that <code>induction</code> in goals like <code>0 + x = x</code> would give you base case goals like <code>0 + zero = zero</code> which again was unsurprisingly found confusing, so there was a lot of rewriting <a href="http://nat.zero">nat.zero</a> to 0 behind the scenes.</p>



<a name="237454324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454324">(May 05 2021 at 07:48)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> Just to make sure we're on the same page, note that Lean 4's "cheap refl" would <em>not</em> close <code>x + 0 = x</code> since <code>Nat.add</code> is not reducible</p>



<a name="237454453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454453">(May 05 2021 at 07:50)</a>:</h4>
<p>Lean 3's doesn't either btw</p>



<a name="237454492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454492">(May 05 2021 at 07:50)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">+</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[]</span> <span class="c1">-- fail</span>
</code></pre></div>



<a name="237454534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jasmin Blanchette <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454534">(May 05 2021 at 07:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp/near/237337942">said</a>:</p>
<blockquote>
<p>Would it be bothersome in your experience to add an extra <code>rfl</code> below a terminal <code>rw</code>?</p>
</blockquote>
<p>For what it's worth, the corresponding tactic in Isabelle/HOL, <code>subst</code>, does not automatically call <code>rfl</code>, and that never seemed to bother anybody.</p>



<a name="237454545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454545">(May 05 2021 at 07:50)</a>:</h4>
<p>It surely closes 0 + 0 = 0, maybe that's what I was remembering</p>



<a name="237454580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454580">(May 05 2021 at 07:51)</a>:</h4>
<p>so it does, that's odd</p>



<a name="237454592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454592">(May 05 2021 at 07:51)</a>:</h4>
<p><code>rw add_zero</code> -- "huh"?</p>



<a name="237454789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454789">(May 05 2021 at 07:52)</a>:</h4>
<p>I think it would be cool if <code>rw</code> used cheap (or even not cheap) refl at the end, <em>if</em> it is the last tactic in the branch. I don't know if the tactic parsing framework is able to determine this though</p>



<a name="237454791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454791">(May 05 2021 at 07:52)</a>:</h4>
<p>I remember now, even <code>rw add_zero</code> doesn't close <code>x + 0 = x</code> in NNG, that's the behaviour I wanted. People are so confused by <code>rw</code>, they can't tell the difference between it and <code>apply</code>, like some maths students can't tell the difference between <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext></mrow><annotation encoding="application/x-tex">\implies</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.549em;vertical-align:-0.024em;"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>=</mo></mrow><annotation encoding="application/x-tex">=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.36687em;vertical-align:0em;"></span><span class="mrel">=</span></span></span></span> when they come to university, the terms are kind of used vaguely at school and sometimes interchangeably. [I am now reminded of a stroppy letter I wrote to my daughter's teacher when she was about 8]</p>



<a name="237454888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454888">(May 05 2021 at 07:53)</a>:</h4>
<p>I think <code>apply</code> is a vague word in mathematics though, it means "use this theorem somehow"</p>



<a name="237454910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237454910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237454910">(May 05 2021 at 07:53)</a>:</h4>
<p>lean's interpretation of <code>apply</code> is a bit too constrained</p>



<a name="237455486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237455486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237455486">(May 05 2021 at 07:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp/near/237454789">said</a>:</p>
<blockquote>
<p>I think it would be cool if <code>rw</code> used cheap (or even not cheap) refl at the end, <em>if</em> it is the last tactic in the branch. I don't know if the tactic parsing framework is able to determine this though</p>
</blockquote>
<p>This sounds easy when you only consider branches, but much harder if you also want to propagate a sensible "terminal" flag through combinators. I believe the result would be more confusing than the status quo. A separate tactic name would be a cleaner solution.</p>



<a name="237455748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237455748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237455748">(May 05 2021 at 08:01)</a>:</h4>
<p>Indeed, I think it doesn't match the tactic architecture itself. If the number of goals returned by the tactic was enforced in the type system, like in HOL, then it would make more sense</p>



<a name="237455967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237455967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237455967">(May 05 2021 at 08:03)</a>:</h4>
<p>I don't think of <code>rw</code> as a terminal tactic, so I'd be in favor of it not closing cheap rfl goals. Is an extra <code>rfl</code> at the end really that inconvenient?</p>



<a name="237456130"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237456130" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237456130">(May 05 2021 at 08:04)</a>:</h4>
<p>Then again, I can see that it might be slightly annoying if then almost <em>every</em> proof case ends with <code>rfl</code>, which I guess some might consider as noise.</p>



<a name="237456244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237456244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237456244">(May 05 2021 at 08:05)</a>:</h4>
<p>I really like <code>by rw [lem1, lem2]</code> in calc blocks, short and easy and fits on the same line as the calculation step.</p>



<a name="237456373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237456373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237456373">(May 05 2021 at 08:06)</a>:</h4>
<p>If it becomes <code>by rw [lem1, lem2]; rfl</code> those 5 extra chars will cause line overflow in some cases</p>



<a name="237456380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237456380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237456380">(May 05 2021 at 08:06)</a>:</h4>
<p>I wouldn't mind avoiding that</p>



<a name="237456426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237456426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237456426">(May 05 2021 at 08:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp/near/237456244">said</a>:</p>
<blockquote>
<p>I really like <code>by rw [lem1, lem2]</code> in calc blocks, short and easy and fits on the same line as the calculation step.</p>
</blockquote>
<p>This seems like something that <code>calc</code> in particular could add, right?</p>



<a name="237456571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237456571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237456571">(May 05 2021 at 08:08)</a>:</h4>
<p>Aah, I see. It wouldn't be very uniform though</p>



<a name="237456766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237456766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237456766">(May 05 2021 at 08:09)</a>:</h4>
<p>It's not just calc block though, there are lots of lemmas like <code>lemma foo : a = b := by rw [one, two, three]</code>.  Requiring <code>rfl</code> at the end is really cumbersome.</p>



<a name="237457150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237457150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237457150">(May 05 2021 at 08:12)</a>:</h4>
<p><span class="user-mention" data-user-id="112680">@Johan Commelin</span> Another aspect to consider, if a) <code>simp</code> was much cheaper in general, and b) squeezing it into <code>simp only</code> was only a Code Action away, do you think you would use <code>rw</code> as often as today? Because I believe Isabelle users would probably default to <code>simp</code> in these cases.</p>



<a name="237457555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237457555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237457555">(May 05 2021 at 08:16)</a>:</h4>
<p>It will be interesting to see how important/effective squeezing will be in Lean 4 in general. The discrimination trees fundamentally change the whole scalability issue.</p>



<a name="237457558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237457558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237457558">(May 05 2021 at 08:16)</a>:</h4>
<p><code>rw</code> does a lot of things that simp doesn't: 1) it rewrites in the specified order (which is important if you go against the grain), 1b) it rewrites only once, 2) it can open extra subgoals.</p>



<a name="237457655"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237457655" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237457655">(May 05 2021 at 08:17)</a>:</h4>
<p><code>simp only</code> is also important for maintaining predictability/robustness in the face of new additions to the simp set</p>



<a name="237457658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237457658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237457658">(May 05 2021 at 08:17)</a>:</h4>
<p>(Type-theory issues aside where <code>rw</code> works but <code>simp</code> doesn't.)</p>



<a name="237457744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237457744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237457744">(May 05 2021 at 08:18)</a>:</h4>
<p>(this is summarized in the "no nonterminal <code>simp</code>" rule)</p>



<a name="237457780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237457780" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237457780">(May 05 2021 at 08:18)</a>:</h4>
<p>Oh, nonterminal <code>simp</code>s should definitely be squeezed of course</p>



<a name="237457991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237457991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237457991">(May 05 2021 at 08:20)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Do you have a feeling for how often these features are used in terminal <code>rw</code>s? Also not sure off the top of my mind if Lean 4 <code>simp</code> can actually open new goals.</p>



<a name="237458171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237458171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237458171">(May 05 2021 at 08:22)</a>:</h4>
<p>I find <code>rw</code> generally easier to control than <code>simp</code>, for the reasons gabriel mentioned</p>



<a name="237458230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237458230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237458230">(May 05 2021 at 08:22)</a>:</h4>
<p>but I don't think there is a significant prejudice for one over the other where they both apply</p>



<a name="237458380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237458380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237458380">(May 05 2021 at 08:24)</a>:</h4>
<p>Opening new goals typically does not happen with non-terminal rws.  But still, having to write <code>by rw Nat.sub_add_cancel; rfl; ...</code> is cumbersome and noisy.</p>



<a name="237458698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237458698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237458698">(May 05 2021 at 08:26)</a>:</h4>
<p>I wouldn't mind having <code>rwr</code> for rewrite and then not-cheap refl, but I generally dislike tactics whose only purpose is to be two tactics in a row</p>



<a name="237458746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237458746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237458746">(May 05 2021 at 08:26)</a>:</h4>
<p>Probably terrible idea: instead of having tactics speculatively close goals, use an extensible set of tactics at <code>done</code> (which is implicit at the end of a "terminal" tactic block) to do so instead. Then at least you really don't pay for the feature unless you use it.</p>



<a name="237458860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237458860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237458860">(May 05 2021 at 08:27)</a>:</h4>
<p>is this like my suggestion about doing it only for the last tactic in a block? How is the position detected / communicated?</p>



<a name="237459537"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237459537" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237459537">(May 05 2021 at 08:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp/near/237457991">said</a>:</p>
<blockquote>
<p>Also not sure off the top of my mind if Lean 4 <code>simp</code> can actually open new goals.</p>
</blockquote>
<p>This doesn't seem to work, even if I explicitly name the metavariable:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">axiom</span> <span class="n">Nat.sub_add_cancel</span> <span class="o">{</span><span class="n">m</span> <span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">≤</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">-</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">=</span> <span class="n">n</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">&lt;</span> <span class="mi">10</span><span class="o">)</span> <span class="o">:</span> <span class="mi">10</span> <span class="bp">-</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">10</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">rw</span> <span class="n">Nat.sub_add_cancel</span>
  <span class="n">exact</span> <span class="n">Nat.leOfLt</span> <span class="n">h</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">m</span> <span class="bp">&lt;</span> <span class="mi">10</span><span class="o">)</span> <span class="o">:</span> <span class="mi">10</span> <span class="bp">-</span> <span class="n">m</span> <span class="bp">+</span> <span class="n">m</span> <span class="bp">=</span> <span class="mi">10</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">Nat.sub_add_cancel</span> <span class="bp">?</span><span class="n">m</span><span class="o">]</span>
  <span class="c1">-- simp makes no progress here</span>
  <span class="n">exact</span> <span class="n">Nat.leOfLt</span> <span class="n">h</span>
</code></pre></div>



<a name="237460118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237460118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237460118">(May 05 2021 at 08:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp/near/237458860">said</a>:</p>
<blockquote>
<p>is this like my suggestion about doing it only for the last tactic in a block? How is the position detected / communicated?</p>
</blockquote>
<p>The block itself would do it, not the last tactic. Which is simpler and more robust (we only call the tactic set when we know we would otherwise fail with "unsolved goals" anyway), but means the last tactic can't influence what to try.</p>



<a name="237460237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237460237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237460237">(May 05 2021 at 08:39)</a>:</h4>
<p>ha, so we will see proofs by <code>example : true := by</code>?</p>



<a name="237460317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237460317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237460317">(May 05 2021 at 08:39)</a>:</h4>
<p>Only if we allow that syntactically :)</p>



<a name="237460331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237460331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237460331">(May 05 2021 at 08:39)</a>:</h4>
<p>As I said, it's probably a terrible idea</p>



<a name="237460411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237460411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237460411">(May 05 2021 at 08:40)</a>:</h4>
<p>I could get behind writing <code>{}</code> instead of <code>{refl}</code>.</p>



<a name="237460451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237460451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237460451">(May 05 2021 at 08:40)</a>:</h4>
<p>Having things that run on close isn't that unusual, it's supported in lean 3 as well, although it is only actually used in custom tactic blocks like <code>smt_tactic</code></p>



<a name="237460498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237460498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237460498">(May 05 2021 at 08:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp/near/237460237">said</a>:</p>
<blockquote>
<p>ha, so we will see proofs by <code>example : true := by</code>?</p>
</blockquote>
<p>How is this worse than <code>example : false -&gt; true.</code>?</p>



<a name="237460530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237460530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237460530">(May 05 2021 at 08:41)</a>:</h4>
<p>Did I mean to suggest I disliked the pattern? It's fine, just a bit odd</p>



<a name="237460670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237460670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237460670">(May 05 2021 at 08:42)</a>:</h4>
<p>in fact, since <code>example : false -&gt; true.</code> doesn't work anymore in lean 4 I will have to find a new favorite and that one looks like a candidate</p>



<a name="237466726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237466726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237466726">(May 05 2021 at 09:34)</a>:</h4>
<p>Having tactics run on the end of a proof is standard in Isabelle, and very convenient to close all remaining trivial goals.</p>



<a name="237469010"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237469010" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237469010">(May 05 2021 at 09:56)</a>:</h4>
<p><span class="user-mention" data-user-id="110050">@Sebastien Gouezel</span> If you don't specify an explicit one after <code>qed</code>, it uses <code>assumption</code> only, no?</p>



<a name="237471144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237471144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237471144">(May 05 2021 at 10:15)</a>:</h4>
<p>Yes, I think so -- but <code>qed (auto)</code> is a very standard idiom.</p>



<a name="237471387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237471387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237471387">(May 05 2021 at 10:18)</a>:</h4>
<p>Since there is no token at the end of a proof block anymore anyway, we can add <code>qed</code> as a macro for <code>allGoals</code> in Lean 4 <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="237499198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237499198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237499198">(May 05 2021 at 13:59)</a>:</h4>
<p>Just to throw in my own two cents: I like the idea of <code>rwr</code>. I do have qualms with auto-closing "trivial' goals at the end of a proof without some kind of marker  (such as a <code>qed</code>) that you are doing so though. My design philosophy is to minimize implicit magic as much as possible.</p>



<a name="237535958"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237535958" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jeremy Avigad <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237535958">(May 05 2021 at 17:38)</a>:</h4>
<p>IIRC, SSReflect has a simple <code>done</code> tactic that you can invoke in places by writing <code>//</code>. So for example you can write</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="n">rewrite</span> <span class="n">foo</span> <span class="n">bar</span> <span class="n">baz</span> <span class="bp">//</span>
</code></pre></div>
<p>and the <code>done</code> would be invoked at the <code>//</code>. Again IIRC, it was a <code>try</code> tactic, so there was no harm if it failed. <code>rewrite</code> would sometimes open up new subgoals (with conditional rewrites), and this was a way you could close them off and then keep going after the <code>//</code>. </p>
<p>(Georges Gonthier was a master of optimizing the number of things that can be accomplished with a single 80-character line of SSReflect code.)</p>



<a name="237536286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Kinds%20of%20goals%20closed%20by%20rw/simp%20only/simp/near/237536286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jeremy Avigad <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Kinds.20of.20goals.20closed.20by.20rw.2Fsimp.20only.2Fsimp.html#237536286">(May 05 2021 at 17:40)</a>:</h4>
<p>Docs:<br>
<a href="https://coq.inria.fr/refman/proof-engine/ssreflect-proof-language.html#an-extended-rewrite-tactic">https://coq.inria.fr/refman/proof-engine/ssreflect-proof-language.html#an-extended-rewrite-tactic</a><br>
<a href="https://coq.inria.fr/refman/proof-engine/ssreflect-proof-language.html#simplification-items">https://coq.inria.fr/refman/proof-engine/ssreflect-proof-language.html#simplification-items</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>