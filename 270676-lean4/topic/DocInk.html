---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/DocInk.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html">DocInk</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="286799977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286799977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286799977">(Jun 20 2022 at 14:08)</a>:</h4>
<p>I happily present: <br>
<a href="/user_uploads/3121/3oG9wcOizRQxY4ExJf-bwVN_/image.png">image.png</a> <br>
<a href="/user_uploads/3121/rWu9Fi9lqYFqnSC2tlfjdiyJ/image.png">image.png</a> </p>
<div class="message_inline_image"><a href="/user_uploads/3121/3oG9wcOizRQxY4ExJf-bwVN_/image.png" title="image.png"><img src="/user_uploads/3121/3oG9wcOizRQxY4ExJf-bwVN_/image.png"></a></div><div class="message_inline_image"><a href="/user_uploads/3121/rWu9Fi9lqYFqnSC2tlfjdiyJ/image.png" title="image.png"><img src="/user_uploads/3121/rWu9Fi9lqYFqnSC2tlfjdiyJ/image.png"></a></div><p>my newest Lean4 rip off of an HTML generating tool in Python, this time alectryon.</p>
<p>I have two main questions on this (which are the actual reason im posting here):</p>
<ul>
<li>In alectryon pygments does the syntax highlighting for us and it uses pygments CSS to reflect this in the end code, since we want to avoid dependencies on Python, how do I highlight this?</li>
<li>The types are merely given to me as boring old strings, linking these back to doc-gen's main page seems like quite of a challenge, I'd have to reelaborate them and what not, is there a way we can store InfoTree information instead of types in Aelctryon? (Should be possible to do as far as I can see from the code, I just wanted to make sure I'm not doing something impossible before I start)</li>
</ul>
<p>CC: <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> <span class="user-mention" data-user-id="451040">@Niklas Bülow</span></p>



<a name="286800712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286800712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286800712">(Jun 20 2022 at 14:14)</a>:</h4>
<p>Awesome! I didn't think you would copy Alectryon's style that directly, you should ask <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> about what we should improve there <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> . But it's a good starting point of course. See also <a href="https://github.com/leanprover/lean4/commit/8f2f6bc17d11bfaac8fae7448dff4d047a187568">https://github.com/leanprover/lean4/commit/8f2f6bc17d11bfaac8fae7448dff4d047a187568</a> for some quick adjustments I did after Gabriel's feedback in the other thread.</p>



<a name="286801414"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286801414" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286801414">(Jun 20 2022 at 14:19)</a>:</h4>
<blockquote>
<p>In alectryon pygments does the syntax highlighting for us and it uses pygments CSS to reflect this in the end code, since we want to avoid dependencies on Python, how do I highlight this?</p>
</blockquote>
<p>Note that <a href="https://github.com/Kha/alectryon/tree/typeid">https://github.com/Kha/alectryon/tree/typeid</a> (the branch the doc examples are built with) uses semantic highlighting reported by LeanInk on top of Pygments. There may be some missing highlighting such as strings and comments in the semantic highlighting, but we should probably fix this in the language server.</p>
<blockquote>
<p>is there a way we can store InfoTree information instead of types in Aelctryon?</p>
</blockquote>
<p>I assume you mean in LeanInk? But sounds reasonable, yes.</p>



<a name="286808877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286808877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286808877">(Jun 20 2022 at 15:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/DocInk/near/286800712">said</a>:</p>
<blockquote>
<p>Awesome! I didn't think you would copy Alectryon's style that directly, you should ask <span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> about what we should improve there <span aria-label="big smile" class="emoji emoji-1f604" role="img" title="big smile">:big_smile:</span> . But it's a good starting point of course. See also <a href="https://github.com/leanprover/lean4/commit/8f2f6bc17d11bfaac8fae7448dff4d047a187568">https://github.com/leanprover/lean4/commit/8f2f6bc17d11bfaac8fae7448dff4d047a187568</a> for some quick adjustments I did after Gabriel's feedback in the other thread.</p>
</blockquote>
<p><a href="/user_uploads/3121/SbShpzFFU_j2bzkuy6jxTpZw/image.png">image.png</a> ^^</p>
<div class="message_inline_image"><a href="/user_uploads/3121/SbShpzFFU_j2bzkuy6jxTpZw/image.png" title="image.png"><img src="/user_uploads/3121/SbShpzFFU_j2bzkuy6jxTpZw/image.png"></a></div><p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/DocInk/near/286801414">said</a>:</p>
<blockquote>
<blockquote>
<p>In alectryon pygments does the syntax highlighting for us and it uses pygments CSS to reflect this in the end code, since we want to avoid dependencies on Python, how do I highlight this?</p>
</blockquote>
<p>Note that <a href="https://github.com/Kha/alectryon/tree/typeid">https://github.com/Kha/alectryon/tree/typeid</a> (the branch the doc examples are built with) uses semantic highlighting reported by LeanInk on top of Pygments. There may be some missing highlighting such as strings and comments in the semantic highlighting, but we should probably fix this in the language server.</p>
<blockquote>
<p>is there a way we can store InfoTree information instead of types in Aelctryon?</p>
</blockquote>
<p>I assume you mean in LeanInk? But sounds reasonable, yes.</p>
</blockquote>
<p>exactly, I'll get to implementing this then.</p>



<a name="286811187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286811187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286811187">(Jun 20 2022 at 15:34)</a>:</h4>
<p>Do I understand that you're somehow using LeanInk without Alectryon?</p>



<a name="286815784"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286815784" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286815784">(Jun 20 2022 at 16:15)</a>:</h4>
<p>Yeah I rebuilt the HTML renderer that alectryon provides in Lean, hence the Python rip off.</p>



<a name="286815918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286815918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286815918">(Jun 20 2022 at 16:17)</a>:</h4>
<p>Do you still use the intermediate json representation?</p>



<a name="286815951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286815951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286815951">(Jun 20 2022 at 16:18)</a>:</h4>
<p>you could use the semantic highlighter for doing syntax highlighting</p>



<a name="286816999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286816999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286816999">(Jun 20 2022 at 16:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/270676-lean4/topic/DocInk/near/286815918">said</a>:</p>
<blockquote>
<p>Do you still use the intermediate json representation?</p>
</blockquote>
<p>Yes, I went for a minimally invasive approach on LeanInk so I just taught it how to also read its data structures from JSON again to use that part as a library then I let it produce its output files, read them in and delete them afterwards (I spawn the LeanInk process as an external one due to limitations that Sebastian and I discovered with running all the analysis of mathlib in the same process).</p>
<p>There is a little performance concern here because we basically run elaboration twice, once with the Lean compiler from Lake during the normal olean build (doc-gen then consumes the produced .olean files) and once with LeanInk afterwards (where doc-gen consumes the JSON files), right now a full run for mathlib that explicitly stops the entire compiler from getting rendered with LeanInk (that would probably take ages) takes ~8 min on my laptop. Once we port the big mathlib this will most likely become a bigger concern but Sebastian already came up with the idea that we could maybe load LeanInk into the Lean compiler itself as a plugin and produce the .json files as normal build artifacts during the .olean build which would essentially eliminate the concern.</p>



<a name="286817081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286817081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286817081">(Jun 20 2022 at 16:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/DocInk/near/286815951">said</a>:</p>
<blockquote>
<p>you could use the semantic highlighter for doing syntax highlighting</p>
</blockquote>
<p>If i understand Sebastian correctly that's basically what he is proposing as well right?</p>



<a name="286840764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286840764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286840764">(Jun 20 2022 at 21:34)</a>:</h4>
<p>I deployed the minimal version to github pages now: <a href="https://leanprover-community.github.io/mathlib4_docs/">https://leanprover-community.github.io/mathlib4_docs/</a> so people can look out for bugs or even use it normally^^. A few remarks on this:</p>
<ul>
<li>the compiler (so Lean, Init and Std) is at the moment not rendered on purpose, rendering this mathilb alone takes 8 min already, the compiler would take ages but I'll get to that at some point</li>
<li>the highlighting is as good as it gets right now (though we can of course talk about colouring)</li>
<li>Linking back from ink to doc-gen is planned but not implemented right now since this requires some more work on both sides</li>
</ul>
<p>If you find anything wrong apart from that please do tell!</p>



<a name="286901650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286901650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286901650">(Jun 21 2022 at 11:56)</a>:</h4>
<p>This is nice. I'm surprised by how little code it took, this bodes well for future extensions and tweaks.</p>



<a name="286901664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286901664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286901664">(Jun 21 2022 at 11:56)</a>:</h4>
<p>Do I want to know why <code>&lt;//small&gt;</code> is written with two slashes now?</p>



<a name="286920981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286920981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286920981">(Jun 21 2022 at 14:24)</a>:</h4>
<p>Note that Alectryon runs quite a few transformation steps after extraction: <a href="https://github.com/cpitclaudel/alectryon/blob/739b46da22d272e748f60f3efcd2989d696fba71/alectryon/transforms.py#L841-L849">https://github.com/cpitclaudel/alectryon/blob/739b46da22d272e748f60f3efcd2989d696fba71/alectryon/transforms.py#L841-L849</a>. Compare the "bubble" placement between <a href="https://leanprover.github.io/lean4/doc/examples/palindromes.lean.html">https://leanprover.github.io/lean4/doc/examples/palindromes.lean.html</a> and <a href="https://leanprover-community.github.io/mathlib4_docs/src/Mathlib/Algebra/Group/Basic.html">https://leanprover-community.github.io/mathlib4_docs/src/Mathlib/Algebra/Group/Basic.html</a>, for example. However, we might as well fix that in LeanInk directly where possible.</p>



<a name="286934607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286934607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286934607">(Jun 21 2022 at 15:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/DocInk/near/286901664">said</a>:</p>
<blockquote>
<p>Do I want to know why <code>&lt;//small&gt;</code> is written with two slashes now?</p>
</blockquote>
<p>weeell, I decided some time ago to add a field to the <code>Html</code> datatype that tells the HTML formatter whether to format it or not so the generated HTML looks more pretty, this is what <code>&lt;/</code> generates per default, however the output of alectryon is of course <em>very very very</em> sensitive to whitespaces and newlines so I decided to add another syntax that does explicitly not do this. I guess I could also run a recursive function over the generated Html that unsets this flag everywhere but at the time i was not sure whether I want to get rid off it everywhere. The other alternative would be to make the default false but I haven't had the time yet to see whether this affects generation of the doc HTML.</p>



<a name="286953125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286953125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286953125">(Jun 21 2022 at 18:06)</a>:</h4>
<p>Hm, does seem to look fine, who needs pretty looking HTML when the browser shows stuff to us anyways!</p>



<a name="286959150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/286959150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#286959150">(Jun 21 2022 at 18:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/DocInk/near/286901664">said</a>:</p>
<blockquote>
<p>Do I want to know why <code>&lt;//small&gt;</code> is written with two slashes now?</p>
</blockquote>
<p>Now it's gone...it might be that during my inspection of how the now much less pretty printed HTML is generated i missed a few cosmetic things so if you notice something cosmetically weird that wasn't there before that is probably on this change.</p>



<a name="290616512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290616512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290616512">(Jul 23 2022 at 14:30)</a>:</h4>
<p>I did start looking into the back linking things and as far as I can tell LeanInk would have to do a hard breaking change on its Alectryon JSON API if doc-gen wants to access this information. This is because right now I'm receiving every type as a single long string so that means if there is a popup like this: <code>t1 : Nat → Test</code> i receive the <code>t1</code> and the <code>Nat → Test</code> as separate strings. I did consider to just parse and analyze the type strings but I don't think this will work out since they are (correctly) leaving away namespaces etc. so it would basically come down to me writing a mini elaborator if I wanted to do this.</p>
<p>Furthermore there is also things like <code>#check Nat</code> where i actually receive the whole answer as just a single string <code>Nat : Type</code>. similar things happen in the goal view and probably other places I didn't check yet.</p>
<p>So if we wanted backlinking to happen over this JSON API I'd have add changes to LeanInk that probably hard break the Alectryon API as it is right now, is this acceptable/desired? If not, what else should I do about this?</p>



<a name="290616662"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290616662" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290616662">(Jul 23 2022 at 14:33)</a>:</h4>
<p>I thought you no longer relied on Alectryon itself, did I dream that?</p>



<a name="290616841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290616841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290616841">(Jul 23 2022 at 14:37)</a>:</h4>
<p>I think the point is that we want to keep Alectryon working with LeanInk (e.g. for LaTeX output) even if doc-gen4 doesn't need it anymore</p>



<a name="290617163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290617163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290617163">(Jul 23 2022 at 14:43)</a>:</h4>
<p>I don't think a breaking change would be a big issue; I wouldn't be surprised if all currently existing LeanInk CI setups are in fact by me (in which case they are properly version-pinned). There's always the option of simple producing a strict superset of the current JSON though, at the cost of some redundancy in implementation and output.</p>



<a name="290617331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290617331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290617331">(Jul 23 2022 at 14:46)</a>:</h4>
<p>I don't rely on alectryon for what I do in doc-gen yes, but I use the JSON format that LeanInk originally provided for alectryon for the doc-gen work so if doc-gen shall do more than now it would either have to break this format or a new API would have to be built entirely</p>



<a name="290631543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290631543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290631543">(Jul 23 2022 at 20:22)</a>:</h4>
<p>I'm a little uncertain on how to do the encode decode part here, maybe someone can help me out. Ideally I'd like to receive some <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Lean.Widget.CodeWithInfos#doc">docs4#Lean.Widget.CodeWithInfos</a> from LeanInk because that is what doc-gen already uses, it seems to me like the relevant parts of LeanInk are basically operating on <code>Expr</code>s as well so generating the <code>CodeWithInfos</code> from that can be done just like in doc-gen as well. What I'm not quite sure about is how to ship them from LeanInk to doc-gen. <code>CodeWithInfos</code> is a <code>TaggedText SubexprInfo</code> where <code>TaggedText</code> derives <code>FromJson</code> and <code>ToJson</code> and <code>Subexprinfo</code> derives <code>RpcEncoding</code> but not the ordinary <code>ToJson</code> <code>FromJson</code>, from reading the docs of <code>RpcEncoding</code> it seems like it is pretty close to <code>ToJson</code> <code>FromJson</code> but has some additional magic involved with <code>WithRpcRef</code> which hides stuff behind some RPC reference (whatever that is, I'm guessing it means I won't get the full data but have to ask for it?). And this is where I'm a little lost because I'm not at all familiar with the LSP and RPC parts of Lean.</p>
<p>Basically I want: <code>CodeWithInfos</code> or a representation convertible to <code>CodeWithInfos</code> -&gt; JSON via LeanInk and then in doc-gen JSON -&gt; whatever representation -&gt; <code>CodeWithInfos</code> to analyze further, how can I get that?</p>



<a name="290631644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290631644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290631644">(Jul 23 2022 at 20:25)</a>:</h4>
<p>I may have asked it before, but would it be easier to interface with LeanInk as a Lean library? Or do you want the JSON for caching?</p>



<a name="290631696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290631696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290631696">(Jul 23 2022 at 20:26)</a>:</h4>
<p>I did try that but it failed horribly :D Remember when I bothered you about the repeating imports due to multiple LeanInk calls?</p>



<a name="290631773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290631773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290631773">(Jul 23 2022 at 20:28)</a>:</h4>
<p>I guess once doc-gen is at the point where it get's called by Lake on a per file basis though this won't be an issue anymore so I could also wait for that instead of trying to solve the JSON encoding issue further.</p>



<a name="290632031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290632031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290632031">(Jul 23 2022 at 20:35)</a>:</h4>
<p>Ah yeah, I was thinking of per-file</p>



<a name="290632095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290632095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290632095">(Jul 23 2022 at 20:37)</a>:</h4>
<p>Right, well in that case I'll wait for Mac to finish on his facets thingy and pull LeanInk back in as a library <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="290637194"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290637194" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290637194">(Jul 23 2022 at 22:38)</a>:</h4>
<p><span class="user-mention" data-user-id="395550">@Henrik Böving</span> oh. it is already finished, would you like a PR that does it for doc-gen4?</p>



<a name="290637207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290637207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290637207">(Jul 23 2022 at 22:39)</a>:</h4>
<p>Oh, definitely yeah <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="290640429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290640429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290640429">(Jul 23 2022 at 23:56)</a>:</h4>
<p><span class="user-mention" data-user-id="395550">@Henrik Böving</span> while doing so I noticed that doc-gen currently produces both a <code>Foo.bar</code> link and a <code>Foo.&lt;&lt;Bar.html&gt;&gt;</code> link in the navbar. I imagine that  is a bug?</p>



<a name="290640441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290640441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290640441">(Jul 23 2022 at 23:57)</a>:</h4>
<p>Yeah, how can i reproduce that? I probably didn't parse a name properly somewhere</p>



<a name="290640516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290640516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290640516">(Jul 23 2022 at 23:59)</a>:</h4>
<p>I remember that i did already observe this behaviour but I fixed it, the doc-gen that is deployed on <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat#doc">docs4#Nat</a> right now does not have this issue in the navbar so I'd be curious what you are doing.</p>



<a name="290640777"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290640777" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290640777">(Jul 24 2022 at 00:04)</a>:</h4>
<p>For instance, I ran (through Lake):</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>LEAN_PATH=.\lean_packages\Cli\build\lib;.\lean_packages\leanInk\build\lib;.\build\lib;.\lean_packages\Unicode\build\lib;.\lean_packages\mathlib\build\lib;.\lean_packages\lake\build\lib;.\lean_packages\CMark\build\lib;c:\Users\Mac\.elan\toolchains\leanprover--lean4---nightly-2022-07-20\lib\lean .\build\bin\doc-gen4.exe single DocGen4.LeanInk
</code></pre></div>
<p>And got a <code>DocGen4.LeanInk</code> and a <code>DocGen4.&lt;&lt;LeanInk.html&gt;&gt;</code> entry on my Windows machine.</p>



<a name="290640940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290640940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290640940">(Jul 24 2022 at 00:08)</a>:</h4>
<p><a href="/user_uploads/3121/9lqTY-N0K6Y9rsTsmYhRCaYr/image.png">image.png</a>  I fear that's some Windows specific behaviour then /o\</p>
<div class="message_inline_image"><a href="/user_uploads/3121/9lqTY-N0K6Y9rsTsmYhRCaYr/image.png" title="image.png"><img src="/user_uploads/3121/9lqTY-N0K6Y9rsTsmYhRCaYr/image.png"></a></div>



<a name="290641169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290641169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290641169">(Jul 24 2022 at 00:15)</a>:</h4>
<p><a href="https://github.com/leanprover/doc-gen4/blob/main/DocGen4/Process/Hierarchy.lean#L103-L117">https://github.com/leanprover/doc-gen4/blob/main/DocGen4/Process/Hierarchy.lean#L103-L117</a> this code here will be at fault. Its job should be to find all files that are not in the blacklist and end on html, then cut the html part out properly so I know all the names of modules that have to be clickable in the navbar tree, the rest is done by the Hierarchy.fromArray which definitely works correctly because it's been here for a while. It seems to me that for some reason I am not dropping the <code>.html</code> of a file name properly but I can't quite tell why.</p>



<a name="290642974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290642974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290642974">(Jul 24 2022 at 01:06)</a>:</h4>
<p><span class="user-mention" data-user-id="395550">@Henrik Böving</span>  Oh, I know what the problem is! It is catching the <code>.trace</code> files produced by the module facet as files to generate entries for.</p>



<a name="290642984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290642984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290642984">(Jul 24 2022 at 01:06)</a>:</h4>
<p>To fix this, why not just catch the files with an <code>html</code> extension?</p>



<a name="290643259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290643259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290643259">(Jul 24 2022 at 01:10)</a>:</h4>
<p>Eg. via <code>fi entry.path.extension == some "html</code>"</p>



<a name="290643523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290643523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290643523">(Jul 24 2022 at 01:14)</a>:</h4>
<p>I will add such a check to my PR.</p>



<a name="290643675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290643675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290643675">(Jul 24 2022 at 01:19)</a>:</h4>
<p>I also noticed it does not catch top-level module documentation at all.</p>



<a name="290666431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290666431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290666431">(Jul 24 2022 at 11:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/270676-lean4/topic/DocInk/near/290642974">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="395550">Henrik Böving</span>  Oh, I know what the problem is! It is catching the <code>.trace</code> files produced by the module facet as files to generate entries for.</p>
</blockquote>
<p>Ahhhhh, well I guess I couldn't reproduce that :p </p>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/270676-lean4/topic/DocInk/near/290643675">said</a>:</p>
<blockquote>
<p>I also noticed it does not catch top-level module documentation at all.</p>
</blockquote>
<p>Yeah I did notice that as well while rereading the code but wanted to wait until you are done so there are no merge conflicts but I see you already fixed it.</p>
<p>So I guess I'll just merge now and start operating under the assumption that I'm only building modules with <code>single</code> on my new branch and can thus use LeanInk as a library for my stuff <span aria-label="thumbs up" class="emoji emoji-1f44d" role="img" title="thumbs up">:thumbs_up:</span></p>



<a name="290899360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/290899360" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#290899360">(Jul 26 2022 at 14:24)</a>:</h4>
<p>Update! <a href="/user_uploads/3121/i_Pn3oRxyaSEPB1lZ9e5d-8T/image.png">image.png</a> everything that is italics (and the \N and the operators) in the goal view here correctly links back to the doc-gen page</p>
<div class="message_inline_image"><a href="/user_uploads/3121/i_Pn3oRxyaSEPB1lZ9e5d-8T/image.png" title="image.png"><img src="/user_uploads/3121/i_Pn3oRxyaSEPB1lZ9e5d-8T/image.png"></a></div>



<a name="293016504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/293016504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#293016504">(Aug 11 2022 at 22:04)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/365">https://github.com/leanprover-community/mathlib4/pull/365</a> if one of the people with commit permissions on mathlib4 want to merge this we can probably have this feature (at least in a partial version) online and much faster documentation build times on top.</p>



<a name="294163910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/DocInk/near/294163910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/DocInk.html#294163910">(Aug 18 2022 at 20:24)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Array/Basic.html#Array.get_push">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Data/Array/Basic.html#Array.get_push</a> published!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>