---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html">VSCode Lean4 extension doesn't like `lakefile.lean`</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="255923212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255923212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255923212">(Oct 03 2021 at 04:48)</a>:</h4>
<p>I now get error messages of the form:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">`</span><span class="n">leanpkg</span> <span class="n">print</span><span class="bp">-</span><span class="n">paths</span><span class="bp">`</span> <span class="n">failed</span><span class="o">:</span>

<span class="n">stderr</span><span class="o">:</span>
<span class="n">configuring</span> <span class="n">testdep</span> <span class="mi">0</span><span class="bp">.</span><span class="mi">1</span>
<span class="bp">/</span><span class="n">Users</span><span class="bp">/</span><span class="n">scott</span><span class="bp">/</span><span class="n">projects</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">test</span><span class="bp">-</span><span class="n">mathport</span> <span class="n">must</span> <span class="n">contain</span> <span class="n">a</span> <span class="n">unique</span> <span class="bp">'.</span><span class="n">lean'</span> <span class="n">file</span> <span class="n">as</span> <span class="n">the</span> <span class="n">package</span> <span class="n">root</span>
</code></pre></div>
<p>because I have both <code>lakefile.lean</code> and <code>Testdep.lean</code> in the root of a repository. Is this a known issue? Is someone already working on having the VSCode lean4 extension talk to <code>lake</code> to obtain the path information?</p>



<a name="255924152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255924152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255924152">(Oct 03 2021 at 05:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Yeah, sadly Lean server and VSCode integration does not exist for Lake yet.</p>
<p>The way I understand it there needs to be an change to the Lean 4 server so that it will try<code>lake print-paths</code> if there is a <code>lakefile.lean</code> in the working directory. There may also be something on the VSCode side that needs to be done as well, but I am not sure what. </p>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> , <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> ?</p>



<a name="255925863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255925863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255925863">(Oct 03 2021 at 05:36)</a>:</h4>
<p>I believe that's it</p>



<a name="255951271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255951271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255951271">(Oct 03 2021 at 13:21)</a>:</h4>
<p>Yes, the server calls <code>leanpkg print-paths A.B C.D E.F.G</code> to compile the specified dependencies and print the path for the oleans.  Changing this to call lake is the easiest way to support lake.<br>
I would take the opportunity to use a more descriptive command name though (like <code>compile-imports</code>), and maybe also upgrade the output format to json.</p>



<a name="255951313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255951313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255951313">(Oct 03 2021 at 13:22)</a>:</h4>
<p>In the vscode extension, there is nothing to do (because we require the user to open the right directory).  We'll need to adapt the neovim plugin though.  I'm not sure if the emacs mode requires any changes.</p>



<a name="255953173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255953173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255953173">(Oct 03 2021 at 13:55)</a>:</h4>
<p>Compiling imports is merely a necessary side-effect for printing their paths <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="255953452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255953452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255953452">(Oct 03 2021 at 14:00)</a>:</h4>
<p>Yeah, I'm not sure what the best name for the operation is either.  If we reimplement <code>--old</code>, then that command will only print and not compile.</p>



<a name="255953890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255953890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255953890">(Oct 03 2021 at 14:06)</a>:</h4>
<p>When is <code>--old</code> used in Lean 3c?</p>



<a name="255953987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255953987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255953987">(Oct 03 2021 at 14:08)</a>:</h4>
<p>You need to manually set it in the vscode settings (as an extra argument to the server).  Then the server will use oleans even if they're out of date.</p>



<a name="255958201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255958201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255958201">(Oct 03 2021 at 15:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60/near/255925863">said</a>:</p>
<blockquote>
<p>I believe that's it</p>
</blockquote>
<p>What is the plan on this? Is this something you will be implementing after merging <a href="https://github.com/leanprover/lean4/pull/683">#683</a>? Or should i be updating the server and PR'ing a change?</p>



<a name="255971585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255971585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255971585">(Oct 03 2021 at 18:56)</a>:</h4>
<p>It should be part of the PR,  I can write the Lean side. JSON sounds like a good idea.</p>



<a name="255976271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255976271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255976271">(Oct 03 2021 at 20:08)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> currently, <code>lake print-paths</code> operators the same as <code>leanpkg print-paths</code>. That is, it performs a build (outputting the usual build information along the way) and then spits out two lines of search paths (the first being oleans and the second being sources). How would you like to see that changed?</p>



<a name="255982127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255982127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255982127">(Oct 03 2021 at 21:45)</a>:</h4>
<p>How about <code>{"LEAN_PATH": ..., "LEAN_SRC_PATH": ...}</code>?</p>



<a name="255989017"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/255989017" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#255989017">(Oct 03 2021 at 23:50)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> works for me. What about the build output, should that be completely quieted?</p>



<a name="256021679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256021679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256021679">(Oct 04 2021 at 08:15)</a>:</h4>
<p>Right. We definitely want to keep streaming it to the editor, so should we put the build output on stderr and the JSON on stdout?</p>



<a name="256088879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256088879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256088879">(Oct 04 2021 at 16:32)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> okay, done (results to stdout, build output to stderr). Do you want the the values for <code>LEAN_PATH</code> and <code>LEAN_SRC_PATH</code> in the JSON to still be search paths (i.e., strings separated by a <code>:</code>) or would you like them to just be JSON arrays of paths?</p>



<a name="256089805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256089805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256089805">(Oct 04 2021 at 16:37)</a>:</h4>
<p>Thanks. I have a slight preference for search paths since most users will simply forward the values to Lean. What do you think?</p>



<a name="256090129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256090129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256090129">(Oct 04 2021 at 16:39)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> it does not matter to me. The only complaints I can imagine is that search paths could break if a file name contains a ':'/';` (which I think my a be legal on Linux?) and that said separator is different on each platform (whereas the JSON would be cross-platform). Otherwise, they are both relatively easy to parse / process.</p>



<a name="256090870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256090870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256090870">(Oct 04 2021 at 16:43)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span>  another, somewhat unrelated question that has been bugging me: why are the <code>Json</code> and <code>Xml</code> libraries in <code>Lean</code> instead of <code>Std</code>?</p>



<a name="256096228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256096228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256096228">(Oct 04 2021 at 17:15)</a>:</h4>
<blockquote>
<p>I have a slight preference for search paths since most users will simply forward the values to Lean.</p>
</blockquote>
<p>We're talking about a lean-internal API here that is only called by the server.  The reason I suggested json here is partly for 1) future proofness, and 2) clarity of the information when debugging (if the two arrays come with human-readable keys then you don't have to guess what the first and second lines are (or if it's possible to get a third line)).</p>
<p>Regarding the format, I was thinking of a slightly more typed version:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">deriving</span> <span class="kd">instance</span> <span class="n">ToJson</span> <span class="n">for</span> <span class="n">System.FilePath</span>
<span class="n">deriving</span> <span class="kd">instance</span> <span class="n">FromJson</span> <span class="n">for</span> <span class="n">System.FilePath</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">ToJson</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">ToJson</span> <span class="o">(</span><span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">toJson</span> <span class="n">xs</span> <span class="o">:=</span> <span class="n">toJson</span> <span class="n">xs.toArray</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">FromJson</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">FromJson</span> <span class="o">(</span><span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">fromJson</span><span class="bp">?</span> <span class="n">j</span> <span class="o">:=</span> <span class="o">(</span><span class="n">fromJson</span><span class="bp">?</span> <span class="n">j</span> <span class="o">(</span><span class="n">α</span> <span class="o">:=</span> <span class="n">Array</span> <span class="n">α</span><span class="o">))</span><span class="bp">.</span><span class="n">map</span> <span class="n">Array.toList</span>

<span class="kd">structure</span> <span class="n">OutputBikesheddable</span> <span class="n">where</span>
  <span class="n">sourcePath</span> <span class="o">:</span> <span class="n">SearchPath</span>
  <span class="n">binaryPath</span> <span class="o">:</span> <span class="n">SearchPath</span>
  <span class="n">deriving</span> <span class="n">ToJson</span><span class="o">,</span> <span class="n">FromJson</span>
</code></pre></div>



<a name="256097416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256097416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256097416">(Oct 04 2021 at 17:23)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> neat idea. <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> what do you think? If we went this route, the <code>FilePath</code> and <code>List</code> instances should be added to Lean itself not Lake.</p>



<a name="256097601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256097601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256097601">(Oct 04 2021 at 17:24)</a>:</h4>
<p>If we choose this approach, then everything in the snippet needs to be in Lean.  The server needs the <code>FromJson OutputBikesheddable</code> instance after all.</p>



<a name="256097901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256097901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256097901">(Oct 04 2021 at 17:26)</a>:</h4>
<p>true, good point! In that case I would name that structure as follows:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">structure</span> <span class="n">LeanPaths</span> <span class="n">where</span>
  <span class="n">oleanPath</span> <span class="o">:</span> <span class="n">SearchPath</span>
  <span class="n">sourcePath</span> <span class="o">:</span> <span class="n">SearchPath</span>
  <span class="n">deriving</span> <span class="n">ToJson</span><span class="o">,</span> <span class="n">FromJson</span>
</code></pre></div>



<a name="256098612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256098612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256098612">(Oct 04 2021 at 17:30)</a>:</h4>
<p>I think we also need custom <code>FromJson</code>/<code>ToJson</code> instances for <code>FilePath</code>.  The default one produces <code>{"toString": "my/path"}</code>.</p>



<a name="256123438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256123438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256123438">(Oct 04 2021 at 20:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60/near/256090870">said</a>:</p>
<blockquote>
<p>why are the <code>Json</code> and <code>Xml</code> libraries in <code>Lean</code> instead of <code>Std</code>?</p>
</blockquote>
<p>I think this is just because we needed them in <code>Lean</code> (<code>Json</code> for the first LSP version), and so they ended up there. They might or might not also depend on other stuff in <code>Lean</code>. There are many modules or parts of modules which, imo, should be in <code>Std</code> before version 4.0 but aren't because it's not high priority.</p>



<a name="256124558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256124558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256124558">(Oct 04 2021 at 20:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="128280">Wojciech Nawrocki</span> [Fair enough, but to this point:</p>
<blockquote>
<p>I think this is just because we needed them in <code>Lean</code></p>
</blockquote>
<p>it should be noted that virtually of all <code>Std</code> is needed in <code>Lean</code> (that is why it is in the Lean core in the first place), so that really shouldn't be a consideration for its placement.</p>



<a name="256404700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256404700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256404700">(Oct 06 2021 at 12:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60/near/256096228">said</a>:</p>
<blockquote>
<blockquote>
<p>I have a slight preference for search paths since most users will simply forward the values to Lean.</p>
</blockquote>
<p>We're talking about a lean-internal API here that is only called by the server</p>
</blockquote>
<p>Is it likely it will stay that way for long :) ? If a user either wants to execute <code>lean</code> directly on a module (for which there could also be a subcommand like <code>lake lean</code>, much like <code>cargo rustc</code>) <em>or</em> wants to run any other Lean program that wants to <code>importModules</code> that module, using <code>print-paths</code> to set up the environment seems like the most natural solution. It is our equivalent to <a href="https://nixos.org/manual/nix/unstable/command-ref/new-cli/nix3-print-dev-env.html"><code>nix print-dev-env</code></a>. In fact, perhaps it should even default to <code>export LEAN_PATH=...</code> Bash output just like the Nix command unless <code>--json</code> is given.</p>



<a name="256405240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256405240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256405240">(Oct 06 2021 at 12:53)</a>:</h4>
<blockquote>
<p>to set up the environment seems like the most natural solution.</p>
</blockquote>
<p>I think the most natural solution would be to have a <code>lake lean ...</code> command that sets up the correct environment variables (and <code>--plugin</code> arguments!!).</p>



<a name="256405678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256405678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256405678">(Oct 06 2021 at 12:56)</a>:</h4>
<blockquote>
<p>or wants to run any other Lean program that wants to importModules that module,</p>
</blockquote>
<p>If you are already running Lean then it is arguably easier to parse the json (with the FromJson instance) than to parse a bash script.</p>



<a name="256405825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256405825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256405825">(Oct 06 2021 at 12:57)</a>:</h4>
<p>I was thinking more like <code>$(lake print-paths Mod.lean); myprogram Mod.lean</code></p>



<a name="256406012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256406012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256406012">(Oct 06 2021 at 12:58)</a>:</h4>
<p>But if <code>myprogram</code> wants to hardcode dependency on lake, then it can just use the same code as the server to communicate with it, sure</p>



<a name="256406057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256406057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256406057">(Oct 06 2021 at 12:58)</a>:</h4>
<blockquote>
<p>In fact, perhaps it should even default to export LEAN_PATH=... Bash output</p>
</blockquote>
<p>This reminds me of <a href="https://github.com/NixOS/nix/pull/545">https://github.com/NixOS/nix/pull/545</a>. Requiring to source bash scripts is a terrible UX for other shells.</p>



<a name="256406271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256406271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256406271">(Oct 06 2021 at 13:00)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60/near/256405825">said</a>:</p>
<blockquote>
<p>I was thinking more like <code>$(lake print-paths Mod.lean); myprogram Mod.lean</code></p>
</blockquote>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code> $(lake print-paths Mod.lean); myprogram Mod.lean
fish: Command substitutions not allowed
$(lake print-paths Mod.lean); myprogram Mod.lean
 ^
</code></pre></div>



<a name="256406283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256406283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256406283">(Oct 06 2021 at 13:00)</a>:</h4>
<p>Also not very cross-platform, I'll give you that :)</p>



<a name="256406462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256406462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256406462">(Oct 06 2021 at 13:01)</a>:</h4>
<p>So probably JSON is sufficient. I would still be surprised if users didn't find other uses for <code>print-paths</code>.</p>



<a name="256406497"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256406497" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256406497">(Oct 06 2021 at 13:01)</a>:</h4>
<blockquote>
<p>wants to hardcode dependency on lake</p>
</blockquote>
<p>I thought the plan was to hardcode a lake dependency everywhere, no?  At least editors, etc., will interface directly with lake so it's not like you can get away from it.</p>



<a name="256406679"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256406679" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256406679">(Oct 06 2021 at 13:02)</a>:</h4>
<blockquote>
<p>So probably JSON is sufficient. I would still be surprised if users didn't find other uses for print-paths.</p>
</blockquote>
<p>In most cases the command that is called "print-paths" right now is a pretty bad fit.  For example, if you want to get the list of source directories you don't want to trigger a build.</p>



<a name="256414663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256414663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256414663">(Oct 06 2021 at 13:53)</a>:</h4>
<p>I think editors are more justified in being opinionated than (underlying) cmdline tools are, just like <code>lean</code> does not depend on leanpkg/lake while <code>lean --server</code> does. But it doesn't really matter, I'm sure potential external users will manage to cope with auto-generated JSON field names as well.</p>



<a name="256451429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256451429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256451429">(Oct 06 2021 at 17:35)</a>:</h4>
<p>Added <code>print-paths</code> JSON &amp; Lake support to the Lake PR, not thoroughly tested</p>



<a name="256451659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256451659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256451659">(Oct 06 2021 at 17:37)</a>:</h4>
<p>I don't want the server to judge whether a project has Lake set up, so I'm assuming Lake will respond with empty output if that is not the case, like leanpkg</p>



<a name="256452105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256452105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256452105">(Oct 06 2021 at 17:40)</a>:</h4>
<p>If you want to test it with an external Lake, I'd suggest copying it into Lean's <code>bin/</code>... do we need a <code>LAKE_PATH</code> env var separate from <code>LEAN_SYSROOT</code> to make that easier?</p>



<a name="256452601"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256452601" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256452601">(Oct 06 2021 at 17:42)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> the structure uses <code>sourcePath</code>(i.e., spells out 'source') but its uses use <code>srcPath</code> -- how does that work?</p>



<a name="256452678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256452678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256452678">(Oct 06 2021 at 17:43)</a>:</h4>
<p>I am fine with the short spelling <code>src</code> if that is what you would prefer</p>



<a name="256453132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256453132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256453132">(Oct 06 2021 at 17:46)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> also, from, the CI results you appear to have missed renaming a <code>leanpkgProc</code> somewhere.</p>



<a name="256453230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256453230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256453230">(Oct 06 2021 at 17:46)</a>:</h4>
<p>Huh, I must have pushed the wrong commit somehow</p>



<a name="256487810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256487810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256487810">(Oct 06 2021 at 21:28)</a>:</h4>
<p>Should be good now. I hope.</p>



<a name="256490761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256490761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256490761">(Oct 06 2021 at 21:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> it builds, but sadly many of the interactive test are now broken for some reason. Could it be because they lack both a <code>leanpkg.toml</code> and/or a <code>lakefile.lean</code>?</p>



<a name="256491566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256491566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256491566">(Oct 06 2021 at 22:01)</a>:</h4>
<p>I'll fix it tomorrow</p>



<a name="256491773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256491773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256491773">(Oct 06 2021 at 22:03)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> fyi, I did update Lake to mirror the JSON syntax the server is now using, so an up-to-date should (hopefully) work with the server changes</p>



<a name="256563696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256563696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256563696">(Oct 07 2021 at 11:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60/near/256451659">said</a>:</p>
<blockquote>
<p>I don't want the server to judge whether a project has Lake set up, so I'm assuming Lake will respond with empty output if that is not the case, like leanpkg</p>
</blockquote>
<p><span class="user-mention" data-user-id="315577">@Mac</span> This is not the case yet, is it? The tests are failing because of that</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>    <span class="s2">"`/home/sebastian/lean/lean/build/release/stage1/bin/lake print-paths` failed:</span><span class="se">\n\n</span><span class="s2">stderr:</span><span class="se">\n</span><span class="s2">error: no such file or directory (error code: 2)</span><span class="se">\n</span><span class="s2">  file: ./lakefile.lean</span><span class="se">\n</span><span class="s2">"</span><span class="o">,</span>
</code></pre></div>



<a name="256601887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256601887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256601887">(Oct 07 2021 at 15:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60/near/256563696">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60/near/256451659">said</a>:</p>
<blockquote>
<p>I don't want the server to judge whether a project has Lake set up, so I'm assuming Lake will respond with empty output if that is not the case, like leanpkg</p>
</blockquote>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> This is not the case yet, is it? The tests are failing because of that</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code>    <span class="s2">"`/home/sebastian/lean/lean/build/release/stage1/bin/lake print-paths` failed:</span><span class="se">\n\n</span><span class="s2">stderr:</span><span class="se">\n</span><span class="s2">error: no such file or directory (error code: 2)</span><span class="se">\n</span><span class="s2">  file: ./lakefile.lean</span><span class="se">\n</span><span class="s2">"</span><span class="o">,</span>
</code></pre></div><br>
</p>
</blockquote>
<p>No, I guess misunderstood what you meant by that. I thought you meant that it would output nothing to stdout (which it does not). I strikes me as very weird for a Lake command to silently succeed when there is no lakefile and it did nothing.</p>



<a name="256601920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256601920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256601920">(Oct 07 2021 at 15:54)</a>:</h4>
<p>However, if you think that is best. I can make it do that. Since <code>print-paths</code> is a non-public command I don't feel that strongly about it.</p>



<a name="256603948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256603948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256603948">(Oct 07 2021 at 16:06)</a>:</h4>
<p>I'm also open to a special return code, but as you said it doesn't matter much</p>



<a name="256606536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256606536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256606536">(Oct 07 2021 at 16:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60/near/256603948">said</a>:</p>
<blockquote>
<p>I'm also open to a special return code</p>
</blockquote>
<p>I actually quite like that solution! That way the distinction is not completely undetectable. Any particular preference which code to use?</p>



<a name="256607632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256607632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256607632">(Oct 07 2021 at 16:28)</a>:</h4>
<p>No :)</p>



<a name="256609550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256609550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256609550">(Oct 07 2021 at 16:40)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> pushed, I went with the very uncreative code of <code>2</code>. XD</p>



<a name="256609635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256609635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256609635">(Oct 07 2021 at 16:41)</a>:</h4>
<p>Then we think alike <span aria-label="laughing" class="emoji emoji-1f606" role="img" title="laughing">:laughing:</span></p>



<a name="256614904"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256614904" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256614904">(Oct 07 2021 at 17:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60/near/256452105">said</a>:</p>
<blockquote>
<p>If you want to test it with an external Lake, I'd suggest copying it into Lean's <code>bin/</code>... do we need a <code>LAKE_PATH</code> env var separate from <code>LEAN_SYSROOT</code> to make that easier?</p>
</blockquote>
<p>Also, I meant to mention this earlier, but forgot. I do think a <code>LAKE_PATH</code> (or, ideally, just <code>LAKE</code>) environment variable for configuring the  Lake the Lean 4 server uses would be a good idea.</p>



<a name="256621412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256621412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256621412">(Oct 07 2021 at 17:55)</a>:</h4>
<p>done</p>



<a name="256621750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256621750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256621750">(Oct 07 2021 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> sounds great! what are the plans for when to merge the PR?</p>



<a name="256625136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256625136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256625136">(Oct 07 2021 at 18:21)</a>:</h4>
<p>I think we're only missing elan support</p>



<a name="256625171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256625171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256625171">(Oct 07 2021 at 18:21)</a>:</h4>
<p>Feel free to test-drive the CI artifact</p>



<a name="256658963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256658963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256658963">(Oct 07 2021 at 22:20)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> I gave it and go and it appears to be broken <span aria-label="sad" class="emoji emoji-2639" role="img" title="sad">:sad:</span> . The server running  <code>print-paths</code> through either <code>leanpkg</code> or <code>lake</code>  breaks with the error "expected JSON array, got 'null'".</p>



<a name="256659841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256659841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256659841">(Oct 07 2021 at 22:28)</a>:</h4>
<p>I believe <a href="https://github.com/leanprover/lean4/pull/683#discussion_r724574804">the change</a> I suggest in the PR may fix this.</p>



<a name="256661485"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256661485" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256661485">(Oct 07 2021 at 22:46)</a>:</h4>
<p>While attempting to debug that issue, I also discovered (and fixed) at least <a href="https://github.com/leanprover/lake/commit/18724704054d695a13bf5537fd89c00d1d27bc7e">one bug</a> of my own in Lake. So the Lake submodule will also need  a bump.</p>



<a name="256757322"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256757322" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256757322">(Oct 08 2021 at 15:29)</a>:</h4>
<p>Pushed the JSON changes, now tested once more, to master</p>



<a name="256764080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256764080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256764080">(Oct 08 2021 at 16:15)</a>:</h4>
<p>elan 1.1.0 with support for <code>lake</code> has been released</p>



<a name="256797152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256797152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256797152">(Oct 08 2021 at 19:58)</a>:</h4>
<p>Added some hints to make living with submodules easier :) <a href="https://github.com/leanprover/lean4/pull/683/commits/86cf1ceb0bb5b9280f2122e6895e9d99043817af">https://github.com/leanprover/lean4/pull/683/commits/86cf1ceb0bb5b9280f2122e6895e9d99043817af</a> /cc <span class="user-mention" data-user-id="112857">@Leonardo de Moura</span></p>



<a name="256797577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256797577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256797577">(Oct 08 2021 at 20:01)</a>:</h4>
<p>I can't think of anything else that should be done before merging the PR</p>



<a name="256798631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256798631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256798631">(Oct 08 2021 at 20:11)</a>:</h4>
<p>(If it's not too bikeshedy or controversial, subtrees are better than submodules IMHO --though still have a problem or two of their own if you mix a commit that touches lean and lake at the same time and want to now push to lake--, but they mean someone cloning the lean4 repo wouldn't need to know it vendors the lake repo)</p>



<a name="256803059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256803059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256803059">(Oct 08 2021 at 20:44)</a>:</h4>
<p>I didn't know that git subtree can squash the history, to be honest. One tenuous argument for a Lake submodule is that we were considering to eventually put stage0/ into a shallow submodule to drastically reduce the size of the repo.</p>



<a name="256803746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256803746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256803746">(Oct 08 2021 at 20:49)</a>:</h4>
<p>Yeah, the squashing is very convenient.</p>



<a name="256803858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256803858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256803858">(Oct 08 2021 at 20:50)</a>:</h4>
<p>I've been using one for ~8+ years on a pair of repos I manage (here: <a href="https://github.com/Julian/jsonschema/tree/main/json">https://github.com/Julian/jsonschema/tree/main/json</a>) and you can see each time it's a single easy to understand commit.</p>



<a name="256813925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/VSCode%20Lean4%20extension%20doesn%27t%20like%20%60lakefile.lean%60/near/256813925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60.html#256813925">(Oct 08 2021 at 22:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/270676-lean4/topic/VSCode.20Lean4.20extension.20doesn't.20like.20.60lakefile.2Elean.60/near/256797577">said</a>:</p>
<blockquote>
<p>I can't think of anything else that should be done before merging the PR</p>
</blockquote>
<p>I'd wait until at least tomorrow to merge it. That way I can update Lake to use <code>LeanPaths</code> and test it on today's nightly. Then the Lake submodule can be updated and the PR merged tomorrow so Lake is available in that nightly's release.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>