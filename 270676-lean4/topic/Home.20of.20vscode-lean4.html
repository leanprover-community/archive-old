---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Home.20of.20vscode-lean4.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html">Home of vscode-lean4</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="222167892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222167892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222167892">(Jan 09 2021 at 11:58)</a>:</h4>
<p>I'm not particularly happy with the current home of vscode-lean4 at <a href="https://github.com/mhuisi/vscode-lean4">mhuisi/vscode-lean4</a>. Ideally, I'd like the following to be true:</p>
<ol>
<li>vscode-lean4 should be situated at <a href="https://github.com/leanprover-community">leanprover-community</a>.</li>
<li>Given that much of vscode-lean4 will include porting features from vscode-lean, the full history with all the original authors should be preserved.</li>
<li>Future improvements to vscode-lean should be ported to vscode-lean4 (e.g. the recent improvements to <code>input.ts</code>), also while preserving the original authors.</li>
<li>The extension should be published under <code>leanprover</code>, not under my <code>mhuisi</code> account.</li>
</ol>
<p>I'd prefer to get this over with as soon as possible, so that <a href="https://github.com/mhuisi/vscode-lean4">mhuisi/vscode-lean4</a> does not widely establish itself as the URL for vscode-lean4 in documentation and elsewhere.</p>
<p>One difficulty is that I'm not sure how to satisfy (2) and (3).<br>
At the moment, vscode-lean4 is intentionally minimal, both in terms of structure and configuration. Ideally, I'd like to keep it this way for the time being, and not litter the project with files that are being used in vscode-lean, but have not been ported yet as the corresponding server behaviour has not been implemented. Additionally, the extension was initially based on Microsoft's <a href="https://github.com/microsoft/vscode-extension-samples/tree/master/lsp-sample">lsp-sample</a>, not vscode-lean, and hence also includes its <code>LICENSE</code>.</p>
<p>What do you think would be the best way to go about this?</p>



<a name="222167970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222167970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222167970">(Jan 09 2021 at 12:01)</a>:</h4>
<p>(<span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span class="user-mention" data-user-id="121918">@Edward Ayers</span> <span class="user-mention" data-user-id="123965">@Bryan Gin-ge Chen</span>)</p>



<a name="222168319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222168319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222168319">(Jan 09 2021 at 12:10)</a>:</h4>
<p>Regarding (1), that can be handled by transferring ownership of the repo. Github will helpfully make mhuisi/vscode-lean4 a redirect for leanprover-community/vscode-lean4 in perpetuity (we did the same thing when moving leanprover/mathlib to the leanprover-community account).</p>



<a name="222168386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222168386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222168386">(Jan 09 2021 at 12:12)</a>:</h4>
<p>I've been thinking about whether it is possible to have vscode-lean and vscode-lean4 actually be the same extension, with some heuristics to figure out whether we are in lean 4 mode. That will make the user experience a lot smoother</p>



<a name="222169266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222169266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222169266">(Jan 09 2021 at 12:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Home.20of.20vscode-lean4/near/222168386">said</a>:</p>
<blockquote>
<p>I've been thinking about whether it is possible to have vscode-lean and vscode-lean4 actually be the same extension, with some heuristics to figure out whether we are in lean 4 mode. That will make the user experience a lot smoother</p>
</blockquote>
<p>We could read <code>leanpkg.toml</code> and use <a href="https://code.visualstudio.com/api/references/vscode-api#languages.setTextDocumentLanguage">languages.setTextDocumentLanguage</a> or <a href="https://code.visualstudio.com/api/references/vscode-api#languages.setLanguageConfiguration">languages.setLanguageConfiguration</a>. Note that as of now, vscode-lean4 does not really require users to open the project folder, although that may change as e.g. <code>go to definition</code> is implemented.</p>



<a name="222172140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222172140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222172140">(Jan 09 2021 at 13:56)</a>:</h4>
<p>(2) can be solved by having a git repo with multiple roots in the git DAG, right?</p>



<a name="222174592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222174592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222174592">(Jan 09 2021 at 15:07)</a>:</h4>
<p>Yes, but that only helps if you want to bring in all the lean3 files with it</p>



<a name="222174637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222174637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222174637">(Jan 09 2021 at 15:08)</a>:</h4>
<p>Otherwise if you create that dag, delete all the files, then re-add them as you need them, git blame will just show when they were added</p>



<a name="222179003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222179003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222179003">(Jan 09 2021 at 17:11)</a>:</h4>
<p>Without being a specific solution, git-filter-repo is a (really <em>the</em>) thing that can help you filter some specific subset of files and preserve history: <a href="https://github.com/newren/git-filter-repo">https://github.com/newren/git-filter-repo</a>, but it can also get annoying if you at a later point want to add some additional file you didn't add at the beginning</p>



<a name="222179079"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222179079" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222179079">(Jan 09 2021 at 17:12)</a>:</h4>
<p>If you go the git-blame route (which I suspect is less annoying), git blame has a thing that lets you tell it revisions to ignore</p>



<a name="222179096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222179096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222179096">(Jan 09 2021 at 17:13)</a>:</h4>
<p><a href="https://www.git-scm.com/docs/git-blame#Documentation/git-blame.txt---ignore-revs-fileltfilegt">https://www.git-scm.com/docs/git-blame#Documentation/git-blame.txt---ignore-revs-fileltfilegt</a> -- that -- so you could maintain some file with the revisions that cleared out the files</p>



<a name="222180521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222180521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222180521">(Jan 09 2021 at 17:44)</a>:</h4>
<p>I like the idea of integrating vscode-lean4 into vscode-lean and might take a stab at it when I find the time to. Some initial thoughts about what that would look like:</p>
<ol>
<li><code>vscode-lean/extension.ts</code> becomes <code>extension_lean3.ts</code>, <code>vscode-lean4/extension.ts</code> becomes <code>extension_lean4.ts</code>.</li>
<li>A new <code>extension.ts</code> file reads <code>leanpkg.toml</code> and activates either <code>extension_lean3.ts</code> or <code>extension_lean4.ts</code> depending on the Lean version in the TOML. I don't think <code>leanpkg.ts</code> is useful here, since it has a dependency to <code>server.ts</code>. There might end up being some duplicate code here that can be factored out later.</li>
<li><code>lean.*</code> config options and commands remain as they are. The Lean 4 portion of the extension will reuse <code>lean.*</code> options/commands where possible and will declare its own Lean 4-exclusive options/commands as <code>lean4.*</code>.</li>
<li>Lean 3 will remain associated with the <code>lean</code> language id, whereas Lean 4 will be associated with the <code>lean4</code> language id. Similarly, there will be language configurations and syntax files for each version. <code>*.lean</code> remains associated with the language id <code>lean</code> by default. If launched, <code>extension_lean4.ts</code> will set the language id of every newly opened file to be <code>lean4</code>.</li>
<li>Files that don't reference <code>server.ts</code> can probably be used immediately as-is, whereas files that depend on <code>server.ts</code>will need to be ported for the Lean 4 portion of the extension. To support both language versions, this might result in multiple ported files <code>*_lean4.ts</code>.</li>
</ol>
<p>One might also consider running both language servers, e.g. in (4) if we decided to only set the language id to <code>lean4</code> for files from within the project and Lean 3 files from outside the project are opened, or if users decide to set the language of a file to <code>lean</code> manually. I'm not sure how well that would work; it would probably require more changes to the Lean 3 part of the extension so that there's no accidental overlap between features and hence I'm in favor of disregarding this for now.</p>



<a name="222181327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222181327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222181327">(Jan 09 2021 at 18:00)</a>:</h4>
<p>(Whether Lean 4-exclusive options/commands need to be <code>lean4.*</code> is also debatable, I think :))</p>



<a name="222189441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222189441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Bryan Gin-ge Chen <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222189441">(Jan 09 2021 at 20:57)</a>:</h4>
<p>Having a single extension for both Lean 3 and Lean 4 sounds like it would make things easiest for users at the cost of some integration pain for developers, which I personally think would be worth the effort. Points 1-5 above look like a reasonable plan to me, but I'd like to hear what <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> thinks.</p>
<p>P.S. I'm happy to help out to the extent I can, but I'm not familiar enough with the Lean 4 server yet to build much on my own. (Would be very interested in learning more about it though!) Feel free to ping me for questions or review.</p>



<a name="222316678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222316678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222316678">(Jan 11 2021 at 16:02)</a>:</h4>
<p><span class="user-mention" data-user-id="221921">@Marc Huisinga</span> I think your approach looks good.  The main benefit I expect from integrating both extensions is that it makes it easier to use both Lean 3 and Lean 4.  I believe the only code that would be initially shared by both extensions would be the input mode.  Eventually, the infoview might be shared as well.</p>



<a name="222316774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222316774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222316774">(Jan 11 2021 at 16:02)</a>:</h4>
<p>One potential downside is that we'll need to keep the Lean 3 part of the extension virtually forever.</p>



<a name="222316961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222316961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222316961">(Jan 11 2021 at 16:04)</a>:</h4>
<p>Maybe we should keep them separate after all, but still support installing them side-by-side (and running them at the same time in a workspace).</p>



<a name="222317331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222317331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222317331">(Jan 11 2021 at 16:06)</a>:</h4>
<p>I don't have a strong opinion on this, except that integrating the two makes it easier for me to preserve the git history of files like <code>input.ts</code> and use improvements to it in the future :)</p>



<a name="222317444"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222317444" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222317444">(Jan 11 2021 at 16:07)</a>:</h4>
<p>I'm perfectly happy to backport / forwardport PRs between the extensions myself if necessary, that shouldn't influence the decision.</p>



<a name="222317929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222317929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222317929">(Jan 11 2021 at 16:10)</a>:</h4>
<p>My suggestion for the "separate" approach would be to make one commit on top of the vscode-lean extension, which ontains the current changes of <code>vscode-lean4</code>, and then move out all the files that are not ported yet to a separate directory where they are not compiled.  This should result in straightforward merge PRs.</p>



<a name="222318067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222318067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222318067">(Jan 11 2021 at 16:11)</a>:</h4>
<p>I think it's unrealistic to expect much code sharing between the two extensions, both now and in the long run.</p>



<a name="222318518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222318518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222318518">(Jan 11 2021 at 16:14)</a>:</h4>
<blockquote>
<p>(and running them at the same time in a workspace).</p>
</blockquote>
<p>This is difficult. My proposal suggests that all *.lean files are identified according to the version specified in the <code>leanpkg.toml</code>. Users can set the version of a single file manually, but does that really work well with vscode-lean? I vaguely remember plenty of things only working well when you launch vscode-lean at the workspace-level.</p>



<a name="222318908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222318908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222318908">(Jan 11 2021 at 16:17)</a>:</h4>
<p>If we went for the "separate extensions" approach, I'd imagine that it would work somewhat similar to my earlier proposal: Both extensions read the <code>leanpkg.toml</code> and activate depending on the version.</p>



<a name="222319528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222319528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222319528">(Jan 11 2021 at 16:20)</a>:</h4>
<p>My main concern is that keeping the two extensions together is a lot of technical debt: Lean 3 server mode is essentially frozen (for compatibility reasons).  In a year or two from now, virtually nobody will use Lean 3 anymore but we'll still have lots of dead code in the repo.  Which we can't remove because one or two people will still want to look at old mathlib versions.</p>



<a name="222319621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222319621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222319621">(Jan 11 2021 at 16:21)</a>:</h4>
<blockquote>
<p>extension_lean4.ts will set the language id of every newly opened file to be lean4.</p>
</blockquote>
<p>Is there a reason this won't work for two separate extensions?</p>



<a name="222319839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222319839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222319839">(Jan 11 2021 at 16:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/Home.20of.20vscode-lean4/near/222319621">said</a>:</p>
<blockquote>
<blockquote>
<p>extension_lean4.ts will set the language id of every newly opened file to be lean4.</p>
</blockquote>
<p>Is there a reason this won't work for two separate extensions?</p>
</blockquote>
<p>It does, as suggested right above :)</p>



<a name="222319959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222319959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222319959">(Jan 11 2021 at 16:23)</a>:</h4>
<blockquote>
<p>Users can set the version of a single file manually, but does that really work well with vscode-lean?</p>
</blockquote>
<p>If I set the language type to C++, then the Lean 3 extensions seems to shut up.  It might still start the Lean server, but we can probably fix this.</p>



<a name="222320172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222320172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222320172">(Jan 11 2021 at 16:24)</a>:</h4>
<blockquote>
<p>If we went for the "separate extensions" approach, I'd imagine that it would work somewhat similar to my earlier proposal: Both extensions read the leanpkg.toml and activate depending on the version.</p>
</blockquote>
<p>This is probably the most reasonable approach.</p>



<a name="222320212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222320212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222320212">(Jan 11 2021 at 16:24)</a>:</h4>
<p>Right, that's not the issue. I'm wondering whether it's actually possible to reasonably run both language servers at once for the same workspace, and have vscode-lean do reasonable things when the project is a lean4 project, but the user sets some file to be lean3. The alternative is the conditional approach from my proposal, where only one server is active at a time.</p>



<a name="222320318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222320318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222320318">(Jan 11 2021 at 16:26)</a>:</h4>
<p>Ah, so there are two questions here:</p>
<ol>
<li>Should there be two extensions?</li>
<li>Should they be able run in a single project at the same time?</li>
</ol>



<a name="222320408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222320408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222320408">(Jan 11 2021 at 16:26)</a>:</h4>
<p>I'm not sure 2) matters very much.  If we want to do hybrid projects, we can always put them in subdirectories.</p>



<a name="222320459"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222320459" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222320459">(Jan 11 2021 at 16:27)</a>:</h4>
<p>What about mathlib porting though...? :)</p>



<a name="222320644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222320644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222320644">(Jan 11 2021 at 16:28)</a>:</h4>
<p>The hybrid approach as suggested by Leo would just have two directories: <code>mathlib/lean3</code> and <code>mathlib/lean4</code>.  Plus a script that compiles the lean3 directory into <code>lean4/MathlibOld.olean</code> or something.</p>



<a name="222320749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222320749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222320749">(Jan 11 2021 at 16:29)</a>:</h4>
<p>Putting both in the same directory doesn't work seamlessly either: elan picks the lean version based on <code>leanpkg.toml</code>.  And there's only one version field there.</p>



<a name="222321843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222321843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222321843">(Jan 11 2021 at 16:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/Home.20of.20vscode-lean4/near/222319528">said</a>:</p>
<blockquote>
<p>My main concern is that keeping the two extensions together is a lot of technical debt: Lean 3 server mode is essentially frozen (for compatibility reasons).  In a year or two from now, virtually nobody will use Lean 3 anymore but we'll still have lots of dead code in the repo.  Which we can't remove because one or two people will still want to look at old mathlib versions.</p>
</blockquote>
<p>It's not dead code until the users are not using it anymore. All indications are that this won't happen for a long while. If/when we get to a point where we can drop support for it, it can be moved to a separate extension (assuming you want to keep some lean 3 extension on the marketplace in perpetuity) based on a frozen version of the current one</p>



<a name="222322174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222322174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222322174">(Jan 11 2021 at 16:38)</a>:</h4>
<p>Also, I think it is possible to share more code if the lean 3 part of the code is just a shim to make the communication roughly compatible with the LSP interface</p>



<a name="222322192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222322192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222322192">(Jan 11 2021 at 16:38)</a>:</h4>
<p>If we want to separate the extensions anyhow, then why merge them in the first place?  From my point of view, the only real advantage is that the input mode can be shared.  Everything else will and should probably be independent anyhow.</p>



<a name="222322366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222322366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222322366">(Jan 11 2021 at 16:40)</a>:</h4>
<p>Having them as separate installed extensions means that they compete for "ownership" of the files. VSCode wants to associate an extension to the <code>.lean</code> file extension</p>



<a name="222322507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222322507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222322507">(Jan 11 2021 at 16:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Home.20of.20vscode-lean4/near/222322366">said</a>:</p>
<blockquote>
<p>Having them as separate installed extensions means that they compete for "ownership" of the files. VSCode wants to associate an extension to the <code>.lean</code> file extension</p>
</blockquote>
<p>This is not an issue, we can activate either extension conditionally depending on <code>leanpkg.toml</code> as in the earlier proposal and dynamically associate <code>*.lean</code> files with Lean 4.</p>



<a name="222322508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222322508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222322508">(Jan 11 2021 at 16:41)</a>:</h4>
<p>Having them both in one extension means that the lean 3/4 determination is up to the extension, which I think will be necessary</p>



<a name="222322586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222322586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222322586">(Jan 11 2021 at 16:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Home.20of.20vscode-lean4/near/222322508">said</a>:</p>
<blockquote>
<p>Having them both in one extension means that the lean 3/4 determination is up to the extension, which I think will be necessary</p>
</blockquote>
<p>I agree that this is necessary.  But it is also completely independent of whether there's one or two extensions.</p>



<a name="222322797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222322797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222322797">(Jan 11 2021 at 16:43)</a>:</h4>
<p>So the lean 3 extension thinks that all lean files are lean 3 and the lean 4 extension is conditionally activated? How does that work with things like syntax highlight?</p>



<a name="222322956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222322956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222322956">(Jan 11 2021 at 16:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Home.20of.20vscode-lean4/near/222322797">said</a>:</p>
<blockquote>
<p>So the lean 3 extension thinks that all lean files are lean 3 and the lean 4 extension is conditionally activated? How does that work with things like syntax highlight?</p>
</blockquote>
<p>Syntax highlighting is bound to the language id, not the file extension. I've already done and tested this stuff in my local fork of vscode-lean, I only need to integrate the conditional <code>leanpkg.toml</code> stuff.</p>



<a name="222322999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222322999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222322999">(Jan 11 2021 at 16:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Home.20of.20vscode-lean4/near/222322174">said</a>:</p>
<blockquote>
<p>Also, I think it is possible to share more code if the lean 3 part of the code is just a shim to make the communication roughly compatible with the LSP interface</p>
</blockquote>
<p>There's enough differences that it's not easy to paper over them with a shim.  For example: Lean 4 doesn't rebuild dependencies by itself.  Lean 3 has a specific widget protocol, etc.<br>
Either you make Lean 3 users angry by taking away Lean 3 features, or you make Lean 4 users angry by not supporting better protocols.</p>



<a name="222323145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222323145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222323145">(Jan 11 2021 at 16:45)</a>:</h4>
<blockquote>
<p>Lean 4 doesn't rebuild dependencies by itself</p>
</blockquote>
<p>So you have a "rebuild dependencies" command that is a no op for one of them</p>
<blockquote>
<p>Lean 3 has a specific widget protocol</p>
</blockquote>
<p>I hope that lean 4 gets one too (in the meantime it can be a no op)</p>



<a name="222323262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222323262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222323262">(Jan 11 2021 at 16:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/Home.20of.20vscode-lean4/near/222322192">said</a>:</p>
<blockquote>
<p>If we want to separate the extensions anyhow, then why merge them in the first place?  From my point of view, the only real advantage is that the input mode can be shared.  Everything else will and should probably be independent anyhow.</p>
</blockquote>
<p>One advantage (which I'm not sure matters much) is that we could eventually seamlessly turn vscode-lean into the Lean 4 extension and factor out the Lean 3 part into a vscode-lean3 extension, whereas if we use two separate extensions, the Lean 4 extension would likely always remain vscode-lean4, which could result in confusion.</p>



<a name="222323890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222323890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222323890">(Jan 11 2021 at 16:50)</a>:</h4>
<p>We can rename the "lean" extension to "lean 3" today.  That shouldn't be the issue here.</p>



<a name="222323961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222323961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222323961">(Jan 11 2021 at 16:51)</a>:</h4>
<p>Ok :)</p>



<a name="222324567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222324567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222324567">(Jan 11 2021 at 16:55)</a>:</h4>
<p>As long as it's <code>leanprover/lean4</code>, <code>vscode-lean4</code> seems appropriate</p>



<a name="222324575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222324575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222324575">(Jan 11 2021 at 16:55)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> The new widget protocol will probably look different from the current one.  Obvious cleanups aside, e.g. there's currently no way to keep a widget when a file is recompiled.<br>
But we're getting away from the main issue here.  Writing (and maintaining) a compatibility shim for Lean 3 is a dead end and having to support it indefinitely is technical debt.</p>



<a name="222324732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222324732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222324732">(Jan 11 2021 at 16:56)</a>:</h4>
<p>perhaps eventually, but good lean 3/4 integration is very important during the transition period, and I think the transition period will be quite long (&gt;1 year) so it seems like a worthwhile investment</p>



<a name="222324744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222324744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222324744">(Jan 11 2021 at 16:56)</a>:</h4>
<p>I am very happy that we don't have to support Lean 2 in the vscode extension.</p>



<a name="222324827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222324827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222324827">(Jan 11 2021 at 16:57)</a>:</h4>
<p>(i surrender at trying to understand zulip polls)</p>



<a name="222324895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222324895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222324895">(Jan 11 2021 at 16:57)</a>:</h4>
<p>From what Marc has found out, there doesn't seem to be any technical advantage to integrating both extensions.  We can and need to use exactly the same mechanism (manually setting language ids and parsing leanpkg.toml) in both cases.</p>



<a name="222325054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222325054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222325054">(Jan 11 2021 at 16:58)</a>:</h4>
<p>Fwiw, for the handful of Emacs users I'll just assume they're happy with using a separate editor instance per Lean version, which <code>emacs --eval</code> makes easy enough to set up (which is exactly what <code>nix run .#emacs-dev</code> is doing).</p>



<a name="222325390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222325390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222325390">(Jan 11 2021 at 17:00)</a>:</h4>
<p>vscode doesn't like it when you open the same folder twice, so as long as the vscode-lean4 extension takes over use of the lean extension as it does currently, it can't be used for hybrid projects</p>



<a name="222325572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222325572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222325572">(Jan 11 2021 at 17:02)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> What are your thoughts on <code>leanpkg.toml</code> for hybrid projects.  Both 3 and 4 in the same toml?  Two subdirectories for 3/4, and one toml per subdirectory?</p>



<a name="222325579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222325579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222325579">(Jan 11 2021 at 17:02)</a>:</h4>
<p>will it work if you manually set the language ID?</p>



<a name="222325669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222325669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222325669">(Jan 11 2021 at 17:03)</a>:</h4>
<p>My original hope was for the files themselves to indicate the language, e.g. via <code>#lang lean3</code></p>



<a name="222325930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222325930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222325930">(Jan 11 2021 at 17:04)</a>:</h4>
<p>It could be one toml or two, I don't think it makes a big difference. One toml per subdirectory would be a big change from the current setup though</p>



<a name="222325997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222325997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222325997">(Jan 11 2021 at 17:05)</a>:</h4>
<p>since right now you don't have to declare the list of files in a project</p>



<a name="222326069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222326069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222326069">(Jan 11 2021 at 17:05)</a>:</h4>
<p>I mean <code>mathlib/lean3/leanpkg.toml</code> and <code>mathlib/lean4/leanpkg.toml</code>.</p>



<a name="222326157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222326157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222326157">(Jan 11 2021 at 17:06)</a>:</h4>
<p>The reason I'm asking is this:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$ grep lean_version leanpkg.toml
<span class="nv">lean_version</span> <span class="o">=</span> <span class="s2">"leanprover-community/lean:3.24.0"</span>
</code></pre></div>



<a name="222326282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222326282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222326282">(Jan 11 2021 at 17:07)</a>:</h4>
<p>Oh, that might work, although if the lean3 files call the lean4 files and vice versa it's an interesting task to figure out how to get everything compiling</p>



<a name="222326344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222326344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222326344">(Jan 11 2021 at 17:07)</a>:</h4>
<p>I'm not sure if vice versa is necessary.  We can just start porting at the leaves.</p>



<a name="222326473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222326473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222326473">(Jan 11 2021 at 17:08)</a>:</h4>
<p>wasn't there talk of using oleans to communicate both ways?</p>



<a name="222326484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222326484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222326484">(Jan 11 2021 at 17:08)</a>:</h4>
<p>(in the lean 4 logic)</p>



<a name="222326593"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222326593" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222326593">(Jan 11 2021 at 17:09)</a>:</h4>
<p>I think it's easier to start porting from the root, since there will be competition for basic things like <code>Nat</code> vs <code>nat</code> otherwise</p>



<a name="222326704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222326704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222326704">(Jan 11 2021 at 17:10)</a>:</h4>
<p>Clearly, the olean converter needs to adapt the naming convention as well.</p>



<a name="222326753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222326753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222326753">(Jan 11 2021 at 17:10)</a>:</h4>
<p>that's not all though, it needs to be logic-equivalent and that's surely not going to be the case</p>



<a name="222326843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222326843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222326843">(Jan 11 2021 at 17:11)</a>:</h4>
<p>it will probably work okay for a lot of things but your average leaf file will almost certainly depend on at least one of the exceptions</p>



<a name="222327192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222327192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222327192">(Jan 11 2021 at 17:14)</a>:</h4>
<p>I'm not sure I understand completely what "logic-equivalent" is.  You obviously need to map <code>and</code> to <code>And</code>, and <code>iff</code> to <code>Iff</code>, and <code>quot</code> to <code>Quot</code>, and <code>classical.choice</code> to <code>Classical.choice</code>.</p>



<a name="222327837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222327837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222327837">(Jan 11 2021 at 17:18)</a>:</h4>
<p>I haven't looked at all the details of lean 4 definitions, but I would assume that they vary in at least a few places. For example <code>Add</code> has more arguments than <code>has_add</code>, there is more stuff with boolean equality and less with decidability, and other things of that nature. It's not a literal 1-1 replacement even if you fix the naming scheme</p>



<a name="222327861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222327861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Lacker <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222327861">(Jan 11 2021 at 17:18)</a>:</h4>
<p>are all the inheritance hierarchies going to be exactly the same between lean 3 and lean 4</p>



<a name="222328083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222328083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222328083">(Jan 11 2021 at 17:20)</a>:</h4>
<p>so in some leaf file about topological rings you will have <code>has_add</code> from lean 3 stuff and <code>Add</code> from lean 4 stuff and no theorems that relate them</p>



<a name="222328106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222328106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222328106">(Jan 11 2021 at 17:20)</a>:</h4>
<p><code>Add</code> is actually the same.  <code>HAdd</code> is new and different.</p>



<a name="222328379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222328379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222328379">(Jan 11 2021 at 17:22)</a>:</h4>
<p>There are some really gratuitious argument order changes though:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Lean 3:</span>
<span class="kd">def</span> <span class="n">ite</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">[</span><span class="n">h</span> <span class="o">:</span> <span class="n">decidable</span> <span class="n">c</span><span class="o">]</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">t</span> <span class="n">e</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="o">:=</span>
<span class="c1">-- Lean 4:</span>
<span class="kd">def</span> <span class="n">ite</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">[</span><span class="n">h</span> <span class="o">:</span> <span class="n">Decidable</span> <span class="n">c</span><span class="o">]</span> <span class="o">(</span><span class="n">t</span> <span class="n">e</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">α</span> <span class="o">:=</span>
</code></pre></div>



<a name="222328854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222328854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222328854">(Jan 11 2021 at 17:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/270676-lean4/topic/Home.20of.20vscode-lean4/near/222328106">said</a>:</p>
<blockquote>
<p><code>Add</code> is actually the same.  <code>HAdd</code> is new and different.</p>
</blockquote>
<p>This might be something to watch out for:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">comm1</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">[</span><span class="n">HAdd</span> <span class="n">α</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">HAdd.hAdd</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">HAdd.hAdd</span> <span class="n">y</span> <span class="n">x</span> <span class="o">:=</span> <span class="gr">sorry</span>
<span class="kd">theorem</span> <span class="n">comm2</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">[</span><span class="n">Add</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">Add.add</span> <span class="n">x</span> <span class="n">y</span> <span class="bp">=</span> <span class="n">Add.add</span> <span class="n">y</span> <span class="n">x</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">[</span><span class="n">Add</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">z</span> <span class="o">:=</span> <span class="kd">by</span>
    <span class="n">rw</span> <span class="n">comm1</span> <span class="n">x</span> <span class="c1">-- OK</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="n">z</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">[</span><span class="n">Add</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">y</span> <span class="bp">+</span> <span class="n">x</span> <span class="bp">+</span> <span class="n">z</span> <span class="o">:=</span> <span class="kd">by</span>
    <span class="n">rw</span> <span class="n">comm2</span> <span class="n">x</span> <span class="c1">-- Fails</span>
</code></pre></div>



<a name="222329375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222329375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222329375">(Jan 11 2021 at 17:30)</a>:</h4>
<p>I'm not sure if this will be a huge problem in practice.  Typically both <code>Add</code> and <code>HAdd</code> should come from <code>CommMonoid</code> or something, and then they're defeq.</p>



<a name="222329798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222329798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222329798">(Jan 11 2021 at 17:33)</a>:</h4>
<p>Except when doing keyed matching e.g. in <code>simp</code> (edit: or <code>rw</code> as above) <span aria-label="silence" class="emoji emoji-1f910" role="img" title="silence">:silence:</span> . Ideally the operators should not be mixed.</p>



<a name="222329916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222329916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222329916">(Jan 11 2021 at 17:34)</a>:</h4>
<p>I just mean if there's an interface to import Lean 3 oleans, then if somehow there's a mapping <code>has_add.add -&gt; Add.Add</code>, this test suggests you won't be able to use those lemmas with <code>rw</code> without some more work.</p>



<a name="222332069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222332069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222332069">(Jan 11 2021 at 17:49)</a>:</h4>
<p>Ah, so if I understand this correctly, <code>Add.add</code> is a forbidden constant that shouldn't be used.  Kind of like <code>comm_monoid.mul</code> now.</p>



<a name="222433921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222433921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222433921">(Jan 12 2021 at 14:00)</a>:</h4>
<p>Heterogeneous operators are very expressive, but that, as usual, does come with <a href="https://github.com/leanprover/lean4/commit/21208833078c022eb7ff60bd14fde3a730dc98a9">a few surprises</a> in practice. So really there should be one more experiment on whether the current encoding of heterogeneous operators with default instances works for mathlib or not. But once there has been a decision, people should stick with it to avoid rewriting issues, yes. Or they will need to call a tactic normalizing homogeneous to heterogeneous operators first.</p>



<a name="222443515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222443515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222443515">(Jan 12 2021 at 15:08)</a>:</h4>
<p>By the way Sebastian -- we've been using homogeneous <code>*</code> for years now in Lean 3, but occasionally we want an object to act on another object, and for this we often use mathlib's</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">has_scalar</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="n">γ</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">v</span><span class="o">)</span> <span class="o">:=</span> <span class="o">(</span><span class="n">smul</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">γ</span> <span class="bp">→</span> <span class="n">γ</span><span class="o">)</span>
</code></pre></div>
<p>which is tied to different notation (<code> • </code> a.k.a. <code>\bub</code>).</p>



<a name="222547243"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222547243" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mohamed Al-Fahim <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222547243">(Jan 13 2021 at 08:12)</a>:</h4>
<p>Should new feature PRs be made to <a href="https://github.com/mhuisi/vscode-lean4">https://github.com/mhuisi/vscode-lean4</a> or to <a href="https://github.com/leanprover/vscode-lean">https://github.com/leanprover/vscode-lean</a>? I have implemented unicode autocomplete for <a href="https://github.com/mhuisi/vscode-lean4">https://github.com/mhuisi/vscode-lean4</a>, and am not sure whether to implement it for <a href="https://github.com/leanprover/vscode-lean">https://github.com/leanprover/vscode-lean</a> too.</p>
<p><a href="/user_uploads/3121/qm4UlSuXJZ4ZFlKHZSH4XKgK/Lean-Unicode-Completion.gif">Lean-Unicode-Completion.gif</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/qm4UlSuXJZ4ZFlKHZSH4XKgK/Lean-Unicode-Completion.gif" title="Lean-Unicode-Completion.gif"><img src="/user_uploads/3121/qm4UlSuXJZ4ZFlKHZSH4XKgK/Lean-Unicode-Completion.gif"></a></div>



<a name="222550354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222550354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222550354">(Jan 13 2021 at 08:47)</a>:</h4>
<p>Input-related PRs should go to vscode-lean for the forseeable future.</p>



<a name="222708451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222708451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222708451">(Jan 14 2021 at 12:05)</a>:</h4>
<p>Isn't there already an open PR against vscode-lean for unicode autocomplete?</p>



<a name="222980217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222980217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222980217">(Jan 16 2021 at 13:02)</a>:</h4>
<p>[With the leanprover/lean4 master, all LSP clients now support displaying the type and documentation on hover]</p>



<a name="222982580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222982580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Super Veridical <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222982580">(Jan 16 2021 at 14:00)</a>:</h4>
<p>Would I be correct in saying that neither "lean4-mode" for emacs nor vscode-lean4 currently support proof-state/goal display?</p>



<a name="222988167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222988167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222988167">(Jan 16 2021 at 15:41)</a>:</h4>
<p>I guess my limited C++ skills are failing me since I can't seem to compile master on macOS, cmake is complaining about <code>fatal error: 'stdlib.h' file not found</code> once it gets to compiling <code>stage1</code> which IIRC is something usually about it using the wrong <code>sysroot</code> on macOS or somethign right? I'm using normal <code>clang++</code> as it looks like the lean4 docs recommend.</p>



<a name="222988270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222988270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222988270">(Jan 16 2021 at 15:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="321696">Julian Berman</span> <a href="#narrow/stream/270676-lean4/topic/Home.20of.20vscode-lean4/near/222988167">said</a>:</p>
<blockquote>
<p>I guess my limited C++ skills are failing me since I can't seem to compile master on macOS, cmake is complaining about <code>fatal error: 'stdlib.h' file not found</code> once it gets to compiling <code>stage1</code> which IIRC is something usually about it using the wrong <code>sysroot</code> on macOS or somethign right? I'm using normal <code>clang++</code> as it looks like the lean4 docs recommend.</p>
</blockquote>
<p>Alternatively you can also download the artifact directly: <a href="https://github.com/leanprover/lean4/runs/1712478947">https://github.com/leanprover/lean4/runs/1712478947</a> ("Artifacts" in the top right corner)</p>



<a name="222988344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222988344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222988344">(Jan 16 2021 at 15:44)</a>:</h4>
<p>Ah cool thanks!</p>



<a name="222988544"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222988544" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222988544">(Jan 16 2021 at 15:48)</a>:</h4>
<p><span class="user-mention" data-user-id="221921">@Marc Huisinga</span> prettyyyy :) it works, thanks!</p>



<a name="222988546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/222988546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#222988546">(Jan 16 2021 at 15:48)</a>:</h4>
<p>No need for that, everything should be contained in the latest nightly: <a href="https://github.com/leanprover/lean4-nightly/releases/tag/nightly-2021-01-16">https://github.com/leanprover/lean4-nightly/releases/tag/nightly-2021-01-16</a></p>



<a name="223066993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/223066993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#223066993">(Jan 17 2021 at 22:26)</a>:</h4>
<p>PR for compat with vscode-lean4: <a href="https://github.com/leanprover/vscode-lean/pull/253">https://github.com/leanprover/vscode-lean/pull/253</a></p>



<a name="224019164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/224019164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#224019164">(Jan 26 2021 at 10:16)</a>:</h4>
<p>To conclude this thread:</p>
<ul>
<li>vscode-lean4 has moved to <a href="https://github.com/leanprover-community/vscode-lean4">leanprover-community/vscode-lean4</a></li>
<li>The extension can now be found under the ID <a href="https://marketplace.visualstudio.com/items?itemName=leanprover.lean4">leanprover.lean4</a> on the marketplace</li>
<li>mhuisi.lean4, the old version of vscode-lean4 that was published on my user account, has been unpublished</li>
<li>The version of vscode-lean4 that is published at leanprover.lean4 can be run at the same time as vscode-lean</li>
<li><span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span> added server support for go to definition :)</li>
</ul>



<a name="224100954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/224100954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#224100954">(Jan 26 2021 at 20:50)</a>:</h4>
<p>I just installed Lean 4 to play a little bit with it. No problem to install the VScode extension, thanks a lot! Just a small issue with the go to definition feature: it seems it doesn't try to open the right file, so it doesn't find it. Possibly related to the fact that I'm on windows. The output is like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Impossible</span> <span class="n">d'ouvrir</span> <span class="bp">'</span><span class="n">Prelude.lean'</span> <span class="o">:</span> <span class="n">Impossible</span> <span class="n">de</span> <span class="n">lire</span> <span class="n">le</span> <span class="n">fichier</span> <span class="bp">'\\</span><span class="n">c</span><span class="o">:</span><span class="bp">\</span><span class="n">Users</span><span class="bp">\</span><span class="n">Sebastien</span><span class="bp">\.</span><span class="n">elan</span><span class="bp">\</span><span class="n">toolchains</span><span class="bp">\</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">lean4</span><span class="bp">-</span><span class="n">nightly</span><span class="bp">\</span><span class="n">bin</span><span class="bp">\</span><span class="n">Users</span><span class="bp">\</span><span class="n">Sebastien</span><span class="bp">\.</span><span class="n">elan</span><span class="bp">\</span><span class="n">toolchains</span><span class="bp">\</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">lean4</span><span class="bp">-</span><span class="n">nightly</span><span class="bp">\</span><span class="n">lib</span><span class="bp">\</span><span class="n">lean</span><span class="bp">\</span><span class="n">src</span><span class="bp">\</span><span class="n">Init</span><span class="bp">\</span><span class="n">Prelude.lean'</span> <span class="o">(</span><span class="n">Unknown</span> <span class="o">(</span><span class="n">FileSystemError</span><span class="o">):</span> <span class="n">Error</span><span class="o">:</span> <span class="n">UNKNOWN</span><span class="o">:</span> <span class="n">unknown</span> <span class="n">error</span><span class="o">,</span> <span class="n">stat</span> <span class="bp">'\\</span><span class="n">c</span><span class="o">:</span><span class="bp">\</span><span class="n">Users</span><span class="bp">\</span><span class="n">Sebastien</span><span class="bp">\.</span><span class="n">elan</span><span class="bp">\</span><span class="n">toolchains</span><span class="bp">\</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">lean4</span><span class="bp">-</span><span class="n">nightly</span><span class="bp">\</span><span class="n">bin</span><span class="bp">\</span><span class="n">Users</span><span class="bp">\</span><span class="n">Sebastien</span><span class="bp">\.</span><span class="n">elan</span><span class="bp">\</span><span class="n">toolchains</span><span class="bp">\</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">lean4</span><span class="bp">-</span><span class="n">nightly</span><span class="bp">\</span><span class="n">lib</span><span class="bp">\</span><span class="n">lean</span><span class="bp">\</span><span class="n">src</span><span class="bp">\</span><span class="n">Init</span><span class="bp">\</span><span class="n">Prelude.lean'</span><span class="o">)</span><span class="bp">.</span>
</code></pre></div>
<p>The right file to open would be <code>\\c:\Users\Sebastien\.elan\toolchains\leanprover-lean4-nightly\lib\lean\src\Init\Prelude.lean</code>, and the Lean location is <code>\\c:\Users\Sebastien\.elan\toolchains\leanprover-lean4-nightly\bin</code>. It seems it tries to concatenate the two to find the file name.</p>



<a name="224110462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/224110462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#224110462">(Jan 26 2021 at 22:00)</a>:</h4>
<p>Huh, interesting! <span class="user-mention" data-user-id="128280">@Wojciech Nawrocki</span> Any idea? Since the error seems to be from VS Code, <code>fileWithExt</code> must have succeeded. Prefixing that backslash-separated path with <code>file://</code> afterwards is probably incorrect, though I'm not sure how it could lead to this duplication.</p>



<a name="224117860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/224117860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#224117860">(Jan 26 2021 at 23:05)</a>:</h4>
<p>Just getting set up on Windows and I get this:</p>
<div class="codehilite" data-code-language="Bash"><pre><span></span><code>$ which leanpkg
/c/Users/Wojtek/Desktop/<span class="se">\U</span>sers<span class="se">\W</span>ojtek/.elan/bin/leanpkg
</code></pre></div>
<p>which looks suspiciously similar but it's just the shell.</p>



<a name="224144431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/224144431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#224144431">(Jan 27 2021 at 06:18)</a>:</h4>
<p>Well, I played with Lean 4 on Windows and I'm amazed you got as far as go-to-def <span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span> The actual bug appears to be that <code>file://host/fname</code> means "<code>fname</code> on remote host <code>host</code>", so VSCode interprets <code>c:</code> as a network share and then who knows what happens. For me, the editor crashes with an OOM/infinite loop. PR'd a fix that should appear in the nightly in a few days. My Windows setup is unfortunately incredibly painful to work with, so I will not be able to look at Windows any more until I resolve that.</p>



<a name="224435412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Home%20of%20vscode-lean4/near/224435412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Home.20of.20vscode-lean4.html#224435412">(Jan 29 2021 at 06:34)</a>:</h4>
<p>Just to confirm that with the last nightly the problem is solved on my computer. Thanks!</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>