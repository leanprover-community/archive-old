---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html">âœ” unintended instance</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="262957253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957253">(Nov 29 2021 at 00:41)</a>:</h4>
<p>Why not just provide that instance?</p>



<a name="262957301"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957301" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957301">(Nov 29 2021 at 00:42)</a>:</h4>
<p>and is the <code>1</code> being inferred as <code>Entry.int</code> or <code>Entry.float</code>?</p>



<a name="262957378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957378">(Nov 29 2021 at 00:44)</a>:</h4>
<p>One way around this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">Row</span> <span class="o">:=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="s2">"e"</span><span class="o">,</span> <span class="o">(</span><span class="mi">3</span><span class="bp">.</span><span class="mi">4</span> <span class="o">:</span> <span class="n">Float</span><span class="o">)]</span>
</code></pre></div>



<a name="262957399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957399">(Nov 29 2021 at 00:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="308899">Yakov Pechersky</span> <a href="#narrow/stream/270676-lean4/topic/unintended.20instance/near/262957301">said</a>:</p>
<blockquote>
<p>and is the <code>1</code> being inferred as <code>Entry.int</code> or <code>Entry.float</code>?</p>
</blockquote>
<p>Good question. I'm not sure</p>



<a name="262957476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957476">(Nov 29 2021 at 00:47)</a>:</h4>
<p>Make the <code>def</code> and then <code>#print</code> it.</p>



<a name="262957533"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957533" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957533">(Nov 29 2021 at 00:49)</a>:</h4>
<p>(The <code>OfScientific</code> isn't a coercion, by the way. It's the way <code>3.4</code> gets parsed using the typeclass system -- it's similar to <code>OfNat</code>.)</p>



<a name="262957596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957596">(Nov 29 2021 at 00:50)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">qq</span> <span class="o">:</span> <span class="n">Row</span> <span class="o">:=</span>
<span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="n">Entry.str</span> <span class="s2">"e"</span><span class="o">]</span>
</code></pre></div>
<p>It didn't say <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="262957609"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957609" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957609">(Nov 29 2021 at 00:50)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#reduce</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">Entry</span><span class="o">)</span>
<span class="c1">-- Entry.int (Int.ofNat 1)</span>
</code></pre></div>



<a name="262957619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957619">(Nov 29 2021 at 00:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="306601">Kyle Miller</span> <a href="#narrow/stream/270676-lean4/topic/unintended.20instance/near/262957533">said</a>:</p>
<blockquote>
<p>(The <code>OfScientific</code> isn't a coercion, by the way. It's the way <code>3.4</code> gets parsed using the typeclass system -- it's similar to <code>OfNat</code>.)</p>
</blockquote>
<p>Does it mean there isn't much I can do to provide a way for the user to do <code>let r : Row := [1, "e", 3.4]</code>?</p>



<a name="262957689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957689">(Nov 29 2021 at 00:52)</a>:</h4>
<p>Like Yakov suggested, you can provide an <code>OfScientific</code> instance, for example, rather than a coercion from <code>Float</code>, using Float's <code>OfScientific</code> instance.</p>



<a name="262957747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957747">(Nov 29 2021 at 00:54)</a>:</h4>
<p>How is the syntax for that?</p>



<a name="262957831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262957831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262957831">(Nov 29 2021 at 00:57)</a>:</h4>
<p>I wonder why <code>Int</code> is working, though.  There's a default instance for <code>Float</code> just like for <code>Nat</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[defaultInstance 100]</span> <span class="c">/-</span><span class="cm"> low prio -/</span>
<span class="kd">instance</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">OfNat</span> <span class="n">Nat</span> <span class="n">n</span> <span class="n">where</span> <span class="bp">...</span>

<span class="kd">@[defaultInstance mid+1]</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">OfScientific</span> <span class="n">Float</span> <span class="n">where</span> <span class="bp">...</span>
</code></pre></div>



<a name="262958034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262958034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262958034">(Nov 29 2021 at 01:00)</a>:</h4>
<p>I copy/pasted it, basically:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">OfScientific</span> <span class="n">Entry</span> <span class="n">where</span>
  <span class="n">ofScientific</span> <span class="n">m</span> <span class="n">s</span> <span class="n">e</span> <span class="o">:=</span> <span class="n">Entry.float</span>
    <span class="o">(</span><span class="k">if</span> <span class="n">s</span> <span class="k">then</span>
      <span class="k">let</span> <span class="n">s</span> <span class="o">:=</span> <span class="mi">64</span> <span class="bp">-</span> <span class="n">m.log2</span> <span class="c1">-- ensure we have 64 bits of mantissa left after division</span>
      <span class="k">let</span> <span class="n">m</span> <span class="o">:=</span> <span class="o">(</span><span class="n">m</span> <span class="bp">&lt;&lt;&lt;</span> <span class="o">(</span><span class="mi">3</span> <span class="bp">*</span> <span class="n">e</span> <span class="bp">+</span> <span class="n">s</span><span class="o">))</span> <span class="bp">/</span> <span class="mi">5</span><span class="bp">^</span><span class="n">e</span>
      <span class="n">Float.ofBinaryScientific</span> <span class="n">m</span> <span class="o">(</span><span class="bp">-</span><span class="mi">4</span> <span class="bp">*</span> <span class="n">e</span> <span class="bp">-</span> <span class="n">s</span><span class="o">)</span>
    <span class="k">else</span>
      <span class="n">Float.ofBinaryScientific</span> <span class="o">(</span><span class="n">m</span> <span class="bp">*</span> <span class="mi">5</span><span class="bp">^</span><span class="n">e</span><span class="o">)</span> <span class="n">e</span><span class="o">)</span>
</code></pre></div>
<p>It worked</p>



<a name="262958037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262958037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262958037">(Nov 29 2021 at 01:01)</a>:</h4>
<p>There you go:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">OfScientific</span> <span class="n">Entry</span> <span class="n">where</span>
  <span class="n">ofScientific</span> <span class="n">m</span> <span class="n">s</span> <span class="n">e</span> <span class="o">:=</span> <span class="n">Entry.float</span> <span class="o">(</span><span class="n">OfScientific.ofScientific</span> <span class="n">m</span> <span class="n">s</span> <span class="n">e</span><span class="o">)</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">Row</span> <span class="o">:=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="s2">"e"</span><span class="o">,</span> <span class="mi">3</span><span class="bp">.</span><span class="mi">4</span><span class="o">]</span>
</code></pre></div>



<a name="262958059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262958059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262958059">(Nov 29 2021 at 01:01)</a>:</h4>
<p>Nice!</p>



<a name="262958115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262958115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262958115">(Nov 29 2021 at 01:02)</a>:</h4>
<p>You probably want to keep the coercion since it would be convenient for non-literals.</p>



<a name="262958128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262958128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262958128">(Nov 29 2021 at 01:03)</a>:</h4>
<p>like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">c</span> <span class="o">:=</span> <span class="mi">3</span><span class="bp">.</span><span class="mi">4</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">Row</span> <span class="o">:=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="s2">"e"</span><span class="o">,</span> <span class="n">c</span><span class="o">]</span>
</code></pre></div>



<a name="262958200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262958200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262958200">(Nov 29 2021 at 01:05)</a>:</h4>
<p>Hm, I'm not intending to drop the coercions. Which coercion do you mean?</p>



<a name="262959700"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262959700" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262959700">(Nov 29 2021 at 01:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> has marked this topic as resolved.</p>



<a name="262983391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/%E2%9C%94%20unintended%20instance/near/262983391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marcus Rossel <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/.E2.9C.94.20unintended.20instance.html#262983391">(Nov 29 2021 at 09:25)</a>:</h4>
<p><span class="user-mention" data-user-id="451983">@Arthur Paulino</span> <br>
I think he means the <code>Float</code> to <code>Entry</code> coercion. </p>
<p>The example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">c</span> <span class="o">:=</span> <span class="mi">3</span><span class="bp">.</span><span class="mi">4</span>
<span class="kd">example</span> <span class="o">:</span> <span class="n">Row</span> <span class="o">:=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="s2">"e"</span><span class="o">,</span> <span class="n">c</span><span class="o">]</span>
</code></pre></div>
<p>...wouldn't work without it.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>