---
layout: archive
title: Zulip Chat Archive
permalink: /stream/270676-lean4/topic/Partitioning.20mathlib.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/index.html">lean4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html">Partitioning mathlib</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="240749889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240749889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240749889">(May 30 2021 at 10:44)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> What are the smallest strongly connected components? (i.e. pick a point, close under all forward edges)</p>



<a name="240749953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240749953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240749953">(May 30 2021 at 10:46)</a>:</h4>
<p>Regarding <code>data</code>, I think you should just treat the top level subfiles/folders in <code>data</code> as their own nodes in this graph. It's kind of a "misc" directory</p>



<a name="240750427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240750427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240750427">(May 30 2021 at 11:01)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">In</span><span class="o">[</span><span class="mi">76</span><span class="o">]:=</span> <span class="n">ConnectedComponents</span><span class="o">[</span><span class="n">t</span><span class="o">]</span>

<span class="n">Out</span><span class="o">[</span><span class="mi">76</span><span class="o">]</span><span class="bp">=</span> <span class="o">{{</span><span class="s2">"algebraic_topology"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"geometry"</span><span class="o">},</span> <span class="bp">\</span>
<span class="o">{</span><span class="s2">"representation_theory"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"probability_theory"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"computability"</span><span class="o">},</span> <span class="bp">\</span>
<span class="o">{</span><span class="s2">"algebra"</span><span class="o">,</span> <span class="s2">"algebraic_geometry"</span><span class="o">,</span> <span class="s2">"analysis"</span><span class="o">,</span> <span class="s2">"category_theory"</span><span class="o">,</span>
  <span class="s2">"combinatorics"</span><span class="o">,</span> <span class="s2">"control"</span><span class="o">,</span> <span class="s2">"data"</span><span class="o">,</span> <span class="s2">"deprecated"</span><span class="o">,</span> <span class="s2">"dynamics"</span><span class="o">,</span>
  <span class="s2">"field_theory"</span><span class="o">,</span> <span class="s2">"group_theory"</span><span class="o">,</span> <span class="s2">"linear_algebra"</span><span class="o">,</span> <span class="s2">"logic"</span><span class="o">,</span>
  <span class="s2">"number_theory"</span><span class="o">,</span> <span class="s2">"order"</span><span class="o">,</span> <span class="s2">"ring_theory"</span><span class="o">,</span> <span class="s2">"system"</span><span class="o">,</span> <span class="s2">"tactic"</span><span class="o">,</span>
  <span class="s2">"topology"</span><span class="o">,</span> <span class="s2">"measure_theory"</span><span class="o">,</span> <span class="s2">"testing"</span><span class="o">,</span> <span class="s2">"meta"</span><span class="o">,</span> <span class="s2">"set_theory"</span><span class="o">}}</span>
</code></pre></div>



<a name="240750475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240750475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240750475">(May 30 2021 at 11:02)</a>:</h4>
<p>:-(</p>



<a name="240750567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240750567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240750567">(May 30 2021 at 11:05)</a>:</h4>
<p>Doesn't appreciably improve if we explode <code>data</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">{{</span><span class="s2">"algebraic_topology"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"computability"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"data$ordmap"</span><span class="o">},</span> <span class="bp">\</span>
<span class="o">{</span><span class="s2">"geometry"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"probability_theory"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"data$analysis"</span><span class="o">},</span> <span class="bp">\</span>
<span class="o">{</span><span class="s2">"data$qpf"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"data$pfunctor"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"data$fp"</span><span class="o">},</span> <span class="bp">\</span>
<span class="o">{</span><span class="s2">"representation_theory"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"algebra"</span><span class="o">,</span> <span class="s2">"algebraic_geometry"</span><span class="o">,</span>
  <span class="s2">"analysis"</span><span class="o">,</span> <span class="s2">"category_theory"</span><span class="o">,</span> <span class="s2">"combinatorics"</span><span class="o">,</span> <span class="s2">"control"</span><span class="o">,</span> <span class="s2">"data"</span><span class="o">,</span>
  <span class="s2">"data$complex"</span><span class="o">,</span> <span class="s2">"data$equiv"</span><span class="o">,</span> <span class="s2">"data$finset"</span><span class="o">,</span> <span class="s2">"data$finsupp"</span><span class="o">,</span>
  <span class="s2">"data$fintype"</span><span class="o">,</span> <span class="s2">"data$int"</span><span class="o">,</span> <span class="s2">"data$list"</span><span class="o">,</span> <span class="s2">"data$matrix"</span><span class="o">,</span>
  <span class="s2">"data$multiset"</span><span class="o">,</span> <span class="s2">"data$mv_polynomial"</span><span class="o">,</span> <span class="s2">"data$nat"</span><span class="o">,</span> <span class="s2">"data$padics"</span><span class="o">,</span>
  <span class="s2">"data$pnat"</span><span class="o">,</span> <span class="s2">"data$polynomial"</span><span class="o">,</span> <span class="s2">"data$rat"</span><span class="o">,</span> <span class="s2">"data$real"</span><span class="o">,</span> <span class="s2">"data$set"</span><span class="o">,</span>
   <span class="s2">"data$zmod"</span><span class="o">,</span> <span class="s2">"data$zsqrtd"</span><span class="o">,</span> <span class="s2">"deprecated"</span><span class="o">,</span> <span class="s2">"dynamics"</span><span class="o">,</span>
  <span class="s2">"field_theory"</span><span class="o">,</span> <span class="s2">"group_theory"</span><span class="o">,</span> <span class="s2">"linear_algebra"</span><span class="o">,</span> <span class="s2">"logic"</span><span class="o">,</span>
  <span class="s2">"number_theory"</span><span class="o">,</span> <span class="s2">"order"</span><span class="o">,</span> <span class="s2">"ring_theory"</span><span class="o">,</span> <span class="s2">"system"</span><span class="o">,</span> <span class="s2">"tactic"</span><span class="o">,</span>
  <span class="s2">"topology"</span><span class="o">,</span> <span class="s2">"measure_theory"</span><span class="o">,</span> <span class="s2">"data$array"</span><span class="o">,</span> <span class="s2">"data$buffer"</span><span class="o">,</span>
  <span class="s2">"data$dlist"</span><span class="o">,</span> <span class="s2">"data$lazy_list"</span><span class="o">,</span> <span class="s2">"testing"</span><span class="o">,</span> <span class="s2">"data$bitvec"</span><span class="o">,</span>
  <span class="s2">"data$string"</span><span class="o">,</span> <span class="s2">"set_theory"</span><span class="o">,</span> <span class="s2">"data$num"</span><span class="o">,</span> <span class="s2">"data$seq"</span><span class="o">,</span> <span class="s2">"data$stream"</span><span class="o">,</span>
  <span class="s2">"meta"</span><span class="o">,</span> <span class="s2">"data$option"</span><span class="o">,</span> <span class="s2">"data$setoid"</span><span class="o">,</span> <span class="s2">"data$sigma"</span><span class="o">}}</span>
</code></pre></div>



<a name="240753595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240753595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240753595">(May 30 2021 at 12:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240750427">said</a>:</p>
<blockquote>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">In</span><span class="o">[</span><span class="mi">76</span><span class="o">]:=</span> <span class="n">ConnectedComponents</span><span class="o">[</span><span class="n">t</span><span class="o">]</span>

<span class="n">Out</span><span class="o">[</span><span class="mi">76</span><span class="o">]</span><span class="bp">=</span> <span class="o">{{</span><span class="s2">"algebraic_topology"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"geometry"</span><span class="o">},</span> <span class="bp">\</span>
<span class="o">{</span><span class="s2">"representation_theory"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"probability_theory"</span><span class="o">},</span> <span class="o">{</span><span class="s2">"computability"</span><span class="o">},</span> <span class="bp">\</span>
<span class="o">{</span><span class="s2">"algebra"</span><span class="o">,</span> <span class="s2">"algebraic_geometry"</span><span class="o">,</span> <span class="s2">"analysis"</span><span class="o">,</span> <span class="s2">"category_theory"</span><span class="o">,</span>
  <span class="s2">"combinatorics"</span><span class="o">,</span> <span class="s2">"control"</span><span class="o">,</span> <span class="s2">"data"</span><span class="o">,</span> <span class="s2">"deprecated"</span><span class="o">,</span> <span class="s2">"dynamics"</span><span class="o">,</span>
  <span class="s2">"field_theory"</span><span class="o">,</span> <span class="s2">"group_theory"</span><span class="o">,</span> <span class="s2">"linear_algebra"</span><span class="o">,</span> <span class="s2">"logic"</span><span class="o">,</span>
  <span class="s2">"number_theory"</span><span class="o">,</span> <span class="s2">"order"</span><span class="o">,</span> <span class="s2">"ring_theory"</span><span class="o">,</span> <span class="s2">"system"</span><span class="o">,</span> <span class="s2">"tactic"</span><span class="o">,</span>
  <span class="s2">"topology"</span><span class="o">,</span> <span class="s2">"measure_theory"</span><span class="o">,</span> <span class="s2">"testing"</span><span class="o">,</span> <span class="s2">"meta"</span><span class="o">,</span> <span class="s2">"set_theory"</span><span class="o">}}</span>
</code></pre></div><br>
</p>
</blockquote>
<p>Note that there is nothing special about <code>algebraic_topology</code>, <code>geometry</code>, or <code>representation_theory</code>. The fact that these are their own SCC just means that we haven't gone very far in these directions yet.<br>
There are quite-easy-to-state <del>conjectures</del>theorems in commutative algebra that were only proven a couple of years ago using perfectoid spaces. The Breen-Deligne resolutions in homological algebra that we carefully avoided in LTE are proven to exist using some hammers from algebraic topology. Representation theory uses a lot of Lie theory and algebraic geometry. At the same time, motivic conjectures in number theory/algebraic geometry use a lot of representation theory.<br>
This list can go on and on.</p>



<a name="240758226"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240758226" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240758226">(May 30 2021 at 14:29)</a>:</h4>
<p>Something looks odd about that result. I know that <code>computability</code> references <code>data$nat</code> for example. Perhaps we have the arrows the wrong way around?</p>



<a name="240758313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240758313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240758313">(May 30 2021 at 14:31)</a>:</h4>
<p>(I'm interested in a node in the graph and it's <em>dependencies</em>, since that represents a subcomponent that could possibly be extracted to a library. The lonely points in your analysis are just "endpoint theorems" that have no current applications outside their own field, like computability and representation theory.)</p>



<a name="240782328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240782328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240782328">(May 31 2021 at 01:02)</a>:</h4>
<p>What I did was take the equivalence relation <code>a ~ b</code> iff there is a path from a to b, and a path from b to a. (I think...)</p>



<a name="240782419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240782419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240782419">(May 31 2021 at 01:05)</a>:</h4>
<p>This is the strongly connected components. (And is invariant under reversing all arrows.)</p>
<p>What you suggested above (just take the closure under arrows in one direction) doesn't give a partition, but I agree is still useful. I'll compute it in a moment.</p>



<a name="240802649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240802649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240802649">(May 31 2021 at 07:50)</a>:</h4>
<p>The smallest set of top-level (+data) directories closed under adding imports is sadly:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">{</span><span class="s2">"algebra"</span><span class="o">,</span> <span class="s2">"analysis"</span><span class="o">,</span> <span class="s2">"category_theory"</span><span class="o">,</span> <span class="s2">"control"</span><span class="o">,</span> <span class="s2">"data"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"data.equiv"</span><span class="o">,</span> <span class="s2">"data.finset"</span><span class="o">,</span> <span class="s2">"data.finsupp"</span><span class="o">,</span> <span class="s2">"data.fintype"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"data.int"</span><span class="o">,</span> <span class="s2">"data.list"</span><span class="o">,</span> <span class="s2">"data.matrix"</span><span class="o">,</span> <span class="s2">"data.multiset"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"data.mv_polynomial"</span><span class="o">,</span> <span class="s2">"data.nat"</span><span class="o">,</span> <span class="s2">"data.option"</span><span class="o">,</span> <span class="s2">"data.polynomial"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"data.rat"</span><span class="o">,</span> <span class="s2">"data.seq"</span><span class="o">,</span> <span class="s2">"data.set"</span><span class="o">,</span> <span class="s2">"data.zmod"</span><span class="o">,</span> <span class="s2">"deprecated"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"group_theory"</span><span class="o">,</span> <span class="s2">"linear_algebra"</span><span class="o">,</span> <span class="s2">"logic"</span><span class="o">,</span> <span class="s2">"number_theory"</span><span class="o">,</span> <span class="s2">"order"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"ring_theory"</span><span class="o">,</span> <span class="s2">"tactic"</span><span class="o">,</span> <span class="s2">"topology"</span><span class="o">,</span> <span class="s2">"combinatorics"</span><span class="o">,</span> <span class="s2">"data.complex"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"data.real"</span><span class="o">,</span> <span class="s2">"field_theory"</span><span class="o">,</span> <span class="s2">"measure_theory"</span><span class="o">,</span> <span class="s2">"data.sigma"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"set_theory"</span><span class="o">,</span> <span class="s2">"data.stream"</span><span class="o">,</span> <span class="s2">"data.array"</span><span class="o">,</span> <span class="s2">"data.num"</span><span class="o">,</span> <span class="s2">"data.pnat"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"data.string"</span><span class="o">,</span> <span class="s2">"data.setoid"</span><span class="o">,</span> <span class="s2">"dynamics"</span><span class="o">,</span> <span class="s2">"data.zsqrtd"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"algebraic_geometry"</span><span class="o">,</span> <span class="s2">"data.padics"</span><span class="o">,</span> <span class="s2">"data.buffer"</span><span class="o">,</span> <span class="s2">"data.dlist"</span><span class="o">,</span> <span class="bp">\</span>
<span class="s2">"meta"</span><span class="o">,</span> <span class="s2">"testing"</span><span class="o">,</span> <span class="s2">"data.bitvec"</span><span class="o">,</span> <span class="s2">"data.lazy_list"</span><span class="o">,</span> <span class="s2">"system"</span><span class="o">}</span>
</code></pre></div>



<a name="240802819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240802819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240802819">(May 31 2021 at 07:52)</a>:</h4>
<p>Wait, I don't think I understand what you mean with "closed under adding imports".</p>



<a name="240802851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240802851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240802851">(May 31 2021 at 07:52)</a>:</h4>
<p>Say directory A imports directory B if _some_ file in A imports _some_ file in B.</p>



<a name="240802889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240802889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240802889">(May 31 2021 at 07:53)</a>:</h4>
<p>Say directory A transitively imports directory B is there is a chain of such...</p>



<a name="240802891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240802891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240802891">(May 31 2021 at 07:53)</a>:</h4>
<p>Ooh, wow. What is the complement of that smallest set?</p>



<a name="240802910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240802910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240802910">(May 31 2021 at 07:53)</a>:</h4>
<p>Claim, this is the smallest set of directories closed under "imports".</p>



<a name="240802968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240802968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240802968">(May 31 2021 at 07:54)</a>:</h4>
<p>{"algebraic_topology", "computability", "data.analysis", "data.fp", \<br>
"data.ordmap", "data.pfunctor", "data.qpf", "geometry", \<br>
"probability_theory", "representation_theory"}</p>



<a name="240802981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240802981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240802981">(May 31 2021 at 07:54)</a>:</h4>
<p>So just the "brand new" stuff plus some abandonware.</p>



<a name="240802992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240802992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240802992">(May 31 2021 at 07:54)</a>:</h4>
<p>If you take any point v in the graph and add all points it points to and all points they point to and so on, you get a set. You can do this for every point in the graph and many of them will be the same, and the ones that are minimal by subset order will also be SCCs (every point in the set will generate the set by this procedure)</p>



<a name="240803061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240803061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240803061">(May 31 2021 at 07:55)</a>:</h4>
<p>The problem here is that blurring things out to directory level makes mathlib very much not a DAG.</p>



<a name="240803145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240803145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240803145">(May 31 2021 at 07:56)</a>:</h4>
<p>I think this is all making the point that every directory uses every other directory very well though</p>



<a name="240803296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240803296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240803296">(May 31 2021 at 07:58)</a>:</h4>
<p>for example with the graph <code>A -&gt; B &lt;-&gt; C</code> you get the sets <code>{A, B, C}</code> (not a SCC) and <code>{B, C}</code> (a SCC)</p>



<a name="240806677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240806677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240806677">(May 31 2021 at 08:37)</a>:</h4>
<p>I don't think that effect of directory blurring is surprising; if you have a lemma connecting two directories A and B, its file usually ends up in one of A or B without much thought as to which.</p>



<a name="240845511"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240845511" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240845511">(May 31 2021 at 15:21)</a>:</h4>
<p>Any particular reason why dependencies are being analyzed at the directory level rather than the file level? I would imagine that each area of theory would be interconnected with others. However, I also imagine there exists some "basic" foundation that each area defines without reference to others that could be extracted out into some "prelude" that could be imported by each area that leverages it. The interconnected components would then be add latter in the main file.</p>
<p>For example,  you could have <code>prelude/algebra</code> which defines all the type classes relevant to algebra and that may be imported by other things like <code>ring_theory</code> and then <code>algebra</code> proper that imports <code>prelude/algebra</code> along with stuff in others areas to fill in the interconnections.</p>



<a name="240846934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240846934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240846934">(May 31 2021 at 15:35)</a>:</h4>
<p>I guess that means we'll have north of 50 pkgs. Which is probably fine. As long as they don't have to be maintained manually.</p>



<a name="240851136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240851136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240851136">(May 31 2021 at 16:21)</a>:</h4>
<p>Yeah I have no problem with having 50 packages <em>if</em> it can all be handled transparently and doesn't affect the naming of things. The problem is that naming things <code>prelude27/algebra</code> makes it absolutely atrocious to find anything. I really want a solution that allows the packaging to work on a level orthogonal to file layout and module naming (which is topical, not based on dependency order)</p>



<a name="240859836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240859836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Brandon Brown <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240859836">(May 31 2021 at 18:17)</a>:</h4>
<p>Is just splitting mathlib into two things still on the table, a "complib" and a "mathlib" where complib (or whatever it would be called) just contains tactics and other basic things that mathlib or any computation-focused people alike would need?</p>



<a name="240860046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860046" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860046">(May 31 2021 at 18:20)</a>:</h4>
<p>quite frankly I would like to call that other lib "std"</p>



<a name="240860269"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860269" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860269">(May 31 2021 at 18:23)</a>:</h4>
<p>I do think there is a place for a more separate piece of mathlib which is more focused on comp sci, tactics, and the basic mathematics needed to support it, while still being batteries-included like mathlib</p>



<a name="240860422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860422">(May 31 2021 at 18:25)</a>:</h4>
<p>That is at least topically separate enough that people can probably get their heads around it (although there is conceivably a good deal of overlap when it comes to the kind of stuff that ends up in <code>data</code>)</p>



<a name="240860425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860425">(May 31 2021 at 18:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240851136">said</a>:</p>
<blockquote>
<p>Yeah I have no problem with having 50 packages <em>if</em> it can all be handled transparently and doesn't affect the naming of things. The problem is that naming things <code>prelude27/algebra</code> makes it absolutely atrocious to find anything.</p>
</blockquote>
<p>I am not sure this would be a problem. For example if I have I want all of algebra I import<code>Algebra</code>, if I just want algebra's prelude I import <code>Algebra.Prelude</code>. The prelude, if necessary, could be split into separate modules as well (ex. <code>Algebra.PreludeA</code>and <code>Algebra.PreludeB</code> -- the real modules would have more informative names -- like <code>Classes</code> or <code>Basic</code> or whatever). If said splits are sequential (i.e. <code>PreludeB</code> imports <code>PreludeA</code>) then only the relevant level would need to be imported by users. If said splits are independent than the user can imported whichever of <code>PreludeA</code> and/or <code>PreludeB</code> they need.</p>



<a name="240860529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860529">(May 31 2021 at 18:26)</a>:</h4>
<blockquote>
<p>if said splits are independent than the user can imported whichever of PreludeA or PreludeB they need.</p>
</blockquote>
<p>Right, this is the problem - you won't be able to tell which one you want most of the time because the names are likely to be very difficult to make informative</p>



<a name="240860684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860684">(May 31 2021 at 18:29)</a>:</h4>
<p>We already have this kind of thing, at the file level. Mathlib almost always uses precise imports to combat dependency creep. I just want to leverage that instead of adding another thing for users to deal with</p>



<a name="240860713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860713">(May 31 2021 at 18:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240860529">said</a>:</p>
<blockquote>
<p>you won't be able to tell which one you want most of the time because the names are likely to be very difficult to make informative</p>
</blockquote>
<p>Why? What makes it so hard to give informative names? For example, If have a module with <code>foo</code>, <code>bar</code>, and <code>baz</code>. I could, in the worst case,  call it <code>FooBarBaz</code>.</p>



<a name="240860800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860800">(May 31 2021 at 18:30)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240860684">said</a>:</p>
<blockquote>
<p>We already have this kind of thing, at the file level. Mathlib almost always uses precise imports to combat dependency creep. I just want to leverage that instead of adding another thing for users to deal with</p>
</blockquote>
<p>I thought we were talking about the file level?</p>



<a name="240860808"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860808" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860808">(May 31 2021 at 18:30)</a>:</h4>
<p>What if it's <code>foo</code> and then <code>bar</code> and then more <code>foo</code> and then <code>foo</code> and <code>bar</code> together?</p>



<a name="240860837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860837">(May 31 2021 at 18:30)</a>:</h4>
<p>sometimes it gets hard to name things beyond <code>Foo1</code>, <code>Bar</code>, <code>Foo2</code>, <code>FooBar</code></p>



<a name="240860856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860856">(May 31 2021 at 18:31)</a>:</h4>
<p>Or what if there are 10 files that progressively treat more and more theory of <code>foo</code>?</p>



<a name="240860857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860857">(May 31 2021 at 18:31)</a>:</h4>
<p>and then if you have a foo fact you want you have to go looking through several files</p>



<a name="240860880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860880" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860880">(May 31 2021 at 18:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240860808">said</a>:</p>
<blockquote>
<p>What if it's <code>foo</code> and then <code>bar</code> and then more <code>foo</code> and then <code>foo</code> and <code>bar</code> together?</p>
</blockquote>
<p>If there is no greater logical grouping than I really should have six modules: <code>Foo.Basic</code>, <code>Bar.Basic</code>, <code>Foo.Extra</code>,  <code>FooBar</code>,  <code>Foo</code> (<code>Foo.Basic</code> + <code>Foo.Extra</code> + <code>FooBar</code>), and <code>Bar</code> (<code>Bar.Basic</code> + <code>FooBar</code>).</p>



<a name="240860960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240860960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240860960">(May 31 2021 at 18:32)</a>:</h4>
<p>mathlib has this issue a <em>lot</em>, because that's how math works: the concepts are few but the layers of theorems keep coming. Reminder that FLT is a theorem about the natural numbers</p>



<a name="240861082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861082">(May 31 2021 at 18:34)</a>:</h4>
<p>So <code>Foo</code> is the complete theory of <code>foo</code>? Does that mean that it conceptually could import literally anything in mathlib?</p>



<a name="240861093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861093">(May 31 2021 at 18:34)</a>:</h4>
<p>because that means it will be unusable (in mathlib)</p>



<a name="240861109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861109">(May 31 2021 at 18:35)</a>:</h4>
<p>That is what I would expect, yes</p>



<a name="240861124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861124">(May 31 2021 at 18:35)</a>:</h4>
<p>(as an end user)</p>



<a name="240861126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861126">(May 31 2021 at 18:35)</a>:</h4>
<p>Unfortunately a lot of mathlib files fall in roughly this category which is why the dependency graph is such a rats nest</p>



<a name="240861391"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861391" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861391">(May 31 2021 at 18:39)</a>:</h4>
<p>In what category do you mean?</p>



<a name="240861400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861400">(May 31 2021 at 18:39)</a>:</h4>
<p>From an end user perspective (someone importing the library), there aren't any dependency issues, you can just use whatever you like. I'm talking about the within-mathlib perspective. (When I said "users" earlier I meant contributors)</p>



<a name="240861503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861503">(May 31 2021 at 18:40)</a>:</h4>
<p>Almost every new file conceptually builds on everything that came before. If you are a mathematician expanding the theory in some area you don't want to be bothered with this dependency tetris, you just import what you need</p>



<a name="240861577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861577">(May 31 2021 at 18:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240861503">said</a>:</p>
<blockquote>
<p>Almost every new file conceptually builds on everything that came before. If you are a mathematician expanding the theory in some area you don't want to be bothered with this dependency tetris, you just import what you need</p>
</blockquote>
<p>That's fine for prototyping, but upon actual addition to the library, optimizing imports should be done.</p>



<a name="240861586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861586">(May 31 2021 at 18:41)</a>:</h4>
<p>As a maintainer, this approach doesn't bother me so much, because dependency pruning is an activity that can be dealt with separately and requires very little mathematical skill</p>



<a name="240861652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861652">(May 31 2021 at 18:42)</a>:</h4>
<p>Okay so we seem to be on the same page there.</p>



<a name="240861699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861699" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861699">(May 31 2021 at 18:43)</a>:</h4>
<p>In which case a contributor could write their new file using the complete endpoints (ex. <code>Foo</code> and <code>Bar</code>) and the later dependency pruning step could optimize the dependencies and add that file to its relevant  theories (including, possibly <code>Foo</code> and/or <code>Bar</code>).</p>



<a name="240861767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861767">(May 31 2021 at 18:44)</a>:</h4>
<p>However, what this means is that the actual intended position of most files in the dependency graph is not clear. Is this a high-end theorem? Something foundational? Many files mix a bit of both, and high-end theorems often try to race each other to the top</p>



<a name="240861833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861833">(May 31 2021 at 18:45)</a>:</h4>
<p>Maybe some tooling could be written to take a Lean file and inject its definitions into the proper place in the dependency graph based on used name?</p>



<a name="240861880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861880" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861880">(May 31 2021 at 18:46)</a>:</h4>
<p>Given that, a naming/foldering convention that makes dependency height important is a distraction for most contributors. Dependency organization is important but should be centralized in a way that doesn't impact the contributor experience</p>



<a name="240861909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861909">(May 31 2021 at 18:46)</a>:</h4>
<p>for example, a build file that explicitly orders everything</p>



<a name="240861930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861930">(May 31 2021 at 18:47)</a>:</h4>
<p>although full dependency inference is also possible</p>



<a name="240861966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240861966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240861966">(May 31 2021 at 18:47)</a>:</h4>
<p>the advantage being that you never have to worry about dependency order unless you hit a cycle</p>



<a name="240862040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862040">(May 31 2021 at 18:48)</a>:</h4>
<p>Yeah that is what I was thinking. The idea would be contributors would all stick their contributions in a <code>newstuff</code> folder (or something like that) that would use the easy-to-access endpoints (ex. <code>Algebra</code> or <code>Foo</code>/<code>Bar</code>) and a latter dependency pruning / build step would reorder things to be reasonable (by refactor additions into <code>Foo.Basic</code> / <code>Bar.Basic</code> or whatever).</p>



<a name="240862104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862104">(May 31 2021 at 18:49)</a>:</h4>
<p>We want people to organize new material though. The organization is based on topic, not dependency order, though</p>



<a name="240862162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862162">(May 31 2021 at 18:50)</a>:</h4>
<p>okay, so the contributions in the postulated <code>newstuff</code> folder (or whatever) could be organized into folders based on topic?</p>



<a name="240862195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862195">(May 31 2021 at 18:51)</a>:</h4>
<p>and the other part?</p>



<a name="240862207"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862207" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862207">(May 31 2021 at 18:51)</a>:</h4>
<p>which other part?</p>



<a name="240862236"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862236" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862236">(May 31 2021 at 18:51)</a>:</h4>
<p>right now all of mathlib is organized like your <code>newstuff</code> folder</p>



<a name="240862299"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862299" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862299">(May 31 2021 at 18:52)</a>:</h4>
<p>it sounds like you are trying to add an explicit transition point to a different organization scheme which is based on dependencies</p>



<a name="240862333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862333">(May 31 2021 at 18:52)</a>:</h4>
<p>So then the dependency pruning step involves taking those definitions and sticking them into the proper modules based on their dependency order (and topic).</p>



<a name="240862353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862353">(May 31 2021 at 18:53)</a>:</h4>
<p>but then users have to know about that dependency order in order to import the file</p>



<a name="240862441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862441">(May 31 2021 at 18:54)</a>:</h4>
<p>Yes, that is generally how end user importing of files/libraries works? If they want to be specific about things, otherwise they also just use the easy endpoints.</p>



<a name="240862527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862527">(May 31 2021 at 18:55)</a>:</h4>
<p>The point in this whole effort would be for those users who specifically only want to leverage stuff at higher levels of the dependency chain.</p>



<a name="240862597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862597">(May 31 2021 at 18:56)</a>:</h4>
<p>It would also then help in migrating some of that stuff into a separate less mathy, more standard library.</p>



<a name="240862622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862622">(May 31 2021 at 18:57)</a>:</h4>
<p>Why can't the naming just not be related to dependency order?</p>



<a name="240862631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862631">(May 31 2021 at 18:57)</a>:</h4>
<p>It is strange to me that this needs to be so intertwined</p>



<a name="240862639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862639">(May 31 2021 at 18:57)</a>:</h4>
<p>Just let people name things as they like</p>



<a name="240862871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862871">(May 31 2021 at 19:00)</a>:</h4>
<p>When you start going to the very fine grained approach, your packages again won't make much sense. You need the packages to talk about a topic, at least roughly</p>



<a name="240862922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240862922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240862922">(May 31 2021 at 19:01)</a>:</h4>
<p>Yes, but I think we are talking about files within packages though.</p>



<a name="240863022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863022">(May 31 2021 at 19:02)</a>:</h4>
<p>If end users have the ability to make a la carte sub-packages from mathlib according to whatever they feel like importing, then that pretty much solves the problem without having to do solve the hardest problem in computer science (naming things)</p>



<a name="240863031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863031">(May 31 2021 at 19:02)</a>:</h4>
<p>Why don't we simply have a MacLib organized and developped by Mac the way Mac thinks is good and keep mathlib the way it works so great for everyone else?</p>



<a name="240863075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863075">(May 31 2021 at 19:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240863031">said</a>:</p>
<blockquote>
<p>Why don't we simply have a MacLib organized and developped by Mac the way Mac thinks is good and keep mathlib the way it works so great for everyone else?</p>
</blockquote>
<p>Fyi, I wasn't the one who proposed partitioning mathlib here.</p>



<a name="240863105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863105">(May 31 2021 at 19:03)</a>:</h4>
<p>I was simply providing some ideas as to how that could occur.</p>



<a name="240863234"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863234" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863234">(May 31 2021 at 19:05)</a>:</h4>
<p>I asked about topical packages early in the thread and I got legitimate issues. The idea of splitting up must make sense in order to happen.</p>



<a name="240863337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863337">(May 31 2021 at 19:06)</a>:</h4>
<p>The idea of doing ad hoc packages sounds like dead code elimination which is something we could do in the compiler domain</p>



<a name="240863379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863379">(May 31 2021 at 19:07)</a>:</h4>
<p>this would be more like leanpkg domain, but that's the general idea</p>



<a name="240863490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863490">(May 31 2021 at 19:09)</a>:</h4>
<p>Not really... Why bother with files. Might just as well do it on the definition level</p>



<a name="240863519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863519">(May 31 2021 at 19:09)</a>:</h4>
<p>It's like dead code elimination and you choosing to re export what you want to reuse</p>



<a name="240863530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863530">(May 31 2021 at 19:09)</a>:</h4>
<p>that would be even better, but it's almost science fiction level I think</p>



<a name="240863586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863586">(May 31 2021 at 19:10)</a>:</h4>
<p>It's what Javascript does more of less</p>



<a name="240863587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863587">(May 31 2021 at 19:10)</a>:</h4>
<p>The domain of <code>leanpkg</code> is download/building/running packages, it has more-or-less nothing to do with how those packages are used in code.</p>



<a name="240863625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863625">(May 31 2021 at 19:10)</a>:</h4>
<p>dependency management is definitely in the purview of <code>cargo</code></p>



<a name="240863723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863723">(May 31 2021 at 19:12)</a>:</h4>
<p>To get that fine grained dependency management that you like about mathlib, the most logical approach is a source dependency with dead code elimination</p>



<a name="240863758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863758">(May 31 2021 at 19:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="235513">Daniel Fabian</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240863519">said</a>:</p>
<blockquote>
<p>It's like dead code elimination and you choosing to re export what you want to reuse</p>
</blockquote>
<p>For the latter, this should actually be pretty possible once Lean gets it module system. The former would require retooling the compiler to keep track of which imported symbols are used and prune the unused ones from the result <code>olean</code> and providing  that information in a way that the rebuilder (which <em>is</em> part of <code>leanpkg</code>) can figure out whether or not to rebuild the file when its dependencies change.</p>



<a name="240863765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863765">(May 31 2021 at 19:13)</a>:</h4>
<p>That could totally be a way of depending on mathlib, effectively as a submodule with pruning</p>



<a name="240863769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863769">(May 31 2021 at 19:13)</a>:</h4>
<p>How do you know if an import is dead though? Simon looked at this problem a while back and unfortunately the most reliable method is just to take the import line out and see if lean complains</p>



<a name="240863842"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863842" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863842">(May 31 2021 at 19:14)</a>:</h4>
<p>because lean imports can have so many kinds of side effects on the environment and parsing</p>



<a name="240863880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863880" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863880">(May 31 2021 at 19:14)</a>:</h4>
<p>Yeah, that is the major problem with automatic approach.</p>



<a name="240863907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863907">(May 31 2021 at 19:15)</a>:</h4>
<p>Interesting. I think we will learn more about the problem space when we build the module system</p>



<a name="240863928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863928">(May 31 2021 at 19:15)</a>:</h4>
<p>You can still do it, but it is computationally expensive enough that it's worth just taking the import lines at face value and relying on external processes to optimize them</p>



<a name="240863937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863937">(May 31 2021 at 19:15)</a>:</h4>
<p>I could for instance see having an isolated environment per module or similar</p>



<a name="240863959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240863959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240863959">(May 31 2021 at 19:16)</a>:</h4>
<p><span class="user-mention" data-user-id="235513">@Daniel Fabian</span> In fact, this also sounds similar to the discussion around changing <code>Notation.lean</code> and having to rebuild all of Lean.</p>



<a name="240864016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240864016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240864016">(May 31 2021 at 19:16)</a>:</h4>
<p>It is certainly worth thinking about</p>



<a name="240864062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240864062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240864062">(May 31 2021 at 19:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240863928">said</a>:</p>
<blockquote>
<p>You can still do it, but it is computationally expensive enough that it's worth just taking the import lines at face value and relying on external processes to optimize them</p>
</blockquote>
<p>Alternatively, the ad-hoc package approach (within the module system) where someone just imports the entirety of Mathlib and then only manual exports select symbols would also work (and remove the need for optimizing imports).</p>



<a name="240864180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240864180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240864180">(May 31 2021 at 19:18)</a>:</h4>
<p>ala JavaScript and Haskell</p>



<a name="240864188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240864188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Brandon Brown <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240864188">(May 31 2021 at 19:19)</a>:</h4>
<p>If mathlib becomes more narrowly math-focused, then it seems that it makes sense to keep it a monolith since a monolith is simple and many of the math-focused users are not well-versed with complexities of all these dependency/build issues and just want to be doing math, and it's easy to contribute to a monolith. Packages that are meant for writing practical programs can do the typical programming language package dichotomization.</p>



<a name="240864300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240864300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240864300">(May 31 2021 at 19:20)</a>:</h4>
<p>Another option might be ex post dead code elimination. After elaboration it might be much easier</p>



<a name="240864336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240864336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240864336">(May 31 2021 at 19:20)</a>:</h4>
<p>It is definitely easier post elaboration, but it's also "wrong", you miss out on imports that were required for the lean file to build</p>



<a name="240864389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240864389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240864389">(May 31 2021 at 19:21)</a>:</h4>
<p>If you only care about the output files then that's quite doable. <code>olean</code> files have an easily accessible explicit dependency relation</p>



<a name="240864526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240864526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240864526">(May 31 2021 at 19:23)</a>:</h4>
<p>If lean4 compiles to C, can't the gcc linker do the dead code elimination? If we're not eliminating dead code to reduce binary sizes, what are we eliminating it for?</p>



<a name="240864699"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240864699" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240864699">(May 31 2021 at 19:26)</a>:</h4>
<p>Regarding "Packages that are meant for writing practical programs can do the typical programming language package dichotomization.", keep in mind that a big part of the draw (for me, at least) is the ability to write programs <em>and then prove things about them</em>. This is an anti-modular pattern though, because you need to know what a program is doing to prove it is correct. So splitting the mathy stuff from the programming stuff doesn't really work, or rather it works as long as you accept that the packages are separate but actually tightly coupled</p>



<a name="240864783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240864783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240864783">(May 31 2021 at 19:27)</a>:</h4>
<p>This is part of why I have argued against the pervasive use of <code>private</code> in lean core, because it hinders reusability and introspection from external packages like mathlib</p>



<a name="240865210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865210">(May 31 2021 at 19:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240864526">said</a>:</p>
<blockquote>
<p>If lean4 compiles to C, can't the gcc linker do the dead code elimination? If we're not eliminating dead code to reduce binary sizes, what are we eliminating it for?</p>
</blockquote>
<p>The idea is to create ad-hoc packages that only have some subset of the functionality of mathlib. So let's say I want to create the package <code>OpenPrivate</code> that only has the <code>open private</code> command from mathlib. I could import all of mathlib export open private and its related syntax and then the dead code elimination would remove the rest of the code in mathlib so that the resulting binary library for <code>OpenPrivate</code> only has the code it needs to support <code>open private</code>.</p>



<a name="240865319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865319">(May 31 2021 at 19:36)</a>:</h4>
<p>If you are building a binary, the linker should already do that</p>



<a name="240865342"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865342" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865342">(May 31 2021 at 19:37)</a>:</h4>
<p><code>open private</code> seems like one of those this-should-actually-be-in-core modules that could be easily split from mathlib.</p>



<a name="240865379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865379">(May 31 2021 at 19:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240864699">said</a>:</p>
<blockquote>
<p>Regarding "Packages that are meant for writing practical programs can do the typical programming language package dichotomization.", keep in mind that a big part of the draw (for me, at least) is the ability to write programs <em>and then prove things about them</em>.</p>
</blockquote>
<p>However the idea is that Lean is now going to be a general purpose language. That is, many people will write programs and libraries without necessarily proving anything about them. Then, if someone else comes along and wants to verify the contents of said libraries they can create a separate (but related) library that proves things about it. Thus, the dichotomization can still appear.</p>



<a name="240865462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865462">(May 31 2021 at 19:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240865319">said</a>:</p>
<blockquote>
<p>If you are building a binary, the linker should already do that</p>
</blockquote>
<p>I'm pretty sure it doesn't. In fact, I believe that resulting library will be the entirety of math lib plus whatever code you write (because transitive imports).</p>



<a name="240865464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865464">(May 31 2021 at 19:38)</a>:</h4>
<blockquote>
<p>That is, many people will write programs and libraries without necessarily proving anything about them. Then, if someone else comes along and wants to verify the contents of said libraries they can create a separate (but related) library that proves things about it.</p>
</blockquote>
<p>Yes, that's exactly the situation we currently find ourselves in. The unverified package is lean core, and the someone else is mathlib</p>



<a name="240865518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865518">(May 31 2021 at 19:39)</a>:</h4>
<p>Yes? So? I'm confused as to what you are getting at.</p>



<a name="240865524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865524">(May 31 2021 at 19:39)</a>:</h4>
<p>But the dependent proofy package needs to be able to couple to the unverified package and encapsulation mechanisms from traditional programming languages are actively hostile to this effort</p>



<a name="240865589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865589">(May 31 2021 at 19:40)</a>:</h4>
<p>I agree completely with your desire to remove <code>private</code> as concept.</p>



<a name="240865613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865613">(May 31 2021 at 19:40)</a>:</h4>
<p>I think, if desired, being able to get at any definition should be possible.</p>



<a name="240865630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865630">(May 31 2021 at 19:41)</a>:</h4>
<p>I am vaguely uncomfortable with discussions about a module system because I expect it to be another, possibly stronger, iteration of the same idea</p>



<a name="240865653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865653">(May 31 2021 at 19:41)</a>:</h4>
<p>why not do an in-between thing? private could hide intellsense, making the UX nice and clean, but you might eg do something like <code>obj.#privateMethod</code> to access privates?</p>



<a name="240865698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865698">(May 31 2021 at 19:42)</a>:</h4>
<p>There's value to private stuff due to encapsulation, but in a pure language you don't need to worry about corrupting state.</p>



<a name="240865704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865704">(May 31 2021 at 19:42)</a>:</h4>
<p>so maybe making it a UX thing is good enough?</p>



<a name="240865705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865705">(May 31 2021 at 19:42)</a>:</h4>
<p>That kind of privacy is totally fine by me</p>



<a name="240865711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865711">(May 31 2021 at 19:42)</a>:</h4>
<p>I think python also does something like that</p>



<a name="240865716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865716">(May 31 2021 at 19:42)</a>:</h4>
<p>privacy by ugly naming convention</p>



<a name="240865718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865718">(May 31 2021 at 19:43)</a>:</h4>
<p>Sounds good to me as well.</p>



<a name="240865727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865727">(May 31 2021 at 19:43)</a>:</h4>
<p>but in python you can shoot yourself into the foot.</p>



<a name="240865732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865732">(May 31 2021 at 19:43)</a>:</h4>
<p>In a pure language, not so much...</p>



<a name="240865753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Brandon Brown <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865753">(May 31 2021 at 19:43)</a>:</h4>
<p>In Python the "private" methods start with underscores. Not really hidden just a prefix naming convention</p>



<a name="240865819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865819">(May 31 2021 at 19:44)</a>:</h4>
<p>I would suggest leaving <code>#</code> to mean side-effecting commands though and use something else for the notation.</p>



<a name="240865872"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865872" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865872">(May 31 2021 at 19:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243102">Brandon Brown</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240865753">said</a>:</p>
<blockquote>
<p>In Python the "private" methods start with underscores. Not really hidden just a prefix naming convention</p>
</blockquote>
<p>Yeah I like the underscore / double underscore naming convention unfortunately that clashes with placeholders in Lean.</p>



<a name="240865878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240865878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240865878">(May 31 2021 at 19:45)</a>:</h4>
<p>sounds at least worth an RFC, we can see what others think?</p>



<a name="240866123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866123">(May 31 2021 at 19:49)</a>:</h4>
<p>This would also have the possible side effect of fixing <a href="https://github.com/leanprover/lean4/issues/418">#418</a>.</p>



<a name="240866244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Brandon Brown <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866244">(May 31 2021 at 19:51)</a>:</h4>
<p>How about <code>obj.@private_method</code>  since the <code>@</code> symbol is already used to make the implicit explicit in functions, so sort of semantically in the same ballpark</p>



<a name="240866407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866407">(May 31 2021 at 19:53)</a>:</h4>
<p>That's a good idea! The only qualm I have is that users may confuse it to mean explicit applying a function field.</p>



<a name="240866475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866475">(May 31 2021 at 19:54)</a>:</h4>
<p>not <code>@</code>, please. Because <code>private</code> still can have implicits.</p>



<a name="240866506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Brandon Brown <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866506">(May 31 2021 at 19:55)</a>:</h4>
<p>ah right, of course</p>



<a name="240866507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866507">(May 31 2021 at 19:55)</a>:</h4>
<p>I don't think anything like this is really needed, though. We already have a convention of using <code>fooAux</code> or <code>foo.impl</code> and such for internal function names, that is generally sufficient</p>



<a name="240866577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866577">(May 31 2021 at 19:56)</a>:</h4>
<p>leading underscore is also used in some places, although lean takes a harder stance here since you can't actually use it in definition names</p>



<a name="240866581"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866581" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866581">(May 31 2021 at 19:56)</a>:</h4>
<p>But that would appear in auto-complete which we want to avoid by marking the definitions private.</p>



<a name="240866625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866625">(May 31 2021 at 19:57)</a>:</h4>
<p>you could have the effect of <code>private</code> or an equivalent attribute be to hide it from such displays, or the tooling could pick up on the naming convention</p>



<a name="240866633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866633">(May 31 2021 at 19:57)</a>:</h4>
<p>The goal is to make private definitions "hidden" in some sense (ex. from auto complete) while still providing a means to access them.</p>



<a name="240866736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866736">(May 31 2021 at 19:58)</a>:</h4>
<p><code>private</code> serves three encapsulation purposes in a normal programming language: Hiding stuff in the namespace, preventing corruption of state, and making it impossible to depend on internal details to lower coupling.</p>



<a name="240866760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866760">(May 31 2021 at 19:59)</a>:</h4>
<p>we need all 3 to still be true after we weaken the restrictions imposed by <code>private</code>.</p>



<a name="240866772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866772">(May 31 2021 at 19:59)</a>:</h4>
<p>State corruption we get for free due to being a pure language.</p>



<a name="240866780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866780" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866780">(May 31 2021 at 19:59)</a>:</h4>
<p>the other two we have to solve somehow.</p>



<a name="240866793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866793">(May 31 2021 at 19:59)</a>:</h4>
<p>In Lean, (2) isn't a concern (as you said), and (3) is just undesirable, because as <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  said proofs sometimes need to do just that.</p>



<a name="240866948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866948">(May 31 2021 at 20:01)</a>:</h4>
<p>so only real use is (1)</p>



<a name="240866971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240866971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240866971">(May 31 2021 at 20:01)</a>:</h4>
<p>and since we need to violate that sometimes for the same reason as (3), even it should only hold conditionally.</p>



<a name="240867032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867032">(May 31 2021 at 20:02)</a>:</h4>
<p>yeah, I see how (3) is a potential concern. We <em>might</em> restrict accessing privates to proofs? It feels a bit weird. But on the other hand, if someone goes through enough effort to access <code>private</code>s, I wouldn't care too much to break them by refactoring. (E.g. in .net you can use reflection to access privates).</p>



<a name="240867063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867063">(May 31 2021 at 20:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240866625">said</a>:</p>
<blockquote>
<p>you could have the effect of <code>private</code> or an equivalent attribute be to hide it from such displays</p>
</blockquote>
<p>The disadvantage here is that it would then always hide it (which would be annoying in proofs that rely heavily on it). The <code>.#</code> or whatever syntax would allow for auto-completion in such contexts.</p>



<a name="240867085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867085">(May 31 2021 at 20:03)</a>:</h4>
<p><code>local attribute [-private] foobar</code> would fix that</p>



<a name="240867161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867161">(May 31 2021 at 20:04)</a>:</h4>
<blockquote>
<p>But on the other hand, if someone goes through enough effort to access privates, I wouldn't care too much to break them by refactoring. (E.g. in .net you can use reflection to access privates).</p>
</blockquote>
<p>Exactly. <code>open private</code> isn't a code smell, it is explicitly opting out of stability of the upstream package. When you have dependent types, dependent packages can be a thing too</p>



<a name="240867182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867182">(May 31 2021 at 20:04)</a>:</h4>
<p>it doesn't need to be easy, but it does need to be possible</p>



<a name="240867200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867200">(May 31 2021 at 20:05)</a>:</h4>
<p><code>open private</code> is a bit like .net reflection to access <code>private</code>s.</p>



<a name="240867201"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867201" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867201">(May 31 2021 at 20:05)</a>:</h4>
<p>I think the "private" as an attribute seems reasonable. I would also probably rename it to "hidden" as that is more indicative of what is actually doing.</p>



<a name="240867224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867224">(May 31 2021 at 20:05)</a>:</h4>
<p>rust has <code>doc(hidden)</code></p>



<a name="240867279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867279">(May 31 2021 at 20:06)</a>:</h4>
<p>the experience for writing production code needs to be natural. You can easily have a large-ish development with only very light proving, e.g. lean4 compiler itself.</p>



<a name="240867296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867296">(May 31 2021 at 20:06)</a>:</h4>
<p>And that kind of thing needs to be natural, so a keyword for private stuff seems warranted.</p>



<a name="240867361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867361">(May 31 2021 at 20:07)</a>:</h4>
<p>seems reasonable</p>



<a name="240867373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867373">(May 31 2021 at 20:07)</a>:</h4>
<p>so... long story short... <code>open private</code> would pretty much cover all the requirements?</p>



<a name="240867375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867375">(May 31 2021 at 20:07)</a>:</h4>
<p>I think avoiding <em>accidental</em> use of an unstable internal implementation detail is a good reason to have <code>private</code> as a language concept</p>



<a name="240867494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867494">(May 31 2021 at 20:09)</a>:</h4>
<p>so something like <code>open private</code> is probably the best UX to give it just enough syntax salt. The only thing I would change is that it shouldn't need to be <code>open private foo in bar</code>, which is currently needed due to the absolute hackery going on in the implementation</p>



<a name="240867506"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867506" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867506">(May 31 2021 at 20:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="235513">Daniel Fabian</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240867373">said</a>:</p>
<blockquote>
<p>so... long story short... <code>open private</code> would pretty much cover all the requirements?</p>
</blockquote>
<p>That and <code>export private</code> as well (for cases where an dependent package disagrees on visibility). It is also currently defined/used in mathlib</p>



<a name="240867590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867590">(May 31 2021 at 20:10)</a>:</h4>
<p>I have more misgivings about <code>export private</code>, because it's basically saying the upstream author was wrong about their decision</p>



<a name="240867618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867618">(May 31 2021 at 20:11)</a>:</h4>
<p>Which as the fallible humans we are, that can, in fact, sometimes be the case. ;)</p>



<a name="240867630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Fabian <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867630">(May 31 2021 at 20:11)</a>:</h4>
<p>plus you can always emulate it by <code>def foo := private.foo</code></p>



<a name="240867631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867631">(May 31 2021 at 20:11)</a>:</h4>
<p>I don't mind <code>open private</code> as an escape hatch, but I can almost guarantee that it will not become part of the stdlib, nor will the semantics of <code>private</code> change. On the positive side, that means the current <code>open private</code> code is <em>relatively</em> unlikely to break in the future.</p>



<a name="240867710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867710">(May 31 2021 at 20:12)</a>:</h4>
<p>I would prefer if <code>private</code> just kept the name as is but made it an error to directly reference</p>



<a name="240867719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867719">(May 31 2021 at 20:12)</a>:</h4>
<p>rather than mangling the name and/or sticking some <code>_hyg</code>'s in there</p>



<a name="240867746"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867746" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867746">(May 31 2021 at 20:13)</a>:</h4>
<p>those names are way too hard to reference, even after you have paid the "I know what I'm doing" tax</p>



<a name="240867750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867750">(May 31 2021 at 20:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="235513">Daniel Fabian</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240867630">said</a>:</p>
<blockquote>
<p>plus you can always emulate it by <code>def foo := private.foo</code></p>
</blockquote>
<p>Sadly, that is semantic different from an alias like that created by <code>export</code> in many cases.</p>



<a name="240867818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867818">(May 31 2021 at 20:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240867710">said</a>:</p>
<blockquote>
<p>I would prefer if <code>private</code> just kept the name as is but made it an error to directly reference</p>
</blockquote>
<p>That would preclude using the same name for <code>private</code>s in module diamonds, which would be super counterintuitive. We went through <em>multiple</em> designs before converging on the current one.</p>



<a name="240867821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867821">(May 31 2021 at 20:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240867746">said</a>:</p>
<blockquote>
<p>those names are way too hard to reference, even after you have paid the "I know what I'm doing" tax</p>
</blockquote>
<p>So hard, in fact, that it creates issue <a href="https://github.com/leanprover/lean4/issues/418">#418</a>.</p>



<a name="240867828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867828">(May 31 2021 at 20:14)</a>:</h4>
<p>Module diamonds?</p>



<a name="240867867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867867">(May 31 2021 at 20:15)</a>:</h4>
<p><code>private foo</code> in two files you import</p>



<a name="240867937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240867937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240867937">(May 31 2021 at 20:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/270676-lean4/topic/Partitioning.20mathlib/near/240867494">said</a>:</p>
<blockquote>
<p>so something like <code>open private</code> is probably the best UX to give it just enough syntax salt. The only thing I would change is that it shouldn't need to be <code>open private foo in bar</code>, which is currently needed due to the absolute hackery going on in the implementation</p>
</blockquote>
<p>You can also do <code>open private something from MyModule</code> now.  Not sure if that helps you.</p>



<a name="240868089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240868089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240868089">(May 31 2021 at 20:18)</a>:</h4>
<p>While we're on the topic, I've seen some issues with excessive privacy around <code>deriving instance DecidableEq</code> and other automatic constructions</p>



<a name="240868144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240868144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240868144">(May 31 2021 at 20:19)</a>:</h4>
<p><code>DecidableEq</code> might not be the best example here.  The type already contains everything you could prove about it.</p>



<a name="240868978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/Partitioning%20mathlib/near/240868978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/270676-lean4/topic/Partitioning.20mathlib.html#240868978">(May 31 2021 at 20:32)</a>:</h4>
<p>Actually it was <code>BEq</code>. I'll post the example in another thread</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>