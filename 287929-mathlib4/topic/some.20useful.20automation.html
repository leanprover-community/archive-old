---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/some.20useful.20automation.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html">some useful automation</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="305940289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/305940289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#305940289">(Oct 25 2022 at 01:04)</a>:</h4>
<p>There are a few pieces of CI automation that would help smooth the process for people porting files from mathlib3 to mathlib4. </p>
<ol>
<li>when someone creates the PR mathlib4#NNN which ports file <code>XXX</code>, automatically update the <code>XXX</code> line in <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">#port-status</a> to say <code>No: PR'd as mathlib4#NNN</code></li>
<li>when the PR mathlib4#NNN which ports file <code>XXX</code> is merged, update the <code>XXX</code> line in <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">#port-status</a> to say <code>Yes mathlib4#NNN</code> (checking that it doesn't already say <code>Yes mathlib4#MMM AAAAAA</code>).</li>
<li>when the mathlib4 PR which ports file <code>XXX</code> is merged, automatically create the mathlib3 PR which adds the <code>SYNCHRONIZED</code> label to the module-doc</li>
</ol>
<p>and something which I think can't / shouldn't be automated</p>
<ol start="4">
<li>after all those steps, a human needs to open mathlib3 master (say at commit AAAAAA, and mathlib4 master, and verify that everything actually made it across, then update <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">#port-status</a> to say <code>Yes mathlib4#MMM AAAAAA</code>, to record that someone has checked that the file was fully ported as of that commit.</li>
</ol>
<p>and finally, for automation</p>
<ol start="5">
<li>a bot, that at some interval sends a reminder to zulip about any files in mathlib3 which have been modified after their recorded verification commit (so a human can either verify that nothing really changed, and update the verification hash, or make the corresponding changes in mathlib4)</li>
</ol>



<a name="305940290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/305940290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#305940290">(Oct 25 2022 at 01:04)</a>:</h4>
<p>Some discussion points:</p>
<ol start="0">
<li>Perhaps <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">#port-status</a> should be something more structured than a wiki page!</li>
<li>Do we need labels for mathlib4 PRs that say they are a porting PR?</li>
<li>How does CI look at a mathlib4 PR and work out which (multiple?) files it is claiming to completely port.</li>
<li>Do we need labels for mathlib3 PRs that are just adding synchronization comments? (We have <a href="https://github.com/leanprover-community/mathlib/pulls?q=is%3Apr+label%3Amathlib4-synchronization+"><code>mathlib4-synchronization</code></a>.)</li>
</ol>



<a name="305940412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/305940412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#305940412">(Oct 25 2022 at 01:06)</a>:</h4>
<p>The only automation we currently have is the very ad-hoc <code>scripts/port-status.py</code> in mathlib3, which as well as telling you what you can currently work on, emits warnings like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">#</span> <span class="n">The</span> <span class="n">following</span> <span class="n">files</span> <span class="n">are</span> <span class="n">marked</span> <span class="n">as</span> <span class="n">ported</span><span class="o">,</span> <span class="n">but</span> <span class="k">do</span> <span class="n">not</span> <span class="k">have</span> <span class="n">a</span> <span class="n">SYNCHRONIZED</span> <span class="n">WITH</span> <span class="n">MATHLIB4</span> <span class="n">label.</span>
<span class="n">logic.basic</span>
<span class="n">logic.is_empty</span>
<span class="n">data.prod.pprod</span>
<span class="n">data.fin.fin2</span>

<span class="bp">#</span> <span class="n">The</span> <span class="n">following</span> <span class="n">files</span> <span class="n">are</span> <span class="n">marked</span> <span class="n">as</span> <span class="n">ported</span><span class="o">,</span> <span class="n">but</span> <span class="k">have</span> <span class="n">not</span> <span class="n">been</span> <span class="n">verified</span> <span class="n">against</span> <span class="n">a</span> <span class="n">commit</span> <span class="n">hash</span> <span class="k">from</span> <span class="n">mathlib.</span>
<span class="n">logic.basic</span>
<span class="n">logic.is_empty</span>
<span class="n">data.prod.pprod</span>
<span class="n">data.fin.fin2</span>
<span class="n">algebra.abs</span>
<span class="n">algebra.covariant_and_contravariant</span>
<span class="n">algebra.group.basic</span>
<span class="n">algebra.group.defs</span>

<span class="bp">#</span> <span class="n">The</span> <span class="n">following</span> <span class="n">files</span> <span class="k">have</span> <span class="n">been</span> <span class="n">modified</span> <span class="n">since</span> <span class="n">the</span> <span class="n">commit</span> <span class="n">at</span> <span class="n">which</span> <span class="n">they</span> <span class="n">were</span> <span class="n">verified.</span>
<span class="n">logic.relator</span>
</code></pre></div>



<a name="305940441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/305940441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#305940441">(Oct 25 2022 at 01:06)</a>:</h4>
<p><span class="user-mention" data-user-id="504487">@Sarah Smith</span>, notifying you as you wanted to be part of this discussion.</p>



<a name="305940909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/305940909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#305940909">(Oct 25 2022 at 01:12)</a>:</h4>
<p>How about a mathlib3 branch that is just one file, on which we track commits?</p>



<a name="305941402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/305941402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#305941402">(Oct 25 2022 at 01:19)</a>:</h4>
<p>I mean, I'm not sure a text file in a git branch is really that much different from a wiki page. In particular you can get the wiki via</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="bp">@</span><span class="n">github.com</span><span class="o">:</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">community</span><span class="bp">/</span><span class="n">mathlib.wiki.git</span>
</code></pre></div>



<a name="305941546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/305941546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#305941546">(Oct 25 2022 at 01:21)</a>:</h4>
<p>Ah, great</p>



<a name="305959022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/305959022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#305959022">(Oct 25 2022 at 05:49)</a>:</h4>
<p>Step 4 can be automated if the bot creates a link to the github changes page from the initial mathlib commit to master as of the PR</p>



<a name="306161538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306161538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306161538">(Oct 26 2022 at 04:08)</a>:</h4>
<p>I have another feature request for port-status: files that have been started / have incomplete work in mathlib4 should also be colored in some way. We could either track that manually or make mathport produce a file listing as part of CI (since it knows the naming convention and can tell whether a <code>Mathbin</code> file it translates has a matching file in <code>Mathlib</code>).</p>



<a name="306161673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306161673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306161673">(Oct 26 2022 at 04:09)</a>:</h4>
<p>Does this status indicate presence of a Mathlib4 file? Mathbin file?</p>



<a name="306165033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306165033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306165033">(Oct 26 2022 at 04:52)</a>:</h4>
<p>A mathlib4 file. A mathbin file will exist for everything in mathlib</p>



<a name="306165530"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306165530" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306165530">(Oct 26 2022 at 04:59)</a>:</h4>
<p>What's the function we use that does the <code>snake_case</code> to <code>CamelCase</code>? The usual one?</p>



<a name="306165858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306165858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306165858">(Oct 26 2022 at 05:03)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathport/blob/master/Mathport/Util/String.lean#L8-L21">https://github.com/leanprover-community/mathport/blob/master/Mathport/Util/String.lean#L8-L21</a></p>



<a name="306165965"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306165965" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306165965">(Oct 26 2022 at 05:05)</a>:</h4>
<p>The fact you linked to a lean4 file reinforces the thought I had that this parser/tracker should be written in lean4 =)</p>



<a name="306166076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306166076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306166076">(Oct 26 2022 at 05:06)</a>:</h4>
<p>Files that exist in my mathlib4 dir:<br>
<a href="/user_uploads/3121/vCeam6P3NWaqfbXXZ14fB_IC/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/vCeam6P3NWaqfbXXZ14fB_IC/image.png" title="image.png"><img src="/user_uploads/3121/vCeam6P3NWaqfbXXZ14fB_IC/image.png"></a></div>



<a name="306166088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306166088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306166088">(Oct 26 2022 at 05:06)</a>:</h4>
<p>Like so?</p>



<a name="306166110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306166110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306166110">(Oct 26 2022 at 05:06)</a>:</h4>
<p>Existing files have a red outline</p>



<a name="306167063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306167063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306167063">(Oct 26 2022 at 05:17)</a>:</h4>
<p>Available from <a href="https://github.com/pechersky/mathlib-tools/commit/6e4e07b75e19afd01664ac342200c4e7f625dc66">https://github.com/pechersky/mathlib-tools/commit/6e4e07b75e19afd01664ac342200c4e7f625dc66</a></p>



<a name="306511071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306511071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306511071">(Oct 27 2022 at 18:22)</a>:</h4>
<p>Do we have a bot that labels mathlib3 PRs with <code>touches-frozen-files</code> if they touch frozen files?</p>



<a name="306511108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/306511108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#306511108">(Oct 27 2022 at 18:23)</a>:</h4>
<p>That would immensely help reviewing PRs, I think.</p>



<a name="307015042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307015042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307015042">(Oct 30 2022 at 22:44)</a>:</h4>
<p>I wanted to check that I am using correctly the import graph tool for porting.  I had the impression that there was supposed to be an orange colour on the graph for files whose status is "no" but with a further comment:<br>
<a href="https://github.com/leanprover-community/mathlib-tools/blob/3886f16c04492c768ed821a2d2fc9f583493d5d9/mathlibtools/file_status.py#L50">https://github.com/leanprover-community/mathlib-tools/blob/3886f16c04492c768ed821a2d2fc9f583493d5d9/mathlibtools/file_status.py#L50</a><br>
So the following three files ought to be orange given the current <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">#port-status</a> :</p>
<ul>
<li>data.option.basic: 'No: PRd as <a href="https://github.com/leanprover-community/mathlib4/pull/493">mathlib4#493</a>'</li>
<li>logic.function.basic: 'No: <a href="https://github.com/leanprover-community/mathlib4/pull/511">mathlib4#511</a>'</li>
<li>logic.unique: 'No: WIP PR <a href="https://github.com/leanprover-community/mathlib4/pull/512">mathlib4#512</a>'</li>
</ul>
<p>When I tried the import graph porting tool just now I got <a href="/user_uploads/3121/v6wBX-7F1wUrF7OFN9ulNWQp/import_graph.pdf">this</a>, which has those files in turquoise.  Did I do something wrong?</p>



<a name="307015680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307015680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307015680">(Oct 30 2022 at 22:54)</a>:</h4>
<p>My reading of the intention is that</p>
<ul>
<li>anything with <code>No</code> and also <code>WIP</code> or <code>PR</code> should be <code>lightskyblue</code></li>
<li>anything with <code>No</code> and some nonempty comment that does not contain  <code>WIP</code> or <code>PR</code> should be <code>orange</code>.</li>
</ul>
<p>However according to that <code>logic.function.basic</code> should currently be orange. (Because we forgot to write <code>No: PR mathlib4#511</code> there, rather than just <code>No: mathlib4#511</code>...) <span class="user-mention" data-user-id="308899">@Yakov Pechersky</span>.</p>
<p>Obviously this behaviour is too fragile, and we need something better eventually.</p>



<a name="307016026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307016026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307016026">(Oct 30 2022 at 22:59)</a>:</h4>
<p>I'm actually quite confused.  I'd have thought that these two should be the same colour:</p>
<ul>
<li>algebra.order.ring_lemmas: 'No: PRd as <a href="https://github.com/leanprover-community/mathlib4/pull/482">mathlib4#482</a>'</li>
<li>data.option.basic: 'No: PRd as <a href="https://github.com/leanprover-community/mathlib4/pull/493">mathlib4#493</a>'</li>
</ul>
<p>but on my graph they are different colours.  (Both are blue-ish but I'm not sure which one is <code>lightskyblue</code>.)</p>



<a name="307016385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307016385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307016385">(Oct 30 2022 at 23:04)</a>:</h4>
<p>Can we pick some colors that are better differentiated? Also, if a file is ready for porting (all reqs ported), does that supersede, or does the PR supersede in coloring?</p>



<a name="307016431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307016431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307016431">(Oct 30 2022 at 23:05)</a>:</h4>
<p>I can also add that the PR nodes link directly to the PR</p>



<a name="307016439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307016439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307016439">(Oct 30 2022 at 23:05)</a>:</h4>
<p>Yes, I'd just come to the same hypothesis.  I'm guessing that currently a file being tagged as "ready" supersedes its designation as "WIP", "PR" or "No-for-complicated-reason".  And it should (probably?) be the other way around.</p>



<a name="307016572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307016572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307016572">(Oct 30 2022 at 23:07)</a>:</h4>
<p>I also was in a middle of refactor, then yak-shaved myself in trying to write this in lean4, which yak-shaved into writing a yaml parser, which yak-shaved into trying to understand WF recursion termination in lean4...</p>



<a name="307016762"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307016762" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307016762">(Oct 30 2022 at 23:10)</a>:</h4>
<p>Anyway, to make <code>ready</code> defer to <code>PR</code>, one just has to add two lines here: <a href="https://github.com/leanprover-community/mathlib-tools/blob/67f1bda7637d17a9f765ecade305d3f9ffc93e7c/mathlibtools/lib.py#L1047-L1050">https://github.com/leanprover-community/mathlib-tools/blob/67f1bda7637d17a9f765ecade305d3f9ffc93e7c/mathlibtools/lib.py#L1047-L1050</a><br>
Specifically:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">if</span> <span class="n">not</span> <span class="n">target_node.get</span><span class="o">(</span><span class="s2">"status"</span><span class="o">):</span>
  <span class="n">continue</span>
</code></pre></div>



<a name="307016997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307016997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307016997">(Oct 30 2022 at 23:15)</a>:</h4>
<p>For those that want to add links in PDF, the suggested data is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">node</span><span class="o">[</span><span class="s2">"href"</span><span class="o">]</span> <span class="bp">=</span> <span class="n">url_here</span>
<span class="n">node</span><span class="o">[</span><span class="s2">"target"</span><span class="o">]</span> <span class="bp">=</span> <span class="s2">"_top"</span>  <span class="bp">#</span> <span class="n">or</span> <span class="s2">"_blank"</span><span class="o">,</span> <span class="n">depending</span> <span class="n">on</span> <span class="n">the</span> <span class="n">new</span><span class="bp">-</span><span class="n">tab</span> <span class="n">semantics</span> <span class="n">you</span> <span class="n">want</span>
<span class="n">node</span><span class="o">[</span><span class="s2">"tooltip"</span><span class="o">]</span> <span class="bp">=</span> <span class="bp">...</span>
</code></pre></div>
<p>But right now, the data structure for <code>FileStatus</code> doesn't really support it.<br>
My refactor in <a href="https://github.com/pechersky/mathlib-tools/tree/pechersky/schematized-port">https://github.com/pechersky/mathlib-tools/tree/pechersky/schematized-port</a> likely makes it easier</p>



<a name="307033449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307033449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307033449">(Oct 31 2022 at 04:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="308899">Yakov Pechersky</span> <a href="#narrow/stream/287929-mathlib4/topic/some.20useful.20automation/near/307016572">said</a>:</p>
<blockquote>
<p>I also was in a middle of refactor, then yak-shaved myself in trying to write this in lean4, which yak-shaved into writing a yaml parser, which yak-shaved into trying to understand WF recursion termination in lean4...</p>
</blockquote>
<p>Just some advice: skip the termination proof, just use <code>partial</code> and get on with life. Removing <code>partial</code> should usually be treated as a v2 thing</p>



<a name="307071623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307071623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307071623">(Oct 31 2022 at 10:23)</a>:</h4>
<p>Don't hesitate to open PRs to leanproject for anything that helps porting. Releasing new versions of leanproject is very cheap.</p>



<a name="307071980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/307071980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#307071980">(Oct 31 2022 at 10:25)</a>:</h4>
<p>On the Lean side, would it be easy to have more checks that we are doing things correctly? Can we have a Lean 4 program that checks that a mathlib4 PR indeed ports everything from the Lean3 side in the correct order (modulo autogenerated declarartions) and indeed uses <code>#align</code> whenever mathport had another name? We could have a command flagging declarations that have been omitted and providing an explanation.</p>



<a name="309296770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309296770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309296770">(Nov 12 2022 at 06:21)</a>:</h4>
<p>Oops, I accidentally did <a href="https://github.com/leanprover-community/mathlib-tools/pull/133">mathlib-tools#133</a>, which made the "ready" colour defer to human-specified colours (e.g. for "PR"), although this was separately done in the larger <a href="https://github.com/leanprover-community/mathlib-tools/pull/132">mathlib-tools#132</a>.</p>



<a name="309296854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309296854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309296854">(Nov 12 2022 at 06:23)</a>:</h4>
<p>Alternatives:</p>
<ul>
<li>We just merge <a href="https://github.com/leanprover-community/mathlib-tools/pull/132">mathlib-tools#132</a> (but it does other things I don't yet understand the point of)</li>
<li>We merge <a href="https://github.com/leanprover-community/mathlib-tool/pull/133">mathlib-tool#133</a> first, and <a href="https://github.com/leanprover-community/mathlib-tools/pull/132">mathlib-tools#132</a> can come afterwards.</li>
</ul>



<a name="309296928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309296928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309296928">(Nov 12 2022 at 06:24)</a>:</h4>
<p>I've also just made <a href="https://github.com/leanprover-community/mathlib-tools/pull/134">mathlib-tools#134</a>, which corrects a previous problem with the <code>--exclude-tactics</code> flag, that files that were only imported by tactics files were also being dropped. Instead I just add all the necessary edges "bridging over" the tactics files before deleting them. To make the graphs slightly saner, I've decided to leave in <code>tactic.core</code> and <code>tactic.basic</code>, even if you ask for <code>--exclude-tactics</code>.</p>



<a name="309300214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309300214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309300214">(Nov 12 2022 at 07:22)</a>:</h4>
<p>I've also just made <a href="https://github.com/leanprover-community/mathlib-tools/pull/135">mathlib-tools#135</a>, which enables:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>% leanproject port-progress
Total files in mathlib:           2723
Longest import path in mathlib:   148
Unported files in mathlib:        2693
Longest unported path in mathlib: 138
['logic.equiv.defs', 'order.synonym', 'order.compare', 'order.monotone', 'order.lattice', 'order.bounded_order', 'algebra.order.monoid.defs', 'algebra.order.sub.defs', 'algebra.order.group.defs', 'algebra.order.ring.defs', 'algebra.order.ring.canonical', 'data.nat.order.basic', 'data.nat.order.lemmas', 'algebra.group_power.ring', 'algebra.group_power.order', 'data.nat.pow', 'algebra.group_power.lemmas', 'algebra.group_power.default', 'data.list.big_operators', 'data.list.count', 'data.list.lattice', 'data.list.nodup', 'data.list.dedup', 'data.list.perm', 'data.multiset.basic', 'algebra.big_operators.multiset', 'data.multiset.bind', 'data.multiset.powerset', 'data.multiset.nodup', 'data.multiset.dedup', 'data.multiset.finset_ops', 'data.finset.basic', 'data.finset.card', 'data.finset.option', 'data.finset.lattice', 'data.finset.powerset', 'data.fintype.basic', 'data.finset.sort', 'data.set.finite', 'order.conditionally_complete_lattice', 'data.nat.lattice', 'order.order_iso_nat', 'order.well_founded_set', 'group_theory.submonoid.pointwise', 'group_theory.subgroup.basic', 'ring_theory.subring.basic', 'algebra.group_ring_action', 'algebra.ring.aut', 'algebra.star.basic', 'algebra.module.linear_map', 'algebra.module.equiv', 'algebra.module.submodule.basic', 'algebra.module.submodule.lattice', 'linear_algebra.basic', 'linear_algebra.span', 'algebra.algebra.basic', 'linear_algebra.prod', 'linear_algebra.linear_independent', 'linear_algebra.basis', 'linear_algebra.bilinear_map', 'algebra.module.submodule.bilinear', 'linear_algebra.tensor_product', 'algebra.algebra.bilinear', 'algebra.algebra.operations', 'ring_theory.ideal.operations', 'algebra.algebra.subalgebra.basic', 'algebra.algebra.tower', 'ring_theory.adjoin.basic', 'data.mv_polynomial.basic', 'data.mv_polynomial.rename', 'data.mv_polynomial.monad', 'data.mv_polynomial.variables', 'data.mv_polynomial.comm_ring', 'ring_theory.polynomial.basic', 'ring_theory.adjoin.fg', 'ring_theory.algebra_tower', 'ring_theory.finiteness', 'field_theory.finiteness', 'linear_algebra.finite_dimensional', 'linear_algebra.matrix.finite_dimensional', 'linear_algebra.matrix.to_lin', 'linear_algebra.matrix.basis', 'linear_algebra.determinant', 'topology.algebra.module.basic', 'analysis.normed.field.basic', 'analysis.normed_space.basic', 'analysis.normed.order.basic', 'analysis.locally_convex.basic', 'analysis.locally_convex.balanced_core_hull', 'topology.algebra.module.finite_dimension', 'analysis.convex.topology', 'topology.algebra.module.locally_convex', 'analysis.seminorm', 'analysis.locally_convex.bounded', 'topology.algebra.uniform_convergence', 'topology.algebra.module.strong_topology', 'analysis.normed_space.operator_norm', 'analysis.normed_space.multilinear', 'analysis.normed_space.bounded_linear_maps', 'analysis.calculus.fderiv', 'analysis.calculus.deriv', 'analysis.calculus.local_extr', 'analysis.calculus.mean_value', 'analysis.calculus.cont_diff', 'analysis.calculus.inverse', 'analysis.special_functions.exp_deriv', 'analysis.special_functions.complex.log_deriv', 'analysis.special_functions.pow_deriv', 'analysis.convex.specific_functions', 'analysis.special_functions.trigonometric.complex', 'analysis.special_functions.trigonometric.arctan', 'measure_theory.function.special_functions', 'measure_theory.integral.mean_inequalities', 'measure_theory.function.simple_func_dense', 'measure_theory.function.strongly_measurable', 'measure_theory.function.ae_eq_fun', 'measure_theory.function.lp_space', 'measure_theory.function.lp_order', 'measure_theory.function.l1_space', 'measure_theory.function.simple_func_dense_lp', 'measure_theory.integral.set_to_l1', 'measure_theory.integral.bochner', 'measure_theory.integral.set_integral', 'measure_theory.function.ae_eq_of_integral', 'measure_theory.measure.with_density_vector_measure', 'measure_theory.decomposition.lebesgue', 'measure_theory.decomposition.radon_nikodym', 'measure_theory.function.conditional_expectation.basic', 'measure_theory.function.conditional_expectation.indicator', 'measure_theory.function.conditional_expectation.real', 'probability.process.filtration', 'probability.process.adapted', 'probability.process.stopping', 'probability.process.hitting_time', 'probability.martingale.basic', 'probability.martingale.upcrossing', 'probability.martingale.convergence', 'probability.martingale.borel_cantelli', 'probability.borel_cantelli']
</code></pre></div>



<a name="309300253"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309300253" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309300253">(Nov 12 2022 at 07:23)</a>:</h4>
<p>Perhaps without any information about what the longest unported path is, I'll propose a bot that posts regularly in the CI stream with this information. (In fact, there's already a test post.)</p>



<a name="309300261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309300261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309300261">(Nov 12 2022 at 07:24)</a>:</h4>
<p>What other information would be useful or interesting?</p>



<a name="309300331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309300331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309300331">(Nov 12 2022 at 07:24)</a>:</h4>
<p>Perhaps it's even nice to present these numbers also as percentages (i.e. <code>X% of mathlib has been ported</code> and <code>The longest unported chain is Y% as long as the long chain in mathlib</code>.)</p>



<a name="309300366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309300366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309300366">(Nov 12 2022 at 07:25)</a>:</h4>
<p>It could even calculate estimated completion dates counting from some arbitrary starting point a few weeks ago. :-) Everyone loves a linearly extrapolated progress meter.</p>



<a name="309323563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309323563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jon Eugster <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309323563">(Nov 12 2022 at 11:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/some.20useful.20automation/near/309296770">said</a>:</p>
<blockquote>
<p>Oops, I accidentally did <a href="https://github.com/leanprover-community/mathlib-tools/pull/133">mathlib-tools#133</a>, which made the "ready" colour defer to human-specified colours (e.g. for "PR"), although this was separately done in the larger <a href="https://github.com/leanprover-community/mathlib-tools/pull/132">mathlib-tools#132</a>.</p>
</blockquote>
<p>Yes, merge <a href="https://github.com/leanprover-community/mathlib-tools/pull/133">mathlib-tools#133</a> first. I messed up and included more commits in <a href="https://github.com/leanprover-community/mathlib-tools/pull/132">mathlib-tools#132</a> than I intended, it was meant to be equivalent to <a href="https://github.com/leanprover-community/mathlib-tools/pull/133">mathlib-tools#133</a> <span aria-label="upside down" class="emoji emoji-1f643" role="img" title="upside down">:upside_down:</span></p>



<a name="309325132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309325132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309325132">(Nov 12 2022 at 11:37)</a>:</h4>
<p>There are MacOS issues in the tests that are unrelated to this work. Can some MacOS user have a look at <a href="https://github.com/leanprover-community/mathlib-tools/actions/runs/3449749724/jobs/5757954364#step:3:83">https://github.com/leanprover-community/mathlib-tools/actions/runs/3449749724/jobs/5757954364#step:3:83</a>?</p>



<a name="309326155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309326155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309326155">(Nov 12 2022 at 11:45)</a>:</h4>
<p>I merged <a href="https://github.com/leanprover-community/mathlib-tools/pull/133">mathlib-tools#133</a> and <a href="https://github.com/leanprover-community/mathlib-tools/pull/134">mathlib-tools#134</a> anyway. The MacOS error is probably purely a conflict between CI config and changes on MacOS.</p>



<a name="309334114"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309334114" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309334114">(Nov 12 2022 at 12:47)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I rebased <a href="https://github.com/leanprover-community/mathlib-tools/pull/135">mathlib-tools#135</a> and added a commit counting lines in the relevant files. The current output (eliding the long import chain) is:</p>
<div class="codehilite" data-code-language="plain"><pre><span></span><code>Total files in mathlib:            2677
Longest import chain in mathlib:   156
Ported files in mathlib:           30 (1.1% of total)
Ported lines in mathlib:           9091 (1.0% of total)
Longest unported chain in mathlib: 147
['logic.equiv.defs', ...]
</code></pre></div>



<a name="309334324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309334324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309334324">(Nov 12 2022 at 12:49)</a>:</h4>
<p>If this is good enough for you then I can merge a release on pypi.</p>



<a name="309334529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309334529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309334529">(Nov 12 2022 at 12:50)</a>:</h4>
<p>The line count is about the same files that the other statistics, and there are raw line numbers (including comments and blank lines). This is a rough measure anyway. Note that it seems we reached the 1% milestone!</p>



<a name="309390277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309390277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309390277">(Nov 12 2022 at 21:38)</a>:</h4>
<p>Looks good to me.</p>



<a name="309396952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/309396952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#309396952">(Nov 12 2022 at 23:06)</a>:</h4>
<p>Merged and released.</p>



<a name="310105689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310105689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310105689">(Nov 14 2022 at 23:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/287929-mathlib4/topic/some.20useful.20automation/near/309325132">said</a>:</p>
<blockquote>
<p>There are MacOS issues in the tests that are unrelated to this work. Can some MacOS user have a look at <a href="https://github.com/leanprover-community/mathlib-tools/actions/runs/3449749724/jobs/5757954364#step:3:83">https://github.com/leanprover-community/mathlib-tools/actions/runs/3449749724/jobs/5757954364#step:3:83</a>?</p>
</blockquote>
<p>Let me mention again that it would be really useful to have some MacOS user investigating this. It's really annoying to be unable to quickly check whether tests are still passing in this period where lots of leanproject PRs are made to support the port. Alternatively I could simply disable MacOS tests in CI but that could seem a bit hostile towards Mac users.</p>



<a name="310110681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310110681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310110681">(Nov 15 2022 at 00:44)</a>:</h4>
<p><a href="https://github.com/actions/runner-images/issues/6459#issuecomment-1310535069">https://github.com/actions/runner-images/issues/6459#issuecomment-1310535069</a> seems to be the same thing</p>



<a name="310111185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310111185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310111185">(Nov 15 2022 at 00:51)</a>:</h4>
<p>I’m on a Mac - haven’t seen a failure. What’s the test needed?</p>



<a name="310111983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310111983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310111983">(Nov 15 2022 at 01:01)</a>:</h4>
<p><span class="user-mention" data-user-id="542196">@Arien Malec</span>, this is the build failure Patrick is concerned about: <a href="https://github.com/leanprover-community/mathlib-tools/actions/runs/3466186474/jobs/5789737532">https://github.com/leanprover-community/mathlib-tools/actions/runs/3466186474/jobs/5789737532</a></p>



<a name="310112555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310112555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310112555">(Nov 15 2022 at 01:09)</a>:</h4>
<p>I have an old (2011) Mac running MacOS 10.13, but I don't do any Lean on it. Point being, Patrick, if you need me to fire it up and build and install, but I would prefer if someone else (e.g., Arlen) do it, especially because my OS isn't the latest anyway so the results may not match current user experience.</p>



<a name="310112795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310112795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310112795">(Nov 15 2022 at 01:12)</a>:</h4>
<p>I think <code>leanproject</code> is working fine for everyone on a mac. The problem is that the CI task that checks things work on a mac is failing (and has been for a while!) so we don't have an active guarantee of this.</p>



<a name="310112806"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310112806" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310112806">(Nov 15 2022 at 01:12)</a>:</h4>
<p>That is, the task is to work out why it fails <em>in CI</em>, rather than on an end-users computer.</p>



<a name="310113756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310113756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310113756">(Nov 15 2022 at 01:25)</a>:</h4>
<p>Ah I see.</p>



<a name="310115271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310115271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310115271">(Nov 15 2022 at 01:45)</a>:</h4>
<p>I tried a few things (editing the <code>scripts/install_macos.sh</code> script and opening a PR), but couldn't work it out.</p>



<a name="310115291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310115291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310115291">(Nov 15 2022 at 01:45)</a>:</h4>
<p>homebrew wants to install <code>python3</code>, even though it is already present on the github macos runners.</p>



<a name="310115359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310115359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310115359">(Nov 15 2022 at 01:46)</a>:</h4>
<p>while installing it runs into existing files:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">==&gt;</span> <span class="n">Pouring</span> <span class="n">python</span><span class="bp">@</span><span class="mi">3</span><span class="bp">.</span><span class="mi">11</span><span class="c1">--3.11.0.monterey.bottle.tar.gz</span>
<span class="n">Error</span><span class="o">:</span> <span class="n">The</span> <span class="bp">`</span><span class="n">brew</span> <span class="n">link</span><span class="bp">`</span> <span class="n">step</span> <span class="n">did</span> <span class="n">not</span> <span class="n">complete</span> <span class="n">successfully</span>
<span class="n">The</span> <span class="n">formula</span> <span class="n">built</span><span class="o">,</span> <span class="n">but</span> <span class="n">is</span> <span class="n">not</span> <span class="n">symlinked</span> <span class="n">into</span> <span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="kn">local</span>
<span class="n">Could</span> <span class="n">not</span> <span class="n">symlink</span> <span class="n">bin</span><span class="bp">/</span><span class="mi">2</span><span class="n">to3</span><span class="bp">-</span><span class="mi">3</span><span class="bp">.</span><span class="mi">11</span>
<span class="n">Target</span> <span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="kn">local</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="mi">2</span><span class="n">to3</span><span class="bp">-</span><span class="mi">3</span><span class="bp">.</span><span class="mi">11</span>
<span class="n">already</span> <span class="n">exists.</span> <span class="n">You</span> <span class="n">may</span> <span class="n">want</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">it</span><span class="o">:</span>
  <span class="n">rm</span> <span class="bp">'/</span><span class="n">usr</span><span class="bp">/</span><span class="kn">local</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="mi">2</span><span class="n">to3</span><span class="bp">-</span><span class="mi">3</span><span class="bp">.</span><span class="mi">11</span><span class="bp">'</span>

<span class="n">To</span> <span class="n">force</span> <span class="n">the</span> <span class="n">link</span> <span class="n">and</span> <span class="n">overwrite</span> <span class="n">all</span> <span class="n">conflicting</span> <span class="n">files</span><span class="o">:</span>
  <span class="n">brew</span> <span class="n">link</span> <span class="c1">--overwrite python@3.11</span>
</code></pre></div>



<a name="310115724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310115724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310115724">(Nov 15 2022 at 01:50)</a>:</h4>
<p>I don't have time to look tonight (and possibly not tomorrow either), but a hacky thing to try if no one's said it already is to run <code>brew install python@3.11 &amp;&amp; brew link --overwrite python@3.11</code> explicitly before running the install step</p>



<a name="310115737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310115737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310115737">(Nov 15 2022 at 01:51)</a>:</h4>
<p>If no one figures it out by then I'm happy to look on Wednesdayish</p>



<a name="310115766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310115766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310115766">(Nov 15 2022 at 01:51)</a>:</h4>
<p>(I think it's unlikely the <code>install_macos.sh</code> needs changing -- this is probably some transient thing, but that's also a guess)</p>



<a name="310115888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310115888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Julian Berman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310115888">(Nov 15 2022 at 01:53)</a>:</h4>
<p>Or even safer given that this is meant to check the install script works would be to instead run <code>brew uninstall</code> on whichever version of Python is the conflicting one -- I've had to do that this week for unrelated formulae that are now present on macOS runners (Firefox I think?).</p>



<a name="310118002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310118002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310118002">(Nov 15 2022 at 02:25)</a>:</h4>
<p><a href="https://github.com/actions/runner-images/issues/4033">https://github.com/actions/runner-images/issues/4033</a></p>



<a name="310118186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310118186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310118186">(Nov 15 2022 at 02:28)</a>:</h4>
<p>Per <a href="https://github.com/actions/runner-images/issues/4020">https://github.com/actions/runner-images/issues/4020</a> fixed by updating the image version.</p>



<a name="310118560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310118560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310118560">(Nov 15 2022 at 02:34)</a>:</h4>
<p>From issue 6459, seems to be a recurrence of the issues noted above.</p>



<a name="310118707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310118707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310118707">(Nov 15 2022 at 02:37)</a>:</h4>
<p>As noted, hacking it is probably the best short term action: <code>brew install --overwrite python@3.10 python@3.11</code> forces an overwrite.</p>



<a name="310122852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310122852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310122852">(Nov 15 2022 at 03:39)</a>:</h4>
<p>It's been broken for quite a while, so I'm dubious that just waiting for an image update will help.</p>



<a name="310122912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310122912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310122912">(Nov 15 2022 at 03:40)</a>:</h4>
<p><span class="user-mention" data-user-id="542196">@Arien Malec</span>, could you make a PR with that extra line in <code>install_macos.sh</code> and see if CI likes it?</p>



<a name="310123168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310123168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310123168">(Nov 15 2022 at 03:45)</a>:</h4>
<p>Can do via fork &amp; PR</p>



<a name="310123514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310123514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310123514">(Nov 15 2022 at 03:51)</a>:</h4>
<p>PR <a href="https://github.com/leanprover-community/mathlib/pull/142">#142</a></p>



<a name="310123792"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310123792" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310123792">(Nov 15 2022 at 03:56)</a>:</h4>
<p>might not work if the issue is with the <code>brew update</code> step above it, in which case might need to swap</p>



<a name="310124062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/some%20useful%20automation/near/310124062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/some.20useful.20automation.html#310124062">(Nov 15 2022 at 04:01)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib-tools/pull/142">mathlib-tools#142</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>