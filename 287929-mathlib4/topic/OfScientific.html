---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/OfScientific.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html">OfScientific</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="322425443"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322425443" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322425443">(Jan 20 2023 at 04:07)</a>:</h4>
<p>I just encountered</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>failed to synthesize instance
  OfScientific ℝ
</code></pre></div>
<p>while trying to refer to the real number 0.1.  Do we want an <code>OfScientific</code> instance for (say) any characteristic-zero field?  Is <code>norm_num</code> going to handle this?  cc <span class="user-mention" data-user-id="548935">@Thomas Murrills</span> <span class="user-mention" data-user-id="110049">@Mario Carneiro</span></p>



<a name="322426394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322426394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322426394">(Jan 20 2023 at 04:22)</a>:</h4>
<p>Hmm, I’m not really the one making design choices here, but I definitely think <code>norm_num</code> should be able to recognize scientific notation—it seems it can’t do this even in e.g. the <code>Rat</code> case. </p>
<p>I’ll open an issue/branch and see how far I get writing the extension right now.</p>



<a name="322426512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322426512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322426512">(Jan 20 2023 at 04:24)</a>:</h4>
<p>It also makes sense to me to have <code>OfScientific</code> defined for all charzero division rings. <code>Rat</code> has one already, and I don’t know if the general one should be defined in terms of casting Rat to the charzero field, or if this one should be abandoned in favor of a more general one, or what.</p>
<p>But imo it should exist! I wonder if it’s somewhere in mathlib3 already?</p>



<a name="322427935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322427935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322427935">(Jan 20 2023 at 04:48)</a>:</h4>
<p>Another semi-related question is whether <code>norm_num</code> should handle floats. (Semi-related because scientific notation defaults to <code>Float</code> unless you specify the type.) My guess is maybe, but I'd hope that's not needed soon? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="322550248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322550248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322550248">(Jan 20 2023 at 16:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="548935">Thomas Murrills</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322427935">said</a>:</p>
<blockquote>
<p>scientific notation defaults to <code>Float</code> unless you specify the type</p>
</blockquote>
<p>Is there a way to turn this off?  We really don't want unsuspecting mathlib users to encounter <code>Float</code>s after typing 0.1.  If there's a default in mathlib it should be Rat.</p>



<a name="322578925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322578925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322578925">(Jan 20 2023 at 17:49)</a>:</h4>
<p><code>OfScientific</code> is basically a notation typeclass, which provides the interpretation of decimal numbers. I think it is relatively safe to have a blanket implementation for anything that would have a <code>Rat.cast</code> instance.</p>



<a name="322579104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322579104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322579104">(Jan 20 2023 at 17:50)</a>:</h4>
<p>It is more or less unrelated to <code>norm_num</code>, unless that instance leaves some <code>ofScientific</code> term in the expression in which case <code>norm_num</code> will want to unfold it to a fraction</p>



<a name="322579225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322579225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322579225">(Jan 20 2023 at 17:51)</a>:</h4>
<p>in lean 3, this instance was effectively unfolded at parse time, so if you write <code>0.2</code> you get exactly the same term as if you had written <code>1/5</code> instead</p>



<a name="322579924"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322579924" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322579924">(Jan 20 2023 at 17:54)</a>:</h4>
<p><span class="user-mention silent" data-user-id="548935">Thomas Murrills</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322427935">said</a>:</p>
<blockquote>
<p>Another semi-related question is whether <code>norm_num</code> should handle floats. (Semi-related because scientific notation defaults to <code>Float</code> unless you specify the type.) My guess is maybe, but I'd hope that's not needed soon? <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>
</blockquote>
<p>This is fundamentally impossible for lean 4 <code>Float</code> as currently implemented, because everything is opaque.</p>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322550248">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="548935">Thomas Murrills</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322427935">said</a>:</p>
<blockquote>
<p>scientific notation defaults to <code>Float</code> unless you specify the type</p>
</blockquote>
<p>Is there a way to turn this off?  We really don't want unsuspecting mathlib users to encounter <code>Float</code>s after typing 0.1.  If there's a default in mathlib it should be Rat.</p>
</blockquote>
<p>I have not tried having multiple <code>@[default_instance]</code> instances at once, but I don't see any reason why it wouldn't work. If we provide another default instance for OfScientific pointing at Rat we can override this behavior.</p>



<a name="322580291"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322580291" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322580291">(Jan 20 2023 at 17:56)</a>:</h4>
<p>Is there going to be an issue having a [DivisionRing K] [CharZero K] instance for <code>OfScientific</code>; will it conflict in the case K = Rat with the instance for Rat?</p>



<a name="322580399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322580399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322580399">(Jan 20 2023 at 17:56)</a>:</h4>
<p>(see discussion on <a href="https://github.com/leanprover-community/mathlib4/pull/1707">mathlib4#1707</a>)</p>



<a name="322580670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322580670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322580670">(Jan 20 2023 at 17:57)</a>:</h4>
<p>It shouldn't do, we already solved this problem in Lean 3</p>



<a name="322580896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322580896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322580896">(Jan 20 2023 at 17:57)</a>:</h4>
<p>How?</p>



<a name="322581388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322581388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322581388">(Jan 20 2023 at 17:59)</a>:</h4>
<p>By making it be part of the definition of <code>DivisionRing</code></p>



<a name="322581896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322581896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322581896">(Jan 20 2023 at 18:01)</a>:</h4>
<p>For whatever reason it doesn’t seem to conflict as-is—if I type <code>#synth OfScientific Rat</code> after the <code>DivisionRing</code> instance I still get the <code>Rat</code> instance.</p>
<p>Not sure how Lean decides which instance to prefer or if changing the location of the instance might introduce some issues, but if it does, maybe we could tinker with the instance priorities?</p>



<a name="322581993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322581993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322581993">(Jan 20 2023 at 18:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322581388">said</a>:</p>
<blockquote>
<p>By making it be part of the definition of <code>DivisionRing</code></p>
</blockquote>
<p>What do you mean?  Even nonzero characteristic division rings?</p>



<a name="322582213"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322582213" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322582213">(Jan 20 2023 at 18:01)</a>:</h4>
<p>This is what happens what <code>rat_cast</code>, yes.</p>



<a name="322582423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322582423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322582423">(Jan 20 2023 at 18:02)</a>:</h4>
<p>We're talking about <code>OfScientific</code>, not rat casting.  (Of course they're related.)</p>



<a name="322583388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322583388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322583388">(Jan 20 2023 at 18:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322579104">said</a>:</p>
<blockquote>
<p>It is more or less unrelated to <code>norm_num</code>, unless that instance leaves some <code>ofScientific</code> term in the expression in which case <code>norm_num</code> will want to unfold it to a fraction</p>
</blockquote>
<p>Currently we are left with an <code>ofScientific</code> in the expression and <code>norm_num</code> fails when encountering it. Is there a shortcut we’d want to use for unfolding it here, or is the standard procedure for evaluating things warranted?</p>



<a name="322583653"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322583653" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322583653">(Jan 20 2023 at 18:06)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=OfScientific#doc">docs4#OfScientific</a> for reference</p>



<a name="322583796"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322583796" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322583796">(Jan 20 2023 at 18:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322582423">said</a>:</p>
<blockquote>
<p>We're talking about <code>OfScientific</code>, not rat casting.  (Of course they're related.)</p>
</blockquote>
<p>The implementation for a division ring <code>K</code> is presumably going to be <code>ratCast (OfScientific ...)</code>. The implementation of <code>ratCast</code> for <code>Rat</code> is just <code>id</code>.</p>



<a name="322583837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322583837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322583837">(Jan 20 2023 at 18:07)</a>:</h4>
<p>Well, <code>rat_cast</code> is enough to define <code>of_scientific</code>, so it should be included in at least all the structures where <code>rat_cast</code> is.</p>



<a name="322584641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322584641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322584641">(Jan 20 2023 at 18:12)</a>:</h4>
<p>As Yael alludes to, if we introduce some other division ring which has a more efficient implementation of <code>ofScientific</code> that going through <code>Rat</code>, then we're in trouble unless we make <code>ofScientific</code> a field of <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=DivisionRing#doc">docs4#DivisionRing</a></p>



<a name="322587227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322587227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322587227">(Jan 20 2023 at 18:26)</a>:</h4>
<p>This seems to fail in Lean 4:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Data.Rat.Basic</span>

<span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span><span class="o">:</span><span class="n">ℚ</span><span class="o">)</span> <span class="bp">/</span> <span class="mi">10</span> <span class="bp">=</span> <span class="mi">0</span><span class="bp">.</span><span class="mi">1</span> <span class="o">:=</span> <span class="n">rfl</span> <span class="c1">-- fails</span>
</code></pre></div>
<p>So I guess we really do need a <code>norm_num</code> extension.</p>



<a name="322587717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322587717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322587717">(Jan 20 2023 at 18:28)</a>:</h4>
<p>That's weird; I guess division doesn't reduce any more?</p>



<a name="322587860"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322587860" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322587860">(Jan 20 2023 at 18:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="548935">Thomas Murrills</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322583388">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322579104">said</a>:</p>
<blockquote>
<p>It is more or less unrelated to <code>norm_num</code>, unless that instance leaves some <code>ofScientific</code> term in the expression in which case <code>norm_num</code> will want to unfold it to a fraction</p>
</blockquote>
<p>Currently we are left with an <code>ofScientific</code> in the expression and <code>norm_num</code> fails when encountering it. Is there a shortcut we’d want to use for unfolding it here, or is the standard procedure for evaluating things warranted?</p>
</blockquote>
<p>I was kind of hoping that lean would automatically unfold the instance like it does for coes, that would make things simpler. If there is a <code>ofScientific</code> then we need to do the usual thing in norm_num: have a norm_num extension that matches on <code>ofScientific</code> and unfolds it to a division or what have you. (If this comes up a few more times we might consider having a meta-norm_num tactic/macro which generates such extensions on demand, similar to the delaborator and formatter that you get for free using <code>syntax</code>.)</p>



<a name="322588042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322588042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322588042">(Jan 20 2023 at 18:30)</a>:</h4>
<p>Note that Thomas already made a first stab at a <code>norm_num</code> extension for <code>OfScientific</code>: <a href="https://github.com/leanprover-community/mathlib4/pull/1707">mathlib4#1707</a></p>



<a name="322588101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322588101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322588101">(Jan 20 2023 at 18:30)</a>:</h4>
<p>that last example does seem weird. What does it actually unfold to?</p>



<a name="322588246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322588246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322588246">(Jan 20 2023 at 18:31)</a>:</h4>
<p>oh fun:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">#</span><span class="n">whnf</span> <span class="o">(</span><span class="mi">0</span><span class="bp">.</span><span class="mi">1</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span>
<span class="c1">-- Decidable.rec</span>
<span class="c1">--   (fun h =&gt;</span>
<span class="c1">--     (fun hg =&gt; Rat.mk' (Int.div ↑1 ↑(Nat.gcd (Int.natAbs ↑1) (10 ^ 1))) (10 ^ 1 / Nat.gcd (Int.natAbs ↑1) (10 ^ 1))) h)</span>
<span class="c1">--   (fun h =&gt; (fun hg =&gt; Rat.mk' (↑1) (10 ^ 1)) h) (instDecidableEqNat (Nat.gcd (Int.natAbs ↑1) (10 ^ 1)) 1)</span>
</code></pre></div>



<a name="322588365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322588365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322588365">(Jan 20 2023 at 18:32)</a>:</h4>
<p>it looks like it got stuck evaluating <code>Nat.gcd</code></p>



<a name="322588689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322588689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322588689">(Jan 20 2023 at 18:34)</a>:</h4>
<p>Does nat.gcd reduce in Lean 3?</p>



<a name="322588697"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322588697" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322588697">(Jan 20 2023 at 18:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322588042">said</a>:</p>
<blockquote>
<p>Note that Thomas already made a first stab at a <code>norm_num</code> extension for <code>OfScientific</code>: <a href="https://github.com/leanprover-community/mathlib4/pull/1707">mathlib4#1707</a></p>
</blockquote>
<p>I’ve only got it half done—I’m actually encountering some really weird monad errors in the main extension! I’ll bring them up later when I continue working on it.</p>



<a name="322588742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322588742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322588742">(Jan 20 2023 at 18:34)</a>:</h4>
<p>no it does not <span class="user-mention" data-user-id="310045">@Eric Wieser</span></p>



<a name="322588997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322588997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322588997">(Jan 20 2023 at 18:36)</a>:</h4>
<p>the difference in this case is that the reduction of <code>0.1</code> to <code>1/10</code> is done by meta code in lean 3, so the theorem <code>0.1 = 1/10</code> in lean 3 is a syntactic tautology</p>



<a name="322648388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322648388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322648388">(Jan 21 2023 at 01:29)</a>:</h4>
<p>(Moving from the GitHub discussion) Where is <code>Rat.cast</code>? I can’t seem to find it—only <code>Rat.castRec</code>, <code>RatCast</code>, and <code>Rat.castCoe</code></p>



<a name="322648455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322648455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322648455">(Jan 21 2023 at 01:30)</a>:</h4>
<p>I think it's called <code>RatCast.ratCast</code>.</p>



<a name="322648597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322648597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322648597">(Jan 21 2023 at 01:32)</a>:</h4>
<p>My understanding (via Mario’s comments) is that that’s not the lawful version, though, and Rat.cast is meant to be lawful somehow</p>



<a name="322649418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322649418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322649418">(Jan 21 2023 at 01:44)</a>:</h4>
<p>It seems to me like the laws for the rat cast are fields of <code>DivisionRing</code> directly, though. Does <code>Rat.cast</code> as a stand-alone typeclass actually exist yet?</p>



<a name="322651093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322651093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322651093">(Jan 21 2023 at 02:07)</a>:</h4>
<p><code>Nat.cast</code> isn't lawful either.</p>



<a name="322651178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322651178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322651178">(Jan 21 2023 at 02:08)</a>:</h4>
<p>The lawful version of <code>Nat.cast</code> is the <code>AddMonoidWithOne</code> type class.  And the lawful version of <code>Int.cast</code> is the <code>AddGroupWithOne</code> type class.</p>



<a name="322651238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322651238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322651238">(Jan 21 2023 at 02:09)</a>:</h4>
<p>Requiring a <code>DivisionRing</code> instance to prove things about <code>RatCast.ratCast</code> is the right (or at least consistent) thing to do here.</p>



<a name="322700159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322700159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322700159">(Jan 21 2023 at 10:44)</a>:</h4>
<p>Hot take: <code>AddMonoidWithOne</code> should be the <code>to_additive</code>ised version of <code>MonoidWithE</code>, with E=2.718....</p>



<a name="322701326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322701326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322701326">(Jan 21 2023 at 10:52)</a>:</h4>
<p>Do we have exponential periods yet?</p>



<a name="322733712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322733712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322733712">(Jan 21 2023 at 14:27)</a>:</h4>
<p>Depending on which definition you want, they are either 5 lightyears away, or &lt; 2 days of hacking.</p>



<a name="322778157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322778157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322778157">(Jan 21 2023 at 20:51)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322651238">said</a>:</p>
<blockquote>
<p>Requiring a <code>DivisionRing</code> instance to prove things about <code>RatCast.ratCast</code> is the right (or at least consistent) thing to do here.</p>
</blockquote>
<p>Makes sense! So, if we added it as a field to <code>DivisionRing</code> would we also want a field that made <code>ofScientific</code> lawful (i.e. said it was extensionally equal to the cast of <code>Rat.ofScientific</code>)? </p>
<p>This would make it easy to prove things about it (e.g. in <code>norm_num</code>), but I don’t know if any division rings somehow have completely different scientific notations.</p>



<a name="322778612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322778612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322778612">(Jan 21 2023 at 20:57)</a>:</h4>
<p>The division rings which show up in my research are just full of things called <code>d</code> and <code>x</code>.</p>



<a name="322779390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322779390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322779390">(Jan 21 2023 at 21:09)</a>:</h4>
<p>It shouldn’t be much overhead (computationally or cognitively) in almost all cases, I think, as the default values should take care of it like they do for <code>ratCast</code>: the default value of <code>ofScientific</code> will be the cast of <code>Rat.ofScientific</code>, and so the default proof that it’s lawful will be reflexivity, and you won’t even know it’s there. But if you need 0.1, you’ll have it. :)</p>



<a name="322779768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322779768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322779768">(Jan 21 2023 at 21:15)</a>:</h4>
<p>I still think we should not make this a field and should just have an <code>OfScientific</code> instance for any division ring defined in terms of <code>Rat.ofScientific</code></p>



<a name="322779989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322779989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322779989">(Jan 21 2023 at 21:17)</a>:</h4>
<p>There are lots of definitions that are not fields, and structure fields have a significant cost on the overall typeclass system, so I would <em>really</em> rather not have silly things like this being something everyone has to deal with when making fields</p>



<a name="322780401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780401">(Jan 21 2023 at 21:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322779768">said</a>:</p>
<blockquote>
<p>I still think we should not make this a field and should just have an <code>OfScientific</code> instance for any division ring defined in terms of <code>Rat.ofScientific</code></p>
</blockquote>
<p>Mario, there's a point about this suggestion which I don't understand -- won't it mean that <code>Rat</code> gets two separate <code>OfScientific</code> instances?  Even though their data is the same, I would think that would cause problems.</p>



<a name="322780419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780419">(Jan 21 2023 at 21:23)</a>:</h4>
<p>they should be defeq</p>



<a name="322780439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780439">(Jan 21 2023 at 21:23)</a>:</h4>
<p>OK, maybe I hadn't appreciated that: it's ok to have multiple instances if they're defeq.</p>



<a name="322780455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780455">(Jan 21 2023 at 21:24)</a>:</h4>
<p>because the <code>RatCast Rat</code> instance should be the identity</p>



<a name="322780487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780487">(Jan 21 2023 at 21:24)</a>:</h4>
<p>Do they need to be "quickly" defeq?</p>



<a name="322780504"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780504" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780504">(Jan 21 2023 at 21:24)</a>:</h4>
<p>they should be defeq at instance reducibility</p>



<a name="322780509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780509">(Jan 21 2023 at 21:24)</a>:</h4>
<p>which I think is the case here</p>



<a name="322780515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780515">(Jan 21 2023 at 21:25)</a>:</h4>
<p>Hmm…if someone wants to implement a new definition of <code>ofScientific</code> for their division ring (which happens in one spot I think—something about Cauchy sequences), would that cause problems? Would we give the general one a lower priority or something?</p>



<a name="322780528"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780528" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780528">(Jan 21 2023 at 21:25)</a>:</h4>
<p>They should not do that</p>



<a name="322780540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780540">(Jan 21 2023 at 21:25)</a>:</h4>
<p>They already do <span aria-label="grimacing" class="emoji emoji-1f62c" role="img" title="grimacing">:grimacing:</span></p>



<a name="322780546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780546">(Jan 21 2023 at 21:25)</a>:</h4>
<p>in lean 3 this was simply not a possibility and I think that was a good thing</p>



<a name="322780555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780555">(Jan 21 2023 at 21:25)</a>:</h4>
<p>this is one more knob that people can use to write the same thing in multiple ways</p>



<a name="322780634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780634">(Jan 21 2023 at 21:26)</a>:</h4>
<p>(Maybe we can get rid of the bespoke definition? I haven’t checked…)</p>



<a name="322780650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780650">(Jan 21 2023 at 21:27)</a>:</h4>
<p>I'm sure the definition was written because the general one didn't exist yet</p>



<a name="322780680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780680">(Jan 21 2023 at 21:27)</a>:</h4>
<p>I don't see that one? it's not listed at<br>
<a href="https://leanprover-community.github.io/mathlib4_docs/Init/Data/OfScientific.html#OfScientific">https://leanprover-community.github.io/mathlib4_docs/Init/Data/OfScientific.html#OfScientific</a></p>



<a name="322780834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322780834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322780834">(Jan 21 2023 at 21:29)</a>:</h4>
<p>Wow, if I’m looking at the right thing, it’s disappeared since this thread started! That’s convenient!</p>



<a name="322781585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322781585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322781585">(Jan 21 2023 at 21:41)</a>:</h4>
<p>Oh, perhaps I’m mixing things up. I might have been thinking about things with custom <code>RatCast</code> implementations.  <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=RatCast#doc">docs4#RatCast</a></p>
<p>Will that also make things potentially break though? When the instance of <code>ofScientific</code> for all division rings searches for a way to cast rationals, will it find the custom cast, or the canonical cast? (Should we just force the canonical cast somehow in this instance?)</p>



<a name="322781756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322781756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322781756">(Jan 21 2023 at 21:44)</a>:</h4>
<p>It doesn't search for a way to cast rationals, the cast is baked into the definition and it is the canonical one</p>



<a name="322781855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322781855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322781855">(Jan 21 2023 at 21:45)</a>:</h4>
<p>Hmmm. So writing <code>(3/4 : ℚ) : R</code> will use the canonical cast instead of whatever the division ring <code>R</code> has defined?</p>



<a name="322781933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322781933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322781933">(Jan 21 2023 at 21:46)</a>:</h4>
<p>(Because that’s all this new instance we’re defining does atm)</p>



<a name="322783238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322783238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322783238">(Jan 21 2023 at 22:03)</a>:</h4>
<p>I can only think of one case where the blanket instance is problematic: floating point numbers.  There the (naive) rat cast version has less precision than the current implementation which directly produces the mantissa.</p>



<a name="322783390"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322783390" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322783390">(Jan 21 2023 at 22:05)</a>:</h4>
<p>We could declare the blanket instance only for division rings, where the cast is unique.</p>



<a name="322783630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322783630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322783630">(Jan 21 2023 at 22:08)</a>:</h4>
<p>Is the cast definitionally unique for division rings or just propositionally unique? (Or is the latter enough for all purposes?) Does the <code>ratCast</code> field of division rings ever come into play here?</p>



<a name="322783782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322783782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322783782">(Jan 21 2023 at 22:10)</a>:</h4>
<p>Just proposition ally.</p>



<a name="322783811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322783811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322783811">(Jan 21 2023 at 22:11)</a>:</h4>
<p>The ratCast field is used for coercions from rational numbers as the name implies.</p>



<a name="322783971"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322783971" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322783971">(Jan 21 2023 at 22:13)</a>:</h4>
<p>So when we write this instance for division rings for <code>ofScientific</code>, I’m guessing we should use the value in that field instead of the (potentially not defeq) canonical cast to cast the value of <code>Rat.ofScientific</code>, right? I’m just trying to figure out if that will ever cause any problems…</p>



<a name="322784167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322784167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322784167">(Jan 21 2023 at 22:16)</a>:</h4>
<p>Oh yeah, I think we should define of scientific in terms of rat cast.</p>



<a name="322786838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322786838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322786838">(Jan 21 2023 at 22:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322783238">said</a>:</p>
<blockquote>
<p>I can only think of one case where the blanket instance is problematic: floating point numbers.  There the (naive) rat cast version has less precision than the current implementation which directly produces the mantissa.</p>
</blockquote>
<p>In that case we don't really care that it's the wrong instance since we aren't proving anything about those floats anyway</p>



<a name="322786922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322786922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322786922">(Jan 21 2023 at 22:49)</a>:</h4>
<p>It should be possible to implement that in such a way that there is no loss however, where the <code>Rat -&gt; Float</code> function builds the nearest float to the rational number according to the rounding mode</p>



<a name="322789975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322789975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322789975">(Jan 21 2023 at 23:32)</a>:</h4>
<p>Floating point numbers aren't a division ring so I don't see a conflict here?</p>



<a name="322790175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322790175" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322790175">(Jan 21 2023 at 23:35)</a>:</h4>
<p>That is, DivisionRing.toOfScientific should be safe</p>



<a name="322798849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322798849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322798849">(Jan 22 2023 at 01:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322786838">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322783238">said</a>:</p>
<blockquote>
<p>I can only think of one case where the blanket instance is problematic: floating point numbers.  There the (naive) rat cast version has less precision than the current implementation which directly produces the mantissa.</p>
</blockquote>
<p>In that case we don't really care that it's the wrong instance since we aren't proving anything about those floats anyway</p>
</blockquote>
<p>On the contrary, we care much more for floating-point numbers than for division rings because the two operations are not equivalent.  It's not just that we can't prove they're equal, we can actually observe that one of them is much worse!  For division rings, it doesn't really matter whether we define scientific literals as <code>ratCast ...</code> or <code>intCast .. / natCast ...</code> or something else, because we provably get the same result every time.  But for floating-point numbers e.g. going via <code>intCast .. / natCast ..</code> would have unacceptable numerical precision.</p>



<a name="322799116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799116">(Jan 22 2023 at 01:41)</a>:</h4>
<p>was <code>intCast .. / natCast ..</code> ever on the table?</p>



<a name="322799124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799124">(Jan 22 2023 at 01:41)</a>:</h4>
<p>that is a terrible implementation</p>



<a name="322799128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799128">(Jan 22 2023 at 01:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322786922">said</a>:</p>
<blockquote>
<p>It should be possible to implement that in such a way that there is no loss however, where the <code>Rat -&gt; Float</code> function builds the nearest float to the rational number according to the rounding mode</p>
</blockquote>
<p>It is a good idea to define <code>ratCast</code> that way (or at least close enough to that spec).  Which still leaves the issue that <code>0.1</code> might be a different floating-point number depending on which instance is used.  I'd like to avoid that potential nightmare.</p>



<a name="322799185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799185">(Jan 22 2023 at 01:42)</a>:</h4>
<p>Like Eric said, there is no diamond here</p>



<a name="322799196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799196">(Jan 22 2023 at 01:42)</a>:</h4>
<p>?</p>



<a name="322799204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799204">(Jan 22 2023 at 01:42)</a>:</h4>
<p>Float is not a division ring</p>



<a name="322799206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799206">(Jan 22 2023 at 01:42)</a>:</h4>
<p>Core has an <code>OfScientific</code> instance for <code>Float</code>.</p>



<a name="322799241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799241">(Jan 22 2023 at 01:43)</a>:</h4>
<p>no one is suggesting an instance for <code>[RatCast R] : OfScientific R</code></p>



<a name="322799245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799245">(Jan 22 2023 at 01:43)</a>:</h4>
<p>Oh yeah, my objections doesn't apply to the <code>[DivisionrRing R] : OfScientific R</code> instance.</p>



<a name="322799255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799255">(Jan 22 2023 at 01:43)</a>:</h4>
<p>I don't think <code>Float</code> has a <code>RatCast</code> instance either, for that matter</p>



<a name="322799270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799270">(Jan 22 2023 at 01:44)</a>:</h4>
<p>although it probably should</p>



<a name="322799428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799428">(Jan 22 2023 at 01:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799241">said</a>:</p>
<blockquote>
<p>no one is suggesting an instance for <code>[RatCast R] : OfScientific R</code></p>
</blockquote>
<p>I was going by Thomas's comment on the norm_num PR:</p>
<blockquote>
<p>Though, @digama0, you suggested a blanket implementation for anything that has an instance of RatCast.</p>
</blockquote>



<a name="322799462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/OfScientific/near/322799462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/OfScientific.html#322799462">(Jan 22 2023 at 01:47)</a>:</h4>
<p>yes, he misunderstood what I meant by "the instances required to get <code>Rat.cast</code>"</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>