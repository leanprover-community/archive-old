---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html">Can someone explain what's going on here?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="311917514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/311917514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#311917514">(Nov 23 2022 at 22:41)</a>:</h4>
<p>Here's a silly file:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">True</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="k">let</span> <span class="n">A</span> <span class="o">:</span> <span class="n">Set</span> <span class="o">(</span><span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span><span class="n">x</span> <span class="bp">|</span> <span class="k">match</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="mi">0</span> <span class="bp">∧</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">}</span>
  <span class="n">trivial</span>

<span class="kd">theorem</span> <span class="n">test</span> <span class="o">:</span> <span class="n">True</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="k">let</span> <span class="n">A</span> <span class="o">:</span> <span class="n">Set</span> <span class="o">(</span><span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span><span class="n">x</span> <span class="bp">|</span> <span class="k">match</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="mi">0</span> <span class="bp">∧</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">}</span>
  <span class="n">trivial</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">True</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="k">let</span> <span class="n">A</span> <span class="o">:</span> <span class="n">Set</span> <span class="o">(</span><span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span><span class="n">x</span> <span class="bp">|</span> <span class="k">match</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="mi">0</span> <span class="bp">∧</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">0</span><span class="o">}</span>
  <span class="n">trivial</span>
</code></pre></div>
<p>If I position the cursor at the end of the first <code>let</code> line, then the tactic state includes this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">A</span> <span class="o">:</span> <span class="n">Set</span> <span class="o">(</span><span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">x</span> <span class="bp">|</span> <span class="n">_example.match_1</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="bp">=&gt;</span> <span class="kt">Prop</span><span class="o">)</span> <span class="n">x</span> <span class="k">fun</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="mi">0</span> <span class="bp">∧</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">0</span> <span class="o">}</span>
</code></pre></div>
<p>If I position the cursor at the end of either the second or the third <code>let</code> line, then the tactic state includes this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">A</span> <span class="o">:</span> <span class="n">Set</span> <span class="o">(</span><span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:=</span> <span class="o">{</span> <span class="n">x</span> <span class="bp">|</span>
  <span class="k">match</span> <span class="n">x</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">&gt;</span> <span class="mi">0</span> <span class="bp">∧</span> <span class="n">b</span> <span class="bp">&gt;</span> <span class="mi">0</span> <span class="o">}</span>
</code></pre></div>
<p>Why the difference?  The two examples are exactly the same; why does putting a theorem between them cause Lean to treat the second example differently?  (And what does <code>_example.match_1</code> mean?)</p>



<a name="311919866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/311919866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#311919866">(Nov 23 2022 at 23:08)</a>:</h4>
<p>(deleted)</p>



<a name="311975144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/311975144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#311975144">(Nov 24 2022 at 09:38)</a>:</h4>
<p>Fixed by <a href="https://github.com/leanprover/lean4/pull/1880">https://github.com/leanprover/lean4/pull/1880</a></p>



<a name="312041147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312041147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312041147">(Nov 24 2022 at 15:34)</a>:</h4>
<p>Thanks.  I wonder if the following behavior is related.  This example works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib</span>

<span class="kd">theorem</span> <span class="n">test</span> <span class="o">:</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span> <span class="bp">|</span> <span class="k">match</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">}</span> <span class="bp">⊆</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span> <span class="bp">|</span> <span class="n">x.1</span> <span class="bp">=</span> <span class="n">x.2</span><span class="o">}</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">intro</span> <span class="n">p</span>
  <span class="n">intro</span> <span class="n">h</span>
  <span class="n">exact</span> <span class="n">h</span>
</code></pre></div>
<p>After <code>intro h</code>, the tactic state includes <code>h : p ∈ { x | match x with | (a, b) =&gt; a = b }</code>.  But the following doesn't work:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib</span>

<span class="kd">theorem</span> <span class="n">test</span> <span class="o">:</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span> <span class="bp">|</span> <span class="k">match</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">}</span> <span class="bp">⊆</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span> <span class="bp">|</span> <span class="n">x.1</span> <span class="bp">=</span> <span class="n">x.2</span><span class="o">}</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">intro</span> <span class="n">p</span>
  <span class="n">intro</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">∈</span> <span class="o">{</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span> <span class="bp">|</span> <span class="k">match</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">})</span>
  <span class="n">exact</span> <span class="n">h</span>
</code></pre></div>
<p>I get a red squiggle under <code>(a, b)</code>, and the error message is <code>invalid pattern, constructor or constant marked with '[match_pattern]' expected</code>.  Shouldn't this work?<br>
Will your change fix this too, or is it a different problem?  Or am I doing something wrong?</p>



<a name="312053720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312053720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312053720">(Nov 24 2022 at 16:50)</a>:</h4>
<p>That looks like an unrelated bug. Could you file an issue with an MWE?</p>



<a name="312054048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312054048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312054048">(Nov 24 2022 at 16:52)</a>:</h4>
<p>Will the example I gave count as a MWE?  (I'm not sure I understand what counts as a MWE.)</p>



<a name="312054543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312054543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312054543">(Nov 24 2022 at 16:56)</a>:</h4>
<p>Mathlib should generally be avoided in an MWE :) . This issue should be independent of it.</p>



<a name="312054975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312054975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312054975">(Nov 24 2022 at 16:59)</a>:</h4>
<p>OK, I think I have an example that doesn't require Mathlib:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span><span class="o">),</span> <span class="k">match</span> <span class="n">x</span> <span class="k">with</span> <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">→</span> <span class="o">(</span><span class="n">x.1</span> <span class="bp">=</span> <span class="n">x.2</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">intro</span> <span class="n">p</span>
  <span class="n">intro</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="k">match</span> <span class="n">p</span> <span class="k">with</span> <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span>
  <span class="n">exact</span> <span class="n">h</span>
</code></pre></div>
<p>I get the same error on the <code>intro</code>.  This should work, right?</p>



<a name="312055223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312055223" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312055223">(Nov 24 2022 at 17:01)</a>:</h4>
<p>Should I call this a problem with <code>match</code>?  Or a problem with <code>intro</code>?</p>



<a name="312055676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312055676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312055676">(Nov 24 2022 at 17:04)</a>:</h4>
<p>Mmh, more probably <code>intro</code>?</p>



<a name="312055783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312055783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312055783">(Nov 24 2022 at 17:05)</a>:</h4>
<p>I don't think the usage <code>intro (x : A)</code> was intended to be honest, but it <em>usually</em> works as a pattern</p>



<a name="312056620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312056620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312056620">(Nov 24 2022 at 17:11)</a>:</h4>
<p>I've been writing tactics for use by students learning to write proofs.  One of my tactics is for introducing assumptions.  I want students to write <code>assume h : p</code>.  My tactic checks that the goal is an implication, and then it does <code>intro (h : p)</code>.  For students learning to write proofs, I think it might be helpful to ask them to state what they are assuming, so that Lean can correct them if they are confused about what the assumption is.  And then it is helpful if <code>h</code> is listed in the tactic state as <code>p</code>, not something definitionally equal to <code>p</code>.</p>
<p>I'll file an issue.</p>



<a name="312059555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312059555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312059555">(Nov 24 2022 at 17:34)</a>:</h4>
<p>I don't know if this is related, but I tried this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">test</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="k">match</span> <span class="n">p</span> <span class="k">with</span> <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">p.1</span> <span class="bp">=</span> <span class="n">p.2</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">intro</span> <span class="n">h'</span>
  <span class="k">have</span> <span class="n">h</span> <span class="o">:</span> <span class="k">match</span> <span class="n">p</span> <span class="k">with</span> <span class="bp">|</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="o">:=</span> <span class="n">h'</span>
  <span class="n">exact</span> <span class="n">h</span>
</code></pre></div>
<p>This works, but in the tactic state, <code>h</code> is listed as <code>match p, h' with | (a, b), h' =&gt; a = b</code>.  Is that what it's supposed to be?  Shouldn't it be what I said I wanted <code>h</code> to be?</p>



<a name="312060942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312060942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312060942">(Nov 24 2022 at 17:45)</a>:</h4>
<p>This is probably due to match auto generalization. I would avoid restating <code>match</code> terms like this. If you need the same <code>match</code> twice, it should be a function.</p>



<a name="312062705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Can%20someone%20explain%20what%27s%20going%20on%20here%3F/near/312062705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Dan Velleman <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Can.20someone.20explain.20what's.20going.20on.20here.3F.html#312062705">(Nov 24 2022 at 17:58)</a>:</h4>
<p>I was trying it as a possible workaround for the problem with <code>intro (h : match ...)</code>.  I thought perhaps my tactic, instead of calling <code>intro (h : p)</code>, could instead do <code>intro h'; have h : p := h'; clear h'</code>.  But it looks like that won't work if <code>p</code> is a <code>match</code>?</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>