---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/simp.20normal.20form.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html">simp normal form</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="318018031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318018031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318018031">(Dec 27 2022 at 00:10)</a>:</h4>
<p>In <a href="https://github.com/leanprover-community/mathlib/pull/1135">#1135</a> (and often elsewhere), the linter complains that some simp lemmas' LHS can be "simplified" to some other expression. For example, <code>normalize x</code> can be simp-ed to <code>x * ↑(normUnit x)</code>. But that doesn't look simpler, and it makes the lemmas a lot less meaningful. What should I do in these cases?</p>



<a name="318019018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318019018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318019018">(Dec 27 2022 at 00:27)</a>:</h4>
<p>This is presumably <a href="https://github.com/leanprover-community/mathlib4/pull/1135">mathlib4#1135</a></p>



<a name="318049020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318049020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318049020">(Dec 27 2022 at 08:00)</a>:</h4>
<p>In general, I think changing the lemma statement (as in one of the suggestions of the linter) is rarely/never the right thing to do.<br>
I would start by investigating why the lemmas it is using to simplify the LHS are simp lemmas.</p>



<a name="318049039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318049039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318049039">(Dec 27 2022 at 08:00)</a>:</h4>
<p>(Changing the lemma statement would be sensible for a new lemma, but not for a lemma being ported.)</p>



<a name="318049505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318049505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318049505">(Dec 27 2022 at 08:05)</a>:</h4>
<p>In this case, it's possible that coercion for a <code>GroupWithZeroHom</code> unfolds to something with <code>toFun</code> instead of <code>CoeFun.coe</code>.</p>



<a name="318050362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318050362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318050362">(Dec 27 2022 at 08:13)</a>:</h4>
<p>I don't understand how the situation wasn't the same in mathlib 3, given</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">normalize_apply</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">normalize</span> <span class="n">x</span> <span class="bp">=</span> <span class="n">x</span> <span class="bp">*</span> <span class="n">norm_unit</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">rfl</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">normalize_zero</span> <span class="o">:</span> <span class="n">normalize</span> <span class="o">(</span><span class="mi">0</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">normalize.map_zero</span>
</code></pre></div>
<p>and then a bunch more lemmas about <code>normalize</code>. How did these pass the <code>simp_nf</code> linter?</p>



<a name="318050377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318050377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318050377">(Dec 27 2022 at 08:13)</a>:</h4>
<p>In any case, I don't think <code>normalize_apply</code> is a good simp lemma</p>



<a name="318050565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318050565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318050565">(Dec 27 2022 at 08:15)</a>:</h4>
<p>And indeed <code>normalize</code> is really a <code>monoid_with_zero_hom</code>, but I don't see why that should matter...</p>



<a name="318050636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318050636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318050636">(Dec 27 2022 at 08:16)</a>:</h4>
<p>Agreed. The coercion is a projection, but here we don't want to break the <code>normalize</code> abstraction. This is because the bundling of <code>normalize</code> is an implementation detail.</p>



<a name="318050845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318050845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318050845">(Dec 27 2022 at 08:18)</a>:</h4>
<p>Probably, I was wrong about coercion. About <code>normalize_apply</code> in mathlib3, I think that <code>simp</code> applied lemmas in the reverse order.</p>



<a name="318050896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318050896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318050896">(Dec 27 2022 at 08:19)</a>:</h4>
<p>So, if at some level it can apply both <code>normalize_apply</code> and a more specific lemma about <code>normalize</code>, then it will apply the more specific lemma first.</p>



<a name="318051578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318051578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318051578">(Dec 27 2022 at 08:25)</a>:</h4>
<p>I guess we don't have the simp normal form linter in mathlib 3, but it would have fired if we'd had it?</p>



<a name="318051734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318051734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318051734">(Dec 27 2022 at 08:26)</a>:</h4>
<p>It definitely exists: <a href="https://github.com/leanprover-community/mathlib/blob/master/src/tactic/lint/simp.lean#L170">https://github.com/leanprover-community/mathlib/blob/master/src/tactic/lint/simp.lean#L170</a><br>
I don't know whether it actually runs, or works.</p>



<a name="318051829"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318051829" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318051829">(Dec 27 2022 at 08:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307953">Ruben Van de Velde</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20normal.20form/near/318051578">said</a>:</p>
<blockquote>
<p>I guess we don't have the simp normal form linter in mathlib 3, but it would have fired if we'd had it?</p>
</blockquote>
<p>Of course we do. I'm sure it bothered you (as any of us) more than once <span aria-label="grinning face with smiling eyes" class="emoji emoji-1f601" role="img" title="grinning face with smiling eyes">:grinning_face_with_smiling_eyes:</span></p>



<a name="318054274"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318054274" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318054274">(Dec 27 2022 at 08:47)</a>:</h4>
<p>My memories of mathlib 3 are clearly rapidly fading <span aria-label="innocent" class="emoji emoji-1f607" role="img" title="innocent">:innocent:</span></p>



<a name="318101216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318101216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318101216">(Dec 27 2022 at 13:57)</a>:</h4>
<p>My understanding (from Mario explaining this to me a few weeks ago) is that the simplifier applies lemmas in what should be interpreted as a random order (which might not be preserved by the port), so if the simp set is not confluent then perhaps it's not impossible that the simp_nf linter might fire in mathlib4 but not in mathlib3?</p>



<a name="318125588"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318125588" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318125588">(Dec 27 2022 at 16:32)</a>:</h4>
<p>Is the idea that the <code>simp_nf</code> linter runs with the simp set that's been extended with the new lemma, so if we're lucky(?) then it will trigger on itself, rather than the other lemma triggering?</p>



<a name="318127303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318127303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318127303">(Dec 27 2022 at 16:44)</a>:</h4>
<p>The difference is not with the linter (it works in both mathlib 3 and 4!).  It is with simp itself.  In Lean 3, simp tried the lemmas in the order that they were declared/imported in (or in the reverse order, I can never remember).  In Lean 4, this is a bit more random (simp will still respect priorities though).</p>



<a name="318130174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318130174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318130174">(Dec 27 2022 at 17:05)</a>:</h4>
<p>So, the proper fix in this case is to give the <code>normalize_apply</code> lemma a lower priority?</p>



<a name="318130522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318130522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318130522">(Dec 27 2022 at 17:07)</a>:</h4>
<p>That would replicate the Lean 3 behavior, yes.</p>



<a name="318156517"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318156517" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318156517">(Dec 27 2022 at 20:38)</a>:</h4>
<p>How do I assign priority to simp lemmas in Lean4? <code>@[simp, priority 1100]</code> doesn't seem to work.</p>



<a name="318157410"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318157410" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318157410">(Dec 27 2022 at 20:47)</a>:</h4>
<p><code>@[simp 1100]</code></p>



<a name="318255492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318255492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318255492">(Dec 28 2022 at 13:28)</a>:</h4>
<p>Does this work differently for declaration in <code>core</code>? Even modifying the priority in the Lean declaration the linter keeps complaining that the left hand side can be modified, by a <code>simp</code> lemma in core.</p>



<a name="318397217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318397217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318397217">(Dec 29 2022 at 11:13)</a>:</h4>
<p>What do people think of the following workflow to systematically deal with <code>simp_nf</code> linting errors? (This issue is holding up several PRs by now. We should resolve it.)</p>
<ol>
<li>make a copy of the statement, add <code>'</code> to the name</li>
<li>in the original statement remove <code>@[simp]</code></li>
<li>in the copy, simplify the LHS, to make the linter happy</li>
<li>keep the <code>#align</code> on the original, but don't align the copy.</li>
<li>add a <code>-- Porting note: simp_nf copy</code> just before the copied statement</li>
</ol>



<a name="318399561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318399561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318399561">(Dec 29 2022 at 11:28)</a>:</h4>
<p>LGTM</p>



<a name="318400309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318400309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318400309">(Dec 29 2022 at 11:33)</a>:</h4>
<p>I've been out of the loop since before Christmas and haven't seen these new issues. Is the problem with the linter or the lemmas, or are we not sure? What are examples of PRs being held up by this issue?</p>



<a name="318400812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318400812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318400812">(Dec 29 2022 at 11:37)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/1135">mathlib4#1135</a>  by Winston (who started the thread) and  <a href="https://github.com/leanprover-community/mathlib4/pull/966">mathlib4#966</a> (data.list.basic)</p>



<a name="318400821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318400821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318400821">(Dec 29 2022 at 11:37)</a>:</h4>
<p>There's probably more.</p>



<a name="318403813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318403813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318403813">(Dec 29 2022 at 11:57)</a>:</h4>
<p>Priming the names will bring you trouble, but, if you instead suffix <code>_simp_nf</code> or  something like that, it should never conflict</p>



<a name="318468183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318468183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318468183">(Dec 29 2022 at 18:37)</a>:</h4>
<p>OK so I've had a look at the lint errors in data.list.basic and it seems to me that there are several possibly different issues with the declarations in this file, which <code>simpNF</code> is objecting to. I write them here just to summarise what the main problems seem to be currently.</p>
<p>1) "Left-hand side simplifies". Example: <code>List.modify_head_modify_head</code>. The linter claims that the (lousy) move <code>simp only [List.modifyHead]</code> "simplifies" <code>List.modifyHead g (List.modifyHead f l)</code> to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">match</span>
  <span class="k">match</span> <span class="n">l</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="o">[]</span> <span class="bp">=&gt;</span> <span class="o">[]</span>
  <span class="bp">|</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">f</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span> <span class="k">with</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="bp">=&gt;</span> <span class="o">[]</span>
<span class="bp">|</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">g</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span>
</code></pre></div>
<p>No doubt it does. I think that this one might be easy to fix: right now we have</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Apply `f` to the head of the list, if it exists. -/</span>
<span class="kd">@[simp, inline]</span> <span class="kd">def</span> <span class="n">modifyHead</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span>
  <span class="bp">|</span> <span class="o">[]</span> <span class="bp">=&gt;</span> <span class="o">[]</span>
  <span class="bp">|</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">f</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span>
</code></pre></div>
<p>and in Lean 3 the <code>simp</code> attribute attaches <code>simp</code> to the equation lemmas, but in Lean 4 it also attaches <code>simp</code> to the declaration itself, i.e. telling the simplifier "unfold this to a match whenever you see it, please". This is in <code>std</code>. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> should <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.modifyHead#doc">docs4#List.modifyHead</a> be tagged <code>@[simp]</code> in Lean 4? Similar comments apply to <code>List.filterMap</code> -- this is tagged <code>@[specialize]</code> -- does this somehow imply <code>@[simp]</code>? The most confusing example is <code>List.find?</code> -- <code>simpNF</code> is claiming that <code>List.find? p (a :: l)</code> is being simplified to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="k">match</span> <span class="n">p</span> <span class="n">a</span> <span class="k">with</span>
<span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="n">some</span> <span class="n">a</span>
<span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="n">List.find</span><span class="bp">?</span> <span class="n">p</span> <span class="n">l</span>
</code></pre></div>
<p>but it doen't seem that <code>List.find?</code> is tagged with <code>@[simp]</code> at all? Another example is <code>List.nthLe_repeat</code> which mentions <code>List.repeat</code>; this declaration is in mathlib4 in Data.List.Basic and tagged with <code>@[simp]</code>. If we're tagging <code>List.repeat</code> with <code>@[simp]</code> then it is true that no <code>simp</code> lemma should mention <code>List.repeat</code>, and <code>List.nthLe_repeat</code> does.</p>
<p>2) "Left-hand side does not simplify". This we've seen before, and it might be a bug in the linter. Example:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span>
    <span class="o">(</span><span class="n">l.attach.map</span> <span class="k">fun</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="o">{</span><span class="n">i</span> <span class="bp">//</span> <span class="n">i</span> <span class="bp">∈</span> <span class="n">l</span><span class="o">})</span> <span class="bp">=&gt;</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">l.map</span> <span class="n">f</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">simp</span><span class="bp">?</span>
</code></pre></div>
<p>This works fine; the simplfier suggests <code>simp only [attach_map_coe']</code>. And yet <code>simpNF</code> reports on <code>List.attach_map_coe'</code> that the left hand side doesn't simplify. I have seen this issue before and reported it ; <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> suggested that in this case I ignore the issue and just nolint simpNF. Gabriel is that also true for this example? The declaration is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span>
<span class="kd">theorem</span> <span class="n">attach_map_coe'</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span>
    <span class="o">(</span><span class="n">l.attach.map</span> <span class="k">fun</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="o">{</span><span class="n">i</span> <span class="bp">//</span> <span class="n">i</span> <span class="bp">∈</span> <span class="n">l</span><span class="o">})</span> <span class="bp">=&gt;</span> <span class="n">f</span> <span class="n">i</span><span class="o">)</span> <span class="bp">=</span> <span class="n">l.map</span> <span class="n">f</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">attach</span><span class="o">,</span> <span class="n">map_pmap</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">pmap_eq_map</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span>
</code></pre></div>
<p>3) "simp can prove this". There are two of these. For <code>List.init_cons_of_ne_nil</code> it doesn't actually seem to be true: the claimed proof is the funny-looking <code>simp only [_private.Std.Data.List.Init.Lemmas.0.List.dropLast._eq_3]</code> so I'm wondering if this is a bug in the linter. For the other one, <code>List.indexOf_nil</code>, it is true that <code>simp</code> can prove it by the end of the file. I propose not tagging it with <code>simp</code>.</p>



<a name="318471016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318471016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318471016">(Dec 29 2022 at 18:56)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20normal.20form/near/318468183">said</a>:</p>
<blockquote>
<p>I think that this one might be easy to fix: right now we have</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Apply `f` to the head of the list, if it exists. -/</span>
<span class="kd">@[simp, inline]</span> <span class="kd">def</span> <span class="n">modifyHead</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span>
  <span class="bp">|</span> <span class="o">[]</span> <span class="bp">=&gt;</span> <span class="o">[]</span>
  <span class="bp">|</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">f</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span>
</code></pre></div>
<p>and in Lean 3 the <code>simp</code> attribute attaches <code>simp</code> to the equation lemmas, but in Lean 4 it also attaches <code>simp</code> to the declaration itself, i.e. telling the simplifier "unfold this to a match whenever you see it, please". This is in <code>std</code>. <span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> should <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.modifyHead#doc">docs4#List.modifyHead</a> be tagged <code>@[simp]</code> in Lean 4?</p>
</blockquote>
<p>No it should not. Currently <code>@[simp]</code> on a nonrecursive function unfolds in this unhelpful way, differently to lean 3, and the correct way to reproduce the lean 3 behavior in lean 4 is to remove <code>@[simp]</code> from the definition and add it to the equation lemmas (writing them if necessary).</p>
<blockquote>
<p>Similar comments apply to <code>List.filterMap</code> -- this is tagged <code>@[specialize]</code> -- does this somehow imply <code>@[simp]</code>? </p>
</blockquote>
<p>No, <code>specialize</code> is an instruction for the compiler, it is unrelated to <code>simp</code>.</p>
<blockquote>
<p>The most confusing example is <code>List.find?</code> -- <code>simpNF</code> is claiming that <code>List.find? p (a :: l)</code> is being simplified to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="k">match</span> <span class="n">p</span> <span class="n">a</span> <span class="k">with</span>
<span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="n">some</span> <span class="n">a</span>
<span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="n">List.find</span><span class="bp">?</span> <span class="n">p</span> <span class="n">l</span>
</code></pre></div>
<p>but it doen't seem that <code>List.find?</code> is tagged with <code>@[simp]</code> at all?</p>
</blockquote>
<p>Perhaps the attribute is being applied later? Or it is applied to an equation lemma.</p>
<blockquote>
<p>Another example is <code>List.nthLe_repeat</code> which mentions <code>List.repeat</code>; this declaration is in mathlib4 in Data.List.Basic and tagged with <code>@[simp]</code>. If we're tagging <code>List.repeat</code> with <code>@[simp]</code> then it is true that no <code>simp</code> lemma should mention <code>List.repeat</code>, and <code>List.nthLe_repeat</code> does.</p>
</blockquote>
<p>With <code>List.repeat</code>, I'm not sure if we should set up the simp lemmas so that <code>repeat</code> immediately unfolds to <code>replicate</code> and then <code>replicate</code> has all the useful lemmas, or whether <code>repeat</code> should not unfold unconditionally but instead it has parallel lemmas to <code>replicate</code>, tagged with <code>@[simp]</code> in the same places.</p>
<blockquote>
<p>3) "simp can prove this". There are two of these. For <code>List.init_cons_of_ne_nil</code> it doesn't actually seem to be true: the claimed proof is the funny-looking <code>simp only [_private.Std.Data.List.Init.Lemmas.0.List.dropLast._eq_3]</code> so I'm wondering if this is a bug in the linter. For the other one, <code>List.indexOf_nil</code>, it is true that <code>simp</code> can prove it by the end of the file. I propose not tagging it with <code>simp</code>.</p>
</blockquote>
<p>It seems that a private lemma got marked as a global <code>@[simp]</code> lemma somehow?</p>



<a name="318713332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/318713332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#318713332">(Dec 31 2022 at 10:36)</a>:</h4>
<p>What about trying a partial solution and changing later if it doesn't work?</p>
<p>I tried to find the private lemma corresponding to <code>_private.Std.Data.List.Init.Lemmas.0.List.dropLast._eq_3</code> but I didn't find it :(</p>



<a name="319202874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319202874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319202874">(Jan 03 2023 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Does this mean that we should update <code>std</code> before continuing with fixing linting errors in <code>Data.List.Basic</code>?</p>



<a name="319283862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319283862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319283862">(Jan 03 2023 at 21:35)</a>:</h4>
<p>when a bug occurs upstream, it's best not to block the downstream on that bug unless there is no other choice. In this case you can just use <code>attribute [-simp]</code> and or <code>nolint</code> to move on in <code>Data.List.Basic</code> (in addition to sending a PR to std if I don't get to it in time)</p>



<a name="319284117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319284117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319284117">(Jan 03 2023 at 21:37)</a>:</h4>
<p>Johan, Mario is probably busy with <a href="#narrow/stream/287929-mathlib4/topic/Scoped.20attribute/near/319162000">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Scoped.20attribute/near/319162000</a> which is indeed blocking.</p>



<a name="319415911"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319415911" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319415911">(Jan 04 2023 at 15:44)</a>:</h4>
<p><code>attribute [-simp]</code> only seems to apply locally.</p>



<a name="319416120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319416120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319416120">(Jan 04 2023 at 15:45)</a>:</h4>
<p><code>attribute [-some_attribute]</code> means the same as Lean 3's <code>local attribute [-some_attribute]</code>, because we can't remove attribute globally anymore.</p>



<a name="319416147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319416147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319416147">(Jan 04 2023 at 15:45)</a>:</h4>
<p>Here is one "fun" case.<br>
Std has <code>@[simp] theorem reverse_map (f : α → β) (l : List α) : (l.map f).reverse = l.reverse.map f</code><br>
while Mathlib has <code>@[simp] theorem map_reverse (f : α → β) (l : List α) : map f (reverse l) = reverse (map f l)</code></p>



<a name="319416437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319416437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319416437">(Jan 04 2023 at 15:46)</a>:</h4>
<p>I don't want to start a discussion about which lemma is "better", except to say that in the context of porting mathlib, the better lemma is the one that proofs in the rest of mathlib expect to exist.</p>



<a name="319416500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319416500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319416500">(Jan 04 2023 at 15:47)</a>:</h4>
<p>But it seems that <code>attribute [-simp]</code> is not a possible tool to work around the new lemma in Std, and in fact it cannot be worked around at all.</p>



<a name="319419374"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319419374" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319419374">(Jan 04 2023 at 16:02)</a>:</h4>
<p>A bigger issue is the stuff related to <code>getLastD</code> because mathlib has no lemmas about that--I created <a href="https://github.com/leanprover/std4/pull/75">https://github.com/leanprover/std4/pull/75</a></p>



<a name="319420039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319420039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319420039">(Jan 04 2023 at 16:05)</a>:</h4>
<p>("Bigger" because in the case of <code>reverse_map</code>/<code>map_reverse</code>, one could reasonably let Std "win" and hope there are no consequences for the rest of mathlib)</p>



<a name="319420966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319420966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319420966">(Jan 04 2023 at 16:10)</a>:</h4>
<p>Otoh, a confluent simp set probably needs to be consistent wrt <code>map_&lt;foobar&gt;</code> / <code>&lt;foobar&gt;_map</code> for (almost) all values of <code>&lt;foobar&gt;</code> in mathlib.</p>



<a name="319421155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319421155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319421155">(Jan 04 2023 at 16:10)</a>:</h4>
<p>Yeah it's not at all clear that there would be no consequences.</p>



<a name="319422908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319422908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319422908">(Jan 04 2023 at 16:19)</a>:</h4>
<p>Std is supposed to be non-opinionated, right?  It seems to me that the non-opinionated choice when an attribute is debatable is for Std not to mark with that attribute, and then for a downstream library which wants the attribute to make an alias which does have the attribute.</p>



<a name="319424039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319424039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319424039">(Jan 04 2023 at 16:24)</a>:</h4>
<p>Of course, that only works for lemmas, not for definitions.</p>



<a name="319436176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319436176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319436176">(Jan 04 2023 at 17:30)</a>:</h4>
<p><a href="https://github.com/leanprover/std4/pull/76">https://github.com/leanprover/std4/pull/76</a> removes <code>@[simp]</code> from <code>reverse_map</code> in Std.</p>



<a name="319471368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319471368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319471368">(Jan 04 2023 at 20:54)</a>:</h4>
<p>I hope these ad-hoc developments in Std aren't going to throw many wrenches in the wheels of the porting process. Because it's quite annoying.</p>



<a name="319477729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319477729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319477729">(Jan 04 2023 at 21:38)</a>:</h4>
<p>It seems reasonable to switch from <code>reverse_map</code> to <code>map_reverse</code> here (it would be better if the other lemma was actually upstreamed though instead of just removing the simp attribute from <code>reverse_map</code>)</p>



<a name="319477943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319477943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319477943">(Jan 04 2023 at 21:40)</a>:</h4>
<p>I'm still unhappy about the <code>getLastD</code> issue, but I won't block the port on it. The obvious solution to not having enough lemmas about <code>getLastD</code> is to add more lemmas about <code>getLastD</code></p>



<a name="319484595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319484595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319484595">(Jan 04 2023 at 22:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20normal.20form/near/319416437">said</a>:</p>
<blockquote>
<p>I don't want to start a discussion about which lemma is "better", except to say that in the context of porting mathlib, the better lemma is the one that proofs in the rest of mathlib expect to exist.</p>
</blockquote>
<p>I fully agree with this statement.  Now is not the time to refactor, also not in std4.  If std4 bites off pieces of mathlib, then those pieces need to remain mathlib-compatible until the port is done.</p>



<a name="319484758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20normal%20form/near/319484758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20normal.20form.html#319484758">(Jan 04 2023 at 22:29)</a>:</h4>
<p>We can certainly do <code>xs.getLast h = xs.getLastD</code> <em>after</em> the port is done, but the std4 PR should come with a corresponding mathlib4 PR then.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>