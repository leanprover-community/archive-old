---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html">add `import Leanbin.Init.Default` in synported files</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="258306162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258306162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258306162">(Oct 20 2021 at 03:15)</a>:</h4>
<p>I think when running synport we need to add <code>import Leanbin.Init.Default</code> add the beginning of any files mathlib3 files that don't have other imports.</p>
<p>e.g. in <code>Data/Options/Defs.lean</code>, the synported file has errors on <code>HasMem</code>, <code>Option.eq_none_of_is_none</code>, and many others, which are resolved by adding this import.</p>



<a name="258306372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258306372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258306372">(Oct 20 2021 at 03:18)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>, <span class="user-mention" data-user-id="230999">@Daniel Selsam</span>, I'm happy to take your advice on the best balance between me attempting things like this vs one of you. Obviously I will be inefficient at first and need some hand-holding, but I'm also happy to invest in hacking on binport/synport. (Daniel has already given me a quick walkthrough.)</p>



<a name="258311029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258311029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258311029">(Oct 20 2021 at 04:34)</a>:</h4>
<p>That was actually deliberate. The idea was to have the files look as similar to the original as possible, so ensuring the appropriate imports should be handled by the user in the case where there are no imports.</p>



<a name="258311188"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258311188" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258311188">(Oct 20 2021 at 04:37)</a>:</h4>
<p>That is, in a case like <code>Data.Options.Defs</code> we probably want to continue having no imports and instead rethink what goes in the file</p>



<a name="258311212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258311212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258311212">(Oct 20 2021 at 04:38)</a>:</h4>
<p>or import <code>Mathlib.Init</code> or something</p>



<a name="258312077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258312077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258312077">(Oct 20 2021 at 04:51)</a>:</h4>
<p>Returning to this thread, I'm unclear how to move forward, however. Taking the synported <code>Data/Options/Defs.lean</code>, for example, what are we going to do about the missing <code>HasMem</code>, if not add <code>import Leanbin.Init.Default</code>?</p>



<a name="258312161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258312161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258312161">(Oct 20 2021 at 04:52)</a>:</h4>
<p>I think we want to import a file in mathlib4 that defines <code>HasMem</code>, or else move the code that relates option and <code>HasMem</code> to another file</p>



<a name="258312214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258312214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258312214">(Oct 20 2021 at 04:53)</a>:</h4>
<p>Okay. Have you guys already decided the best way to add such imports? That is, suppose <code>HasMem</code> is in some file in mathlib4. What will be the actual mechanism to add an <code>import</code> line to the synported <code>Data/Options/Defs.lean</code>?</p>



<a name="258313152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313152">(Oct 20 2021 at 05:06)</a>:</h4>
<p>That is, will there be some instruction (where?) that tells synport what to add? Or will there be a "postproduction" step where we patch synported files with human-written changes?</p>



<a name="258313182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313182">(Oct 20 2021 at 05:07)</a>:</h4>
<p>There will be a post production step, that's the human porting part</p>



<a name="258313206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313206">(Oct 20 2021 at 05:08)</a>:</h4>
<p>The machine ported version exists already, that's the generated binport file</p>



<a name="258313381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313381">(Oct 20 2021 at 05:10)</a>:</h4>
<p>Okay, but the "human porting part" is going to have to exist for a long time concurrently with re-running synport, while we fix all the problems in synport. So will we e.g. generate a bunch of patches to apply after synport has run, so the pipeline becomes "run synport" then "apply all patches"?</p>



<a name="258313415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313415">(Oct 20 2021 at 05:11)</a>:</h4>
<p>e.g. if I wanted to add an import to <code>Data/Options/Defs/lean</code>pointing to some mathlib4 file, how would I do that "persistently", i.e. so after synport gets updated in some way that import is still in place?</p>



<a name="258313433"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313433" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313433">(Oct 20 2021 at 05:11)</a>:</h4>
<p>Any patching mechanism that is fully automatic and uniform can be done by synport itself. Anything that comes afterwards is presumably something that needs 1-1 interaction</p>



<a name="258313486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313486">(Oct 20 2021 at 05:12)</a>:</h4>
<p>Great.</p>



<a name="258313540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313540">(Oct 20 2021 at 05:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files/near/258313415">said</a>:</p>
<blockquote>
<p>e.g. if I wanted to add an import to <code>Data/Options/Defs/lean</code>pointing to some mathlib4 file, how would I do that "persistently", i.e. so after synport gets updated in some way that import is still in place?</p>
</blockquote>
<p>Once you have synported <code>Data.Options.Defs</code> and fixed it, the plan is not to synport it ever again; instead future synported files will depend on your new <code>Data.Options.Defs</code>, possibly including <code>#align</code> directives to help it stay relatively close to the binported version</p>



<a name="258313542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313542">(Oct 20 2021 at 05:13)</a>:</h4>
<p>So while my original question was mistaken, because we don't want to be adding <code>import Leanbin.Init.Default</code> to <code>Data/Options/Defs.lean</code>, how to we go about asking synport to <code>import XXX</code>? (I'm guess the answer here is "there isn't yet a way to ask synport to do this"?)</p>



<a name="258313621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313621">(Oct 20 2021 at 05:14)</a>:</h4>
<p>Synport always assumes you want to import whatever you did in lean 3</p>



<a name="258313657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313657">(Oct 20 2021 at 05:15)</a>:</h4>
<p>I don't think we are planning to change the import graph during the port, so that sounds right to me</p>



<a name="258313756"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313756" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313756">(Oct 20 2021 at 05:16)</a>:</h4>
<p>The issue in the case of <code>data.options.defs</code> is that there was a change to <code>init</code> itself, i.e. what is available from a blank starting point</p>



<a name="258313766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313766">(Oct 20 2021 at 05:16)</a>:</h4>
<p>I think we want to handle these things on a case by case basis</p>



<a name="258313769"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313769" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313769">(Oct 20 2021 at 05:16)</a>:</h4>
<p>This doesn't seem right. Are you saying that there is no way to address the fact that <code>Data/Options/Defs.lean</code> doesn't contain an import that defines <code>HasMem</code>, until we declare that particular file will never be synported again?</p>



<a name="258313851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313851">(Oct 20 2021 at 05:18)</a>:</h4>
<p>i.e. if synport is not going to introduce such an import statment, that implies that a human is going to do it. But then from what you said above, as soon as a human touches the file we will never run synport again on that file.</p>



<a name="258313861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313861">(Oct 20 2021 at 05:18)</a>:</h4>
<p>We're making the assumption that <code>Init</code> is basically the same as lean 3 <code>init</code>, because making that strictly true would cause a lot of mess in the files that would just have to be deleted by the user</p>



<a name="258313920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313920">(Oct 20 2021 at 05:19)</a>:</h4>
<p>Yes that's right. Once <code>Data.Option.Defs</code> works out however it will fix this, downstream files will just work</p>



<a name="258313982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258313982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258313982">(Oct 20 2021 at 05:20)</a>:</h4>
<p>Hmm.</p>



<a name="258314040"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314040" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314040">(Oct 20 2021 at 05:21)</a>:</h4>
<p>One way to generically address this would be to always import <code>Mathlib.Init</code> in zero import files, and then put any missing stuff from lean 3 core in that file</p>



<a name="258314102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314102">(Oct 20 2021 at 05:22)</a>:</h4>
<p>We kind of use <code>logic.basic</code> as a pseudo-<code>Mathlib.Init</code> in lean 3 but maybe it's better to be explicit about this</p>



<a name="258314161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314161">(Oct 20 2021 at 05:23)</a>:</h4>
<p>Okay, consider the following scenario. Pretend that <code>Data/Options/Defs.lean</code> only had two problems:</p>
<ol>
<li>there's a missing import which will provide <code>HasMem</code>, because of changes in <code>Init</code></li>
<li>whitespace formatting is horrible.</li>
</ol>
<p>Now, I know 2. is going to get magically better at some point in the future, when e.g. Sebastian feels like working on the Lean4 pretty printer. So if I don't want to fix whitespace by hand (because later it would be fixed automatically), then I can't add an import, because that would "freeze" this file (i.e. mark it as not-to-be-regenerated by synport).</p>



<a name="258314163"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314163" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314163">(Oct 20 2021 at 05:23)</a>:</h4>
<p>Or we can just make sure that <code>data.option.defs</code> imports <code>mathlib.init</code> in lean 3 mathlib</p>



<a name="258314230"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314230" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314230">(Oct 20 2021 at 05:24)</a>:</h4>
<p>My heart was definitely breaking about (2) when I was working on it</p>



<a name="258314245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314245">(Oct 20 2021 at 05:24)</a>:</h4>
<p>but the formatter is in core</p>



<a name="258314347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314347">(Oct 20 2021 at 05:26)</a>:</h4>
<p>I think it is possible to get a re-formatter without synport intervention</p>



<a name="258314356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314356">(Oct 20 2021 at 05:26)</a>:</h4>
<p>that is, read a lean 4 file and spit it back out again</p>



<a name="258314361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314361">(Oct 20 2021 at 05:26)</a>:</h4>
<p>okay, but that is escaping the point of my question :-)</p>



<a name="258314392"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314392" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314392">(Oct 20 2021 at 05:27)</a>:</h4>
<p>that would solve your problem, because when the future time comes around that the formatter is magically better, we can just reformat already synported files</p>



<a name="258314486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314486">(Oct 20 2021 at 05:28)</a>:</h4>
<p>Okay. But I think I understand that your intention is definitely to have no human editing of a file until after the last time synport has ever run on that file. That's fine and good --- indeed simpler than what I was fearing, although possibly less flexible.</p>



<a name="258314523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314523">(Oct 20 2021 at 05:29)</a>:</h4>
<p>So the workflow looks like:</p>
<ol>
<li>Run synport</li>
<li>Add the missing import</li>
<li>Move on</li>
<li>Sebastian fixes the formatter</li>
<li>Reformat the file</li>
</ol>



<a name="258314594"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314594" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314594">(Oct 20 2021 at 05:30)</a>:</h4>
<p>So I guess the next "pipeline" question is how we will actually declare that a particular file is no longer "owned by synport". Just move it to the mathlib4 repo?</p>



<a name="258314661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314661">(Oct 20 2021 at 05:31)</a>:</h4>
<p>I envision a workflow where a person who wants to port file X runs synport on X (using already ported dependency files), fixes it up and pushes it to mathlib4</p>



<a name="258314672"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314672" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314672">(Oct 20 2021 at 05:31)</a>:</h4>
<p>so we would just not pick values of X that are already ported</p>



<a name="258314747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314747">(Oct 20 2021 at 05:32)</a>:</h4>
<p>although it's also possible to pick some X that is already ported, and then diff it with the stored version and cherry pick changes</p>



<a name="258314779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314779">(Oct 20 2021 at 05:33)</a>:</h4>
<p>like I intend to do basically that for all the files in mathlib4 that have been human ported like <code>Data.Nat.Basic</code></p>



<a name="258314815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314815">(Oct 20 2021 at 05:34)</a>:</h4>
<p>Great!</p>



<a name="258314895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258314895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258314895">(Oct 20 2021 at 05:35)</a>:</h4>
<p>for diffing it will be much better if the formatter is good though</p>



<a name="258315030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315030">(Oct 20 2021 at 05:37)</a>:</h4>
<p>Okay, so returning to the initial question of this thread, I think we decided that I was wrong to suggest adding <code>import Leanbin.Init.Default</code> to synported files with no imports, but instead we should add <code>import Mathlib.Init</code>.</p>



<a name="258315036"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315036" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315036">(Oct 20 2021 at 05:37)</a>:</h4>
<p>Do we achieve this by modifying synport?</p>



<a name="258315097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315097">(Oct 20 2021 at 05:38)</a>:</h4>
<p>Or do we go back to mathlib3, and create an empty <code>init</code> file, and add it as an import to all the no import files, so that synport will reproduce this?</p>



<a name="258315155"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315155" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315155">(Oct 20 2021 at 05:39)</a>:</h4>
<p>A combination of both sounds good</p>



<a name="258315173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315173">(Oct 20 2021 at 05:39)</a>:</h4>
<p>like, mathlib should probably have an init file</p>



<a name="258315182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315182">(Oct 20 2021 at 05:39)</a>:</h4>
<p>and it's not empty</p>



<a name="258315186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315186">(Oct 20 2021 at 05:39)</a>:</h4>
<p>But then what would need to change in synport?</p>



<a name="258315238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315238">(Oct 20 2021 at 05:40)</a>:</h4>
<p>but also synport can have a default import if we want to do that generically</p>



<a name="258315254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315254">(Oct 20 2021 at 05:40)</a>:</h4>
<p>although it gets weird if you are porting a prelude file</p>



<a name="258315839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315839">(Oct 20 2021 at 05:49)</a>:</h4>
<p>Here's how to modify mathport to add <code>Mathlib.Init</code> on zero include files:</p>
<div class="codehilite" data-code-language="Diff"><pre><span></span><code><span class="gh">diff --git a/Mathport/Syntax/Translate/Basic.lean b/Mathport/Syntax/Translate/Basic.lean</span>
<span class="gh">index 69a1dd2..1006c89 100644</span>
<span class="gd">--- a/Mathport/Syntax/Translate/Basic.lean</span>
<span class="gi">+++ b/Mathport/Syntax/Translate/Basic.lean</span>
<span class="gu">@@ -152,9 +152,10 @@ def AST3toData4 : AST3 → M Data4</span>
   | ⟨prel, imp, commands, _, _⟩ =&gt; do
     let prel := prel.map fun _ =&gt; mkNode ``Parser.Module.prelude #[mkAtom "prelude"]
     let imp ← imp.foldlM (init := #[]) fun imp ns =&gt;
<span class="gd">-      ns.foldlM (init := imp) fun imp n =&gt; do</span>
<span class="gd">-        imp.push $ mkNode ``Parser.Module.import #[mkAtom "import",</span>
<span class="gd">-          mkNullNode, mkIdent (← renameModule n.kind)]</span>
<span class="gi">+      ns.foldlM (init := imp) fun imp n =&gt; imp.push &lt;$&gt; renameModule n.kind</span>
<span class="gi">+    let imp := if prel.isNone &amp;&amp; imp.isEmpty then #[`Mathlib.Init] else imp</span>
<span class="gi">+    let imp := imp.map fun imp =&gt;</span>
<span class="gi">+      mkNode ``Parser.Module.import #[mkAtom "import", mkNullNode, mkIdent imp]</span>
     let fmt ← liftCoreM $ PrettyPrinter.format Parser.Module.header.formatter $
       mkNode ``Parser.Module.header #[mkOptionalNode prel, mkNullNode imp]
     modify fun s =&gt; { s with output := fmt }
</code></pre></div>



<a name="258315996"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258315996" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258315996">(Oct 20 2021 at 05:51)</a>:</h4>
<p>I can test locally and PR sometime.</p>



<a name="258316057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258316057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258316057">(Oct 20 2021 at 05:52)</a>:</h4>
<p>(I'm holding off on PR'ing now because <code>Mathlib.Init</code> should probably exist first)</p>



<a name="258316340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258316340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258316340">(Oct 20 2021 at 05:56)</a>:</h4>
<p>Now (slightly redundantly with this), you think it's reasonable for me to add an <code>init</code> to mathlib3, even if it is empty at first? (And make otherwise zero-import files import it?)</p>



<a name="258316477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258316477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258316477">(Oct 20 2021 at 05:59)</a>:</h4>
<p>It is basically a backport issue: should we take has_mem out of core? What are the other missing things in lean 4 core? I think a lot of zero import files can still be zero import, and those that can't can <code>import init</code></p>



<a name="258316494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258316494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258316494">(Oct 20 2021 at 05:59)</a>:</h4>
<p>although the actual name <code>init</code> is a no-go because it would collide with the one in lean 3 core</p>



<a name="258321692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258321692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258321692">(Oct 20 2021 at 07:06)</a>:</h4>
<p>Moving <code>has_mem</code> out of lean3 core looks to be a lot of work. The API for <code>rbtree</code> for example uses it extensively. I've personally never worried too much about the "what about non-mathlib users of lean3" argument, but it does seem somewhat unkind to them (or at least, I would anticipate this objection!).</p>



<a name="258321898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258321898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258321898">(Oct 20 2021 at 07:07)</a>:</h4>
<p>But is seems like there is no big obstacle to add <code>import our_init</code> as a placeholder to mathlib3 files that need something that goes missing between Lean3 and Lean4, even if the mathlib3 version of <code>our_init</code> is largely empty, and it just becomes a handwritten file in mathlib4 containing <code>HasMem</code> and all the other things we discover.</p>



<a name="258322006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258322006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258322006">(Oct 20 2021 at 07:08)</a>:</h4>
<p>There could be a comment explaining that this is to assist the mathport effort, without polluting mathlib3 itself too badly.</p>



<a name="258324086"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258324086" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258324086">(Oct 20 2021 at 07:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files/near/258321692">said</a>:</p>
<blockquote>
<p>Moving <code>has_mem</code> out of lean3 core looks to be a lot of work. The API for <code>rbtree</code> for example uses it extensively. I've personally never worried too much about the "what about non-mathlib users of lean3" argument, but it does seem somewhat unkind to them (or at least, I would anticipate this objection!).</p>
</blockquote>
<p>Another blocker for removing has_mem is the set-builder notation.</p>
<p>For the issue at hand, I would assume the easiest way is to just hardcode a list of extra imports in mathport?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">extraImports</span> <span class="o">:</span> <span class="n">HashMap</span> <span class="n">Name</span> <span class="o">(</span><span class="n">Array</span> <span class="n">Name</span><span class="o">)</span> <span class="o">:=</span> <span class="bp">....</span>
</code></pre></div>



<a name="258324284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258324284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258324284">(Oct 20 2021 at 07:30)</a>:</h4>
<p>If the list is per-file, then it's not much different from fixing the import list once when you are in the post-synport fixup stage</p>



<a name="258324454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258324454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258324454">(Oct 20 2021 at 07:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files/near/258322006">said</a>:</p>
<blockquote>
<p>There could be a comment explaining that this is to assist the mathport effort, without polluting mathlib3 itself too badly.</p>
</blockquote>
<p>The reason I am resistant to adding <code>Mathport.Init</code> on every synport file is because I am trying to avoid "pollution" of any kind. That is, it should not add anything that is always unwanted in the t -&gt; infty version of mathlib 4</p>



<a name="258324466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258324466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258324466">(Oct 20 2021 at 07:32)</a>:</h4>
<p>Yes, but I feel like in the early stages, working on a synported file is actually going to consist of many iterations of "lets improve synport in the following way". During these iterations, it's nice if the imports can be usable, and for this, we either need a catchall as in your patchfile above, or Gabriel's suggestion.</p>



<a name="258324531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258324531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258324531">(Oct 20 2021 at 07:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files/near/258324454">said</a>:</p>
<blockquote>
<p>The reason I am resistant to adding <code>Mathport.Init</code> on every synport file is because I am trying to avoid "pollution" of any kind. That is, it should not add anything that is always unwanted in the t -&gt; infty version of mathlib 4</p>
</blockquote>
<p><code>extraImports</code> satisfies this (admirable! :-) constraint, doesn't it?</p>



<a name="258324577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258324577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258324577">(Oct 20 2021 at 07:33)</a>:</h4>
<p>It's a basic version of synport overrides, which is going to be hard to spec</p>



<a name="258324723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258324723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258324723">(Oct 20 2021 at 07:34)</a>:</h4>
<p>an alternative way to interact with synport is to just specify more and more precise overrides on the output until it is generating exactly the file you want. I am guessing that this will be a lot more difficult to do than just manipulating a lean 4 file</p>



<a name="258324817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258324817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258324817">(Oct 20 2021 at 07:35)</a>:</h4>
<p>but it has the advantage that a single change can be applied in many places, and you can rerun the tool as many times as you want</p>



<a name="258325124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325124">(Oct 20 2021 at 07:38)</a>:</h4>
<p>I think that synport overrides make a lot of sense for upstream objects that want to affect downstream output; that's the idea behind <code>#align</code>. But for the downstream file itself, you are already working on that file and can presumably fix it on the spot</p>



<a name="258325337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325337">(Oct 20 2021 at 07:40)</a>:</h4>
<p>My example involving formatting was not so good above (because as you said formatting can be improved later).</p>
<p>A better example of a pair of problems is:</p>
<ol>
<li>we want to insert whatever the appropriate <code>import</code> statements are to every file that is currently missing <code>HasMem</code></li>
<li>there are still many capitalisation problems</li>
</ol>
<p>If we decided for example that inserting these <code>import</code> will only be done in the "by hand" phase, then in some sense no one can start working on these until the capitalisation problems are solved. That's not a deal-breaker, but it makes tasks sequential.</p>



<a name="258325343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325343">(Oct 20 2021 at 07:40)</a>:</h4>
<p>You can also imagine working at less-than-file granularity. You can do this fairly well by just taking segments of the synport file between different versions</p>



<a name="258325409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325409">(Oct 20 2021 at 07:41)</a>:</h4>
<p>(I mean, they can start working on solving such missing imports, but only "offline" in some sense. i.e. preparing some list of future patches to be made. But tracking these would be a nightmare compared to something like <code>extraImports</code> or the global <code>import over_init</code> patch.)</p>



<a name="258325435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325435">(Oct 20 2021 at 07:41)</a>:</h4>
<p>Adding the imports is a fairly trivial thing to do though</p>



<a name="258325509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325509">(Oct 20 2021 at 07:42)</a>:</h4>
<p>and as mentioned, it can also be backported</p>



<a name="258325540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325540">(Oct 20 2021 at 07:42)</a>:</h4>
<p>if you add a dummy import in mathlib3 then you get it for free</p>



<a name="258325541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325541">(Oct 20 2021 at 07:42)</a>:</h4>
<p>Which is trivial? Adding them in <code>synport</code>? Or adding them by hand afterwards?</p>



<a name="258325550"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325550" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325550">(Oct 20 2021 at 07:42)</a>:</h4>
<p>adding them by hand afterwards</p>



<a name="258325647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325647">(Oct 20 2021 at 07:43)</a>:</h4>
<p>I'm not opposed to per-file customization of synport but it doesn't seem necessary here. It might help some folks' workflows but doesn't look like it needs to be checked in</p>



<a name="258325735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325735">(Oct 20 2021 at 07:44)</a>:</h4>
<p>Hmm, another lowtech option might just be to have a shell script with lots of <code>sed</code> calls for post-processing.</p>



<a name="258325810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325810">(Oct 20 2021 at 07:45)</a>:</h4>
<p>That may be necessary for some formatting related things, but I think we can make synport do anything in that category</p>



<a name="258325814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325814">(Oct 20 2021 at 07:45)</a>:</h4>
<p>The <code>sed</code> option, or a directory full of patchfiles, or whatever is what I'd imagined you guys had in mind already, so I've been surprised today to discover its quite the opposite. :-)</p>



<a name="258325840"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325840" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325840">(Oct 20 2021 at 07:45)</a>:</h4>
<p>I kind of agree with Scott that we still want to iterate before moving files to mathlib4.  Once we start doing that, we've effectively passed flag date.  Further development on mathport is essentially pointless (because it only applies to future files), and mathlib changes on already ported files become forbidden.</p>



<a name="258325949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325949">(Oct 20 2021 at 07:46)</a>:</h4>
<p>I'm not sure what the best interface for stored customization of synport is</p>



<a name="258325986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258325986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258325986">(Oct 20 2021 at 07:47)</a>:</h4>
<p>maybe we can read a lean 4 file representing the previous iteration and use info from it somehow</p>



<a name="258326222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258326222" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258326222">(Oct 20 2021 at 07:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files/near/258325840">said</a>:</p>
<blockquote>
<p>Further development on mathport is essentially pointless (because it only applies to future files), and mathlib changes on already ported files become forbidden.</p>
</blockquote>
<p>I'm not sure I would say it is pointless. It only applies to the 98% of mathlib that hasn't yet been ported</p>



<a name="258326366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258326366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258326366">(Oct 20 2021 at 07:50)</a>:</h4>
<p>My guess is that most of the iteration will happen early, once we have started actually attempting to use it on full files but before we have really scaled up</p>



<a name="258326442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258326442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258326442">(Oct 20 2021 at 07:51)</a>:</h4>
<p>e.g. with my imports + capitalisation example, I would probably want to pick some particular concrete file to iterate improvements to the capitalisation scheme. But while doing that, I really don't want the mental burden of adding the import (or whatever the orthogonal problem is) during every iteration of working on capitalisation.</p>



<a name="258326547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258326547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258326547">(Oct 20 2021 at 07:52)</a>:</h4>
<p>(Perhaps the problem here is that I am too much of a voodoo programmer, and need more iterations on a given input than most people before stuff works. :-)</p>



<a name="258326766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258326766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258326766">(Oct 20 2021 at 07:55)</a>:</h4>
<p>it sounds better if you call it "test driven development" :)</p>



<a name="258328620"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258328620" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258328620">(Oct 20 2021 at 08:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files/near/258324817">said</a>:</p>
<blockquote>
<p>but it has the advantage that a single change can be applied in many places, and you can rerun the tool as many times as you want</p>
</blockquote>
<p>It would also have the advantage of potentially allowing synport to get to the point where it can intelligently port virtually any Lean 3 file thus making the transition more painless for users.</p>



<a name="258332984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258332984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258332984">(Oct 20 2021 at 08:49)</a>:</h4>
<p>We're talking about file-specific changes here, though, not general fixes. General fixes, i.e. changes which would be useful in any similar code, should just be done by modifying synport itself so that everyone gets the benefit</p>



<a name="258333518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258333518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258333518">(Oct 20 2021 at 08:53)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> but that then goes back to <span class="user-mention" data-user-id="110087">@Scott Morrison</span>'s original point. If <code>synport</code> keeps getting improved in that manner,' freezing' a file introduces a large commitment as it will no longer be easy to automatically apply the new improvements to the frozen file.</p>



<a name="258333634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258333634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258333634">(Oct 20 2021 at 08:54)</a>:</h4>
<p>I think that it will be very difficult to get a good synport-input that can produce a "live updating" lean 4 file</p>



<a name="258333687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258333687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258333687">(Oct 20 2021 at 08:55)</a>:</h4>
<p>like, another few person-months</p>



<a name="258334500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258334500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258334500">(Oct 20 2021 at 09:01)</a>:</h4>
<p>and presumably, once a file has been ported, any fixes to synport would at best fix something that had to be done by hand on the earlier file. The lost time spent doing that can't be recovered, and the ported file no longer benefits from the synport fix because it's already working</p>



<a name="258336232"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258336232" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258336232">(Oct 20 2021 at 09:15)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> this assumes frozen files will be quickly moved from 'ported' to 'fixed' with no long stretches of WIP. Is that the plan?</p>



<a name="258336379"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258336379" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258336379">(Oct 20 2021 at 09:17)</a>:</h4>
<p>Like I mentioned, you can also work at sub-file granularity by just translating half the file and leaving the other half in the original state; you can then re-run synport and replace the bottom half of the file without any loss of fixup work</p>



<a name="258336490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258336490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258336490">(Oct 20 2021 at 09:18)</a>:</h4>
<p>From my vague understand of this whole affair. It sounded like the goal was to get files minimally working (with sorrys strewn here and there) and slowly improve synport to remove those as time passes. In such cases, there can be reasonable cases where there may be small necessary edits made to the synported file to get downstream stuff simi-functional while still have many gaps that one would like synport to fill later on.</p>



<a name="258336494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258336494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258336494">(Oct 20 2021 at 09:18)</a>:</h4>
<p>but yes, the fixes should not be significantly more complicated than fixing capitalization or broken theorem references and formatting (and I hope synport to get better at both things)</p>



<a name="258336527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258336527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258336527">(Oct 20 2021 at 09:18)</a>:</h4>
<p>Synport produces broken files, not files with <code>sorry</code></p>



<a name="258336575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258336575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258336575">(Oct 20 2021 at 09:18)</a>:</h4>
<p>because you would just have to delete the sorry, put the broken proof in and fix it anyway</p>



<a name="258336668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258336668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258336668">(Oct 20 2021 at 09:19)</a>:</h4>
<p>I think binport prefers to use sorry since it has to keep on trucking even in the presence of mismatches</p>



<a name="258336670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/add%20%60import%20Leanbin.Init.Default%60%20in%20synported%20files/near/258336670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/add.20.60import.20Leanbin.2EInit.2EDefault.60.20in.20synported.20files.html#258336670">(Oct 20 2021 at 09:20)</a>:</h4>
<p>ah, then I guess my mental model was just wrong</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>