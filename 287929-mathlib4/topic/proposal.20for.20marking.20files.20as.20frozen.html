---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html">proposal for marking files as frozen</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="304628648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304628648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304628648">(Oct 18 2022 at 08:03)</a>:</h4>
<p>First, some background. There's been some private discussion on the maintainers list preceding this, but there hasn't yet been a proper public discussion.</p>
<p>We are hoping to soon get started porting files from mathlib3 to mathlib4. This is going to be a gradual process, assisted by the tool <code>mathport</code>.</p>
<p>There is a wiki page with some advice on porting, at <a href="https://github.com/leanprover-community/mathlib4/wiki">https://github.com/leanprover-community/mathlib4/wiki</a>.</p>
<p>There is a page tracking which files have been ported, at <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status</a></p>
<p>There is a tool under <code>scripts/port_status.py</code>, which will land in <a href="https://github.com/leanprover-community/mathlib/pull/17009">#17009</a>, which will provide a list of files which are ready for porting now.</p>



<a name="304628705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304628705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304628705">(Oct 18 2022 at 08:03)</a>:</h4>
<p>Now, once files have been successfully ported, PR'd to mathlib4, and merged, we would like the freeze the file back in mathlib3.</p>



<a name="304628797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304628797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304628797">(Oct 18 2022 at 08:04)</a>:</h4>
<p>This does not mean it is completely impossible to change --- but you'll need to make the corresponding PR to mathlib4, so it will be more cumbersome.</p>



<a name="304628920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304628920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304628920">(Oct 18 2022 at 08:05)</a>:</h4>
<p>We need a way to mark files as frozen. The list at <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status</a> in principle keeps track of this, but it's been suggested there should be a prominent indicator in the files themselves.</p>



<a name="304628949"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304628949" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304628949">(Oct 18 2022 at 08:05)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/17039">#17039</a> is my proposal for how to do this.</p>



<a name="304629007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304629007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304629007">(Oct 18 2022 at 08:05)</a>:</h4>
<p>It adds a block</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">&gt;</span> <span class="n">THIS</span> <span class="n">FILE</span> <span class="n">IS</span> <span class="n">FROZEN</span><span class="o">,</span> <span class="n">AS</span> <span class="n">IT</span> <span class="n">HAS</span> <span class="n">BEEN</span> <span class="n">PORTED</span> <span class="n">TO</span> <span class="n">MATHLIB4</span>
<span class="bp">&gt;</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">community</span><span class="bp">/</span><span class="n">mathlib4</span><span class="bp">/</span><span class="n">pull</span><span class="bp">/</span><span class="mi">467</span>
<span class="bp">&gt;</span> <span class="n">No</span> <span class="n">changes</span> <span class="n">accepted</span> <span class="n">without</span> <span class="n">a</span> <span class="n">corresponding</span> <span class="n">PR</span> <span class="n">to</span> <span class="n">mathlib4.</span>
</code></pre></div>
<p>at the very top of each frozen file.</p>



<a name="304629239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304629239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304629239">(Oct 18 2022 at 08:07)</a>:</h4>
<p>If we go ahead with this, or something similar, we will also want two additional CI tools:</p>
<ol>
<li>something that labels PRs which touch frozen files with a special label, so reviewers can assure that a mathlib4 PR also exists.</li>
<li>something that notifies us when <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status</a> is out of sync with the labels inside actual files.</li>
</ol>



<a name="304646277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304646277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304646277">(Oct 18 2022 at 10:02)</a>:</h4>
<p>Video was super-helpful. Thanks a lot <span class="user-mention" data-user-id="110087">@Scott Morrison</span> ! </p>
<p>In some sense the most terrifying part right now was the "let's figure out which file to port -- oh look there's a gigantic maze with not enough information". Can someone give some kind of a feeling as to which areas of mathlib are currently "ready for porting"? I am keen to get up to speed with this process ASAP because I think it's an excellent way to simultaneously learn about Lean 4 and mathlib4. I would humbly suggest that enabling non-power-users like me to be able to figure out which files need porting in a less painful way would be very helpful, but until that day comes I'm looking for general guidance about where I should start looking. For example is category theory something that we can start on now or are we in no position to do it? What about group theory (group homs, subgroups etc)?</p>
<p>I should say that I have been waiting for this day for years. Initially I had naively assumed that the entire porting process was going to look like (a much more horrible version of) this (without the computer helping us first) and was rather looking forward to it. October is my horrible month; I am submerged in teaching every year, but it's the 18th so the light is at the end of the tunnel.</p>



<a name="304646618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304646618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304646618">(Oct 18 2022 at 10:04)</a>:</h4>
<p>PS what was going on with (a) the missing import (<code>nonempty_prop</code>) and (b) the missing function (<code>extend_apply'</code>) in the video?</p>



<a name="304646751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304646751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304646751">(Oct 18 2022 at 10:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>, as soon as bors is finished with <a href="https://github.com/leanprover-community/mathlib/pull/17009">#17009</a>, you can type at the command line</p>
<blockquote>
<p>scripts/port_status.py</p>
</blockquote>



<a name="304646916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304646916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304646916">(Oct 18 2022 at 10:06)</a>:</h4>
<p>This will show you output something like:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code># The following files have all dependencies ported already, and should be ready to port:
# Earlier items in the list are required in more places in mathlib.
logic.basic
data.option.defs
data.sigma.basic
algebra.group.to_additive
algebra.abs
data.bool.basic
control.functor
lean_core.data.vector
data.char
logic.lemmas
category_theory.concrete_category.bundled
algebra.order.floor
category_theory.elementwise
data.bracket
data.stream.defs
data.rbtree.init
data.num.basic
data.lazy_list
data.fin.fin2
data.nat.bits
data.rbtree.default_lt
lean_core.data.dlist
control.ulift
lean_core.data.buffer
lean_core.data.buffer.parser
algebra.group_power.identities
data.json
control.basic
algebra.hierarchy_design

# The following files have their immediate dependencies ported already, and may be ready to port:
data.nat.cast.defs
group_theory.eckmann_hilton
</code></pre></div>



<a name="304647029"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304647029" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304647029">(Oct 18 2022 at 10:07)</a>:</h4>
<p>We may want to have a thread where at regular intervals someone can post an annotated copy of this list.</p>



<a name="304647205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304647205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304647205">(Oct 18 2022 at 10:09)</a>:</h4>
<p>I would <em>love</em> to have the output of <code>port_status.py</code> merged with the graph drawing super powers of <code>leanproject import-graph</code>, so we can have pretty progress charts to motivate us. :-)</p>



<a name="304647225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304647225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304647225">(Oct 18 2022 at 10:09)</a>:</h4>
<p>I remember once a long time ago porting a bunch of logic.basic just for fun. Is there a way of "claiming" a file so that others know it's being worked on?</p>



<a name="304647394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304647394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304647394">(Oct 18 2022 at 10:10)</a>:</h4>
<p>I don't care about the graphs, I think the text list is fine. The graphs are I'm sure helpful if your goal is "port file X" but my goal is "learn Lean 4 and port all the files"</p>



<a name="304647735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304647735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304647735">(Oct 18 2022 at 10:13)</a>:</h4>
<p>I think the process to claim a file is to create a "porting coordination" thread in this stream, post a copy of that list, and say that you're working on it. :-)</p>



<a name="304648623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304648623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304648623">(Oct 18 2022 at 10:19)</a>:</h4>
<p>That list is sorted, and the number of uses of each file drops off pretty precipitously as you go down the list. I wasn't sure whether it would be more or less helpful to show this number after each file, e.g.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">logic.basic</span> <span class="o">(</span><span class="mi">2563</span><span class="o">)</span>
<span class="n">data.option.defs</span> <span class="o">(</span><span class="mi">2557</span><span class="o">)</span>
<span class="n">data.sigma.basic</span> <span class="o">(</span><span class="mi">2515</span><span class="o">)</span>
<span class="n">algebra.group.to_additive</span> <span class="o">(</span><span class="mi">2433</span><span class="o">)</span>
<span class="n">algebra.abs</span> <span class="o">(</span><span class="mi">2352</span><span class="o">)</span>
<span class="n">data.bool.basic</span> <span class="o">(</span><span class="mi">2229</span><span class="o">)</span>
<span class="n">control.functor</span> <span class="o">(</span><span class="mi">2048</span><span class="o">)</span>
<span class="n">lean_core.data.vector</span> <span class="o">(</span><span class="mi">2030</span><span class="o">)</span>
<span class="n">data.char</span> <span class="o">(</span><span class="mi">1768</span><span class="o">)</span>
<span class="n">logic.lemmas</span> <span class="o">(</span><span class="mi">883</span><span class="o">)</span>
<span class="n">category_theory.concrete_category.bundled</span> <span class="o">(</span><span class="mi">813</span><span class="o">)</span>
<span class="n">algebra.order.floor</span> <span class="o">(</span><span class="mi">742</span><span class="o">)</span>
<span class="n">category_theory.elementwise</span> <span class="o">(</span><span class="mi">564</span><span class="o">)</span>
<span class="n">data.bracket</span> <span class="o">(</span><span class="mi">147</span><span class="o">)</span>
<span class="n">data.stream.defs</span> <span class="o">(</span><span class="mi">26</span><span class="o">)</span>
<span class="n">data.rbtree.init</span> <span class="o">(</span><span class="mi">23</span><span class="o">)</span>
<span class="n">data.num.basic</span> <span class="o">(</span><span class="mi">21</span><span class="o">)</span>
<span class="n">data.lazy_list</span> <span class="o">(</span><span class="mi">20</span><span class="o">)</span>
<span class="n">data.fin.fin2</span> <span class="o">(</span><span class="mi">16</span><span class="o">)</span>
<span class="n">data.nat.bits</span> <span class="o">(</span><span class="mi">15</span><span class="o">)</span>
<span class="n">data.rbtree.default_lt</span> <span class="o">(</span><span class="mi">11</span><span class="o">)</span>
<span class="n">lean_core.data.dlist</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span>
<span class="n">control.ulift</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="n">lean_core.data.buffer</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="n">lean_core.data.buffer.parser</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span>
<span class="n">algebra.group_power.identities</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="n">data.json</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="n">control.basic</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span>
<span class="n">algebra.hierarchy_design</span> <span class="o">(</span><span class="mi">0</span><span class="o">)</span>
</code></pre></div>



<a name="304648853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304648853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304648853">(Oct 18 2022 at 10:20)</a>:</h4>
<p>Realistically, I think everything there with &gt;100 uses is worth doing immediately, and everything with &lt;=100 is not.</p>



<a name="304649221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304649221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304649221">(Oct 18 2022 at 10:23)</a>:</h4>
<p>I see -- the idea being that once everything with &gt; 100 uses is done, there will be more things which appear on the list with &gt; 100 uses.</p>



<a name="304650673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304650673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304650673">(Oct 18 2022 at 10:32)</a>:</h4>
<p>Whereas when you do something with &lt;100 uses, ipso facto the new things that appear also have &lt;100 uses!</p>



<a name="304670136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304670136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304670136">(Oct 18 2022 at 12:44)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> So the second part of the output are files that have non-ported indirect imports?</p>



<a name="304673265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304673265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304673265">(Oct 18 2022 at 13:04)</a>:</h4>
<p>Can someone clarify why <code>logic.basic</code> is on the list but there's already a file <code>Logic.Basic</code> in mathlib4/Mathlib?</p>



<a name="304673354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304673354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304673354">(Oct 18 2022 at 13:04)</a>:</h4>
<p>Same question for data.option.defs</p>



<a name="304674922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304674922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304674922">(Oct 18 2022 at 13:13)</a>:</h4>
<p>I tried to start on data.sigma.basic but despite the claim above that all dependencies are ported already, I can find none of the three imports</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Meta.Univs</span>
<span class="kn">import</span> <span class="n">Mathlib.Tactic.Lint.Default</span>
<span class="kn">import</span> <span class="n">Mathlib.Tactic.Ext</span>
</code></pre></div>
<p>in mathlib4. I am not clear about whether just deleting them all and pressing on will ultimately add more confusion or whether it's a worthwhile endeavour. Sorry for all the questions, I'm just getting the feeling for this -- I would ultimately like to get Imperial undergraduates working on this stuff but I need to figure it out myself first.</p>



<a name="304767418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304767418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304767418">(Oct 18 2022 at 16:15)</a>:</h4>
<p>The script looks at which files on this page have been marked as <code>Yes</code>: <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status</a><br>
<code>Logic.Basic</code> is not a <code>yes</code>, because it was only a partial port: many things from mathlib3 are still missing.</p>



<a name="304768535"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304768535" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304768535">(Oct 18 2022 at 16:21)</a>:</h4>
<p>For <code>tactic</code>/<code>meta</code> imports: I think it is useful to look at the status of which tactics have already been ported in the list <a href="https://github.com/leanprover-community/mathlib4/pull/430">mathlib4#430</a>. <br>
If the tactics mentioned in the imports are already ported, you can import the corresponding mathlib4 files (the file name might have changed a bit). If not, you can replace the <code>'No'</code> on <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status</a> by <code>'Waiting on tactic X'</code> or something.</p>



<a name="304768803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304768803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304768803">(Oct 18 2022 at 16:22)</a>:</h4>
<p>Thanks -- this is very helpful</p>



<a name="304769377"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304769377" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304769377">(Oct 18 2022 at 16:25)</a>:</h4>
<p>Floris, could you add those explanations to the wiki page?</p>



<a name="304790565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304790565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304790565">(Oct 18 2022 at 16:33)</a>:</h4>
<p>Good idea. I added it.</p>



<a name="304791592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304791592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304791592">(Oct 18 2022 at 16:38)</a>:</h4>
<p>I must say I'm a bit worried about the missing tactics/attributes in mathlib4. I think that quite soon we will hit a roadblock where files depend on unported tactics, and the porting either has to wait, or we have to do a lot more manual work.</p>



<a name="304792057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304792057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304792057">(Oct 18 2022 at 16:41)</a>:</h4>
<p>David Renshaw pointed out in the other thread I opened (I wasn't sure if this thread was a place for porting questions) that both the ext and nolint attributes seem to be working (it had not occurred to me to look for instances of them in mathlib4)</p>



<a name="304792810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304792810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304792810">(Oct 18 2022 at 16:44)</a>:</h4>
<p>Note that a chunk of ported <code>Logic.Basic</code> things moved to <code>std4</code> in <a href="https://github.com/leanprover-community/mathlib4/pull/403">https://github.com/leanprover-community/mathlib4/pull/403</a>. (And yes, there's still a bunch that's totally unported too.)</p>



<a name="304792814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304792814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304792814">(Oct 18 2022 at 16:44)</a>:</h4>
<p><a href="https://github.com/leanprover/std4/commit/3f3803e26e2894b0469196303b5afb2e300b68b9">https://github.com/leanprover/std4/commit/3f3803e26e2894b0469196303b5afb2e300b68b9</a></p>



<a name="304830316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304830316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304830316">(Oct 18 2022 at 19:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen/near/304629239">said</a>:</p>
<blockquote>
<p>If we go ahead with this, or something similar, we will also want two additional CI tools:</p>
<ol>
<li>something that labels PRs which touch frozen files with a special label, so reviewers can assure that a mathlib4 PR also exists.</li>
<li>something that notifies us when <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status</a> is out of sync with the labels inside actual files.</li>
</ol>
</blockquote>
<p>I think there are various race conditions to consider with this proposal, with associated CI implications.</p>
<ul>
<li>A PR touching a frozen file might be an old one from before the file was frozen - PRs often take a while to review. So you need to detect that case and mark old PRs (on branches in which the file is not marked as frozen) accordingly. Likewise if a change to the frozen file gets added in the old branch later. Likewise if a new PR is created from a branch predating the freezing.</li>
<li>Or there might be changes to the file in mathlib3 after the version on which the mathlib4 file was based (mathlib3port currently seems to be 9 days old, if people start with files from there they won't get the most recent mathlib3 changes without adding them manually). Or changes occurring in parallel to the porting process or the process of marking as frozen (including merging in the same bors batch, or approved to merge while the batch merging the freeze is going through CI).</li>
</ul>
<p>I think what these race conditions really indicate is that assertions that a file is fully ported need to be <em>versioned</em>. Entries in mathlib4-port-status shouldn't say 'Yes', they should specify a mathlib3 commit such that all the content of the mathlib3 file <em>as of that commit</em> has been confirmed to be fully ported to mathlib4. (mathport might e.g. be made to put comments in the files it generates saying what mathlib3 commit of that file they are up to date with, to help people identify the exact version they have ported.) Once the data about what is ported is explicitly versioned, you no longer need some complicated way for CI to detect and avoid all race conditions (or error-prone manual checks for recent unmerged changes when reviewing a PR to mark a file as frozen), just a much simpler way to list files that were ported based on a version of the mathlib3 file that is no longer the most recent version, and so need more recent changes ported over.</p>
<p>(There should also be documentation of how to apply the source-level porting to a single changed file or definition, to help people in porting changes to a previously ported file - including helping anyone who wants to do a PR to a frozen file and so would like the automatically generated version of their new or changed definitions or lemmas as a starting point for doing a corresponding mathlib4 PR. In general, my impression is that documentation for users of (Lean 3 + mathlib + leanproject) wanting to start doing things with Lean 4, and so wanting to know both how to convert source code and the Lean 4 equivalents of the things they do with Lean 3 + mathlib + leanproject, is fairly sparse at present.)</p>



<a name="304834071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304834071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304834071">(Oct 18 2022 at 20:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243791">David Renshaw</span> <a href="#narrow/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen/near/304792810">said</a>:</p>
<blockquote>
<p>Note that a chunk of ported <code>Logic.Basic</code> things moved to <code>std4</code> in <a href="https://github.com/leanprover-community/mathlib4/pull/403">https://github.com/leanprover-community/mathlib4/pull/403</a>. (And yes, there's still a bunch that's totally unported too.)</p>
</blockquote>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I'm sorry that we ask so much work from you but here I think we really need help to figure out what needs to be ported from this file. We will very quickly hit the time where all porting is blocked on that one. If you have a clear view of what was moved to core or std or is irrelevant, could you create a branch where you simply take the mathport output and remove everything we shouldn't port?</p>



<a name="304840329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304840329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304840329">(Oct 18 2022 at 21:02)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> I'm confused by the question. The rule is the same as for any port: if stuff already exists upstream, then <code>#align</code> it, otherwise port it. If it exists upstream with the same name then it can be removed (and yes, that will mean that mathlib4's <code>Logic.Basic</code> file will be much smaller than it was).</p>



<a name="304840411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304840411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304840411">(Oct 18 2022 at 21:03)</a>:</h4>
<p>The issue is to determine whether the stuff already exists upstream</p>



<a name="304840451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304840451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304840451">(Oct 18 2022 at 21:03)</a>:</h4>
<p>I have already done several full passes over Logic.Basic so it should be pretty complete already, but stuff moves on</p>



<a name="304840559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304840559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304840559">(Oct 18 2022 at 21:04)</a>:</h4>
<p>I have not made any attempt to freeze mathlib3's logic.basic yet</p>



<a name="304840862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304840862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304840862">(Oct 18 2022 at 21:06)</a>:</h4>
<p>Oh. Should we consider it ported then?</p>



<a name="304840865"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304840865" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304840865">(Oct 18 2022 at 21:06)</a>:</h4>
<p>I would say it needs another pass to finalize it. You can find most of the theorems by watching for duplicate definition errors, and there are a few more which have been renamed in std4 (<code>Std.Logic</code> is the new home for most of <code>logic.basic</code>)</p>



<a name="304840915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304840915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304840915">(Oct 18 2022 at 21:06)</a>:</h4>
<p>the <code>#align</code> directives for these are missing</p>



<a name="304841214"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304841214" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304841214">(Oct 18 2022 at 21:09)</a>:</h4>
<p>Should we start with the output from mathport or the current state of the file in mathlib4 then?</p>



<a name="304841448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304841448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304841448">(Oct 18 2022 at 21:10)</a>:</h4>
<p>The output from mathport should hopefully be well formed enough to get those duplicate definition errors</p>



<a name="304841502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304841502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304841502">(Oct 18 2022 at 21:10)</a>:</h4>
<p>the current mathlib4 file can be used as an "answer key" for most of it</p>



<a name="304841819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304841819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304841819">(Oct 18 2022 at 21:12)</a>:</h4>
<p>Ok, I'll try to that tomorrow if nobody is faster. Now is bedtime. I really want to work on the port. Like Kevin I'm super excited that we're now instructed to port theories instead of complicated tactics.</p>



<a name="304847184"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304847184" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304847184">(Oct 18 2022 at 21:54)</a>:</h4>
<p>I agree the race conditions coming from existing PRs, and from mathlib3port lagging behind current mathlib, are somewhat worrisome.</p>
<p>I propose we do the following</p>
<ul>
<li>make sure (?) it is easy to see in mathlib3port which commit hash was used to generate the files</li>
<li>PRs to mathlib4 porting files should include this hash in the PR description?</li>
<li><a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status</a> should include some extra information besides 'Yes'.<ul>
<li>I propose we go with 'Yes mathlib4#nnn mmmmm', where 'nnn' is the pull request number for mathlib4, and 'mmmmm' is the commit hash from mathlib3.</li>
</ul>
</li>
</ul>



<a name="304847238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304847238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304847238">(Oct 18 2022 at 21:54)</a>:</h4>
<p>However this is all extra work and overhead, which I'm not thrilled about. Winging it is another alternative, until we notice things going wrong.</p>



<a name="304847311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304847311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304847311">(Oct 18 2022 at 21:55)</a>:</h4>
<p>Perhaps all these race conditions (which fail by dropping contributions to mathlib3) are features, not bugs: they encourage people to divert their work on mathlib3 into work on mathlib4. :-)</p>



<a name="304847767"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304847767" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304847767">(Oct 18 2022 at 21:58)</a>:</h4>
<p>Maybe we can start having "nightlies" for mathlib: that is, certain designated (tagged?) commits which will be used by mathport CI and carried around</p>



<a name="304847834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304847834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304847834">(Oct 18 2022 at 21:59)</a>:</h4>
<p>the bors pipeline means that we already basically have "six-hour-lies"</p>



<a name="304848092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304848092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304848092">(Oct 18 2022 at 22:00)</a>:</h4>
<p>Another rather brutal approach would just be to freeze all of mathlib3. I thought that this was the plan at some point? Has this been deemed unworkable?</p>



<a name="304848145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304848145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304848145">(Oct 18 2022 at 22:01)</a>:</h4>
<p>At the rate things are going this would be hugely disruptive</p>



<a name="304848199"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304848199" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304848199">(Oct 18 2022 at 22:01)</a>:</h4>
<p>it's certainly not any time soon</p>



<a name="304848613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304848613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304848613">(Oct 18 2022 at 22:04)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>, what if we just tweak mathport to add a comment to all the generated <code>.lean</code> files:<br>
-- This file was generated from mathlib at commit XXXX<br>
-- Please remove this comment before making a pull request to mathlib4, but include the commit hash in your PR description.</p>



<a name="304848652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304848652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304848652">(Oct 18 2022 at 22:04)</a>:</h4>
<p>sure, we can do that</p>



<a name="304848713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304848713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304848713">(Oct 18 2022 at 22:05)</a>:</h4>
<p>actually I guess that requires some more complicated CI scripting</p>



<a name="304848749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304848749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304848749">(Oct 18 2022 at 22:05)</a>:</h4>
<p>since the mathport executable doesn't actually know that information</p>



<a name="304849708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304849708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304849708">(Oct 18 2022 at 22:12)</a>:</h4>
<p>maybe the mathlib3port build script can do that?</p>



<a name="304849883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304849883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304849883">(Oct 18 2022 at 22:14)</a>:</h4>
<p>Oh, actually maybe this isn't such a good idea, it will cause a lot of merge conflicts</p>



<a name="304849939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304849939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304849939">(Oct 18 2022 at 22:14)</a>:</h4>
<p>I like the idea of putting the mathlib commit in the mathlib3port commit message though</p>



<a name="304849988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304849988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304849988">(Oct 18 2022 at 22:15)</a>:</h4>
<p>We really just need a way of making the mathlib3 commit sha visible to someone grabbing a file from mathlib3port.</p>



<a name="304850033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304850033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304850033">(Oct 18 2022 at 22:15)</a>:</h4>
<p>I see, so <code>git log</code> in mathlib3port would tell you the latest mathlib3 sha.</p>



<a name="304850081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304850081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304850081">(Oct 18 2022 at 22:16)</a>:</h4>
<p>So it's just the <code>update.sh</code> script in mathlib3port that needs to know which mathlib3 is being used.</p>



<a name="304850187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304850187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304850187">(Oct 18 2022 at 22:16)</a>:</h4>
<p>I guess we could have mathport CI just put an extra file into the release process, that contains exactly that version information.</p>



<a name="304850407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304850407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304850407">(Oct 18 2022 at 22:18)</a>:</h4>
<p>i.e. we would modify</p>
<ul>
<li>in mathport <code>.github/workflows/build.yml</code> (and <code>predata.yml</code>), to add an extra file to the release bundle, say <code>version.yaml</code> containing <code>mathlib: XXXX</code> etc</li>
<li>in mathlib3port <code>update.sh</code>, to grab that file from the release bundle, and include the mathlib version in the commit message</li>
</ul>



<a name="304850498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304850498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304850498">(Oct 18 2022 at 22:18)</a>:</h4>
<p>(For simplicity perhaps the extra file shouldn't be a yaml, it can just contain the bare sha.)</p>



<a name="304850973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304850973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304850973">(Oct 18 2022 at 22:22)</a>:</h4>
<p>okay, I will try this later today</p>



<a name="304851576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304851576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304851576">(Oct 18 2022 at 22:27)</a>:</h4>
<p>There's going to be a slightly annoying thing here:</p>
<ul>
<li>in the port-status wiki file, we update a file to <code>Yes mathlib4#999 1234abcd</code> after the PR to mathlib4 lands.</li>
<li>we then make a PR back to mathlib3, to label that file as frozen, per this thread</li>
<li>this lands in commit <code>7890cdef</code> for mathlib3, so now the port-status file is out of date, and potentially we worry that the file has meaningfully changed</li>
</ul>
<p>Possible solutions:</p>
<ul>
<li>just cope</li>
<li>when the freezing commit lands, remember to update the port-status wiki file</li>
<li>have CI do that, by tracking appropriate labels</li>
</ul>



<a name="304852332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304852332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304852332">(Oct 18 2022 at 22:34)</a>:</h4>
<p>The file very well could have changed in that time. When reviewing the PR back to mathlib3, one of the tasks is to make sure that there are no such changes, and if there are, to open a mathlib4 update PR.</p>



<a name="304855856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304855856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304855856">(Oct 18 2022 at 23:10)</a>:</h4>
<p>I've updated the porting script in <a href="https://github.com/leanprover-community/mathlib/pull/17056">#17056</a>, so if the port-status wiki file includes comments after <code>No</code>, it prints those. I've also update the port-status wiki header to state that the statuses MUST start with either 'Yes' or 'No' for now.</p>
<p>Example output now:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code># The following files have all dependencies ported already, and should be ready to port:
# Earlier items in the list are required in more places in mathlib.
logic.basic
data.option.defs
data.prod.basic    -- WIP
data.sigma.basic
algebra.group.to_additive
data.bool.basic
control.functor
lean_core.data.vector
data.char
logic.lemmas
category_theory.concrete_category.bundled
algebra.order.floor
category_theory.elementwise
data.bracket
data.stream.defs
data.rbtree.init
data.num.basic
data.lazy_list
data.fin.fin2    -- PRd as #478
data.nat.bits
data.rbtree.default_lt
lean_core.data.dlist
control.ulift
lean_core.data.buffer
lean_core.data.buffer.parser
algebra.group_power.identities    -- Blocked by current status of ring tactic: https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/status.20of.20.60ring.60/near/303965507
data.json
control.basic
algebra.hierarchy_design

# The following files have their immediate dependencies ported already, and may be ready to port:
data.nat.cast.defs
group_theory.eckmann_hilton
</code></pre></div>



<a name="304855888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304855888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304855888">(Oct 18 2022 at 23:10)</a>:</h4>
<p>(Perhaps people writing WIP should add their name. :-)</p>



<a name="304856015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304856015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304856015">(Oct 18 2022 at 23:12)</a>:</h4>
<p>The port-status file looks pretty intimidating (in part because it's a yaml file rendered as markdown). Can we make this less user visible, for example by using a bot to update it automatically when a PR lands?</p>



<a name="304856685"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304856685" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304856685">(Oct 18 2022 at 23:19)</a>:</h4>
<p>I agree it's gross. I think this is the current set of transitions:</p>
<ul>
<li>When running <code>port_status.py</code>, it dumps a new <code>port_status.yaml</code> in the current directory with new lines for newly added files. These should be periodically included in the wiki.</li>
<li>People are adding <code>WIP</code> and <code>PRd as</code> and <code>Blocked by...</code> comments</li>
<li>When a PR is merged into mathlib4, we can change <code>No</code> to <code>Yes mathlib4#XXX</code>, or ideally <code>Yes mathlib4#XXX abcd1234</code> to record the mathlib sha.</li>
<li>When someone freezes the file in mathlib3, they should update the sha.</li>
</ul>
<p>I'd propose we handle things manually for at least a few days, and then ask if someone can write a bot for us to help with CI. (Ask Sarah for help on this at the mathlib porting meeting with her?)</p>



<a name="304861566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304861566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304861566">(Oct 19 2022 at 00:17)</a>:</h4>
<p>I'm not sure the person freezing the file in mathlib3 updating the sha is the best option, because of the risk that they get it wrong (miss that there are intermediate commits that still need porting). Rather, it might be better to have automation that checks if the sha is older than the current revision of the file in mathlib3 - and make that automation able to detect if a commit just does freezing but nothing else, and ignores the commit in that case (so an update isn't needed after a freezing commit but you still get the information when the mathlib4 file is genuinely out of date compared to mathlib3). Alternatively, the automation could update the sha itself in the case where the only mathlib3 commit to the file subsequent to the port to mathlib4 is a freezing-only commit.</p>



<a name="304867059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304867059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304867059">(Oct 19 2022 at 01:33)</a>:</h4>
<p>I agree that would be ideal, but it adds more requirements for the automation (detecting freeze-only commits).</p>



<a name="304867494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304867494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304867494">(Oct 19 2022 at 01:39)</a>:</h4>
<p>not putting the freeze message in the file itself might help with this</p>



<a name="304867625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304867625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304867625">(Oct 19 2022 at 01:40)</a>:</h4>
<p>it might suffice to have PRs that touch some frozen files get a comment from a bot saying "this PR touches files X, Y, Z that have already been ported. Please make sure to open a companion PR on mathlib4"</p>



<a name="304868472"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304868472" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304868472">(Oct 19 2022 at 01:51)</a>:</h4>
<p>It was suggested above that people would like to know that a file is synchronized before they start, and a bot that only touched PRs would be late in the game.</p>



<a name="304868529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304868529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304868529">(Oct 19 2022 at 01:52)</a>:</h4>
<p>I don't think this is a show stopper, though, and I really like the prospect of fewer commits/PRs to make this all happen.</p>



<a name="304868680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304868680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304868680">(Oct 19 2022 at 01:54)</a>:</h4>
<p>I guess we could keep the <code>SYNCHRONIZED</code> messages in individual files, but they would not be the "source of truth" (which I guess for now is the port-status page on the wiki).</p>
<p>One bot could label prs that touch synchronized files.<br>
Perhaps another bot could at regular intervals add the <code>SYNCHRONIZED</code> messages itself. (i.e. like our bot that updates nolints)</p>



<a name="304879171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304879171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304879171">(Oct 19 2022 at 04:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen/near/304850407">said</a>:</p>
<blockquote>
<p>i.e. we would modify</p>
<ul>
<li>in mathport <code>.github/workflows/build.yml</code> (and <code>predata.yml</code>), to add an extra file to the release bundle, say <code>version.yaml</code> containing <code>mathlib: XXXX</code> etc</li>
<li>in mathlib3port <code>update.sh</code>, to grab that file from the release bundle, and include the mathlib version in the commit message</li>
</ul>
</blockquote>
<p>FYI, we already add a <code>rev</code> file in the predata. <a href="https://github.com/leanprover-community/mathport/blob/897d11a96d142d09757acb99461624e7cfc581df/Makefile#L76">https://github.com/leanprover-community/mathport/blob/897d11a96d142d09757acb99461624e7cfc581df/Makefile#L76</a></p>



<a name="304904599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304904599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304904599">(Oct 19 2022 at 08:41)</a>:</h4>
<p>Do we need a way to not accidentally freeze files which are still about to change in open mathlib PRs?</p>



<a name="304904891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304904891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304904891">(Oct 19 2022 at 08:43)</a>:</h4>
<p>Freezing files will, I think, have higher priority. Open PRs that have a "freeze" event intervene will have to cope.</p>



<a name="304907483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304907483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304907483">(Oct 19 2022 at 08:57)</a>:</h4>
<p>(That's just a suggestion, not me saying how things have to be. :-)</p>



<a name="304923268"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304923268" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304923268">(Oct 19 2022 at 10:38)</a>:</h4>
<p>Should <code>mathlib3port</code> be bumped more frequently?</p>



<a name="304925173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304925173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304925173">(Oct 19 2022 at 10:48)</a>:</h4>
<p>Does your script ignore <code>Init</code>? <code>RBTree.Init</code> depends on <code>init.data.ordering.basic</code>, which hasn't been ported</p>



<a name="304931437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304931437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304931437">(Oct 19 2022 at 11:27)</a>:</h4>
<p>Or is there something like <code>mathlib3port</code> for old <code>init</code> files?</p>



<a name="304932492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304932492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304932492">(Oct 19 2022 at 11:33)</a>:</h4>
<p>Can someone grant me write access to non-master branches on <code>mathlib4</code>?</p>



<a name="304935826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304935826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304935826">(Oct 19 2022 at 11:54)</a>:</h4>
<p>The instruction page for porting seems to be missing a reminder to put new files in <code>Mathlib.lean</code></p>



<a name="304937689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/304937689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#304937689">(Oct 19 2022 at 12:05)</a>:</h4>
<p>I added a few comments to the file about blocking tactics and about blocking missing init files</p>



<a name="305052826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305052826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305052826">(Oct 19 2022 at 22:33)</a>:</h4>
<p>Point 8 is now a bit painful, why do we need to track the <code>mathlib</code> commit hash we checked again? Shouldn't it be always on track with the most recent <code>mathlib</code> version?</p>



<a name="305052978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305052978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305052978">(Oct 19 2022 at 22:35)</a>:</h4>
<p>How will we know that it is on track with the most recent <code>mathlib</code> version?</p>



<a name="305053136"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305053136" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305053136">(Oct 19 2022 at 22:36)</a>:</h4>
<p>We need to keep track, somewhere, of the promise "mathlib4 reflects all changes to this file up to commit X".</p>



<a name="305053167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305053167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305053167">(Oct 19 2022 at 22:36)</a>:</h4>
<p>So that if that file has any changes in to post X, we have a way of noticing and not losing those changes.</p>



<a name="305053196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305053196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305053196">(Oct 19 2022 at 22:36)</a>:</h4>
<p>The proposal is that the "source of truth" for such promises is in the port status wiki page.</p>



<a name="305053249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305053249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305053249">(Oct 19 2022 at 22:37)</a>:</h4>
<p>If someone makes a PR that touches a file that is synchronized, there will need to be a PR to mathlib4 to make the corresponding changes.</p>



<a name="305053279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305053279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305053279">(Oct 19 2022 at 22:37)</a>:</h4>
<p>Once both PRs have merged we can update the port status wiki page sha for that file.</p>



<a name="305053352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305053352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305053352">(Oct 19 2022 at 22:38)</a>:</h4>
<p>I agree point 8 is super painful for now. So we need some CI assistance.</p>



<a name="305053455"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305053455" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305053455">(Oct 19 2022 at 22:39)</a>:</h4>
<ul>
<li>a script that tells us a list of synchronized files but which have fresh changes</li>
<li>perhaps some automation that updates the port status wiki page --- but I'm not really sure what automation helps here, as it seems all the steps need human verification that something has been done correctly...</li>
</ul>



<a name="305054239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305054239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305054239">(Oct 19 2022 at 22:46)</a>:</h4>
<p>Right, thanks for the explanation :)</p>



<a name="305054310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305054310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305054310">(Oct 19 2022 at 22:46)</a>:</h4>
<p>I think what could be useful would be a way to automatically PR the freeze comment to mathlib</p>



<a name="305054701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305054701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305054701">(Oct 19 2022 at 22:50)</a>:</h4>
<p>Okay, that's a good point. What should trigger it? A PR being merged to mathlib4 that ...? We need to work out how a bot would parse the PR to decide which files it should mark as synchronized.</p>



<a name="305054727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305054727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305054727">(Oct 19 2022 at 22:51)</a>:</h4>
<p>If someone wants to write such a bot I will happily test it and merge the CI changes. :-)</p>



<a name="305055383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305055383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305055383">(Oct 19 2022 at 22:57)</a>:</h4>
<p>I'll look into it tomorrow.</p>



<a name="305055525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305055525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305055525">(Oct 19 2022 at 22:59)</a>:</h4>
<p>Made a manual PR for the comment for <a href="https://github.com/leanprover-community/mathlib4/pull/480">mathlib4#480</a> at <a href="https://github.com/leanprover-community/mathlib/pull/17077">#17077</a>. Maybe we can fast-track those PRs or add a specific label or switch off some of the CI?</p>



<a name="305055677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305055677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305055677">(Oct 19 2022 at 23:00)</a>:</h4>
<p>(Ah, damn, I just noticed, that your proposal for that message might not be cast in stone as of now)</p>



<a name="305056139"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305056139" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305056139">(Oct 19 2022 at 23:05)</a>:</h4>
<p>A specific label certainly seems like a good idea.</p>



<a name="305056161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305056161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305056161">(Oct 19 2022 at 23:05)</a>:</h4>
<p>I think we can just <code>bors merge</code> such PRs without waiting for CI.</p>



<a name="305058635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305058635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305058635">(Oct 19 2022 at 23:32)</a>:</h4>
<p>I created the <code>mathlib4-synchronization</code> label for these.</p>



<a name="305064738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305064738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305064738">(Oct 20 2022 at 00:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen/near/304904891">said</a>:</p>
<blockquote>
<p>Freezing files will, I think, have higher priority. Open PRs that have a "freeze" event intervene will have to cope.</p>
</blockquote>
<p>I think this rule adds to the case that we need good Lean 4 migration documentation, so that PR submitters (who may never have used Lean 4 and may not have followed any Lean 4 discussions either so don't know any details of the differences between Lean 3 and Lean 4 or the mathlib conversion process) can be pointed to a guide covering how to do with Lean 4 (+ mathlib4 + lake + any other tools used with Lean 4) what they are used to doing in Lean 3 + mathlib + leanproject, and how to run the automated conversion for the new code in their PR. (Without the freeze of converted files we'd still have needed such migration documentation eventually, but maybe not until the conversion was much more advanced.)</p>
<p>Regarding another comment, shouldn't permissions to push to non-master branches of mathlib4 be copied from the permissions on mathlib, so people don't need to request such permissions individually? (Note: I don't know whether this has in fact been done.)</p>



<a name="305065373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305065373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305065373">(Oct 20 2022 at 01:08)</a>:</h4>
<p>Yikes, yes, we have a little over 300 people with write access to the mathlib repository. Do we really want to copy over all those permissions? We'd have to work out how to do it in bulk.</p>



<a name="305065466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305065466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305065466">(Oct 20 2022 at 01:10)</a>:</h4>
<p>Or at least the permissions for those who opened a mathlib PR in the last six months or something like that, but I don't know how much fewer that is (presumably the GitHub API can be used to get a list of such users).</p>



<a name="305065611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305065611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Joseph Myers <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305065611">(Oct 20 2022 at 01:12)</a>:</h4>
<p>There's an assumption here that mathlib4 CI works (or will work) like mathlib CI, i.e. on branches in the main repository but not so well on forks (and will end up providing downloadable oleans for such branches, even if it doesn't yet, and mathlib4 will end up slow enough to build that having such oleans will be important). I don't know if that's actually the case or not.</p>



<a name="305065735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/proposal%20for%20marking%20files%20as%20frozen/near/305065735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/proposal.20for.20marking.20files.20as.20frozen.html#305065735">(Oct 20 2022 at 01:14)</a>:</h4>
<p>Yes, I think that assumption is correct.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>