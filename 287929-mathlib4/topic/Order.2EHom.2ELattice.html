---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html">Order.Hom.Lattice</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="323360873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323360873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Matej Penciak <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323360873">(Jan 24 2023 at 21:56)</a>:</h4>
<p>I started this PR (<a href="https://github.com/leanprover-community/mathlib4/pull/1636">https://github.com/leanprover-community/mathlib4/pull/1636</a>) a bit ago, and I've been looking at the issues on and off over the last few days.</p>
<p>I think most of the errors are coming from a bunch of the instances of <code>RelHomClass</code> not being inferred (starting around line 188). I've tried debugging the best I can, but someone who understand this stuff better than I should probably take a look.</p>
<p>There are some totally unhelpful error messages like</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>type mismatch
  map_top
has type
  ∀ (f : F), ↑f ⊤ = ⊤ : Prop
but is expected to have type
  ∀ (f : F), ↑f ⊤ = ⊤ : Prop
</code></pre></div>
<p>where if I hover over any given sub-expression all the types match up.</p>
<p>This is one of the files in the direction of <code>Data.Complex.Basic</code>, but it doesn't have a lot of immediate descendants so it's not blocking all that much right now.</p>



<a name="323362423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323362423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323362423">(Jan 24 2023 at 22:06)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">set_option</span> <span class="n">synthInstance.maxHeartbeats</span> <span class="mi">2000</span>
<span class="kd">set_option</span> <span class="n">trace.Meta.synthInstance</span> <span class="n">true</span>
<span class="c1">-- See note [lower instance priority]</span>
<span class="kd">instance</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="mi">100</span><span class="o">)</span> <span class="n">BoundedLatticeHomClass.toBoundedOrderHomClass</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">β</span><span class="o">]</span>
    <span class="o">[</span><span class="n">BoundedOrder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedOrder</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedLatticeHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">BoundedOrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
  <span class="k">let</span> <span class="n">foo</span> <span class="o">:</span> <span class="n">OrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span> <span class="n">inferInstance</span>
  <span class="gr">sorry</span>
</code></pre></div>
<p>gives</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">...</span>
<span class="o">[</span><span class="n">resume</span><span class="o">]</span> <span class="n">propagating</span> <span class="o">(</span><span class="n">x_0</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.0</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">x_1</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.1</span><span class="o">)</span> <span class="bp">→</span>
          <span class="o">(</span><span class="n">x_2</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.2</span><span class="o">)</span> <span class="bp">→</span>
            <span class="o">(</span><span class="n">x_3</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.3</span><span class="o">)</span> <span class="bp">→</span>
              <span class="o">(</span><span class="n">x_4</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.4</span><span class="o">)</span> <span class="bp">→</span>
                <span class="o">(</span><span class="n">x_5</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.5</span><span class="o">)</span> <span class="bp">→</span>
                  <span class="o">(</span><span class="n">x_6</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.6</span><span class="o">)</span> <span class="bp">→</span>
                    <span class="o">(</span><span class="n">x_7</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.7</span><span class="o">)</span> <span class="bp">→</span>
                      <span class="o">(</span><span class="n">x_8</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.8</span><span class="o">)</span> <span class="bp">→</span>
                        <span class="o">(</span><span class="n">x_9</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.9</span><span class="o">)</span> <span class="bp">→</span>
                          <span class="o">(</span><span class="n">x_10</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.10</span><span class="o">)</span> <span class="bp">→</span>
                            <span class="o">(</span><span class="n">x_11</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.11</span><span class="o">)</span> <span class="bp">→</span>
                              <span class="o">(</span><span class="n">x_12</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.12</span><span class="o">)</span> <span class="bp">→</span>
                                <span class="o">(</span><span class="n">x_13</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.13</span><span class="o">)</span> <span class="bp">→</span>
                                  <span class="o">(</span><span class="n">x_14</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.14</span><span class="o">)</span> <span class="bp">→</span>
                                    <span class="o">(</span><span class="n">x_15</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.15</span><span class="o">)</span> <span class="bp">→</span>
                                      <span class="o">(</span><span class="n">x_16</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.16</span><span class="o">)</span> <span class="bp">→</span>
                                        <span class="o">(</span><span class="n">x_17</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.17</span><span class="o">)</span> <span class="bp">→</span>
                                          <span class="o">(</span><span class="n">x_18</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.18</span><span class="o">)</span> <span class="bp">→</span>
                                            <span class="n">Bot</span>
                                              <span class="o">((</span><span class="n">WithTop</span> <span class="n">x_0</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_1</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                  <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_2</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                    <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_3</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                      <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_4</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                        <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_5</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                          <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_6</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                            <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_7</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                              <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_8</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                                <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_9</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                                  <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_10</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                                    <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_11</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                                      <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_12</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                                        <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_13</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                                          <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_14</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                                            <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_15</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                                              <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_16</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                                                <span class="o">(</span><span class="n">WithTop</span> <span class="n">x_17</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                                                                  <span class="o">(</span><span class="n">WithTop</span>
                                                                                      <span class="n">x_18</span><span class="o">)</span><span class="bp">ᵒᵈ</span><span class="o">)</span> <span class="n">to</span> <span class="n">subgoal</span> <span class="n">Bot</span>
        <span class="o">((</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21896</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
          <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21897</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
            <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21898</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
              <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21899</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21900</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                  <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21901</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                    <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21902</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                      <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21903</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                        <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21904</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                          <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21905</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                            <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21906</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                              <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21907</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21908</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                  <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21909</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                    <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21910</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                      <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21911</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                        <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21912</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                          <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21913</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                            <span class="o">(</span><span class="n">WithTop</span>
                                                <span class="bp">?</span><span class="n">m.21914</span><span class="o">)</span><span class="bp">ᵒᵈ</span><span class="o">)</span> <span class="n">of</span> <span class="n">Bot</span>
        <span class="o">((</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21154</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
          <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21896</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
            <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21897</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
              <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21898</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21899</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                  <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21900</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                    <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21901</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                      <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21902</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                        <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21903</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                          <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21904</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                            <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21905</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                              <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21906</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21907</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                  <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21908</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                    <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21909</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                      <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21910</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                        <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21911</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span>
                                          <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21912</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21913</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">×</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.21914</span><span class="o">)</span><span class="bp">ᵒᵈ</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[</span><span class="n">resume</span><span class="o">]</span> <span class="n">propagating</span> <span class="o">(</span><span class="n">x_0</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.0</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">x_1</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.1</span><span class="o">)</span> <span class="bp">→</span>
          <span class="o">(</span><span class="n">x_2</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.2</span><span class="o">)</span> <span class="bp">→</span>
            <span class="o">(</span><span class="n">x_3</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_abstMVar.3</span><span class="o">)</span> <span class="bp">→</span>
<span class="bp">...</span>
</code></pre></div>



<a name="323362541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323362541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323362541">(Jan 24 2023 at 22:07)</a>:</h4>
<p><a href="#narrow/stream/287929-mathlib4/topic/slow.20.60positivity.60/near/322871598">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/slow.20.60positivity.60/near/322871598</a></p>



<a name="323363404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323363404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323363404">(Jan 24 2023 at 22:13)</a>:</h4>
<p>Just telling Lean how to do it works:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="mi">100</span><span class="o">)</span> <span class="n">BoundedLatticeHomClass.toBoundedOrderHomClass</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">β</span><span class="o">]</span>
    <span class="o">[</span><span class="n">BoundedOrder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedOrder</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedLatticeHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">BoundedOrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
<span class="o">{</span> <span class="k">show</span> <span class="n">OrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="k">from</span> <span class="n">SupHomClass.toOrderHomClass</span><span class="o">,</span> <span class="o">‹</span><span class="n">BoundedLatticeHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">›</span> <span class="k">with</span> <span class="o">}</span>
</code></pre></div>



<a name="323363896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323363896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323363896">(Jan 24 2023 at 22:16)</a>:</h4>
<p>This isn't going to end well either:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="o">[</span><span class="n">resume</span><span class="o">]</span> <span class="n">propagating</span> <span class="n">Lattice</span> <span class="n">α</span> <span class="n">to</span> <span class="n">subgoal</span> <span class="n">Lattice</span> <span class="n">α</span> <span class="n">of</span> <span class="n">Lattice</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[</span><span class="n">resume</span><span class="o">]</span> <span class="n">propagating</span> <span class="n">Lattice</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">)</span> <span class="n">to</span> <span class="n">subgoal</span> <span class="n">Lattice</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">)</span> <span class="n">of</span> <span class="n">Lattice</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">))</span> <span class="bp">▶</span>
  <span class="o">[</span><span class="n">resume</span><span class="o">]</span> <span class="n">propagating</span> <span class="n">Lattice</span>
        <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">))</span> <span class="n">to</span> <span class="n">subgoal</span> <span class="n">Lattice</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">))</span> <span class="n">of</span> <span class="n">Lattice</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">)))</span> <span class="bp">▶</span>
  <span class="o">[</span><span class="n">resume</span><span class="o">]</span> <span class="n">propagating</span> <span class="n">Lattice</span>
        <span class="o">(</span><span class="n">WithTop</span>
          <span class="o">(</span><span class="n">WithTop</span>
            <span class="o">(</span><span class="n">WithTop</span>
              <span class="n">α</span><span class="o">)))</span> <span class="n">to</span> <span class="n">subgoal</span> <span class="n">Lattice</span>
        <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">)))</span> <span class="n">of</span> <span class="n">Lattice</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">))))</span> <span class="bp">▶</span>
  <span class="o">[</span><span class="n">resume</span><span class="o">]</span> <span class="n">propagating</span> <span class="n">Lattice</span>
        <span class="o">(</span><span class="n">WithTop</span>
          <span class="o">(</span><span class="n">WithTop</span>
            <span class="o">(</span><span class="n">WithTop</span>
              <span class="o">(</span><span class="n">WithTop</span>
                <span class="n">α</span><span class="o">))))</span> <span class="n">to</span> <span class="n">subgoal</span> <span class="n">Lattice</span>
        <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">))))</span> <span class="n">of</span> <span class="n">Lattice</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="n">WithTop</span> <span class="n">α</span><span class="o">)))))</span> <span class="bp">▶</span>
  <span class="o">[</span><span class="n">resume</span><span class="o">]</span> <span class="n">propagating</span> <span class="n">Lattice</span>
</code></pre></div>



<a name="323367618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323367618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323367618">(Jan 24 2023 at 22:38)</a>:</h4>
<p>Here's the behaviour on <code>master</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Order.Hom.Basic</span>

<span class="kd">class</span> <span class="n">SupHomClass</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="n">outParam</span> <span class="bp">&lt;|</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">[</span><span class="n">HasSup</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">HasSup</span> <span class="n">β</span><span class="o">]</span> <span class="kd">extends</span>
  <span class="n">FunLike</span> <span class="n">F</span> <span class="n">α</span> <span class="k">fun</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">β</span> <span class="n">where</span>
  <span class="n">map_sup</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="o">(</span><span class="n">a</span> <span class="bp">⊔</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">⊔</span> <span class="n">f</span> <span class="n">b</span>

<span class="kd">class</span> <span class="n">LatticeHomClass</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="n">outParam</span> <span class="bp">&lt;|</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">β</span><span class="o">]</span> <span class="kd">extends</span>
  <span class="n">SupHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="n">where</span>
  <span class="n">map_inf</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="o">(</span><span class="n">a</span> <span class="bp">⊓</span> <span class="n">b</span><span class="o">)</span> <span class="bp">=</span> <span class="n">f</span> <span class="n">a</span> <span class="bp">⊓</span> <span class="n">f</span> <span class="n">b</span>

<span class="kd">class</span> <span class="n">BoundedLatticeHomClass</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="n">outParam</span> <span class="bp">&lt;|</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">β</span><span class="o">]</span>
  <span class="o">[</span><span class="n">BoundedOrder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedOrder</span> <span class="n">β</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">LatticeHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="n">where</span>
  <span class="n">map_top</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">⊤</span> <span class="bp">=</span> <span class="bp">⊤</span>
  <span class="n">map_bot</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">:</span> <span class="n">f</span> <span class="bp">⊥</span> <span class="bp">=</span> <span class="bp">⊥</span>

<span class="kd">instance</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="mi">100</span><span class="o">)</span> <span class="n">SupHomClass.toOrderHomClass</span> <span class="o">[</span><span class="n">SemilatticeSup</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">SemilatticeSup</span> <span class="n">β</span><span class="o">]</span>
    <span class="o">[</span><span class="n">SupHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">OrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="o">‹</span><span class="n">SupHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">›</span> <span class="k">with</span>
    <span class="n">map_rel</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">f</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">sup_eq_right</span><span class="o">,</span> <span class="bp">←</span> <span class="n">map_sup</span><span class="o">,</span> <span class="n">sup_eq_right.2</span> <span class="n">h</span><span class="o">]</span> <span class="o">}</span>

<span class="kd">example</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedOrder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedOrder</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedLatticeHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span>
    <span class="n">OrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
<span class="n">SupHomClass.toOrderHomClass</span> <span class="c1">-- works</span>

<span class="kd">set_option</span> <span class="n">synthInstance.maxHeartbeats</span> <span class="mi">400</span> <span class="k">in</span> <span class="c1">-- to stop huge outputs crashing VS code</span>
<span class="kd">set_option</span> <span class="n">trace.Meta.synthInstance</span> <span class="n">true</span> <span class="k">in</span>
<span class="kd">example</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">Lattice</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedOrder</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedOrder</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">BoundedLatticeHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span>
    <span class="n">OrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
<span class="n">inferInstance</span> <span class="c1">-- loops</span>
</code></pre></div>



<a name="323367975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323367975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323367975">(Jan 24 2023 at 22:41)</a>:</h4>
<p>People who understand these traces better than me can usually stare at the output below and instantly go "it went wrong at precisely this point and that's your bad instance".</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">Meta.synthInstance</span><span class="o">]</span> <span class="bp">💥</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">▼</span>
  <span class="o">[]</span> <span class="n">new</span> <span class="n">goal</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="n">_tc.2</span> <span class="n">_tc.3</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">SupHomClass.toOrderHomClass</span> <span class="n">to</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span> <span class="n">to</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.2939</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">Prod.semilatticeSup</span> <span class="n">to</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.2943</span> <span class="bp">×</span> <span class="bp">?</span><span class="n">m.2944</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span> <span class="n">to</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.2956</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">Prod.semilatticeSup</span> <span class="n">to</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.2960</span> <span class="bp">×</span> <span class="bp">?</span><span class="n">m.2961</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">OrderDual.semilatticeSup</span> <span class="n">to</span> <span class="n">SemilatticeSup</span> <span class="bp">?</span><span class="n">m.2965</span><span class="bp">ᵒᵈ</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeInf</span> <span class="n">to</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.2976</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">Prod.semilatticeInf</span> <span class="n">to</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.2980</span> <span class="bp">×</span> <span class="bp">?</span><span class="n">m.2981</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">OrderDual.semilatticeInf</span> <span class="n">to</span> <span class="n">SemilatticeInf</span> <span class="bp">?</span><span class="n">m.2985</span><span class="bp">ᵒᵈ</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithBot.semilatticeInf</span> <span class="n">to</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="n">WithBot</span> <span class="bp">?</span><span class="n">m.2988</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="k">Pi</span><span class="bp">.</span><span class="n">semilatticeInf</span> <span class="n">to</span> <span class="n">SemilatticeInf</span> <span class="o">((</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="bp">?</span><span class="n">m.2992</span> <span class="n">i</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3006</span> <span class="n">i</span><span class="o">))</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">Prod.semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3015</span> <span class="n">i</span> <span class="bp">×</span> <span class="bp">?</span><span class="n">m.3016</span> <span class="n">i</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">OrderDual.semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3025</span> <span class="n">i</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3042</span> <span class="n">i</span><span class="o">))</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">Prod.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3051</span> <span class="n">i</span> <span class="bp">×</span> <span class="bp">?</span><span class="n">m.3052</span> <span class="n">i</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">OrderDual.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3061</span> <span class="n">i</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithBot.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithBot</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3069</span> <span class="n">i</span><span class="o">))</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="k">Pi</span><span class="bp">.</span><span class="n">semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">((</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="bp">?</span><span class="n">m.3078</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3098</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">))</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">Prod.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3112</span> <span class="n">i</span> <span class="n">i_1</span> <span class="bp">×</span> <span class="bp">?</span><span class="n">m.3113</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">OrderDual.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3127</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3150</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">))</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">Prod.semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3164</span> <span class="n">i</span> <span class="n">i_1</span> <span class="bp">×</span> <span class="bp">?</span><span class="n">m.3165</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">OrderDual.semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3179</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithBot.semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="n">WithBot</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3192</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">))</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="k">Pi</span><span class="bp">.</span><span class="n">semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">((</span><span class="n">i_2</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3205</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">→</span> <span class="bp">?</span><span class="n">m.3206</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_2</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3205</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3232</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span><span class="o">))</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">Prod.semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_2</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3205</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3251</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span> <span class="bp">×</span> <span class="bp">?</span><span class="n">m.3252</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">OrderDual.semilatticeInf</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_2</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3205</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeInf</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3271</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_2</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3205</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3300</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span><span class="o">))</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">Prod.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_2</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3205</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3319</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span> <span class="bp">×</span> <span class="bp">?</span><span class="n">m.3320</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="n">OrderDual.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_2</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3205</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3339</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span><span class="o">)</span><span class="bp">ᵒᵈ</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithBot.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_2</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3205</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithBot</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3357</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span><span class="o">))</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="k">Pi</span><span class="bp">.</span><span class="n">semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_2</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3205</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">((</span><span class="n">i_3</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3375</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span><span class="o">)</span> <span class="bp">→</span> <span class="bp">?</span><span class="n">m.3376</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span> <span class="n">i_3</span><span class="o">)</span> <span class="bp">▶</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span> <span class="n">to</span> <span class="o">(</span><span class="n">i</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.2991</span><span class="o">)</span> <span class="bp">→</span>
        <span class="o">(</span><span class="n">i_1</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3077</span> <span class="n">i</span><span class="o">)</span> <span class="bp">→</span>
          <span class="o">(</span><span class="n">i_2</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3205</span> <span class="n">i</span> <span class="n">i_1</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">i_3</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.3375</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="o">(</span><span class="bp">?</span><span class="n">m.3408</span> <span class="n">i</span> <span class="n">i_1</span> <span class="n">i_2</span> <span class="n">i_3</span><span class="o">))</span> <span class="bp">▶</span>
</code></pre></div>



<a name="323368071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323368071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323368071">(Jan 24 2023 at 22:42)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> you're one of those people ;-)</p>



<a name="323368211"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323368211" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323368211">(Jan 24 2023 at 22:43)</a>:</h4>
<p>Is it this?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">Meta.synthInstance</span><span class="o">]</span> <span class="bp">💥</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">▼</span>
  <span class="o">[]</span> <span class="n">new</span> <span class="n">goal</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="n">_tc.2</span> <span class="n">_tc.3</span> <span class="bp">▼</span>
    <span class="o">[</span><span class="n">instances</span><span class="o">]</span> <span class="bp">#</span><span class="o">[</span><span class="bp">@</span><span class="n">OrderIsoClass.toOrderHomClass</span><span class="o">,</span> <span class="bp">@</span><span class="n">SupHomClass.toOrderHomClass</span><span class="o">]</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">SupHomClass.toOrderHomClass</span> <span class="n">to</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">▼</span>
    <span class="o">[</span><span class="n">tryResolve</span><span class="o">]</span> <span class="bp">✅</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">≟</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span>
    <span class="o">[]</span> <span class="n">new</span> <span class="n">goal</span> <span class="n">SemilatticeSup</span> <span class="n">_tc.0</span> <span class="bp">▼</span>
      <span class="o">[</span><span class="n">instances</span><span class="o">]</span> <span class="bp">#</span><span class="o">[</span><span class="bp">@</span><span class="n">Lattice.toSemilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="k">Pi</span><span class="bp">.</span><span class="n">semilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="n">WithBot.semilatticeSup</span><span class="o">,</span> <span class="n">OrderDual.semilatticeSup</span><span class="o">,</span> <span class="n">Prod.semilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span><span class="o">]</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span> <span class="n">to</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.2939</span><span class="o">)</span> <span class="bp">▼</span>
    <span class="o">[</span><span class="n">tryResolve</span><span class="o">]</span> <span class="bp">✅</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.2939</span><span class="o">)</span> <span class="bp">≟</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.2939</span><span class="o">)</span>
</code></pre></div>



<a name="323368508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323368508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323368508">(Jan 24 2023 at 22:45)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- `RelHomClass F r s` asserts that `F` is a type of functions such that all `f : F`</span>
<span class="sd">satisfy `r a b → s (f a) (f b)`.</span>

<span class="sd">The relations `r` and `s` are `outParam`s since figuring them out from a goal is a higher-order</span>
<span class="sd">matching problem that Lean usually can't do unaided.</span>
<span class="sd">-/</span>
<span class="kd">class</span> <span class="n">RelHomClass</span> <span class="o">(</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">)</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="n">outParam</span> <span class="bp">&lt;|</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">}</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">outParam</span> <span class="bp">&lt;|</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span>
  <span class="o">(</span><span class="n">s</span> <span class="o">:</span> <span class="n">outParam</span> <span class="bp">&lt;|</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="kd">extends</span> <span class="n">FunLike</span> <span class="n">F</span> <span class="n">α</span> <span class="k">fun</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">β</span> <span class="n">where</span>
  <span class="sd">/-- A `RelHomClass` sends related elements to related elements -/</span>
  <span class="n">map_rel</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">f</span> <span class="o">:</span> <span class="n">F</span><span class="o">)</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span><span class="o">},</span> <span class="n">r</span> <span class="n">a</span> <span class="n">b</span> <span class="bp">→</span> <span class="n">s</span> <span class="o">(</span><span class="n">f</span> <span class="n">a</span><span class="o">)</span> <span class="o">(</span><span class="n">f</span> <span class="n">b</span><span class="o">)</span>
</code></pre></div>



<a name="323368516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323368516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323368516">(Jan 24 2023 at 22:45)</a>:</h4>
<p>It looks like the <code>SemilatticeSup α</code> goal in <code>SupHomClass.toOrderHomClass</code> is not being treated like an out-param</p>



<a name="323368692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323368692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323368692">(Jan 24 2023 at 22:46)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">@</span><span class="n">SupHomClass.toOrderHomClass</span> <span class="o">:</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span><span class="o">}</span> <span class="bp">→</span>
  <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_2</span><span class="o">}</span> <span class="bp">→</span>
    <span class="o">{</span><span class="n">F</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_3</span><span class="o">}</span> <span class="bp">→</span>
      <span class="o">[</span><span class="n">inst</span> <span class="o">:</span> <span class="n">SemilatticeSup</span> <span class="n">α</span><span class="o">]</span> <span class="bp">→</span> <span class="o">[</span><span class="n">inst_1</span> <span class="o">:</span> <span class="n">SemilatticeSup</span> <span class="n">β</span><span class="o">]</span> <span class="bp">→</span> <span class="o">[</span><span class="n">inst_2</span> <span class="o">:</span> <span class="n">SupHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="bp">→</span> <span class="n">OrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span>
</code></pre></div>
<p>No mention of outparams there</p>



<a name="323368733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323368733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323368733">(Jan 24 2023 at 22:47)</a>:</h4>
<p>it looks like <a href="https://github.com/leanprover/lean4/pull/1852">lean4#1852</a></p>



<a name="323368814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323368814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323368814">(Jan 24 2023 at 22:48)</a>:</h4>
<p>Can you explain more precisely what this means? I only have the vaguest concept of what an out-param is.</p>



<a name="323368999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323368999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323368999">(Jan 24 2023 at 22:48)</a>:</h4>
<p>this is all to do with when...unification?...tries to fill in a hole?</p>



<a name="323369077"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323369077" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323369077">(Jan 24 2023 at 22:49)</a>:</h4>
<p>Specifically, we have the goal <code>OrderHomClass F ?α ?β</code> (where <code>?α, ?β</code> are forcibly made into metavariables because they are outparams) and want to find a solution to the typeclass problem which will determine <code>?α, ?β</code></p>



<a name="323369284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323369284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323369284">(Jan 24 2023 at 22:50)</a>:</h4>
<p><code>SemilatticeSup α</code> does not have <code>α</code> as an outparam, so it would be a bad idea to do a typeclass search for <code>SemilatticeSup ?α</code> immediately, because that will enumerate all semilattices</p>



<a name="323369329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323369329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323369329">(Jan 24 2023 at 22:50)</a>:</h4>
<p>which it's doing, right?</p>



<a name="323369336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323369336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323369336">(Jan 24 2023 at 22:50)</a>:</h4>
<p>right</p>



<a name="323369469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323369469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323369469">(Jan 24 2023 at 22:51)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="mi">100</span><span class="o">)</span> <span class="n">SupHomClass.toOrderHomClass</span> <span class="o">[</span><span class="n">outparam</span> <span class="o">(</span><span class="n">SemilatticeSup</span> <span class="n">α</span><span class="o">)]</span> <span class="o">[</span><span class="n">SemilatticeSup</span> <span class="n">β</span><span class="o">]</span>
    <span class="o">[</span><span class="n">SupHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">:</span> <span class="n">OrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="o">‹</span><span class="n">SupHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">›</span> <span class="k">with</span>
    <span class="n">map_rel</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">f</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">sup_eq_right</span><span class="o">,</span> <span class="bp">←</span> <span class="n">map_sup</span><span class="o">,</span> <span class="n">sup_eq_right.2</span> <span class="n">h</span><span class="o">]</span> <span class="o">}</span>
<span class="c">/-</span><span class="cm"></span>
<span class="cm">invalid binder annotation, type is not a class instance</span>
<span class="cm">  ?m.1448</span>
<span class="cm">use the command `set_option checkBinderAnnotations false` to disable the check</span>
<span class="cm">-/</span>
</code></pre></div>



<a name="323369483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323369483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323369483">(Jan 24 2023 at 22:51)</a>:</h4>
<p>The correct order of evaluation here is:</p>
<ol>
<li><code>SupHomClass F ?α ?β</code>, which solves <code>?α := α</code> and <code>?β := β</code></li>
<li><code>SemilatticeSup α</code></li>
<li><code>SemilatticeSup β</code></li>
</ol>



<a name="323369583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323369583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323369583">(Jan 24 2023 at 22:52)</a>:</h4>
<p>you misspelled <code>outParam</code></p>



<a name="323369676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323369676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323369676">(Jan 24 2023 at 22:52)</a>:</h4>
<p>it would be great if that worked, if only as a workaround, but I think that outparam annotations are ignored on instances</p>



<a name="323369932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323369932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323369932">(Jan 24 2023 at 22:54)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="mi">100</span><span class="o">)</span> <span class="n">SupHomClass.toOrderHomClass</span>  <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="n">outParam</span> <span class="bp">&lt;|</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">}</span> <span class="o">[</span><span class="n">outParam</span> <span class="o">(</span><span class="n">SemilatticeSup</span> <span class="n">α</span><span class="o">)]</span> <span class="o">[</span><span class="n">outParam</span> <span class="o">(</span><span class="n">SemilatticeSup</span> <span class="n">β</span><span class="o">)]</span>
    <span class="o">[</span><span class="n">outParam</span> <span class="o">(</span><span class="n">SupHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">)]</span> <span class="o">:</span> <span class="n">OrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="o">‹</span><span class="n">SupHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">›</span> <span class="k">with</span>
    <span class="n">map_rel</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">f</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">sup_eq_right</span><span class="o">,</span> <span class="bp">←</span> <span class="n">map_sup</span><span class="o">,</span> <span class="n">sup_eq_right.2</span> <span class="n">h</span><span class="o">]</span> <span class="o">}</span>
</code></pre></div>
<p>This doesn't fix it</p>



<a name="323370063"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323370063" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323370063">(Jan 24 2023 at 22:55)</a>:</h4>
<p>Gabriel's workaround is to use <code>{_ : SemilatticeSup α}</code> in the instance, but I think that won't work here because <code>SupHomClass</code> requires <code>HasSup</code> instead of <code>SemilatticeSup</code></p>



<a name="323370751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323370751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323370751">(Jan 24 2023 at 23:00)</a>:</h4>
<p>I don't understand why this is happening</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">Meta.synthInstance</span><span class="o">]</span> <span class="bp">💥</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">▼</span>
  <span class="o">[]</span> <span class="n">new</span> <span class="n">goal</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="n">_tc.2</span> <span class="n">_tc.3</span> <span class="bp">▼</span>
    <span class="o">[</span><span class="n">instances</span><span class="o">]</span> <span class="bp">#</span><span class="o">[</span><span class="bp">@</span><span class="n">OrderIsoClass.toOrderHomClass</span><span class="o">,</span> <span class="bp">@</span><span class="n">SupHomClass.toOrderHomClass</span><span class="o">]</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">SupHomClass.toOrderHomClass</span> <span class="n">to</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">▼</span>
    <span class="o">[</span><span class="n">tryResolve</span><span class="o">]</span> <span class="bp">✅</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">≟</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span>
    <span class="o">[]</span> <span class="n">new</span> <span class="n">goal</span> <span class="n">outParam</span> <span class="o">(</span><span class="n">SemilatticeSup</span> <span class="n">_tc.0</span><span class="o">)</span> <span class="bp">▼</span>
      <span class="o">[</span><span class="n">instances</span><span class="o">]</span> <span class="bp">#</span><span class="o">[</span><span class="bp">@</span><span class="n">Lattice.toSemilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="k">Pi</span><span class="bp">.</span><span class="n">semilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="n">WithBot.semilatticeSup</span><span class="o">,</span> <span class="n">OrderDual.semilatticeSup</span><span class="o">,</span> <span class="n">Prod.semilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span><span class="o">]</span>
</code></pre></div>
<p>when we have this</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">RelHomClass</span> <span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span> <span class="bp">→</span>
  <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="n">outParam</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">u_2</span><span class="o">)}</span> <span class="bp">→</span>
    <span class="o">{</span><span class="n">β</span> <span class="o">:</span> <span class="n">outParam</span> <span class="o">(</span><span class="kt">Type</span> <span class="n">u_3</span><span class="o">)}</span> <span class="bp">→</span> <span class="n">outParam</span> <span class="o">(</span><span class="n">α</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="bp">→</span> <span class="n">outParam</span> <span class="o">(</span><span class="n">β</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="o">(</span><span class="n">max</span> <span class="o">(</span><span class="n">max</span> <span class="n">u_1</span> <span class="n">u_2</span><span class="o">)</span> <span class="n">u_3</span><span class="o">)</span>
</code></pre></div>
<p>Oh! The outParam falls off in this trace:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">[</span><span class="n">Meta.synthInstance</span><span class="o">]</span> <span class="bp">💥</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">▼</span>
  <span class="o">[]</span> <span class="n">new</span> <span class="n">goal</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="n">_tc.2</span> <span class="n">_tc.3</span> <span class="bp">▼</span>
    <span class="o">[</span><span class="n">instances</span><span class="o">]</span> <span class="bp">#</span><span class="o">[</span><span class="bp">@</span><span class="n">OrderIsoClass.toOrderHomClass</span><span class="o">,</span> <span class="bp">@</span><span class="n">SupHomClass.toOrderHomClass</span><span class="o">]</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">SupHomClass.toOrderHomClass</span> <span class="n">to</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">▼</span>
    <span class="o">[</span><span class="n">tryResolve</span><span class="o">]</span> <span class="bp">✅</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span> <span class="bp">≟</span> <span class="n">RelHomClass</span> <span class="n">F</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span><span class="o">)</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">=&gt;</span> <span class="n">x</span> <span class="bp">≤</span> <span class="n">x_1</span>
    <span class="o">[]</span> <span class="n">new</span> <span class="n">goal</span> <span class="n">outParam</span> <span class="o">(</span><span class="n">SemilatticeSup</span> <span class="n">_tc.0</span><span class="o">)</span> <span class="bp">▼</span>
      <span class="o">[</span><span class="n">instances</span><span class="o">]</span> <span class="bp">#</span><span class="o">[</span><span class="bp">@</span><span class="n">Lattice.toSemilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="k">Pi</span><span class="bp">.</span><span class="n">semilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="n">WithBot.semilatticeSup</span><span class="o">,</span> <span class="n">OrderDual.semilatticeSup</span><span class="o">,</span> <span class="n">Prod.semilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span><span class="o">]</span>
  <span class="o">[]</span> <span class="bp">✅</span> <span class="n">apply</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span> <span class="n">to</span> <span class="n">outParam</span> <span class="o">(</span><span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.2962</span><span class="o">))</span> <span class="bp">▼</span>
    <span class="o">[</span><span class="n">tryResolve</span><span class="o">]</span> <span class="bp">✅</span> <span class="n">outParam</span> <span class="o">(</span><span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.2962</span><span class="o">))</span> <span class="bp">≟</span> <span class="n">SemilatticeSup</span> <span class="o">(</span><span class="n">WithTop</span> <span class="bp">?</span><span class="n">m.2962</span><span class="o">)</span>
    <span class="o">[]</span> <span class="n">new</span> <span class="n">goal</span> <span class="n">SemilatticeSup</span> <span class="n">_tc.0</span> <span class="bp">▼</span>
      <span class="o">[</span><span class="n">instances</span><span class="o">]</span> <span class="bp">#</span><span class="o">[</span><span class="bp">@</span><span class="n">Lattice.toSemilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="k">Pi</span><span class="bp">.</span><span class="n">semilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="n">WithBot.semilatticeSup</span><span class="o">,</span> <span class="n">OrderDual.semilatticeSup</span><span class="o">,</span> <span class="n">Prod.semilatticeSup</span><span class="o">,</span> <span class="bp">@</span><span class="n">WithTop.semilatticeSup</span><span class="o">]</span>
</code></pre></div>
<p>The new goal was <code>outParam (SemilatticeSup _tc.0)</code> and then it became <code>SemilatticeSup _tc.0</code></p>



<a name="323370897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323370897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323370897">(Jan 24 2023 at 23:01)</a>:</h4>
<p>outParam isn't really a tag on goals, it's a tag on arguments to a typeclass</p>



<a name="323370933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323370933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323370933">(Jan 24 2023 at 23:01)</a>:</h4>
<p>when it shows up elsewhere it's just a thing to be unfolded</p>



<a name="323372189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323372189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323372189">(Jan 24 2023 at 23:11)</a>:</h4>
<p>What needs to be changed to make type class inference not try to solve <code>SemilatticeSup _tc.0</code>? Is this something which can be fixed in mathlib or does it need a change in core Lean? Do we need a new meme?</p>



<a name="323374173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323374173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323374173">(Jan 24 2023 at 23:27)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">(</span><span class="n">priority</span> <span class="o">:=</span> <span class="mi">100</span><span class="o">)</span> <span class="n">SupHomClass.toOrderHomClass</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="n">outParam</span> <span class="bp">&lt;|</span> <span class="kt">Type</span> <span class="n">_</span><span class="o">}</span> <span class="o">[</span><span class="n">outParam</span> <span class="o">(</span><span class="n">SemilatticeSup</span> <span class="n">α</span><span class="o">)]</span> <span class="o">[</span><span class="n">outParam</span> <span class="o">(</span><span class="n">SemilatticeSup</span> <span class="n">β</span><span class="o">)]</span>
    <span class="o">[</span><span class="n">outParam</span> <span class="o">(</span><span class="n">SupHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">)]</span> <span class="o">:</span> <span class="n">OrderHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="o">‹</span><span class="n">SupHomClass</span> <span class="n">F</span> <span class="n">α</span> <span class="n">β</span><span class="o">›</span> <span class="k">with</span>
    <span class="n">map_rel</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">f</span> <span class="n">a</span> <span class="n">b</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">sup_eq_right</span><span class="o">,</span> <span class="bp">←</span> <span class="n">map_sup</span><span class="o">,</span> <span class="n">sup_eq_right.2</span> <span class="n">h</span><span class="o">]</span> <span class="o">}</span>
</code></pre></div>
<p>This doesn't fix it.</p>



<a name="323376164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323376164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323376164">(Jan 24 2023 at 23:46)</a>:</h4>
<p>It's a core lean issue. Maybe <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> has some ideas?</p>



<a name="323376367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Order.Hom.Lattice/near/323376367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Order.2EHom.2ELattice.html#323376367">(Jan 24 2023 at 23:48)</a>:</h4>
<p>I didn't look through the whole thread yet.  Does using <code>{}</code> instead of <code>[]</code> on the out-params help?  Note that <code>SupHomClass</code> should not be an outparam.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>