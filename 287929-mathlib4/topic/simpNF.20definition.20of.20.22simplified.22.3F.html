---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html">simpNF definition of "simplified"?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="321247174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321247174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321247174">(Jan 13 2023 at 20:04)</a>:</h4>
<p>I'm getting the message for <a href="https://github.com/leanprover-community/mathlib4/pull/1517">mathlib4#1517</a></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Encodable.encode_true</span> <span class="c">/-</span><span class="cm"> Left-hand side simplifies from</span>
<span class="cm">  Encodable.encode true</span>
<span class="cm">to</span>
<span class="cm">  Encodable.encode (↑Equiv.boolEquivPUnitSumPUnit true)</span>
<span class="cm">using</span>
<span class="cm">  simp only [@Encodable.encode_ofEquiv]</span>
<span class="cm">Try to change the left-hand side to the simplified term!</span>
</code></pre></div>
<p>I assume I want to <code>nolint</code> this one (and the equivalent for <code>false</code>)</p>



<a name="321248640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321248640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321248640">(Jan 13 2023 at 20:13)</a>:</h4>
<p>No, because the linter has a valid complaint.</p>



<a name="321248726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321248726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321248726">(Jan 13 2023 at 20:13)</a>:</h4>
<p>In this case, please copy the lemma, and call it <code>encode_true'</code>. Mark that copy as <code>@[simp]</code> and remove <code>@[simp]</code> from the original.<br>
In the copy, turn the LHS into what the linter suggests.</p>



<a name="321248861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321248861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321248861">(Jan 13 2023 at 20:14)</a>:</h4>
<p>Ooh, wait. These are <code>rfl</code>-lemmas. So the <code>dsimp</code> test applies.</p>



<a name="321249182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321249182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321249182">(Jan 13 2023 at 20:16)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=boolEquivPUnitSumPUnit#doc">docs4#boolEquivPUnitSumPUnit</a></p>



<a name="321249254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321249254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321249254">(Jan 13 2023 at 20:17)</a>:</h4>
<p>Huh? The docs seem broken.</p>



<a name="321249320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321249320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321249320">(Jan 13 2023 at 20:17)</a>:</h4>
<p>Anyway, it looks like maybe that equiv should have simp lemmas.</p>



<a name="321249638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321249638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321249638">(Jan 13 2023 at 20:19)</a>:</h4>
<p>I guess my issue here is thinking that <code>↑Equiv.boolEquivPUnitSumPUnit true</code> is simpler than <code>true</code></p>



<a name="321249782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321249782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321249782">(Jan 13 2023 at 20:20)</a>:</h4>
<p>Well, it can become simpler.</p>



<a name="321249819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321249819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321249819">(Jan 13 2023 at 20:20)</a>:</h4>
<p>There should be a simp-lemma for that expression.</p>



<a name="321249850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321249850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321249850">(Jan 13 2023 at 20:21)</a>:</h4>
<p>Where is that equiv defined?</p>



<a name="321249861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321249861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321249861">(Jan 13 2023 at 20:21)</a>:</h4>
<p>mathlib or core?</p>



<a name="321250398"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321250398" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321250398">(Jan 13 2023 at 20:24)</a>:</h4>
<p><code>Mathlib.Logic.Equiv.Basic</code></p>
<p>But then again, if I try what <code>simpNF</code> suggests, I get:</p>
<p><code>invalid coercion notation, expected type is not known</code></p>



<a name="321250928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321250928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321250928">(Jan 13 2023 at 20:28)</a>:</h4>
<p>Can you write <code>attribute [simps] Equiv.boolEquivPUnitSumPUnit</code> just above that <code>encode_true</code> lemma?</p>



<a name="321251124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321251124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321251124">(Jan 13 2023 at 20:29)</a>:</h4>
<p>Nope -- declaration is in an imported module.</p>



<a name="321260426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321260426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321260426">(Jan 13 2023 at 21:27)</a>:</h4>
<p>Ooof, Lean4 is so strict about these things <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="321267025"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321267025" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321267025">(Jan 13 2023 at 22:09)</a>:</h4>
<p>(<a href="https://github.com/leanprover-community/mathlib4/pull/1517">mathlib4#1517</a> since the link above is broken)</p>



<a name="321267267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321267267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321267267">(Jan 13 2023 at 22:10)</a>:</h4>
<p><code>Encodable.encode_ofEquiv</code> (<a href="https://leanprover-community.github.io/mathlib_docs/find/encodable.encode_of_equiv">docs#encodable.encode_of_equiv</a>) feels like a bad simp lemma to me</p>



<a name="321267285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321267285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321267285">(Jan 13 2023 at 22:11)</a>:</h4>
<p>Unfolding instances is a pretty weird things to do</p>



<a name="321273486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321273486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321273486">(Jan 13 2023 at 22:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F/near/321267025">said</a>:</p>
<blockquote>
<p>(<a href="https://github.com/leanprover-community/mathlib4/pull/1517">mathlib4#1517</a> since the link above is broken)</p>
</blockquote>
<p>Oops, fixed.</p>



<a name="321282702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321282702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321282702">(Jan 14 2023 at 00:20)</a>:</h4>
<p>Removed, should put PR back to green.</p>



<a name="321282831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321282831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321282831">(Jan 14 2023 at 00:22)</a>:</h4>
<p>Sadly we won't spell <code>true</code> as <code>inr</code> (or the reverse?).</p>



<a name="321319447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321319447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321319447">(Jan 14 2023 at 09:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F/near/321267285">said</a>:</p>
<blockquote>
<p>Unfolding instances is a pretty weird things to do</p>
</blockquote>
<p>Thinking again, can this be resolved by putting a <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=noindex#doc">docs4#noindex</a> around the instance argument after the @? Would that prevent unification and force syntactic matching?</p>



<a name="321322183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321322183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321322183">(Jan 14 2023 at 09:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F/near/321319447">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F/near/321267285">said</a>:</p>
<blockquote>
<p>Unfolding instances is a pretty weird things to do</p>
</blockquote>
<p>Thinking again, can this be resolved by putting a <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=noindex#doc">docs4#noindex</a> around the instance argument after the @? Would that prevent unification and force syntactic matching?</p>
</blockquote>
<p>It's the opposite - <code>noindex</code> will make it ignore the syntactic matching by replacing it with a metavariable, and then use unification to ensure that the instance applies. (That is, you can use <code>noindex</code> to make instances that match up to semireducible defeq, rather than simply reducible/instance defeq.)</p>



<a name="321330803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simpNF%20definition%20of%20%22simplified%22%3F/near/321330803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simpNF.20definition.20of.20.22simplified.22.3F.html#321330803">(Jan 14 2023 at 10:37)</a>:</h4>
<p>Is there any way to make this lemma only match syntactically and not via unification? I realize this is sort of a special case and that unification is the right thing to do for typeclass arguments most of the time</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>