---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/simp.20can.20prove.20it.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html">simp can prove it</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="318896466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/318896466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#318896466">(Jan 01 2023 at 19:10)</a>:</h4>
<p>Did the "simp can prove it" linter not exist in mathlib 3?</p>



<a name="318896602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/318896602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#318896602">(Jan 01 2023 at 19:12)</a>:</h4>
<p>It existed in a weaker form in mathlib3 for things tagged <code>@[simp]</code></p>



<a name="318896616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/318896616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#318896616">(Jan 01 2023 at 19:12)</a>:</h4>
<p>"simp can prove it" isn't a sufficient condition to make a simp lemma unecessary</p>



<a name="318896698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/318896698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#318896698">(Jan 01 2023 at 19:14)</a>:</h4>
<p>Then why is there a linter for that in mathlib4?</p>



<a name="318896799"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/318896799" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#318896799">(Jan 01 2023 at 19:14)</a>:</h4>
<p>Maybe simp is clever enough that it now is sufficient?</p>



<a name="318896833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/318896833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#318896833">(Jan 01 2023 at 19:15)</a>:</h4>
<p>The case I had in mind is <a href="https://leanprover-community.github.io/mathlib_docs/find/submodule.coe_zero">docs#submodule.coe_zero</a> vs <a href="https://leanprover-community.github.io/mathlib_docs/find/submodule.coe_eq_zero">docs#submodule.coe_eq_zero</a></p>



<a name="318896932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/318896932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#318896932">(Jan 01 2023 at 19:16)</a>:</h4>
<p>Simp can obviously prove the former with the latter</p>



<a name="318897064"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/318897064" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#318897064">(Jan 01 2023 at 19:18)</a>:</h4>
<p>But the former is needed to simplify <code>f ↑0 = f 0</code>, unless simp now knows to use <code>coe_eq_zero.mpr rfl</code></p>



<a name="318897744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/318897744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#318897744">(Jan 01 2023 at 19:26)</a>:</h4>
<p>OK, I will just assume that whatever the linter says is correct</p>



<a name="318897766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/318897766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#318897766">(Jan 01 2023 at 19:26)</a>:</h4>
<p>and that it might differ from lean 3 for no reason</p>



<a name="319412259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319412259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319412259">(Jan 04 2023 at 15:25)</a>:</h4>
<p>It seems like the Lean 3 linter doesn't always work correctly, e.g., simp can prove <code>list.reverse_singleton</code> (and there is no <code>nolints.txt</code> entry for it)</p>



<a name="319423361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319423361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319423361">(Jan 04 2023 at 16:22)</a>:</h4>
<p>I also wonder about the wisdom of this linter in general? e.g. it fails on</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">theorem</span> <span class="n">indexOf_nil</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">indexOf</span> <span class="n">a</span> <span class="o">[]</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>
<p>with the message</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="bp">@</span><span class="n">List.indexOf_nil</span> <span class="c">/-</span><span class="cm"> simp can prove this:</span>
<span class="cm">  by simp only [List.find?, List.not_mem_nil, not_false_iff, List.indexOf_of_not_mem, List.length_nil]</span>
</code></pre></div>
<p>But isn't it better to do 1 simp step than 5?</p>



<a name="319423400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319423400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319423400">(Jan 04 2023 at 16:22)</a>:</h4>
<p>I came across an interesting false positive for this linter today. <code>simp</code> can prove the lemma <code>x + x = x</code> in <code>Algebra.Tropical.Basic</code> but only by rewriting it using the lemma <code>x + y = x ↔ x ≤ y</code>, so the lemma is still required to prove <code>f (x + x) = f x</code> for example.</p>



<a name="319423776"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319423776" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319423776">(Jan 04 2023 at 16:23)</a>:</h4>
<p>btw, when the proof is <code>rfl</code>, doesn't <code>@[simp]</code> also affect the behavior of <code>dsimp</code>? But <code>dsimp</code> can't prove it</p>



<a name="319423923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319423923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319423923">(Jan 04 2023 at 16:24)</a>:</h4>
<p>I mean I guess it could be the case that all 5 of those lemmas are definitional equalities, but say they aren't</p>



<a name="319424450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319424450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319424450">(Jan 04 2023 at 16:26)</a>:</h4>
<p>I guess that's good evidence that the "simp can prove it" linter should be less strictly enforced. At least in its current state.</p>



<a name="319424863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319424863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319424863">(Jan 04 2023 at 16:28)</a>:</h4>
<p>As I mentioned to Johan earlier, it's also nice from a modularity perspective to be able to declare that e.g. <code>indexOf_nil</code> should be proven by <code>simp</code>, and not have to delete the attribute and rely on it being proven by a jenga tower of 5 other simp lemmas</p>



<a name="319425225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319425225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319425225">(Jan 04 2023 at 16:30)</a>:</h4>
<p>At the moment I'm going through Data.List.Basic and leaving a commented-out <code>-- @[simp]</code> to lemmas affected by this, since I'm not convinced that just removing the attribute is sensible</p>



<a name="319425245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319425245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319425245">(Jan 04 2023 at 16:30)</a>:</h4>
<p>Of course we could also nolint these.</p>



<a name="319426802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319426802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastien Gouezel <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319426802">(Jan 04 2023 at 16:39)</a>:</h4>
<p>Suppose that you put the simp attribute on <code>indexOf_nil</code>. In concrete situations where this lemma could be used by simp, will it fire or will the other lemmas (that were used to prove <code>indexOf_nil</code>) fire before? In the latter situation, there is indeed no use for the simp attribute on  <code>indexOf_nil</code>, because it will never be used.</p>



<a name="319426962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319426962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319426962">(Jan 04 2023 at 16:40)</a>:</h4>
<p>In that specific case, <code>dsimp</code> justifies tagging <code>indexOf_nil</code> already.</p>



<a name="319427009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319427009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319427009">(Jan 04 2023 at 16:40)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20can.20prove.20it/near/319424863">said</a>:</p>
<blockquote>
<p>As I mentioned to Johan earlier, it's also nice from a modularity perspective to be able to declare that e.g. <code>indexOf_nil</code> should be proven by <code>simp</code>, and not have to delete the attribute and rely on it being proven by a jenga tower of 5 other simp lemmas</p>
</blockquote>
<p>Maybe we can make a new attribute <code>simp_can_prove_it</code>, change the <code>simp</code> on these lemmas to <code>simp_can_prove_it</code>, and have a linter which verifies that simp can prove them!</p>



<a name="319427258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319427258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319427258">(Jan 04 2023 at 16:41)</a>:</h4>
<p>In general, it would be good if the simp nf linter was checking whether a refl lemma tagged with <code>simp</code> can be proved by <code>dsimp</code>, instead of merely by <code>simp</code>.</p>



<a name="319427337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319427337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319427337">(Jan 04 2023 at 16:42)</a>:</h4>
<p>That would remove a bunch of nolints from mathlib.</p>



<a name="319427384"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319427384" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319427384">(Jan 04 2023 at 16:42)</a>:</h4>
<p>/me votes for <code>simpCanProveItThankYouVeryMuch</code></p>



<a name="319427577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319427577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319427577">(Jan 04 2023 at 16:43)</a>:</h4>
<p>Ah, but maybe the linter can't access the information of whether a declaration is tagged with the <code>_refl_</code> attribute (or whichever one we use in mathlib)</p>



<a name="319427716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319427716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319427716">(Jan 04 2023 at 16:44)</a>:</h4>
<p>This lack of attribute inspection is a real problem <span aria-label="frown" class="emoji emoji-1f641" role="img" title="frown">:frown:</span></p>



<a name="319428054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319428054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319428054">(Jan 04 2023 at 16:46)</a>:</h4>
<p>But it can find all decls tagged with a given attribute, right? That's all you need in this case.</p>



<a name="319428069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319428069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319428069">(Jan 04 2023 at 16:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20can.20prove.20it/near/319426962">said</a>:</p>
<blockquote>
<p>In that specific case, <code>dsimp</code> justifies tagging <code>indexOf_nil</code> already.</p>
</blockquote>
<p>And even if this was not the case, there is a declarative purpose even if there is no functional effect (lots of stuff we do is useless, after all).</p>



<a name="319428152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319428152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319428152">(Jan 04 2023 at 16:46)</a>:</h4>
<p>Very profound. I must review my life choices.</p>



<a name="319428229"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319428229" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319428229">(Jan 04 2023 at 16:47)</a>:</h4>
<p>Done for now; there are 4 more linter errors (the weird ones involving simp lemmas not simplifying themselves, and the private simp lemma one).</p>



<a name="319428393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319428393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319428393">(Jan 04 2023 at 16:48)</a>:</h4>
<p>Are the "not simplifying themselves" cases due to timeouts? Or some other reason?</p>



<a name="319428783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319428783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319428783">(Jan 04 2023 at 16:50)</a>:</h4>
<p>I don't think that was the reason. They looked sort of complicated</p>



<a name="319428820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319428820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319428820">(Jan 04 2023 at 16:50)</a>:</h4>
<p>one had an argument with a default value involving a tactic and stuff</p>



<a name="319433176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319433176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319433176">(Jan 04 2023 at 17:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110044">Chris Hughes</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20can.20prove.20it/near/319423400">said</a>:</p>
<blockquote>
<p>I came across an interesting false positive for this linter today. <code>simp</code> can prove the lemma <code>x + x = x</code> in <code>Algebra.Tropical.Basic</code> but only by rewriting it using the lemma <code>x + y = x ↔ x ≤ y</code>, so the lemma is still required to prove <code>f (x + x) = f x</code> for example.</p>
</blockquote>
<p>The mathlib 3 linter is written in a way that allows this; it instead asks simp to simplify the LHS of the relation, and only complains if the result is the RHS. Crucially, it doesn't give the lemma the LHS and RHS at the same time, which is necessary for your example</p>



<a name="319434755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319434755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319434755">(Jan 04 2023 at 17:22)</a>:</h4>
<p>Oh I think this probably explains some of the other cases I found where "simp could prove it" in Lean 4 but not Lean 3.</p>



<a name="319467584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319467584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319467584">(Jan 04 2023 at 20:28)</a>:</h4>
<p>Have people been throwing away <code>@[simp]</code> too often during the port, because of this linter nagging?</p>



<a name="319474938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319474938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319474938">(Jan 04 2023 at 21:17)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110044">Chris Hughes</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20can.20prove.20it/near/319423400">said</a>:</p>
<blockquote>
<p>I came across an interesting false positive for this linter today. <code>simp</code> can prove the lemma <code>x + x = x</code> in <code>Algebra.Tropical.Basic</code> but only by rewriting it using the lemma <code>x + y = x ↔ x ≤ y</code>, so the lemma is still required to prove <code>f (x + x) = f x</code> for example.</p>
</blockquote>
<p>This is not at all what's happening here.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="bp">@</span><span class="n">add_self</span> <span class="c">/-</span><span class="cm"> simp can prove this:</span>
<span class="cm">  by simp only [le_refl, Tropical.add_eq_left] -/</span>
</code></pre></div>
<p>And <code>add_eq_left</code> is the conditional simp lemma <code>x ≤ y → x + y = x</code>.  The <code>le_refl</code> is only used to discharge the hypothesis.  So this will also work in <code>f (x + x)</code>.</p>



<a name="319475059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319475059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319475059">(Jan 04 2023 at 21:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20can.20prove.20it/near/319433176">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110044">Chris Hughes</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20can.20prove.20it/near/319423400">said</a>:</p>
<blockquote>
<p>I came across an interesting false positive for this linter today. <code>simp</code> can prove the lemma <code>x + x = x</code> in <code>Algebra.Tropical.Basic</code> but only by rewriting it using the lemma <code>x + y = x ↔ x ≤ y</code>, so the lemma is still required to prove <code>f (x + x) = f x</code> for example.</p>
</blockquote>
<p>The mathlib 3 linter is written in a way that allows this; it instead asks simp to simplify the LHS of the relation, and only complains if the result is the RHS. Crucially, it doesn't give the lemma the LHS and RHS at the same time, which is necessary for your example</p>
</blockquote>
<p>The mathlib 4 linter too.  (Well technically it's the std4 linter now. <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span>)</p>



<a name="319569041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319569041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319569041">(Jan 05 2023 at 11:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20can.20prove.20it/near/319474938">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110044">Chris Hughes</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20can.20prove.20it/near/319423400">said</a>:</p>
<blockquote>
<p>I came across an interesting false positive for this linter today. <code>simp</code> can prove the lemma <code>x + x = x</code> in <code>Algebra.Tropical.Basic</code> but only by rewriting it using the lemma <code>x + y = x ↔ x ≤ y</code>, so the lemma is still required to prove <code>f (x + x) = f x</code> for example.</p>
</blockquote>
<p>This is not at all what's happening here.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="bp">@</span><span class="n">add_self</span> <span class="c">/-</span><span class="cm"> simp can prove this:</span>
<span class="cm">  by simp only [le_refl, Tropical.add_eq_left] -/</span>
</code></pre></div>
<p>And <code>add_eq_left</code> is the conditional simp lemma <code>x ≤ y → x + y = x</code>.  The <code>le_refl</code> is only used to discharge the hypothesis.  So this will also work in <code>f (x + x)</code>.</p>
</blockquote>
<p>I've seen a lot where <code>simp</code> proves it with these conditional lemmas. Is there any significant performance penalty to using a lot of these conditional lemmas to prove things instead of unconditional lemmas?</p>



<a name="319634337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319634337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319634337">(Jan 05 2023 at 17:27)</a>:</h4>
<p>This also comes up in <a href="https://github.com/leanprover-community/mathlib4/pull/1307">mathlib4#1307</a>  -- "simp can prove this" linter errors in lemmas which are tagged <code>simp</code> in mathlib3 and either the mathlib3 linter missed them or some unfolding is being done more eagerly. What are we doing here? Just removing the <code>@[simp]</code> tag and blundering on?</p>



<a name="319635239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319635239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319635239">(Jan 05 2023 at 17:31)</a>:</h4>
<p><span aria-label="ping pong" class="emoji emoji-1f3d3" role="img" title="ping pong">:ping_pong:</span><br>
<span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/287929-mathlib4/topic/simp.20can.20prove.20it/near/319427009">said</a>:</p>
<blockquote>
<p>Maybe we can make a new attribute <code>simp_can_prove_it</code>, change the <code>simp</code> on these lemmas to <code>simp_can_prove_it</code>, and have a linter which verifies that simp can prove them!</p>
</blockquote>
<p>This idea was kind of a joke but it might also be useful; it would serve a similar purpose to <code>assert_not_exists</code>.</p>



<a name="319635507"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319635507" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319635507">(Jan 05 2023 at 17:32)</a>:</h4>
<p>For now, I think we should at least add a porting note.  But it shouldn't be hard to invent a dummy attribute <code>simp_can_prove_it</code> and replace bad <code>simp</code> tags with that, even if we don't immediately write any meta code associated to the new attribute.</p>



<a name="319636284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319636284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319636284">(Jan 05 2023 at 17:36)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> At the very least, please leave a trace: <code>-- @[simp] -- Porting note: simp can prove this</code>.</p>



<a name="319636477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319636477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319636477">(Jan 05 2023 at 17:37)</a>:</h4>
<p>But typically, it seems that you should investigate why simp can suddenly prove this. In <code>Data.List.Basic</code> it was often because of a quasi-dubious simp lemma in Std.</p>



<a name="319639567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/simp%20can%20prove%20it/near/319639567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/simp.20can.20prove.20it.html#319639567">(Jan 05 2023 at 17:53)</a>:</h4>
<p>Right -- that was what I suggested in the PR.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>