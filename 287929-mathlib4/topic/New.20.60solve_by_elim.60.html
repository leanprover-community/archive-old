---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html">New `solve_by_elim`</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="320288690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/320288690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#320288690">(Jan 09 2023 at 17:54)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I was experimenting with the refactored <code>solve_by_elim</code>, particularly with the new functionality to throw in <code>symm</code>s of hypotheses.  I expected the following to work; can you tell me if I am doing something wrong?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Data.Int.ModEq</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≡</span> <span class="mi">2</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="mi">4</span><span class="o">])</span> <span class="o">:</span> <span class="mi">2</span> <span class="bp">≡</span> <span class="n">a</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="mi">4</span><span class="o">]</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">apply_rules</span> <span class="n">only</span> <span class="o">[</span><span class="n">ha</span><span class="o">]</span> <span class="c1">-- doesn't resolve the goal</span>
</code></pre></div>
<p>The goal state after this is</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>a : ℤ
ha : a ≡ 2 [ZMOD 4]
ha_symm : 2 ≡ a [ZMOD 4]
⊢ 2 ≡ a [ZMOD 4]
</code></pre></div>
<p>so at least it correctly formed the <code>symm</code> of <code>ha</code>.</p>



<a name="320290164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/320290164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#320290164">(Jan 09 2023 at 18:01)</a>:</h4>
<p>I'm also curious why this one doesn't work: </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Data.Int.ModEq</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≡</span> <span class="mi">2</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="mi">4</span><span class="o">])</span> <span class="o">:</span>
    <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">≡</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="mi">4</span><span class="o">]</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">apply_rules</span> <span class="n">only</span> <span class="o">[</span><span class="n">ha</span><span class="o">,</span> <span class="n">Int.ModEq.add</span><span class="o">,</span> <span class="n">Int.ModEq.mul</span><span class="o">,</span>
    <span class="n">Int.ModEq.pow</span><span class="o">,</span> <span class="n">Int.ModEq.rfl</span><span class="o">]</span> <span class="c1">-- doesn't resolve the goal</span>
</code></pre></div>
<p>After it runs there is one goal left which ought to be doable by <code>Int.ModEq.rfl</code>:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>a b : ℤ
ha : a ≡ 2 [ZMOD 4]
ha_symm : 2 ≡ a [ZMOD 4]
⊢ b ≡ b [ZMOD 4]
</code></pre></div>
<p>and it's strange because presumably it already resolved another <code>b ≡ b [ZMOD 4]</code> goal.</p>



<a name="320326015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/320326015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#320326015">(Jan 09 2023 at 20:35)</a>:</h4>
<p>The first one is presumably a bug/feature that <code>only</code> doesn't pick up the <code>symm</code> version of that named lemma. I'll have to think about how to allow that.</p>



<a name="320327187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/320327187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#320327187">(Jan 09 2023 at 20:42)</a>:</h4>
<p>If it would be easier, we could have the syntax <code>apply_rules only [←ha]</code></p>



<a name="321532956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321532956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321532956">(Jan 15 2023 at 21:26)</a>:</h4>
<p><code>apply_rules only [←ha]</code> seems a bit superfluous given <code>apply_rules only [ha.symm]</code> works.</p>



<a name="321532999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321532999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321532999">(Jan 15 2023 at 21:27)</a>:</h4>
<p>I can change the behaviour of <code>only</code> so it automatically includes all the symmetric versions, but then I worry someone will want <code>only only</code>.</p>



<a name="321533561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321533561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321533561">(Jan 15 2023 at 21:34)</a>:</h4>
<p>Regarding the second example,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≡</span> <span class="mi">2</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="mi">4</span><span class="o">])</span> <span class="o">:</span>
    <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">≡</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="mi">4</span><span class="o">]</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">apply_rules</span> <span class="o">(</span><span class="n">config</span> <span class="o">:=</span> <span class="o">{</span><span class="n">maxDepth</span> <span class="o">:=</span> <span class="mi">13</span><span class="o">})</span> <span class="n">only</span> <span class="o">[</span><span class="n">ha</span><span class="o">,</span> <span class="n">Int.ModEq.add</span><span class="o">,</span> <span class="n">Int.ModEq.mul</span><span class="o">,</span>
    <span class="n">Int.ModEq.pow</span><span class="o">,</span> <span class="n">Int.ModEq.rfl</span><span class="o">]</span>
</code></pre></div>
<p>suffices.</p>



<a name="321533575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321533575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321533575">(Jan 15 2023 at 21:34)</a>:</h4>
<p>We should probably increase the default maxDepth for <code>apply_rules</code>.</p>



<a name="321533605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321533605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321533605">(Jan 15 2023 at 21:34)</a>:</h4>
<p>Reordering the lemmas as</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">ha</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≡</span> <span class="mi">2</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="mi">4</span><span class="o">])</span> <span class="o">:</span>
    <span class="n">a</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="n">a</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">≡</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">^</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">b</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="mi">4</span><span class="o">]</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">apply_rules</span> <span class="n">only</span> <span class="o">[</span><span class="n">ha</span><span class="o">,</span> <span class="n">Int.ModEq.rfl</span><span class="o">,</span> <span class="n">Int.ModEq.add</span><span class="o">,</span> <span class="n">Int.ModEq.mul</span><span class="o">,</span>
    <span class="n">Int.ModEq.pow</span><span class="o">]</span>
</code></pre></div>
<p>also works.</p>



<a name="321533650"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321533650" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321533650">(Jan 15 2023 at 21:35)</a>:</h4>
<p>i.e. so it tries <code>rfl</code> on things before decomposing products and powers that match to begin with. I'm not sure if there is a sensible way to make these tactics try to find better orderings themselves. That's probably out of scope for now.</p>



<a name="321534781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321534781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321534781">(Jan 15 2023 at 21:50)</a>:</h4>
<p>Is there a reason to have a maxDepth for <code>apply_rules</code> at all?  It seems like with a sensible rule set (no <code>symm</code>s) there's no way it would loop.</p>



<a name="321539018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321539018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321539018">(Jan 15 2023 at 22:52)</a>:</h4>
<p>Actually, given that we already have the <code>config := { symm := false }</code> option, maybe <code>apply_rules only [ha]</code> could reasonably use <code>ha.symm</code> as well, and you have to write <code>apply_rules (config := {symm := false}) only [ha]</code> for the <code>only only</code> behaviour!</p>



<a name="321539119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321539119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321539119">(Jan 15 2023 at 22:54)</a>:</h4>
<p>It would be nice if we could have different defaults: default to <code>symm := true</code> normally, but default to <code>symm := false</code> when called with <code>only</code>. Then users could call <code>apply_rules (config := { symm := true }) only [ha]</code> if they wanted the "weird" behaviour of <code>only</code> + <code>symm</code>.</p>



<a name="321540107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321540107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321540107">(Jan 15 2023 at 23:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60/near/321534781">said</a>:</p>
<blockquote>
<p>Is there a reason to have a maxDepth for <code>apply_rules</code> at all?  It seems like with a sensible rule set (no <code>symm</code>s) there's no way it would loop.</p>
</blockquote>
<p>Well, at some point we need a maxDepth, if only for implementation reasons. <a href="https://github.com/leanprover-community/mathlib/pull/1580">mathlib#1580</a> changes the default to 50. <span class="user-mention" data-user-id="260507">@Heather Macbeth</span>, feel free to merge as is or change the default to anything else that suits you.</p>



<a name="321541889"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321541889" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321541889">(Jan 15 2023 at 23:43)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/1580">mathlib4#1580</a></p>



<a name="321542953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321542953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321542953">(Jan 16 2023 at 00:02)</a>:</h4>
<p>From the <a href="https://github.com/leanprover-community/mathlib4/blob/3fd37757e9ae496854956fb2d0aec463d7e7d5a5/Mathlib/Tactic/SolveByElim.lean#L414"><code>solve_by_elim</code> source</a>:</p>
<blockquote>
<p>(In mathlib3 we could also pass attributes, and all declarations with that attribute were included.  This has not been implemented here.)</p>
</blockquote>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Would it be difficult to implement that functionality?  It was very convenient in mathlib3.</p>
<p>To <a href="https://en.wikipedia.org/wiki/XY_problem">#xy</a> a bit, a typical use case for me would be to implement a tactic</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">mod_rw</span> <span class="o">[</span><span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">]</span>
</code></pre></div>
<p>which is a wrapper for</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">apply_rules</span> <span class="n">only</span> <span class="o">[</span><span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">]</span> <span class="n">using</span> <span class="n">mod_rules</span>
</code></pre></div>
<p>where <code>mod_rules</code> is an attribute which I have tagged <code>Int.ModEq.add</code>, <code>Int.ModEq.mul</code>, <code>Int.ModEq.pow</code> ... with.  I'm not sure how to do this without the attribute functionality.</p>



<a name="321543598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321543598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321543598">(Jan 16 2023 at 00:11)</a>:</h4>
<p>It's the usual problem, that there isn't a "standard" for looking up everything with an attribute. Presumably it would suffice if this worked with something created via <code>register_simp_attr</code>?</p>



<a name="321543683"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321543683" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321543683">(Jan 16 2023 at 00:12)</a>:</h4>
<p>(Or alternatively some relative of this, like <code>register_apply_attr</code> that we make up? It would also potentially be useful for aesop.)</p>



<a name="321543984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321543984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321543984">(Jan 16 2023 at 00:16)</a>:</h4>
<p>I don't think the lemmas I will be tagging are technically suitable as simp-lemmas.  But I'm happy to "abuse" the functionality in this way if it will work.</p>



<a name="321544046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321544046" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321544046">(Jan 16 2023 at 00:17)</a>:</h4>
<p>Actually, can we just re-use the <code>declare_aesop_rule_sets [mod_rules]</code> functionality?</p>



<a name="321544217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321544217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321544217">(Jan 16 2023 at 00:19)</a>:</h4>
<p>Presumably that sets up an attribute which has most of the code needed already written.</p>



<a name="321546534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321546534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321546534">(Jan 16 2023 at 00:48)</a>:</h4>
<p>aesop rule sets are much more complicated</p>



<a name="321549781"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321549781" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321549781">(Jan 16 2023 at 01:31)</a>:</h4>
<p>Do you have any ideas for a hack that could make my desired syntax</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">mod_rw</span> <span class="o">[</span><span class="n">h1</span><span class="o">,</span> <span class="n">h2</span><span class="o">]</span>
</code></pre></div>
<p>work without the attribute functionality?  Some kind of mini-tactic that</p>
<ul>
<li>appends a hard-coded list of lemmas to [h1, h2]</li>
<li>runs <code>apply_rules only</code> on the resulting list</li>
</ul>
<p>?</p>



<a name="321551404"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321551404" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321551404">(Jan 16 2023 at 01:57)</a>:</h4>
<p>I'm writing <code>register_tag_attr</code>, for attributes which have no function except being able to look up everything so tagged.</p>



<a name="321552632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321552632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321552632">(Jan 16 2023 at 02:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60/near/321533605">said</a>:</p>
<blockquote>
<p>Reordering the lemmas also works.</p>
</blockquote>
<p>By the way, when it comes to using <code>register_tag_attr</code> in <code>apply_rules</code>, it sounds like there will be a question of the relative priority of attribute-tagged lemmas vs lemmas listed individually by the user -- the tactic tries the lemmas in a fixed order, only trying a given lemma if all the previous lemmas failed.</p>
<p>In my own use cases it is better that the attribute-tagged lemmas be given lower priority than the individually-listed lemmas.  In fact I am going to be bold and claim that this is better in most use cases.</p>



<a name="321555084"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321555084" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321555084">(Jan 16 2023 at 03:01)</a>:</h4>
<p>Happily, this is what I implemented before reading this message. :-)</p>



<a name="321555095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321555095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321555095">(Jan 16 2023 at 03:01)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/1581">mathlib4#1581</a></p>



<a name="321555378"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321555378" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321555378">(Jan 16 2023 at 03:05)</a>:</h4>
<p><span class="user-mention" data-user-id="260507">@Heather Macbeth</span>, there's a very simple test case</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[dummy_tag_attr]</span> <span class="kd">axiom</span> <span class="n">foo</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">2</span>

<span class="kd">example</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">2</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">fail_if_success</span> <span class="n">solve_by_elim</span>
  <span class="n">solve_by_elim</span> <span class="n">using</span> <span class="n">dummy_tag_attr</span>
</code></pre></div>
<p>but I haven't tested it any beyond that. Please let me know how it goes. :-)</p>



<a name="321584684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321584684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321584684">(Jan 16 2023 at 08:28)</a>:</h4>
<p>As far as I can tell, the attribute setup is working correctly.  Thank you <span class="user-mention" data-user-id="110087">@Scott Morrison</span>!</p>
<p>I did discover a separate weird behaviour, which I suspect might be because the mathlib3 option for a transparency setting is not implemented yet.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Init.Data.Int.Basic</span>
<span class="kn">import</span> <span class="n">Mathlib.Tactic.SolveByElim</span>

<span class="kd">def</span> <span class="n">Int.ModEq</span> <span class="o">(</span><span class="n">n</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:=</span> <span class="n">a</span> <span class="bp">%</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">%</span> <span class="n">n</span>

<span class="kd">notation</span><span class="o">:</span><span class="mi">50</span> <span class="n">a</span> <span class="s2">" ≡ "</span> <span class="n">b</span> <span class="s2">" [ZMOD "</span> <span class="n">n</span> <span class="s2">"]"</span> <span class="bp">=&gt;</span> <span class="n">Int.ModEq</span> <span class="n">n</span> <span class="n">a</span> <span class="n">b</span>

<span class="kd">theorem</span> <span class="n">Int.ModEq.add</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≡</span> <span class="n">b</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="n">n</span><span class="o">])</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">≡</span> <span class="n">d</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="n">n</span><span class="o">])</span> <span class="o">:</span>
    <span class="n">a</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">≡</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">d</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="n">n</span><span class="o">]</span> <span class="o">:=</span>
  <span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">≡</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">a</span> <span class="o">[</span><span class="n">ZMOD</span> <span class="mi">4</span><span class="o">]</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">apply_rules</span> <span class="o">[</span><span class="n">Int.ModEq.add</span><span class="o">]</span>
</code></pre></div>



<a name="321584709"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321584709" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321584709">(Jan 16 2023 at 08:28)</a>:</h4>
<p><a href="https://leanprover-community.github.io/lean-web-editor/#code=import%20tactic.interactive%0A%0Adef%20Int.ModEq%20%28n%20a%20b%20%3A%20%E2%84%A4%29%20%3A%3D%20a%20%25%20n%20%3D%20b%20%25%20n%0A%0Anotation%20a%20%60%20%E2%89%A1%20%60%3A50%20b%20%60%20%5BZMOD%20%60%3A50%20n%20%60%5D%60%3A0%20%3A%3D%20Int.ModEq%20n%20a%20b%0A%0Avariables%20%7Ba%20b%20c%20d%20n%20%3A%20%E2%84%A4%7D%0A%0Atheorem%20Int.ModEq.add%20%28h%E2%82%81%20%3A%20a%20%E2%89%A1%20b%20%5BZMOD%20n%5D%29%20%28h%E2%82%82%20%3A%20c%20%E2%89%A1%20d%20%5BZMOD%20n%5D%29%20%3A%0A%20%20%20%20a%20%2B%20c%20%E2%89%A1%20b%20%2B%20d%20%5BZMOD%20n%5D%20%3A%3D%0A%20%20sorry%0A%0Aexample%20%7Ba%20b%20%3A%20%E2%84%A4%7D%20%3A%20a%20%2B%20b%20%E2%89%A1%20a%20%2B%20a%20%5BZMOD%204%5D%20%3A%3D%0Abegin%0A%20%20apply_rules%20%5BInt.ModEq.add%5D%2C%0A%0Aend%0A">In mathlib3</a>,  <code>apply_rules</code> does what I want here, which is to leave the following goal state:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>2 goals
a b : ℤ
⊢ a ≡ a [ZMOD 4]

a b : ℤ
⊢ b ≡ a [ZMOD 4]
</code></pre></div>
<p>In the mathlib4 implementation the goal state after the <code>apply_rules</code> is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span>
<span class="bp">⊢</span> <span class="n">HAdd.hAdd</span> <span class="bp">=</span> <span class="k">fun</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span><span class="o">}</span> <span class="bp">=&gt;</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">a</span>
</code></pre></div>
<p>However, if I mark <code>def Int.ModEq</code> as <code>@[irreducible]</code>, then I get back the mathlib3 behaviour.  So I'm guessing that if <code>apply_rules { md := reducible }</code> were implemented then the mathlib4 version would do what I want.</p>



<a name="321584973"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321584973" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321584973">(Jan 16 2023 at 08:30)</a>:</h4>
<p>(In the mathlib3 <code>apply_rules</code> I always set <code>{ md := reducible }</code>.)</p>



<a name="321586469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321586469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321586469">(Jan 16 2023 at 08:40)</a>:</h4>
<p>Hmm, actually it can't just be transparency level, because the discrepancy in behaviour persists even without any definitions or notations.  Compare mathlib4</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Init.Data.Int.Basic</span>
<span class="kn">import</span> <span class="n">Mathlib.Tactic.SolveByElim</span>

<span class="kd">variable</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span>

<span class="kd">theorem</span> <span class="n">Int.ModEq.add</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">%</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">%</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">%</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">d</span> <span class="bp">%</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
    <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">c</span><span class="o">)</span> <span class="bp">%</span> <span class="n">n</span> <span class="bp">=</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="n">d</span><span class="o">)</span> <span class="bp">%</span> <span class="n">n</span> <span class="o">:=</span>
  <span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">%</span> <span class="mi">4</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">a</span><span class="o">)</span> <span class="bp">%</span> <span class="mi">4</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">apply_rules</span> <span class="o">[</span><span class="n">Int.ModEq.add</span><span class="o">]</span>
</code></pre></div>
<p>with mathlib3</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.interactive</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span>

<span class="kd">theorem</span> <span class="n">Int.ModEq.add</span> <span class="o">(</span><span class="n">h₁</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">%</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">b</span> <span class="bp">%</span> <span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">h₂</span> <span class="o">:</span> <span class="n">c</span> <span class="bp">%</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">d</span> <span class="bp">%</span> <span class="n">n</span><span class="o">)</span> <span class="o">:</span>
    <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">c</span><span class="o">)</span> <span class="bp">%</span> <span class="n">n</span> <span class="bp">=</span> <span class="o">(</span><span class="n">b</span> <span class="bp">+</span> <span class="n">d</span><span class="o">)</span> <span class="bp">%</span> <span class="n">n</span> <span class="o">:=</span>
  <span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">%</span> <span class="mi">4</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">a</span><span class="o">)</span> <span class="bp">%</span> <span class="mi">4</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">apply_rules</span> <span class="o">[</span><span class="n">Int.ModEq.add</span><span class="o">],</span>

<span class="kd">end</span>
</code></pre></div>



<a name="321729004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321729004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321729004">(Jan 16 2023 at 22:52)</a>:</h4>
<p>Note that in this example <code>apply_rules [Int.ModEq.add]</code> actually produces a different goal list than <code>apply Int.ModEq.add</code>.</p>



<a name="321733625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321733625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321733625">(Jan 16 2023 at 23:50)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Aha!  I think the change in behaviour is that <code>apply_rules</code> now has the following feature, from being implemented on top of <code>solve_by_elim</code>: per the <a href="https://github.com/leanprover-community/mathlib4/blob/65e2763c915d63463bc27d473549e38ddc301f58/Mathlib/Tactic/SolveByElim.lean#L298">source</a>,</p>
<blockquote>
<p><code>mkAssumptionSet</code> builds a collection of lemmas for use in the backtracking search in <code>solve_by_elim</code>.</p>
<ul>
<li>By default, it includes all local hypotheses, along with <code>rfl</code>, <code>trivial</code>, <code>congrFun</code> and <code>congrArg</code>.</li>
</ul>
</blockquote>



<a name="321733631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321733631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321733631">(Jan 16 2023 at 23:50)</a>:</h4>
<p>Indeed, the term proof produced by the version which makes the weird goals</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">%</span> <span class="mi">4</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">a</span><span class="o">)</span> <span class="bp">%</span> <span class="mi">4</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">apply_rules</span> <span class="o">[</span><span class="n">Int.ModEq.add</span><span class="o">]</span>
  <span class="gr">sorry</span>
</code></pre></div>
<p>includes <code>congrFun</code> and <code>congrArg</code>:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>congrFun (congrArg HMod.hMod (congrFun (congrFun (sorryAx (HAdd.hAdd = fun {a b} =&gt; a + a)) a) b)) 4
</code></pre></div>
<p>Whereas with the <code>only</code> flag (which your docs say will omit those default lemmas from the applyset), i.e. running</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">b</span><span class="o">)</span> <span class="bp">%</span> <span class="mi">4</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">+</span> <span class="n">a</span><span class="o">)</span> <span class="bp">%</span> <span class="mi">4</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">apply_rules</span> <span class="n">only</span> <span class="o">[</span><span class="n">Int.ModEq.add</span><span class="o">]</span>
  <span class="bp">.</span> <span class="gr">sorry</span>
  <span class="bp">.</span> <span class="gr">sorry</span>
</code></pre></div>
<p>I get the goals I expected, and the term proof indeed has no <code>congrArg</code> or <code>congrFun</code>:</p>
<div class="codehilite" data-code-language="Text only"><pre><span></span><code>Int.ModEq.add (sorryAx (a % 4 = a % 4)) (sorryAx (b % 4 = a % 4))
</code></pre></div>



<a name="321733733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321733733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321733733">(Jan 16 2023 at 23:53)</a>:</h4>
<p>What would you think about changing the order of the collection of lemmas built by <code>mkAssumptionSet</code>, so that the default lemmas <code>rfl</code>, <code>trivial</code>, <code>congrFun</code> and <code>congrArg</code> are tried last (after lemmas provided by the user, local hypotheses, and lemmas tagged with listed attributes)?  It seems like that would prevent the behaviour I observed here.</p>



<a name="321736787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321736787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321736787">(Jan 17 2023 at 00:33)</a>:</h4>
<p>This change will conflict slightly with <a href="https://github.com/leanprover-community/mathlib4/pull/1581">mathlib4#1581</a> which hasn't been merged yet, so I propose making this change part of that PR.</p>



<a name="321736984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321736984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321736984">(Jan 17 2023 at 00:35)</a>:</h4>
<p>Done.</p>



<a name="321736992"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321736992" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321736992">(Jan 17 2023 at 00:35)</a>:</h4>
<p>Thank you!</p>



<a name="321757050"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321757050" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321757050">(Jan 17 2023 at 05:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60/near/321555378">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span>, there's a very simple test case</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[dummy_tag_attr]</span> <span class="kd">axiom</span> <span class="n">foo</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">2</span>

<span class="kd">example</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">2</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">fail_if_success</span> <span class="n">solve_by_elim</span>
  <span class="n">solve_by_elim</span> <span class="n">using</span> <span class="n">dummy_tag_attr</span>
</code></pre></div>
<p>but I haven't tested it any beyond that. Please let me know how it goes. :-)</p>
</blockquote>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> OK, testing the attribute functionality a little more.  How would I use an attribute in a macro, like the <a href="https://github.com/leanprover-community/mathlib4/blob/875dc09121167f061d9f8974fa511cdaebb3b73e/Mathlib/Tactic/SolveByElim.lean#L538">last line of the <code>apply_rules</code> macro</a>?  I tried writing </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">liftMetaTactic</span> <span class="k">fun</span> <span class="n">g</span> <span class="bp">=&gt;</span> <span class="n">solveByElim.processSyntax</span> <span class="n">cfg</span> <span class="n">true</span> <span class="n">star</span> <span class="n">add</span> <span class="n">remove</span> <span class="bp">#</span><span class="o">[</span><span class="bp">`</span><span class="n">mod_rules</span><span class="o">]</span> <span class="o">[</span><span class="n">g</span><span class="o">]</span>
</code></pre></div>
<p>but it complains that <code>mod_rules</code> is a Name, not an Ident.</p>



<a name="321757066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/321757066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#321757066">(Jan 17 2023 at 05:37)</a>:</h4>
<p>(I can provide the full macro if needed, but it's pretty close to the <code>apply_rules</code> macro except that I want to hard-code a choice of attribute.)</p>



<a name="322411148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/322411148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#322411148">(Jan 20 2023 at 01:06)</a>:</h4>
<p>Was scrolling through old messages and saw this, so it might be resolved by now, but if that's the error, does <code>mkIdent `mod_rules</code> work?</p>



<a name="322411193"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/New%20%60solve_by_elim%60/near/322411193" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/New.20.60solve_by_elim.60.html#322411193">(Jan 20 2023 at 01:06)</a>:</h4>
<p>it does (solved in PMs)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>