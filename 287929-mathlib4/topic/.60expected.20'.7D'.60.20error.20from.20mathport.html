---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html">`expected '}'` error from mathport</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="314672498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%60expected%20%27%7D%27%60%20error%20from%20mathport/near/314672498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html#314672498">(Dec 08 2022 at 13:10)</a>:</h4>
<p>Is the following a problem in mathport's output syntax?   <a href="https://github.com/leanprover-community/mathlib3port/blob/e1c547853a56c1309c8a2fddbb0dfe0789c5e239/Mathbin/Algebra/Order/WithZero.lean#L51">Here</a> mathport outputs something of the following form, which gives the error <code>expected '}'</code> on <code>prop3</code>.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">class1</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">LE</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="kt">Prop</span> <span class="n">where</span>
  <span class="n">prop1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">a</span>

<span class="kd">class</span> <span class="n">class2</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="o">[</span><span class="n">LE</span> <span class="n">α</span><span class="o">]</span> <span class="kd">extends</span> <span class="n">class1</span> <span class="n">α</span> <span class="n">where</span>
  <span class="n">prop2</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">,</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span>
  <span class="n">prop3</span> <span class="o">:</span> <span class="n">true</span>

<span class="kd">instance</span> <span class="n">inst</span> <span class="o">[</span><span class="n">LE</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">class1</span> <span class="n">α</span> <span class="o">:=</span> <span class="gr">sorry</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">LE</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">class2</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">inst</span> <span class="k">with</span> <span class="n">prop2</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
    <span class="n">prop3</span> <span class="o">:=</span> <span class="gr">sorry</span> <span class="o">}</span>
</code></pre></div>
<p>The problem seems to be purely syntactic, since a reformatted final instance gives no errors.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">[</span><span class="n">LE</span> <span class="n">α</span><span class="o">]</span> <span class="o">:</span> <span class="n">class2</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">inst</span> <span class="k">with</span>
    <span class="n">prop2</span> <span class="o">:=</span> <span class="gr">sorry</span><span class="o">,</span>
    <span class="n">prop3</span> <span class="o">:=</span> <span class="gr">sorry</span> <span class="o">}</span>
</code></pre></div>



<a name="314672750"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%60expected%20%27%7D%27%60%20error%20from%20mathport/near/314672750" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html#314672750">(Dec 08 2022 at 13:12)</a>:</h4>
<p>I think this is mentioned in the porting guide on the wiki, but it would be neat if mathport got it right in the first place, yeah</p>



<a name="314674634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%60expected%20%27%7D%27%60%20error%20from%20mathport/near/314674634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html#314674634">(Dec 08 2022 at 13:22)</a>:</h4>
<p>Ah, thanks.  I updated the wiki discussion of this point to mention <code>expected '}'</code> as a symptom.</p>



<a name="314689936"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%60expected%20%27%7D%27%60%20error%20from%20mathport/near/314689936" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html#314689936">(Dec 08 2022 at 14:37)</a>:</h4>
<p>FYI, these are generally issues in the lean core formatter. Mathport actually can't do much about it since it uses the unmodified formatter from core</p>



<a name="314783587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%60expected%20%27%7D%27%60%20error%20from%20mathport/near/314783587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html#314783587">(Dec 08 2022 at 22:24)</a>:</h4>
<p>If someone who knows how to invoke the formatter could produce a MWE of this, we should report it.</p>



<a name="314783923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%60expected%20%27%7D%27%60%20error%20from%20mathport/near/314783923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html#314783923">(Dec 08 2022 at 22:27)</a>:</h4>
<p>pretty printing a definition often works</p>



<a name="314784066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%60expected%20%27%7D%27%60%20error%20from%20mathport/near/314784066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html#314784066">(Dec 08 2022 at 22:28)</a>:</h4>
<p>the <code>formatTerm.lean</code> test file has a setup for testing formatting of arbitrary syntax</p>



<a name="314784618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%60expected%20%27%7D%27%60%20error%20from%20mathport/near/314784618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html#314784618">(Dec 08 2022 at 22:32)</a>:</h4>
<p>I'm not sure why there is a comma there in the first place. Mathport never uses commas in structure instances</p>



<a name="314784707"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%60expected%20%27%7D%27%60%20error%20from%20mathport/near/314784707" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html#314784707">(Dec 08 2022 at 22:32)</a>:</h4>
<p>if you use any newlines it formats correctly</p>



<a name="314784909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%60expected%20%27%7D%27%60%20error%20from%20mathport/near/314784909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.60expected.20'.7D'.60.20error.20from.20mathport.html#314784909">(Dec 08 2022 at 22:33)</a>:</h4>
<p>oh the irony:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>    <span class="c1">-- TODO(Mario): formatter has trouble if you omit the commas</span>
    <span class="k">if</span> <span class="n">catchall</span> <span class="k">then</span>
      <span class="bp">`</span><span class="o">({</span> <span class="bp">$</span><span class="o">[</span><span class="bp">$</span><span class="n">srcs</span><span class="o">,</span><span class="bp">*</span> <span class="k">with</span><span class="o">]</span><span class="bp">?</span> <span class="bp">$</span><span class="o">[</span><span class="bp">$</span><span class="n">flds</span><span class="o">],</span><span class="bp">*</span> <span class="bp">..</span> <span class="o">})</span>
    <span class="k">else</span>
      <span class="bp">`</span><span class="o">({</span> <span class="bp">$</span><span class="o">[</span><span class="bp">$</span><span class="n">srcs</span><span class="o">,</span><span class="bp">*</span> <span class="k">with</span><span class="o">]</span><span class="bp">?</span> <span class="bp">$</span><span class="o">[</span><span class="bp">$</span><span class="n">flds</span><span class="o">],</span><span class="bp">*</span> <span class="o">})</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>