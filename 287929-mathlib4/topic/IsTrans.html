---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/IsTrans.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html">IsTrans</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="320864595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/320864595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#320864595">(Jan 12 2023 at 06:49)</a>:</h4>
<p>Should we migrate from <code>IsTrans</code> to <code>Trans</code>?</p>



<a name="320864724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/320864724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#320864724">(Jan 12 2023 at 06:50)</a>:</h4>
<p>E.g., by using</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">abbreviation</span> <span class="n">IsTrans</span> <span class="n">α</span> <span class="n">r</span> <span class="o">:=</span> <span class="n">Trans</span> <span class="n">r</span> <span class="n">r</span> <span class="n">r</span>
</code></pre></div>



<a name="320875884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/320875884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#320875884">(Jan 12 2023 at 08:18)</a>:</h4>
<p><code>Trans</code> is used, e.g., by <code>calc</code> and tactic <code>trans</code></p>



<a name="320877161"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/320877161" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#320877161">(Jan 12 2023 at 08:26)</a>:</h4>
<p>With this definition Lean fails to extend <code>IsTrans α r</code> saying that it's not a class.</p>



<a name="320877186"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/320877186" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#320877186">(Jan 12 2023 at 08:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> What should I do?</p>



<a name="320877327"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/320877327" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#320877327">(Jan 12 2023 at 08:27)</a>:</h4>
<p>Make it <code>class IsTrans α r extends Trans r r r</code> and add a loop instance <code>[IsTrans α r] : Trans r r r</code>?</p>



<a name="320877356"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/320877356" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#320877356">(Jan 12 2023 at 08:27)</a>:</h4>
<p>Or something else?</p>



<a name="321028938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321028938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321028938">(Jan 12 2023 at 20:33)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="321059891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321059891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321059891">(Jan 13 2023 at 00:19)</a>:</h4>
<p>I think there's <code>class abbrev IsTrans α r := Trans r r r</code>.</p>



<a name="321077595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321077595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321077595">(Jan 13 2023 at 03:44)</a>:</h4>
<p>It seems that <code>Trans</code> is not in <code>Prop</code>.</p>



<a name="321077765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321077765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321077765">(Jan 13 2023 at 03:46)</a>:</h4>
<p>So, I see 2 options.</p>
<ul>
<li>Add an instance <code>[IsTrans α r] : Trans r r r</code> and a linter that bans other <code>Trans r r r</code> instances.</li>
<li>Add both instances <code>[IsTrans α r] : Trans r r r</code> and <code>[Trans r r r] : IsTrans α r</code> and hope that Lean 4 is good with instance loops.</li>
</ul>



<a name="321079897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321079897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321079897">(Jan 13 2023 at 04:13)</a>:</h4>
<p>Lean 4 is good with this kind of instance loop.</p>



<a name="321079909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321079909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321079909">(Jan 13 2023 at 04:13)</a>:</h4>
<p>Related issue: since <code>calc</code> doesn't unfold <code>Trans</code> instances, an <code>Equiv</code> defined using <code>calc</code> uses <code>Trans.trans</code>, not <code>Equiv.trans</code>.</p>



<a name="321079993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321079993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321079993">(Jan 13 2023 at 04:15)</a>:</h4>
<p>Ah, I don't think much thought has gone into non-Prop <code>Trans</code> instances.</p>



<a name="321080026"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321080026" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321080026">(Jan 13 2023 at 04:15)</a>:</h4>
<p>While the results are defeq, <code>simp</code> doesn't work on the result.</p>



<a name="321080089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321080089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321080089">(Jan 13 2023 at 04:16)</a>:</h4>
<p>Of course, we can drop <code>Equiv.trans</code> and use <code>Trans.trans</code> instead.</p>



<a name="321080096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321080096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321080096">(Jan 13 2023 at 04:16)</a>:</h4>
<p>But this way we can't use dot notation.</p>



<a name="321080231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321080231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321080231">(Jan 13 2023 at 04:18)</a>:</h4>
<p>One more question: can we unexport <code>Trans.trans</code>? In many cases, our <code>_root_.trans</code> is more useful.</p>



<a name="321083603"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321083603" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321083603">(Jan 13 2023 at 05:06)</a>:</h4>
<p>I understand that <code>Trans.trans</code> is more general but in many cases it's not useful outside of <code>calc</code>. E.g., we can't write <code>apply Trans.trans h</code> and expect Lean to figure out the type of the second argument.</p>



<a name="321084400"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321084400" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321084400">(Jan 13 2023 at 05:18)</a>:</h4>
<p>I added instances <code>IsTrans α r → Trans r r r</code> and <code>Trans r r r → IsTrans α r</code>, and now I have to add <code>_root_</code> here and there.</p>



<a name="321085208"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321085208" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321085208">(Jan 13 2023 at 05:29)</a>:</h4>
<p>These collisions are new because without these instances, one of two <code>trans</code> did not apply.</p>



<a name="321114317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321114317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321114317">(Jan 13 2023 at 09:30)</a>:</h4>
<p>BTW, am I right that Lean 4 <code>calc</code> can't handle <a href="https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Hom/Equiv/Basic.html#MulEquiv.trans">https://leanprover-community.github.io/mathlib4_docs/Mathlib/Algebra/Hom/Equiv/Basic.html#MulEquiv.trans</a>?</p>



<a name="321115556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321115556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321115556">(Jan 13 2023 at 09:36)</a>:</h4>
<p>The only class-based solution that I can think of is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">Trans</span> <span class="o">(</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="n">γ</span> <span class="o">:</span> <span class="n">outParam</span> <span class="o">(</span><span class="kt">Sort</span> <span class="n">_</span><span class="o">))</span> <span class="n">where</span>
  <span class="n">trans</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">γ</span>
</code></pre></div>
<p>with instances like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">[</span><span class="n">Preorder</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">:</span> <span class="n">Trans</span> <span class="o">(</span><span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="n">b</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="bp">≤</span> <span class="n">c</span><span class="o">)</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="n">le_trans</span><span class="o">⟩</span>

<span class="kd">instance</span> <span class="o">[</span><span class="n">Mul</span> <span class="n">M</span><span class="o">]</span> <span class="o">[</span><span class="n">Mul</span> <span class="n">N</span><span class="o">]</span> <span class="o">[</span><span class="n">Mul</span> <span class="n">P</span><span class="o">]</span> <span class="o">:</span> <span class="n">Trans</span> <span class="o">(</span><span class="n">M</span> <span class="bp">≃*</span> <span class="n">N</span><span class="o">)</span> <span class="o">(</span><span class="n">N</span> <span class="bp">≃*</span> <span class="n">P</span><span class="o">)</span> <span class="o">(</span><span class="n">M</span> <span class="bp">≃*</span> <span class="n">P</span><span class="o">)</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="n">MulEquiv.trans</span><span class="o">⟩</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>
</code></pre></div>



<a name="321531616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321531616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321531616">(Jan 15 2023 at 21:07)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Who is the right person to talk about <code>calc</code> support for <code>MulEquiv</code> etc?</p>



<a name="321531717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321531717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321531717">(Jan 15 2023 at 21:08)</a>:</h4>
<p>It's a core PR, but I don't think it has any special prerequisites</p>



<a name="321531753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321531753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321531753">(Jan 15 2023 at 21:09)</a>:</h4>
<p>but you should be aware that <span class="user-mention" data-user-id="380302">@Adrien Champion</span> 's PR might affect how <code>calc</code> works because it needs the ability to add a refl step at the beginning</p>



<a name="321531834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321531834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321531834">(Jan 15 2023 at 21:10)</a>:</h4>
<p>(I wouldn't mind if we found another way to do it though)</p>



<a name="321531888"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321531888" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321531888">(Jan 15 2023 at 21:11)</a>:</h4>
<p>the issue is that the new syntax has an (optional) extra LHS term at the beginning which we have to fit into the inequality chain</p>



<a name="321531892"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321531892" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321531892">(Jan 15 2023 at 21:11)</a>:</h4>
<p>I wanted to discuss what should be done before trying to do something.</p>



<a name="321531944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321531944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321531944">(Jan 15 2023 at 21:12)</a>:</h4>
<p>Where can I read about the new syntax?</p>



<a name="321531964"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321531964" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321531964">(Jan 15 2023 at 21:12)</a>:</h4>
<p>Also, that more general instance will have problems with the <code>Trans Eq R R</code> and <code>Trans R Eq R</code> instances</p>



<a name="321531994"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321531994" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321531994">(Jan 15 2023 at 21:13)</a>:</h4>
<p><a href="#narrow/stream/270676-lean4/topic/.60calc.60.20indentation">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/.60calc.60.20indentation</a></p>



<a name="321532250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/IsTrans/near/321532250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/IsTrans.html#321532250">(Jan 15 2023 at 21:16)</a>:</h4>
<p>We can have general instances <code>Trans (a = b) (R b c) (R a b)</code> and <code>Trans (R a b) (b = c) (R a c)</code>. For <code>MulEquiv</code>s etc, we can't have <code>M = N → N ≃* P → M ≃* P</code> anyway because the first equality says nothing about <code>[Mul M]</code> and <code>[Mul N]</code>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>