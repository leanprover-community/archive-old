---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/to_additive.20and.20instances.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html">to_additive and instances</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="310831640"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/310831640" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#310831640">(Nov 18 2022 at 14:16)</a>:</h4>
<p>I've had linter errors for the <code>to_additive</code> and <code>instance</code> combination and tracked it down to this todo in <code>to_additive</code>: <a href="https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/ToAdditive.lean#L359">https://github.com/leanprover-community/mathlib4/blob/master/Mathlib/Tactic/ToAdditive.lean#L359</a><br>
is there any news on that (this comment is 6 months old) and is it now possible to implement the <code>instance</code> attribute in <code>to_additive</code>?</p>



<a name="310834524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/310834524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#310834524">(Nov 18 2022 at 14:31)</a>:</h4>
<p>Ah, if <code>to_additive</code> doesn't work on <code>instances</code> this at least explain some errors I've got!</p>



<a name="310835542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/310835542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#310835542">(Nov 18 2022 at 14:36)</a>:</h4>
<p>if the linter complains that your def should be a lemma even though it is an instance, then yes</p>



<a name="310835576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/310835576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#310835576">(Nov 18 2022 at 14:36)</a>:</h4>
<p>(this is what happened to me)</p>



<a name="310835638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/310835638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#310835638">(Nov 18 2022 at 14:36)</a>:</h4>
<p>and of course it only complains at the additive versions</p>



<a name="310835782"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/310835782" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#310835782">(Nov 18 2022 at 14:37)</a>:</h4>
<p>Yes, this is exactly what happened.</p>



<a name="310835901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/310835901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#310835901">(Nov 18 2022 at 14:38)</a>:</h4>
<p>the easy way out is to do the instances by hand, but this is obviously stupid</p>



<a name="310835929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/310835929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#310835929">(Nov 18 2022 at 14:38)</a>:</h4>
<p>As a workaround you can add it by hand, with a porting note. But I agree it's annoying, if we start doing this a lot we will surely forget to use <code>to_additive</code> later.</p>



<a name="310835955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/310835955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#310835955">(Nov 18 2022 at 14:38)</a>:</h4>
<p>Ahah, I see we agree :D</p>



<a name="311590311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/311590311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#311590311">(Nov 22 2022 at 13:16)</a>:</h4>
<p>Ok, so I've looked a bit more into this and the underlying issue seems to be that the part in <code>to_additive</code> that does the copying of attributes is in a <code>CoreM</code> monad, whereas adding instances is in <code>MetaM</code>. I did not find anything in the history in Lean 4 that suggests that there were any changes to how instances are added.<br>
I don't really see why we cannot just bump the monad, the instance attribute obviously runs in the <code>MetaM</code> monad.</p>



<a name="311600335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20and%20instances/near/311600335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20and.20instances.html#311600335">(Nov 22 2022 at 14:06)</a>:</h4>
<p>It doesn't look too bad actually: <a href="https://github.com/leanprover-community/mathlib4/pull/678">mathlib4#678</a> but I have to go to sleep now..<br>
Is the defLemma linter included in <code>#lint</code>? I had it now that <code>#lint</code> did not complain, but CI did.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>