---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html">typeclass instance problem with singleton</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="320584147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320584147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Maxwell Thum <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320584147">(Jan 11 2023 at 03:11)</a>:</h4>
<p><code>theorem smul_singleton : s • {b} = (· • b) '' s</code> is giving me </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">typeclass</span> <span class="kd">instance</span> <span class="n">problem</span> <span class="n">is</span> <span class="n">stuck</span><span class="o">,</span> <span class="n">it</span> <span class="n">is</span> <span class="n">often</span> <span class="n">due</span> <span class="n">to</span> <span class="n">metavariables</span>
  <span class="n">Singleton</span> <span class="n">β</span> <span class="bp">?</span><span class="n">m.3944</span>
</code></pre></div>
<p>The type should be <code>Set \b</code>, right? If so, how do I tell Lean this?</p>



<a name="320584278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320584278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320584278">(Jan 11 2023 at 03:13)</a>:</h4>
<p><span class="user-mention" data-user-id="570929">@Maxwell Thum</span> Please give imports or a link to the line in a branch.</p>



<a name="320584405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320584405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Maxwell Thum <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320584405">(Jan 11 2023 at 03:15)</a>:</h4>
<p>The imports are</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Algebra.Module.Basic</span>
<span class="kn">import</span> <span class="n">Mathlib.Data.Set.Pairwise</span>
<span class="kn">import</span> <span class="n">Mathlib.Data.Set.Pointwise.Basic</span>
<span class="kn">import</span> <span class="n">Mathlib.Tactic.ByContra</span>
</code></pre></div>



<a name="320584522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320584522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Maxwell Thum <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320584522">(Jan 11 2023 at 03:17)</a>:</h4>
<p>Here is a link to the line in a recent PR (I think) <a href="https://github.com/leanprover-community/mathlib4/pull/1473/commits/813e3d1c41c962f98567d495a03b5d5643c91d4c#diff-bb3fe98a6d8a82c76f7f4bd9412449f57c1e421d63c526705c14dab92432dc86R138">https://github.com/leanprover-community/mathlib4/pull/1473/commits/813e3d1c41c962f98567d495a03b5d5643c91d4c#diff-bb3fe98a6d8a82c76f7f4bd9412449f57c1e421d63c526705c14dab92432dc86R138</a></p>



<a name="320584702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320584702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320584702">(Jan 11 2023 at 03:19)</a>:</h4>
<p>That link doesn't work, but this does:<br>
<a href="https://github.com/leanprover-community/mathlib4/blob/813e3d1c41c962f98567d495a03b5d5643c91d4c/Mathlib/Data/Set/Pointwise/Smul.lean#L138">https://github.com/leanprover-community/mathlib4/blob/813e3d1c41c962f98567d495a03b5d5643c91d4c/Mathlib/Data/Set/Pointwise/Smul.lean#L138</a></p>



<a name="320585717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320585717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320585717">(Jan 11 2023 at 03:26)</a>:</h4>
<p>However, it looks like that branch isn't up to date with any work you have done.  Can you please push so we can look at it in context?</p>



<a name="320585812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320585812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320585812">(Jan 11 2023 at 03:27)</a>:</h4>
<p>Alternatively, provide a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> (the imports, but also variable declarations, etc).</p>



<a name="320585999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320585999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Maxwell Thum <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320585999">(Jan 11 2023 at 03:28)</a>:</h4>
<p>I don't think I've significantly changed the context, but I'll still push; I'll just be a minute.</p>



<a name="320586464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320586464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Maxwell Thum <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320586464">(Jan 11 2023 at 03:32)</a>:</h4>
<p>Okay, here it is. <a href="https://github.com/leanprover-community/mathlib4/blob/port/Data.Set.Pointwise.Smul/Mathlib/Data/Set/Pointwise/Smul.lean#L144">https://github.com/leanprover-community/mathlib4/blob/port/Data.Set.Pointwise.Smul/Mathlib/Data/Set/Pointwise/Smul.lean#L144</a></p>



<a name="320586698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320586698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320586698">(Jan 11 2023 at 03:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="570929">Maxwell Thum</span> <a href="#narrow/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton/near/320585999">said</a>:</p>
<blockquote>
<p>I don't think I've significantly changed the context</p>
</blockquote>
<p>(You changed <code>[HasSmul α β]</code> to <code>[SMul α β]</code>, which made the line make sense!)</p>



<a name="320586857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320586857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320586857">(Jan 11 2023 at 03:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="570929">Maxwell Thum</span> <a href="#narrow/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton/near/320584147">said</a>:</p>
<blockquote>
<p>The type should be <code>Set \b</code>, right? If so, how do I tell Lean this?</p>
</blockquote>
<p>OK, yes.  You want</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">smul_singleton</span> <span class="o">:</span> <span class="n">s</span> <span class="bp">•</span> <span class="o">({</span><span class="n">b</span><span class="o">}</span> <span class="o">:</span> <span class="n">Set</span> <span class="n">β</span><span class="o">)</span> <span class="bp">=</span> <span class="o">(</span><span class="bp">·</span> <span class="bp">•</span> <span class="n">b</span><span class="o">)</span> <span class="bp">''</span> <span class="n">s</span> <span class="o">:=</span>
</code></pre></div>



<a name="320587011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320587011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320587011">(Jan 11 2023 at 03:35)</a>:</h4>
<p>It's unfortunate that this change is needed, <del>but my guess is that it falls into a well-known class of behaviour where Lean 4 (unlike Lean 3) can't use one side of an equation to help elaborate the other.</del> (edit: see below)</p>



<a name="320587089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320587089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Maxwell Thum <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320587089">(Jan 11 2023 at 03:36)</a>:</h4>
<p>Perfect; thank you!</p>



<a name="320589048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320589048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320589048">(Jan 11 2023 at 03:49)</a>:</h4>
<p>Actually, I don't think I've seen this problem before.  Does anyone want to try to make an import-free example?  This fails in Lean 4:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib.Data.Set.NAry</span>
<span class="kn">import</span> <span class="n">Mathlib.Algebra.Group.Defs</span>

<span class="kd">variable</span> <span class="o">[</span><span class="n">SMul</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">Set</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span><span class="o">}</span>

<span class="kd">instance</span> <span class="n">Set.hasSmul</span> <span class="o">:</span> <span class="n">SMul</span> <span class="o">(</span><span class="n">Set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">Set</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">Set.image2</span> <span class="n">SMul.smul</span><span class="o">⟩</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">Set</span> <span class="n">β</span> <span class="o">:=</span> <span class="n">s</span> <span class="bp">•</span> <span class="o">{</span><span class="n">b</span><span class="o">}</span> <span class="c1">-- fails</span>
</code></pre></div>
<p>and this works in Lean 3:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">data.set.n_ary</span>
<span class="kn">import</span> <span class="n">algebra.group.defs</span>

<span class="kd">variables</span> <span class="o">{</span><span class="n">α</span> <span class="n">β</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">}</span> <span class="o">[</span><span class="n">has_smul</span> <span class="n">α</span> <span class="n">β</span><span class="o">]</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">set</span> <span class="n">α</span><span class="o">}</span> <span class="o">{</span><span class="n">b</span> <span class="o">:</span> <span class="n">β</span><span class="o">}</span>

<span class="kd">instance</span> <span class="n">Set.hasSmul</span> <span class="o">:</span> <span class="n">has_smul</span> <span class="o">(</span><span class="n">set</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">set.image2</span> <span class="n">has_smul.smul</span><span class="o">⟩</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">set</span> <span class="n">β</span> <span class="o">:=</span> <span class="n">s</span> <span class="bp">•</span> <span class="o">{</span><span class="n">b</span><span class="o">}</span>
</code></pre></div>



<a name="320589541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/typeclass%20instance%20problem%20with%20singleton/near/320589541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/typeclass.20instance.20problem.20with.20singleton.html#320589541">(Jan 11 2023 at 03:52)</a>:</h4>
<p>I notice that this works in Lean 4:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">Set</span> <span class="n">β</span> <span class="o">:=</span> <span class="n">SMul.smul</span> <span class="n">s</span> <span class="o">{</span><span class="n">b</span><span class="o">}</span>
</code></pre></div>
<p>So maybe the problem is our having added the extra layer of HSMul.  I'm really not convinced that change was a good idea ...</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>