---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html">Data.Rat.Defs</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="315842437"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315842437" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315842437">(Dec 14 2022 at 15:14)</a>:</h4>
<p><span class="user-mention" data-user-id="307953">@Ruben Van de Velde</span> are you still working on that file?</p>



<a name="315842462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315842462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315842462">(Dec 14 2022 at 15:14)</a>:</h4>
<p>I have a bit of time now.</p>



<a name="315842549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315842549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315842549">(Dec 14 2022 at 15:14)</a>:</h4>
<p>No, pushed the little bit that I accomplished</p>



<a name="315842659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315842659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315842659">(Dec 14 2022 at 15:15)</a>:</h4>
<p>Ok, thanks</p>



<a name="315853738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315853738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315853738">(Dec 14 2022 at 16:01)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> could you have a look at a very strange <code>simp</code> behavior at <a href="https://github.com/leanprover-community/mathlib4/pull/998/commits/7d0e0318750daeb511776e8a968a2032955d8617">https://github.com/leanprover-community/mathlib4/pull/998/commits/7d0e0318750daeb511776e8a968a2032955d8617</a>? Line 135 has a <code>simp</code> doing nothing whereas when I extract the relevant goal in a lemma <code>bar</code> on line 117 it works normally</p>



<a name="315855458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315855458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315855458">(Dec 14 2022 at 16:09)</a>:</h4>
<p>While you are in this file, it would also be nice to investigate why the elaborator needs more help in the definition of <code>numDenCasesOn'</code> than in Lean 3. Note that helping the elaborator is easy here, I'm only pointing out one possible improvement.</p>



<a name="315856526"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315856526" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315856526">(Dec 14 2022 at 16:13)</a>:</h4>
<p>Your <code>bar</code> lemma is wrong. The correct version is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">lemma</span> <span class="n">bar</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hb</span> <span class="o">:</span> <span class="bp">¬</span><span class="n">b</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">¬</span><span class="n">b</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">),</span> <span class="n">mkPNat</span> <span class="n">a</span> <span class="o">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">b.pos_of_ne_zero</span> <span class="n">h</span><span class="o">⟩</span> <span class="bp">=</span> <span class="mi">0</span><span class="o">)</span>  <span class="o">:</span> <span class="n">False</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">hb</span><span class="o">]</span> <span class="n">at</span> <span class="n">h</span>
  <span class="gr">sorry</span>
</code></pre></div>
<p>and this indeed does not simplify</p>



<a name="315856946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315856946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315856946">(Dec 14 2022 at 16:15)</a>:</h4>
<p>Re: <code>numDenCasesOn'</code>, it seems to work fine for me:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Define a (dependent) function or prove `∀ r : ℚ, p r` by dealing with rational</span>
<span class="sd">numbers of the form `n /. d` with `0 &lt; d` and coprime `n`, `d`. -/</span>
<span class="kd">@[elab_as_elim]</span>
<span class="kd">def</span> <span class="n">numDenCasesOn.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span>
    <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="n">d</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">d</span> <span class="bp">→</span> <span class="o">(</span><span class="n">Int.natAbs</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">coprime</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/.</span> <span class="n">d</span><span class="o">)),</span> <span class="n">C</span> <span class="n">a</span>
  <span class="bp">|</span> <span class="o">⟨</span><span class="n">n</span><span class="o">,</span> <span class="n">d</span><span class="o">,</span> <span class="n">h</span><span class="o">,</span> <span class="n">c</span><span class="o">⟩,</span> <span class="n">H</span> <span class="bp">=&gt;</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">num_den'</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">H</span> <span class="n">n</span> <span class="n">d</span> <span class="o">(</span><span class="n">Nat.pos_of_ne_zero</span> <span class="n">h</span><span class="o">)</span> <span class="n">c</span>
<span class="bp">#</span><span class="n">align</span> <span class="n">rat.num_denom_cases_on</span> <span class="n">Rat.numDenCasesOn</span>

<span class="sd">/-- Define a (dependent) function or prove `∀ r : ℚ, p r` by dealing with rational</span>
<span class="sd">numbers of the form `n /. d` with `d ≠ 0`. -/</span>
<span class="kd">@[elab_as_elim]</span>
<span class="kd">def</span> <span class="n">numDenCasesOn'.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">d</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/.</span> <span class="n">d</span><span class="o">))</span> <span class="o">:</span>
    <span class="n">C</span> <span class="n">a</span> <span class="o">:=</span>
  <span class="n">numDenCasesOn</span> <span class="n">a</span> <span class="k">fun</span> <span class="n">n</span> <span class="n">d</span> <span class="n">h</span> <span class="n">c</span> <span class="bp">=&gt;</span> <span class="n">H</span> <span class="n">n</span> <span class="n">d</span> <span class="n">h.ne'</span>
</code></pre></div>



<a name="315857180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315857180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315857180">(Dec 14 2022 at 16:16)</a>:</h4>
<p>I don't see any difference between your bar and mine</p>



<a name="315857284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315857284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315857284">(Dec 14 2022 at 16:17)</a>:</h4>
<p><code>h</code> is a dependent function, because it mentions the local variable <code>h</code></p>



<a name="315857360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315857360" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315857360">(Dec 14 2022 at 16:17)</a>:</h4>
<p>you can see this in the pretty printer, it prints yours as a nondependent arrow and not mine</p>



<a name="315857524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315857524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315857524">(Dec 14 2022 at 16:18)</a>:</h4>
<p>as a result <code>simp</code> doesn't want to rewrite the <code>¬b = 0</code></p>



<a name="315857738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315857738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315857738">(Dec 14 2022 at 16:19)</a>:</h4>
<p>I think there was some kind of "canonize proofs" thing that lean 3 simp did that might explain the difference</p>



<a name="315858096"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315858096" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315858096">(Dec 14 2022 at 16:21)</a>:</h4>
<p>Oh ok, I see the difference now.</p>



<a name="315858178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315858178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315858178">(Dec 14 2022 at 16:21)</a>:</h4>
<p>you could also try marking <code>forall_prop_of_true</code> as a simp lemma</p>



<a name="315858228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315858228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315858228">(Dec 14 2022 at 16:21)</a>:</h4>
<p>Now at least consistency is restored, and we do have some simp regression compared to Lean 3.</p>



<a name="315858449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315858449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315858449">(Dec 14 2022 at 16:22)</a>:</h4>
<p>is <code>forall_prop_of_true</code> a simp lemma in lean 3? Is it used here?</p>



<a name="315858574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315858574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315858574">(Dec 14 2022 at 16:22)</a>:</h4>
<p>The Lean 3 version has a simp only there.</p>



<a name="315858812"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315858812" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315858812">(Dec 14 2022 at 16:23)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/blob/master/src/data/rat/defs.lean#L106">https://github.com/leanprover-community/mathlib/blob/master/src/data/rat/defs.lean#L106</a></p>



<a name="315859008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859008">(Dec 14 2022 at 16:24)</a>:</h4>
<p>what does the rewrite trace look like?</p>



<a name="315859078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859078">(Dec 14 2022 at 16:24)</a>:</h4>
<p>The new definition of addition on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Q</mi></mrow><annotation encoding="application/x-tex">\mathbb{Q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8556em;vertical-align:-0.1667em;"></span><span class="mord mathbb">Q</span></span></span></span> will be a lot of work for porting this file</p>



<a name="315859101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859101">(Dec 14 2022 at 16:24)</a>:</h4>
<p>Rewrite trace in Lean 3?</p>



<a name="315859119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859119">(Dec 14 2022 at 16:24)</a>:</h4>
<p>yes</p>



<a name="315859181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859181">(Dec 14 2022 at 16:25)</a>:</h4>
<p>i.e. what did it do</p>



<a name="315859326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859326">(Dec 14 2022 at 16:25)</a>:</h4>
<p>Could you remind me the relevant option?</p>



<a name="315859429"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859429" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859429">(Dec 14 2022 at 16:26)</a>:</h4>
<p>eh, I do <code>rewr</code> + autocomplete</p>



<a name="315859463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859463">(Dec 14 2022 at 16:26)</a>:</h4>
<p>something like simplify.rewrite</p>



<a name="315859715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859715">(Dec 14 2022 at 16:27)</a>:</h4>
<p>thanks</p>



<a name="315859723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859723">(Dec 14 2022 at 16:27)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify.rewrite</span><span class="o">]</span> <span class="o">[[</span><span class="n">anonymous</span><span class="o">]]:</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">==&gt;</span> <span class="n">false</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify.rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">not_false_iff</span><span class="o">]:</span> <span class="bp">¬</span><span class="n">false</span> <span class="bp">==&gt;</span> <span class="n">true</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify.rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">forall_true_left</span><span class="o">]:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">true</span><span class="o">),</span> <span class="n">mk_pnat</span> <span class="n">a</span> <span class="o">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">==&gt;</span> <span class="n">mk_pnat</span> <span class="n">a</span> <span class="o">⟨</span><span class="n">b</span><span class="o">,</span> <span class="n">_</span><span class="o">⟩</span> <span class="bp">=</span> <span class="mi">0</span>
</code></pre></div>



<a name="315859772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859772">(Dec 14 2022 at 16:27)</a>:</h4>
<p>with pp.proofs?</p>



<a name="315859814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315859814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315859814">(Dec 14 2022 at 16:27)</a>:</h4>
<p>because that's kind of magic</p>



<a name="315860082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315860082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315860082">(Dec 14 2022 at 16:28)</a>:</h4>
<p>I think it's using a custom <code>congr</code> to descend into both sides of a forall and getting some messy eq.rec term in that <code>_</code></p>



<a name="315861013"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315861013" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315861013">(Dec 14 2022 at 16:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110031">Patrick Massot</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2ERat.2EDefs/near/315859078">said</a>:</p>
<blockquote>
<p>The new definition of addition on <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="double-struck">Q</mi></mrow><annotation encoding="application/x-tex">\mathbb{Q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8556em;vertical-align:-0.1667em;"></span><span class="mord mathbb">Q</span></span></span></span> will be a lot of work for porting this file</p>
</blockquote>
<p>Note that the first theorem we will be proving is <code>a + b = (a.num * b.den + b.num * a.den) /. (a.den * b.den)</code> and all the other theorems follow from that, treating it as the definition</p>



<a name="315861035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315861035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315861035">(Dec 14 2022 at 16:33)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify.rewrite</span><span class="o">]</span> <span class="o">[[</span><span class="n">anonymous</span><span class="o">]]:</span> <span class="n">b</span> <span class="bp">=</span> <span class="mi">0</span> <span class="bp">==&gt;</span> <span class="n">false</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify.rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">not_false_iff</span><span class="o">]:</span> <span class="bp">¬</span><span class="n">false</span> <span class="bp">==&gt;</span> <span class="n">true</span>
<span class="mi">0</span><span class="bp">.</span> <span class="o">[</span><span class="n">simplify.rewrite</span><span class="o">]</span> <span class="o">[</span><span class="n">forall_true_left</span><span class="o">]:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">true</span><span class="o">),</span>
  <span class="n">mk_pnat</span> <span class="n">a</span>
      <span class="o">⟨</span><span class="n">b</span><span class="o">,</span>
       <span class="n">nat.pos_of_ne_zero</span>
         <span class="o">(((</span><span class="n">not_congr</span> <span class="o">(</span><span class="n">iff_false_intro</span> <span class="o">(</span><span class="n">mt</span> <span class="o">(</span><span class="n">congr_arg</span> <span class="n">int.of_nat</span><span class="o">)</span> <span class="n">b0</span><span class="o">)))</span><span class="bp">.</span><span class="n">trans</span> <span class="n">not_false_iff</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">h</span><span class="o">)⟩</span> <span class="bp">=</span>
    <span class="mi">0</span> <span class="bp">==&gt;</span> <span class="n">mk_pnat</span> <span class="n">a</span>
    <span class="o">⟨</span><span class="n">b</span><span class="o">,</span>
     <span class="n">nat.pos_of_ne_zero</span>
       <span class="o">(((</span><span class="n">not_congr</span> <span class="o">(</span><span class="n">iff_false_intro</span> <span class="o">(</span><span class="n">mt</span> <span class="o">(</span><span class="n">congr_arg</span> <span class="n">int.of_nat</span><span class="o">)</span> <span class="n">b0</span><span class="o">)))</span><span class="bp">.</span><span class="n">trans</span> <span class="n">not_false_iff</span><span class="o">)</span><span class="bp">.</span><span class="n">mpr</span> <span class="n">true.intro</span><span class="o">)⟩</span> <span class="bp">=</span>
  <span class="mi">0</span>
</code></pre></div>



<a name="315861983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315861983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315861983">(Dec 14 2022 at 16:37)</a>:</h4>
<p>here's a lean 3 MWE:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[congr]</span> <span class="kd">lemma</span> <span class="n">forall_prop_congr'</span> <span class="o">{</span><span class="n">p</span> <span class="n">p'</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">q</span> <span class="n">q'</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span>
  <span class="o">(</span><span class="n">hq</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">h</span><span class="o">,</span> <span class="n">q</span> <span class="n">h</span> <span class="bp">↔</span> <span class="n">q'</span> <span class="n">h</span><span class="o">)</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">↔</span> <span class="n">p'</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="bp">∀</span> <span class="n">h</span><span class="o">,</span> <span class="n">q</span> <span class="n">h</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">∀</span> <span class="n">h</span> <span class="o">:</span> <span class="n">p'</span><span class="o">,</span> <span class="n">q'</span> <span class="o">(</span><span class="n">hp.2</span> <span class="n">h</span><span class="o">)</span> <span class="o">:=</span>
<span class="gr">sorry</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">nat</span><span class="o">)</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">5</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">(</span><span class="n">h'</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="mi">5</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">h</span> <span class="o">:</span> <span class="n">x</span> <span class="bp">&lt;</span> <span class="mi">5</span><span class="o">,</span> <span class="n">p</span> <span class="o">⟨</span><span class="n">x</span><span class="o">,</span> <span class="n">h</span><span class="o">⟩</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="o">{</span> <span class="n">simp</span> <span class="n">only</span> <span class="o">[</span><span class="n">h'</span><span class="o">],</span> <span class="gr">sorry</span> <span class="o">}</span>
</code></pre></div>



<a name="315862052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315862052" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315862052">(Dec 14 2022 at 16:37)</a>:</h4>
<p><code>simp</code> does nothing unless you have that <code>@[congr]</code> lemma</p>



<a name="315862217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315862217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315862217">(Dec 14 2022 at 16:38)</a>:</h4>
<p>and would you look at that:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Porting note: `@[congr]` commented out for now.</span>
<span class="c1">-- @[congr]</span>
<span class="kd">theorem</span> <span class="n">forall_prop_congr'</span> <span class="o">{</span><span class="n">p</span> <span class="n">p'</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">{</span><span class="n">q</span> <span class="n">q'</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">}</span> <span class="o">(</span><span class="n">hq</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">h</span><span class="o">,</span> <span class="n">q</span> <span class="n">h</span> <span class="bp">↔</span> <span class="n">q'</span> <span class="n">h</span><span class="o">)</span> <span class="o">(</span><span class="n">hp</span> <span class="o">:</span> <span class="n">p</span> <span class="bp">↔</span> <span class="n">p'</span><span class="o">)</span> <span class="o">:</span>
    <span class="o">(</span><span class="bp">∀</span> <span class="n">h</span><span class="o">,</span> <span class="n">q</span> <span class="n">h</span><span class="o">)</span> <span class="bp">=</span> <span class="bp">∀</span> <span class="n">h</span> <span class="o">:</span> <span class="n">p'</span><span class="o">,</span> <span class="n">q'</span> <span class="o">(</span><span class="n">hp.2</span> <span class="n">h</span><span class="o">)</span> <span class="o">:=</span>
  <span class="n">propext</span> <span class="o">(</span><span class="n">forall_prop_congr</span> <span class="n">hq</span> <span class="n">hp</span><span class="o">)</span>
</code></pre></div>



<a name="315862282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315862282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315862282">(Dec 14 2022 at 16:38)</a>:</h4>
<p>so it looks like the root cause is that simp doesn't accept this congr lemma</p>



<a name="315863980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315863980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315863980">(Dec 14 2022 at 16:46)</a>:</h4>
<p>This is the same one as <a class="stream-topic" data-stream-id="287929" href="/#narrow/stream/287929-mathlib4/topic/Difference.20in.20.02klzzwxh.3A0000.03.20behaviour">#mathlib4 &gt; Difference in <code>simp</code> behaviour</a> right?</p>



<a name="315864366"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315864366" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315864366">(Dec 14 2022 at 16:48)</a>:</h4>
<p><a href="#narrow/stream/287929-mathlib4/topic/Difference.20in.20.60simp.60.20behaviour/near/314698730">this link works for me</a> (and Jannis' doesn't)</p>



<a name="315864514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315864514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315864514">(Dec 14 2022 at 16:49)</a>:</h4>
<p><a href="https://github.com/leanprover/lean4/issues/1926">https://github.com/leanprover/lean4/issues/1926</a></p>



<a name="315869988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315869988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jannis Limperg <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315869988">(Dec 14 2022 at 17:13)</a>:</h4>
<p>Seems like you can't hash-link to topics containing backticks. :(</p>



<a name="315879365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315879365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315879365">(Dec 14 2022 at 17:57)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> as you can see from this thread, I was also working on this file. It would have been nice to tell us you wanted to work on it too. All the work you pushed two hours ago was duplicated.</p>



<a name="315879716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315879716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315879716">(Dec 14 2022 at 17:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2ERat.2EDefs/near/315856946">said</a>:</p>
<blockquote>
<p>Re: <code>numDenCasesOn'</code>, it seems to work fine for me:</p>
<p><div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Define a (dependent) function or prove `∀ r : ℚ, p r` by dealing with rational</span>
<span class="sd">numbers of the form `n /. d` with `0 &lt; d` and coprime `n`, `d`. -/</span>
<span class="kd">@[elab_as_elim]</span>
<span class="kd">def</span> <span class="n">numDenCasesOn.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">:</span>
    <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span> <span class="n">d</span><span class="o">,</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">d</span> <span class="bp">→</span> <span class="o">(</span><span class="n">Int.natAbs</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="n">coprime</span> <span class="n">d</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/.</span> <span class="n">d</span><span class="o">)),</span> <span class="n">C</span> <span class="n">a</span>
  <span class="bp">|</span> <span class="o">⟨</span><span class="n">n</span><span class="o">,</span> <span class="n">d</span><span class="o">,</span> <span class="n">h</span><span class="o">,</span> <span class="n">c</span><span class="o">⟩,</span> <span class="n">H</span> <span class="bp">=&gt;</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">num_den'</span><span class="o">]</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">H</span> <span class="n">n</span> <span class="n">d</span> <span class="o">(</span><span class="n">Nat.pos_of_ne_zero</span> <span class="n">h</span><span class="o">)</span> <span class="n">c</span>
<span class="bp">#</span><span class="n">align</span> <span class="n">rat.num_denom_cases_on</span> <span class="n">Rat.numDenCasesOn</span>

<span class="sd">/-- Define a (dependent) function or prove `∀ r : ℚ, p r` by dealing with rational</span>
<span class="sd">numbers of the form `n /. d` with `d ≠ 0`. -/</span>
<span class="kd">@[elab_as_elim]</span>
<span class="kd">def</span> <span class="n">numDenCasesOn'.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">ℚ</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">(</span><span class="n">d</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">),</span> <span class="n">d</span> <span class="bp">≠</span> <span class="mi">0</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">n</span> <span class="bp">/.</span> <span class="n">d</span><span class="o">))</span> <span class="o">:</span>
    <span class="n">C</span> <span class="n">a</span> <span class="o">:=</span>
  <span class="n">numDenCasesOn</span> <span class="n">a</span> <span class="k">fun</span> <span class="n">n</span> <span class="n">d</span> <span class="n">h</span> <span class="n">c</span> <span class="bp">=&gt;</span> <span class="n">H</span> <span class="n">n</span> <span class="n">d</span> <span class="n">h.ne'</span>
</code></pre></div><br>
</p>
</blockquote>
<p>I forgot to comment on this: the reason why I thought this didn't work is because mathport introduced parentheses that confused Lean. See for instance how Chris and I independently fixed things like <a href="https://github.com/leanprover-community/mathlib4/pull/998/commits/5e0e39f6bbee32af1c92863b812e39a918aa1a95#diff-ea45d5aad7c20f5cadf98bd993c050cb08e464552adac793796d1d05f6e4560bL455-R463">these</a></p>



<a name="315884415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315884415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315884415">(Dec 14 2022 at 18:10)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span> this has happened to me too and I found it very frustrating. Right now what I am doing is only claiming files when I have time to do the initial run through the entire file fixing the trivial stuff (capitalization etc). Whenever I see a file half-done I am very scared to do more in case it happens to me again.</p>



<a name="315884783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315884783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315884783">(Dec 14 2022 at 18:12)</a>:</h4>
<p>To be clear, I'm not blaming Chris for anything, only telling him to be more cautious when Scott explicitly tell people to work on a file. I'm delighted to see all the great work Chris is putting in the port. And there is plenty enough of work for all of us without duplication.</p>



<a name="315885584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315885584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315885584">(Dec 14 2022 at 18:16)</a>:</h4>
<p>And now <span class="user-mention" data-user-id="542196">@Arien Malec</span> is also pushing to that branch. I give up.</p>



<a name="315885711"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315885711" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315885711">(Dec 14 2022 at 18:16)</a>:</h4>
<p>Sorry, was responding to Scott's call for help. Happy to back off/revert.</p>



<a name="315885716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315885716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315885716">(Dec 14 2022 at 18:16)</a>:</h4>
<p>Anyway, the file has a lot less errors now, and probably <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> should take over since the remaining stuff is really tied to the super un-mathematical new definitions.</p>



<a name="315885852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315885852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315885852">(Dec 14 2022 at 18:17)</a>:</h4>
<p>Help is fine! But I think when there is explicit call for help then we should post here before editing the file.</p>



<a name="315885960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315885960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315885960">(Dec 14 2022 at 18:18)</a>:</h4>
<p>And also post when we stop. Hence I post: I'm stopping now.</p>



<a name="315886227"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315886227" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315886227">(Dec 14 2022 at 18:19)</a>:</h4>
<p>Anyway from previous work here, I generally think the best approach is for <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  to provide the theorems for invariants in <code>Std</code>, at which the basic lemmas for <code>Rat</code> are trivial.</p>



<a name="315886988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315886988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315886988">(Dec 14 2022 at 18:23)</a>:</h4>
<p>I don't think I can work on it right at this moment, so my recommendation if it's holding up the port is to port all the theorems in terms of some interface theorems similar to the original mathlib definition and sorry the theorems asserting that the new definition matches this, and just commit the file with sorries</p>



<a name="315887745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315887745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315887745">(Dec 14 2022 at 18:27)</a>:</h4>
<p>Or for <em>someone</em> with the juice to prove things like <code>add_def</code> to get those invariants in place.</p>



<a name="315887962"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315887962" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315887962">(Dec 14 2022 at 18:28)</a>:</h4>
<p>Well even if someone does that I'm likely to significantly rewrite it on the way to Std so it's probably not worth it</p>



<a name="315888072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315888072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315888072">(Dec 14 2022 at 18:29)</a>:</h4>
<p>this whole file will be migrated to Std but it's easier to do that if it's mostly working already</p>



<a name="315888206"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315888206" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315888206">(Dec 14 2022 at 18:29)</a>:</h4>
<p>that is, I will wait until the <code>feat: port Data.Rat.Defs</code> PR is merged</p>



<a name="315914578"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315914578" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315914578">(Dec 14 2022 at 21:05)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> In response to:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>      <span class="c1">-- Apparently contrary to the documentation, `conv in a =&gt; rw [← Int.sign_mul_natAbs a]`</span>
      <span class="c1">-- rewrites all the `a`s, not just the first one.</span>
      <span class="n">conv</span> <span class="bp">=&gt;</span>
        <span class="n">congr</span><span class="bp">;</span> <span class="n">congr</span><span class="bp">;</span> <span class="n">congr</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">Int.sign_mul_natAbs</span> <span class="n">a</span><span class="o">]</span>
      <span class="n">conv</span> <span class="bp">=&gt;</span>
        <span class="n">congr</span><span class="bp">;</span> <span class="n">congr</span><span class="bp">;</span> <span class="n">rfl</span><span class="bp">;</span> <span class="n">congr</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">Int.sign_mul_natAbs</span> <span class="n">c</span><span class="o">]</span>
</code></pre></div>
<p><del>you are missing the <code>occs</code> parameter:</del></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>      <span class="n">conv</span> <span class="k">in</span> <span class="o">(</span><span class="n">occs</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">)</span> <span class="n">a</span> <span class="bp">=&gt;</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">Int.sign_mul_natAbs</span> <span class="n">a</span><span class="o">]</span>
      <span class="n">conv</span> <span class="k">in</span> <span class="o">(</span><span class="n">occs</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">)</span> <span class="n">c</span> <span class="bp">=&gt;</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">Int.sign_mul_natAbs</span> <span class="n">c</span><span class="o">]</span>
</code></pre></div>
<p>Actually the default <code>occs</code> setting is <code>(occs := 1)</code> but there was a bug preventing it from matching the <code>a</code>'s separately. Fixed in <a href="https://github.com/leanprover/lean4/pull/1956">lean4#1956</a></p>



<a name="315914852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315914852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315914852">(Dec 14 2022 at 21:07)</a>:</h4>
<p>the code with <code>congr</code> can also be written more compactly using <code>enter</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>      <span class="n">conv</span> <span class="bp">=&gt;</span> <span class="n">enter</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">]</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">Int.sign_mul_natAbs</span> <span class="n">a</span><span class="o">]</span>
      <span class="n">conv</span> <span class="bp">=&gt;</span> <span class="n">enter</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">]</span><span class="bp">;</span> <span class="n">rw</span> <span class="o">[</span><span class="bp">←</span> <span class="n">Int.sign_mul_natAbs</span> <span class="n">c</span><span class="o">]</span>
</code></pre></div>



<a name="315925113"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315925113" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315925113">(Dec 14 2022 at 22:14)</a>:</h4>
<p>Thanks for minimizing and fixing this!</p>



<a name="315932760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315932760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315932760">(Dec 14 2022 at 23:14)</a>:</h4>
<p><span class="user-mention" data-user-id="110031">@Patrick Massot</span>, sorry about the race conditions on this PR today. Perhaps I overemphasised its priority; hopefully you weren't too annoyed.</p>



<a name="315936127"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315936127" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315936127">(Dec 14 2022 at 23:46)</a>:</h4>
<p>And just a heads up that I'm working on this file now. I'll push individual commits for every lemma that gets fixed. :-)</p>



<a name="315940171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315940171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315940171">(Dec 15 2022 at 00:25)</a>:</h4>
<p>Okay, I'm stopping on <code>Data.Rat.Defs</code>. Still two sorries, and two broken proofs.</p>



<a name="315967447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/315967447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#315967447">(Dec 15 2022 at 06:38)</a>:</h4>
<p>Please don't worry about me and continue the great work you're doing for all of us!</p>



<a name="316830934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316830934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316830934">(Dec 19 2022 at 21:02)</a>:</h4>
<p>Gah, someone broke <code>data.rat.defs</code>?? What's going on? Yesterday there was just one error, which <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> was going to handle. Now there are lots. :-(</p>



<a name="316831021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316831021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316831021">(Dec 19 2022 at 21:03)</a>:</h4>
<p>I thought <span class="user-mention" data-user-id="307953">@Ruben Van de Velde</span> was working on it</p>



<a name="316831135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316831135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316831135">(Dec 19 2022 at 21:04)</a>:</h4>
<p>I didn't do anything to <code>data.rat.defs</code>, but I added the theorems I said I was going to to Std</p>



<a name="316831320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316831320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316831320">(Dec 19 2022 at 21:05)</a>:</h4>
<p>Ok. I will wait for Ruben.</p>



<a name="316833883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316833883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316833883">(Dec 19 2022 at 21:24)</a>:</h4>
<p>Okay, I think I understand. Mario's new definition of <code>/.</code> basically borked <code>Data.Rat.Defs</code> in mathlib4, and Ruben has started over fixing things again.</p>



<a name="316833948"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316833948" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316833948">(Dec 19 2022 at 21:25)</a>:</h4>
<p>It feels like we went a long way backwards there. :-(</p>



<a name="316833955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316833955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316833955">(Dec 19 2022 at 21:25)</a>:</h4>
<p>what's the issue? It should be the same as the old definition</p>



<a name="316834090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316834090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316834090">(Dec 19 2022 at 21:25)</a>:</h4>
<p>Have a look at the branch <code>data_rat_defs2</code>.</p>



<a name="316834140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316834140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316834140">(Dec 19 2022 at 21:26)</a>:</h4>
<p>This is where the file used to be, updated to latest Std4.</p>



<a name="316834181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316834181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316834181">(Dec 19 2022 at 21:26)</a>:</h4>
<p>It used to be one missing proof, now almost everything fails.</p>



<a name="316834259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316834259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316834259">(Dec 19 2022 at 21:27)</a>:</h4>
<p>oops, I tried to look that up on mathlib4 and accidentally created a branch through the web interface instead</p>



<a name="316834285"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316834285" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316834285">(Dec 19 2022 at 21:27)</a>:</h4>
<p>the branch doesn't seem to exist</p>



<a name="316834420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316834420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316834420">(Dec 19 2022 at 21:28)</a>:</h4>
<p>argh, sorry</p>



<a name="316834505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316834505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316834505">(Dec 19 2022 at 21:28)</a>:</h4>
<p>Branch is there now.</p>



<a name="316834584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316834584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316834584">(Dec 19 2022 at 21:29)</a>:</h4>
<p>Whereas back at <a href="https://github.com/leanprover-community/mathlib4/pull/998/commits/be6ad827179e8203d7ec2e34a2c1ac6a721bc9ec">https://github.com/leanprover-community/mathlib4/pull/998/commits/be6ad827179e8203d7ec2e34a2c1ac6a721bc9ec</a> we just had one sorry.</p>



<a name="316835150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316835150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316835150">(Dec 19 2022 at 21:33)</a>:</h4>
<p>I think to a large extent this file should not be ported at all, just set up the statements and move on. It's basically waiting for the porting wave to pass over it so it can be migrated to std properly, and all the proofs will be written or rewritten at that point anyway</p>



<a name="316835222"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316835222" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316835222">(Dec 19 2022 at 21:33)</a>:</h4>
<p>it feels like while the migration is going on it's just going to be pain for the porting process</p>



<a name="316835358"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316835358" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316835358">(Dec 19 2022 at 21:34)</a>:</h4>
<p>I don't really know what to do with that. :-(</p>



<a name="316835386"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316835386" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316835386">(Dec 19 2022 at 21:34)</a>:</h4>
<p>killing every last sorry is possibly counterproductive if the definitions might change</p>



<a name="316835458"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316835458" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316835458">(Dec 19 2022 at 21:35)</a>:</h4>
<p>what we need for migration to continue is to record all the statements we need</p>



<a name="316835689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316835689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316835689">(Dec 19 2022 at 21:37)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  How long do you think the lemmas would have to remain in a <code>sorry</code>'d state?  A week, a month?  I don't really love the idea of leaving sorries in nominally-ported parts of mathlib.</p>



<a name="316835831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316835831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316835831">(Dec 19 2022 at 21:38)</a>:</h4>
<p>It's more an issue of not working on stuff that is currently under active development to avoid stepping on toes</p>



<a name="316835938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316835938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316835938">(Dec 19 2022 at 21:39)</a>:</h4>
<p>I still don't understand what you're proposing we do with <code>Data.Rat.Defs</code>, <code>Data.Rat.Basic</code>, and <code>Data.Rat.Order</code>.</p>



<a name="316836067"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836067" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836067">(Dec 19 2022 at 21:40)</a>:</h4>
<p>I had been assuming until this morning that you were going to fill in a proof of <code>add_def</code> in <code>Data.Rat.Defs</code>, and then we would have these three files ported before christmas.</p>



<a name="316836137"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836137" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836137">(Dec 19 2022 at 21:40)</a>:</h4>
<p><code>add_def</code> is proved</p>



<a name="316836142"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836142" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836142">(Dec 19 2022 at 21:40)</a>:</h4>
<p>But now <code>Data.Rat.Defs</code> is full of broken proofs again, and I'm not sure if you're proposing that we just sorry them all, or what.</p>



<a name="316836212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836212">(Dec 19 2022 at 21:41)</a>:</h4>
<p>I need to take a closer look at the breakage you are talking about but I didn't make any major changes that should break everything</p>



<a name="316836380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836380">(Dec 19 2022 at 21:42)</a>:</h4>
<p>So you added</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">Rat.add_def</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">),</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">normalize</span> <span class="o">(</span><span class="n">a.num</span> <span class="bp">*</span> <span class="bp">↑</span><span class="n">b.den</span> <span class="bp">+</span> <span class="n">b.num</span> <span class="bp">*</span> <span class="bp">↑</span><span class="n">a.den</span><span class="o">)</span> <span class="o">(</span><span class="n">a.den</span> <span class="bp">*</span> <span class="n">b.den</span><span class="o">)</span> <span class="o">:=</span>
</code></pre></div>
<p>and </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">Rat.add_def'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">),</span> <span class="n">a</span> <span class="bp">+</span> <span class="n">b</span> <span class="bp">=</span> <span class="n">mkRat</span> <span class="o">(</span><span class="n">a.num</span> <span class="bp">*</span> <span class="bp">↑</span><span class="n">b.den</span> <span class="bp">+</span> <span class="n">b.num</span> <span class="bp">*</span> <span class="bp">↑</span><span class="n">a.den</span><span class="o">)</span> <span class="o">(</span><span class="n">a.den</span> <span class="bp">*</span> <span class="n">b.den</span><span class="o">)</span> <span class="o">:=</span>
</code></pre></div>
<p>in Std.</p>
<p>But mathlib4 wants:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">add_def''</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">}</span> <span class="o">(</span><span class="n">b0</span> <span class="o">:</span> <span class="n">b</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">d0</span> <span class="o">:</span> <span class="n">d</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">/.</span> <span class="n">b</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">/.</span> <span class="n">d</span> <span class="bp">=</span> <span class="o">(</span><span class="n">a</span> <span class="bp">*</span> <span class="n">d</span> <span class="bp">+</span> <span class="n">c</span> <span class="bp">*</span> <span class="n">b</span><span class="o">)</span> <span class="bp">/.</span> <span class="o">(</span><span class="n">b</span> <span class="bp">*</span> <span class="n">d</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span>
</code></pre></div>



<a name="316836534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836534">(Dec 19 2022 at 21:43)</a>:</h4>
<p>ok so a lot of problems seem to be that <code>mkNat</code> and <code>mkInt</code> have not been aligned</p>



<a name="316836583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836583">(Dec 19 2022 at 21:44)</a>:</h4>
<p>You added a definition of <code>/.</code> that is different than what we had in <code>data_rat_defs</code>, so all the statements involving it have broken too.</p>



<a name="316836635"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836635" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836635">(Dec 19 2022 at 21:44)</a>:</h4>
<p>at least, these definitions still exist on <code>data_rat_defs2</code></p>



<a name="316836701"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836701" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836701">(Dec 19 2022 at 21:44)</a>:</h4>
<p>Yes, <code>data_rat_defs2</code> does not include any attempt to update <code>Mathlib.Data.Rat.Defs</code> for your recent changes to Srtd</p>



<a name="316836723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836723">(Dec 19 2022 at 21:44)</a>:</h4>
<p>oh, where am I supposed to be working then?</p>



<a name="316836733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836733">(Dec 19 2022 at 21:45)</a>:</h4>
<p>It was just to demonstrate that the mathlib4 branch went from one sorry to many errors.</p>



<a name="316836753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836753">(Dec 19 2022 at 21:45)</a>:</h4>
<p>The HEAD of <code>data_rat_defs</code>, I guess?</p>



<a name="316836787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836787">(Dec 19 2022 at 21:45)</a>:</h4>
<p>That appears to be Ruben's effort to update the branch to cope with the changes to Std</p>



<a name="316836833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316836833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316836833">(Dec 19 2022 at 21:45)</a>:</h4>
<p>But I haven't looked at his changes beyond seeing that there are still lots of breakages.</p>



<a name="316837314"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316837314" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316837314">(Dec 19 2022 at 21:49)</a>:</h4>
<p>I'm sorry if I made life harder for you- I'm not currently looking at the branch, but I'd hoped that the new issues would be easier than the ones we had before</p>



<a name="316837350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316837350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316837350">(Dec 19 2022 at 21:49)</a>:</h4>
<p>No problem, we'll get there. :-)</p>



<a name="316837372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316837372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316837372">(Dec 19 2022 at 21:49)</a>:</h4>
<p>all I'm seeing is that all the theorems are being replaced by half broken sorry proofs by one line reference-std proofs</p>



<a name="316837500"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316837500" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316837500">(Dec 19 2022 at 21:50)</a>:</h4>
<p>Okay. Sorry to panic, I wasn't happy about seeing a sea of red.</p>



<a name="316837589"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316837589" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316837589">(Dec 19 2022 at 21:51)</a>:</h4>
<p>To be clear, before we bumped, I'm pretty sure there were exactly two sorries.</p>



<a name="316837604"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316837604" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316837604">(Dec 19 2022 at 21:51)</a>:</h4>
<p>(add_def and sub_def)</p>



<a name="316837710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316837710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316837710">(Dec 19 2022 at 21:52)</a>:</h4>
<p>I had just started trying <code>Data.Rat.Basic</code> and <code>Data.Rat.Order</code>, and then was horrified to discover <code>Data.Rat.Defs</code> was full of errors. :-)</p>



<a name="316838525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316838525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316838525">(Dec 19 2022 at 21:58)</a>:</h4>
<p>it's sorry free now</p>



<a name="316839493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316839493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316839493">(Dec 19 2022 at 22:05)</a>:</h4>
<p>Thanks!</p>



<a name="316839825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316839825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316839825">(Dec 19 2022 at 22:08)</a>:</h4>
<p>Github was confused about the diff, showing a bunch of changes from the std4-update that landed already, so I merged with master</p>



<a name="316840345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316840345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316840345">(Dec 19 2022 at 22:12)</a>:</h4>
<p>Amazing, thank you.</p>



<a name="316841545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316841545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316841545">(Dec 19 2022 at 22:20)</a>:</h4>
<p>I added Data.Rat.Basic</p>



<a name="316849623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316849623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316849623">(Dec 19 2022 at 23:17)</a>:</h4>
<p>I'm confused about casts in <code>Data.Rat.Defs</code>. <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>, would you be able to help here?</p>
<p>We currently have (in <code>Data.Rat.Defs</code>):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">IntCast</span> <span class="n">ℚ</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="n">ofInt</span><span class="o">⟩</span>

<span class="kd">@[simp]</span>
<span class="kd">theorem</span> <span class="n">of_int_eq_cast</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ofInt</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">Int.cast</span> <span class="n">n</span> <span class="o">:=</span>
  <span class="n">rfl</span>
</code></pre></div>
<p>But it seems that the cast via <code>ofInt</code> is still being picked up as the default, and so several later theorems are written with explicit <code>Int.cast</code> so the LHS is in simp normal form.</p>
<p>What do we need to do here to have <code>Int.cast</code> be preferred?</p>



<a name="316852182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316852182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316852182">(Dec 19 2022 at 23:43)</a>:</h4>
<p>I punted on <code>Int.cast</code> before but we might need to move it to std just like <code>Nat.cast</code></p>



<a name="316852430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316852430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316852430">(Dec 19 2022 at 23:45)</a>:</h4>
<p>Okay, for now, I'm going to leave a note explaining that this problem, then merge as is.</p>



<a name="316854015"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316854015" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316854015">(Dec 20 2022 at 00:02)</a>:</h4>
<p>do you have an example with the issue?</p>



<a name="316854088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316854088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316854088">(Dec 20 2022 at 00:03)</a>:</h4>
<p>also I put a <code>attribute [-simp]</code> in data.rat.defs, this should be noted as a temporary workaround</p>



<a name="316854284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316854284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316854284">(Dec 20 2022 at 00:04)</a>:</h4>
<p>(the longer story is that <code>mkRat</code> is now preferred over <code>divInt</code> when the denominator is nonnegative, but this needs <code>mkRat</code> to have more API and simp lemmas to match mathlib's theorems about <code>/.</code>)</p>



<a name="316858671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316858671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316858671">(Dec 20 2022 at 00:53)</a>:</h4>
<p>I'd like to change</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">coe_int_eq_divInt</span> <span class="o">(</span><span class="n">z</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="n">Int.cast</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">z</span> <span class="bp">/.</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">num_den'</span>
</code></pre></div>
<p>to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">coe_int_eq_divInt</span> <span class="o">(</span><span class="n">z</span> <span class="o">:</span> <span class="n">ℤ</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">z</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="bp">=</span> <span class="n">z</span> <span class="bp">/.</span> <span class="mi">1</span> <span class="o">:=</span> <span class="n">num_den'</span>
</code></pre></div>
<p>but this messes up proofs later. Presumably they are fixable, I'm just not sure if I should do this now or not.</p>



<a name="316858989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316858989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316858989">(Dec 20 2022 at 00:57)</a>:</h4>
<p>Oh, I seem to have sorted it out.</p>



<a name="316863143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316863143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316863143">(Dec 20 2022 at 01:48)</a>:</h4>
<p>Data.Rat.Defs is hopefully all ready to go.</p>
<p>The two missing facts for <code>Data.Rat.Order</code> are:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">lt_iff_le_not_le</span> <span class="o">{</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">}</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">&lt;</span> <span class="n">b</span> <span class="bp">↔</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">∧</span> <span class="bp">¬</span><span class="n">b</span> <span class="bp">≤</span> <span class="n">a</span>  <span class="o">:=</span> <span class="bp">...</span>
<span class="kd">theorem</span> <span class="n">le_iff_sub_num_nonneg</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">ℚ</span><span class="o">)</span> <span class="o">:</span> <span class="n">a</span> <span class="bp">≤</span> <span class="n">b</span> <span class="bp">↔</span> <span class="mi">0</span> <span class="bp">≤</span> <span class="o">(</span><span class="n">b</span> <span class="bp">-</span> <span class="n">a</span><span class="o">)</span><span class="bp">.</span><span class="n">num</span> <span class="o">:=</span> <span class="bp">...</span>
</code></pre></div>
<p>These probably belong in <code>Std</code>.</p>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>, would you like to do this, or shall I have a go?</p>



<a name="316863289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316863289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316863289">(Dec 20 2022 at 01:51)</a>:</h4>
<p>do you have a proof relative to some <code>le_def</code> similar to the old definition?</p>



<a name="316863441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316863441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316863441">(Dec 20 2022 at 01:52)</a>:</h4>
<p>It looks like the definition trivially satisfies <code>a &lt; b &lt;-&gt; !(b &lt;= a)</code> so it probably comes down to transitivity and asymmetry of <code>&lt;</code></p>



<a name="316863758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316863758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316863758">(Dec 20 2022 at 01:57)</a>:</h4>
<p><code>le_iff_sub_num_nonneg</code> is essentially relating the new Std4 definition with the old mathlib3 definition. (But it's stated purely in std4 language).</p>



<a name="316864051"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316864051" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316864051">(Dec 20 2022 at 02:01)</a>:</h4>
<p>So, no, I don't have a proof of <code>le_iff_sub_num_nonneg</code> to work from, since the lhs is the new Std4 definition which mathlib3 didn't talk about.</p>



<a name="316864134"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316864134" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316864134">(Dec 20 2022 at 02:02)</a>:</h4>
<p>aha, I see. (The lt definition is a bit lazy, it could have been just lt &lt;-&gt; not le like it is now)</p>



<a name="316864205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Rat.Defs/near/316864205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2ERat.2EDefs.html#316864205">(Dec 20 2022 at 02:03)</a>:</h4>
<p>I'm done for the day, but I can work on it tomorrow</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>