---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html">[CI] error getting cache</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="322386482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322386482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322386482">(Jan 19 2023 at 21:52)</a>:</h4>
<p>on <a href="https://github.com/leanprover-community/mathlib4/pull/1692">mathlib4#1692</a>, I'm getting a CI error due to cache. how can I fix this? I already tried rerunning CI: <a href="https://github.com/leanprover-community/mathlib4/actions/runs/3962301364/jobs/6788845462">https://github.com/leanprover-community/mathlib4/actions/runs/3962301364/jobs/6788845462</a></p>



<a name="322396059"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322396059" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322396059">(Jan 19 2023 at 22:55)</a>:</h4>
<p>Importing <code>Mathlib.Data.Int.Gcd</code> is causing <code>cache</code> to search for a <code>Mathlib/Data/Int/Gcd.lean</code>, but the file is called <code>Mathlib/Data/Int/GCD.lean</code></p>



<a name="322396159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322396159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322396159">(Jan 19 2023 at 22:56)</a>:</h4>
<p>Is Lean's import system case insensitive? (and out of curiosity, if so, why?)</p>



<a name="322396764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322396764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322396764">(Jan 19 2023 at 23:00)</a>:</h4>
<p>Anyway, the easy solution is doing <code>import Mathlib.Data.Int.GCD</code> instead</p>



<a name="322396937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322396937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322396937">(Jan 19 2023 at 23:01)</a>:</h4>
<p>Can we make <code>cache</code> ignore import errors?</p>



<a name="322397162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322397162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322397162">(Jan 19 2023 at 23:03)</a>:</h4>
<p>It needs the right imports to properly compute the file hash</p>



<a name="322397294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322397294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322397294">(Jan 19 2023 at 23:04)</a>:</h4>
<p>I mean, when I used <code>lake build</code> and ran this file stuff was fine so however it's done it should be the same level of dependence on casing either way</p>



<a name="322397312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322397312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322397312">(Jan 19 2023 at 23:04)</a>:</h4>
<p>(also this import was generated by mathport so that should get fixed at the mathport level)</p>



<a name="322400383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322400383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322400383">(Jan 19 2023 at 23:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322396159">said</a>:</p>
<blockquote>
<p>Is Lean's import system case insensitive? (and out of curiosity, if so, why?)</p>
</blockquote>
<p>In some of my ports I had to fix the case of some imports since they showed up as errors</p>



<a name="322400979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322400979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322400979">(Jan 19 2023 at 23:34)</a>:</h4>
<p>That's just when we change the case relative to mathport</p>



<a name="322402387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322402387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322402387">(Jan 19 2023 at 23:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322397162">said</a>:</p>
<blockquote>
<p>It needs the right imports to properly compute the file hash</p>
</blockquote>
<p>Yes, I understand that.  I think we should just print a warning in this case and ignore the file, instead of failing completely as we do now.</p>



<a name="322403347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322403347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322403347">(Jan 19 2023 at 23:58)</a>:</h4>
<p>I'm thinking through the consequences. It would create a hash chain that's unresponsive to changes. Meaning that eventual changes to <code>Mathlib/Data/Int/GCD.lean</code> wouldn't trigger a change in the hashes of the files that import it, generating a breach for a cascade of hash collisions</p>



<a name="322403597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322403597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322403597">(Jan 20 2023 at 00:00)</a>:</h4>
<p>I think the suggestion is simply to skip constructing the file cache for that file and all its dependents</p>



<a name="322403633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322403633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322403633">(Jan 20 2023 at 00:01)</a>:</h4>
<p>meaning that the file has to be rebuilt from scratch</p>



<a name="322403712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322403712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322403712">(Jan 20 2023 at 00:01)</a>:</h4>
<p>we don't want to make a cache file unless we can do so correctly, but if we can't it shouldn't break the build</p>



<a name="322404057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322404057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322404057">(Jan 20 2023 at 00:05)</a>:</h4>
<p>Okay, but then if a file with an incorrect import sneaks in, it will cause <code>cache</code> not to do its job many times</p>



<a name="322404131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322404131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322404131">(Jan 20 2023 at 00:05)</a>:</h4>
<p>I think that's an independent issue</p>



<a name="322404439"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322404439" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322404439">(Jan 20 2023 at 00:08)</a>:</h4>
<p>Right. If it were me, I wouldn't be willing to pay the price of such sneaky and viral increase in computational cost for the price of a few simple import line change</p>



<a name="322404513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322404513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322404513">(Jan 20 2023 at 00:09)</a>:</h4>
<p>Because it will take someone's eye to notice "hey, cache is taking too long here". And then it might be the case that it's been recomputing a lot of things because one import line was wrong 20 (or who knows how many) PRs ago</p>



<a name="322404938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322404938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322404938">(Jan 20 2023 at 00:12)</a>:</h4>
<p>at least it shouldn't give such an error that doesn't explain the likely source. i assume the imports that mathport gives are the golden standard, so I'd never be tempted to check them</p>



<a name="322405266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322405266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322405266">(Jan 20 2023 at 00:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322404938">said</a>:</p>
<blockquote>
<p>i assume the imports that mathport gives are the golden standard, so I'd never be tempted to check them</p>
</blockquote>
<p>That is very far from the truth. Mathport is especially bad at imports right now, and most of the work is being done by regexes in <a href="http://start_port.sh">start_port.sh</a></p>



<a name="322405441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322405441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322405441">(Jan 20 2023 at 00:17)</a>:</h4>
<p>/poll What to do with wrong imports?<br>
Skip caching for it and accept the risk of sneaky and viral increases in the CI time and computational cost<br>
Just print a better error message</p>



<a name="322405541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322405541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322405541">(Jan 20 2023 at 00:18)</a>:</h4>
<p>It should not be failing if lean is okay with the import. If lean is not okay then it doesn't really matter, does it?</p>



<a name="322405546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322405546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322405546">(Jan 20 2023 at 00:18)</a>:</h4>
<blockquote>
<p>Because it will take someone's eye to notice "hey, cache is taking too long here".</p>
</blockquote>
<p>My suggestion was to print a warning in this case.</p>
<blockquote>
<p>And then it might be the case that it's been recomputing a lot of things because one import line was wrong 20 (or who knows how many) PRs ago</p>
</blockquote>
<p>If the PR has been merged into master, then the imports will be correct.</p>



<a name="322405602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322405602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322405602">(Jan 20 2023 at 00:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322405266">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322404938">said</a>:</p>
<blockquote>
<p>i assume the imports that mathport gives are the golden standard, so I'd never be tempted to check them</p>
</blockquote>
<p>That is very far from the truth. Mathport is especially bad at imports right now, and most of the work is being done by regexes in <a href="http://start_port.sh">start_port.sh</a></p>
</blockquote>
<p>I've added a note in the wiki for this</p>



<a name="322405735"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322405735" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322405735">(Jan 20 2023 at 00:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322405546">said</a>:</p>
<blockquote>
<p>If the PR has been merged into master, then the imports will be correct.</p>
</blockquote>
<p>Then building would fail in this case?</p>



<a name="322405779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322405779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322405779">(Jan 20 2023 at 00:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="451983">Arthur Paulino</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322404057">said</a>:</p>
<blockquote>
<p>Okay, but then if a file with an incorrect import sneaks in, it will cause <code>cache</code> not to do its job many times</p>
</blockquote>
<p>To be clear: in my suggestion, we would skip all files that depend on the missing file.  We wouldn't produce (or query) caches for files with transitively missing imports.</p>



<a name="322405881"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322405881" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322405881">(Jan 20 2023 at 00:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322397294">said</a>:</p>
<blockquote>
<p>I mean, when I used <code>lake build</code> and ran this file stuff was fine</p>
</blockquote>
<p>Then why did this happen?</p>



<a name="322406187"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322406187" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322406187">(Jan 20 2023 at 00:24)</a>:</h4>
<p>That's the second issue, independent of whether cache should break the build. It sounds like the import resolution algorithm is not the same in the cache as in lake/lean4</p>



<a name="322406399"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322406399" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322406399">(Jan 20 2023 at 00:26)</a>:</h4>
<p>Lean is case sensitive, but it can run on file systems that are not so I think it is possible for a mis-cased import to resolve anyway</p>



<a name="322406702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322406702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322406702">(Jan 20 2023 at 00:28)</a>:</h4>
<p>I suppose to catch this you would need to (when reading an <code>import Foo</code>) stat <code>Foo.lean</code> and check that the file name is in fact <code>Foo.lean</code> and not <code>fOo.lean</code></p>



<a name="322409467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322409467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322409467">(Jan 20 2023 at 00:51)</a>:</h4>
<p>PR: <a href="https://github.com/leanprover-community/mathlib4/pull/1698">mathlib4#1698</a></p>



<a name="322409914"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322409914" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322409914">(Jan 20 2023 at 00:55)</a>:</h4>
<p>Oh, wait, it can be optimized. I can cache those to avoid multiple lookups on the filesystem</p>



<a name="322410734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322410734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322410734">(Jan 20 2023 at 01:02)</a>:</h4>
<p>Why not fetch caches</p>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322406399">said</a>:</p>
<blockquote>
<p>Lean is case sensitive, but it can run on file systems that are not so I think it is possible for a mis-cased import to resolve anyway</p>
</blockquote>
<p>This might be a bug if it does; I don't think <a href="https://peps.python.org/pep-0235/">python behaves this way</a>. The check for case sensitivity should be in lean's import mechanism, not just the cache tool</p>



<a name="322411023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322411023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322411023">(Jan 20 2023 at 01:05)</a>:</h4>
<p>yes that's what I meant. Since the cache tool is failing and not lean it sounds like lean is to blame for erroneously allowing the import</p>



<a name="322411122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322411122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322411122">(Jan 20 2023 at 01:06)</a>:</h4>
<p>I'm not entirely sure how the resolution works, it might be lake's responsibility</p>



<a name="322414442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322414442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322414442">(Jan 20 2023 at 01:40)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/1698">mathlib4#1698</a> is updated</p>



<a name="322415205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322415205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322415205">(Jan 20 2023 at 01:50)</a>:</h4>
<p>But TBH I don't agree with it. I think the appropriate approach would be to assume that the imports are correct and to print a better error message if the respective file can't be found (the assumption wasn't fulfilled), but still fail in the later case. Then if Lean is accepting weirdly cased imports on some machines, that should be taken care of separately</p>



<a name="322415919"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322415919" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322415919">(Jan 20 2023 at 01:58)</a>:</h4>
<p>I mean, what's the point of avoiding a <code>cache</code> failure just to expect <code>lake build</code> to fail after a reasonably more expensive computation? It's better to fail earlier.</p>



<a name="322417219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322417219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322417219">(Jan 20 2023 at 02:15)</a>:</h4>
<p>Here's the alternative solution: <a href="https://github.com/leanprover-community/mathlib4/pull/1700">mathlib4#1700</a></p>
<p>Feel free to pick any of the two</p>



<a name="322427089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322427089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322427089">(Jan 20 2023 at 04:35)</a>:</h4>
<p><span class="user-mention" data-user-id="284160">@Eric Rodriguez</span> Please PR the <code>Gcd/GCD</code> name change to <code>start_port.sh</code>.</p>



<a name="322446150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322446150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322446150">(Jan 20 2023 at 07:45)</a>:</h4>
<p>I suspect GCD is being turned into Gcd by some camel casing logic, similar to what happened to ENat, which became Enat a few days ago.</p>



<a name="322447654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322447654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322447654">(Jan 20 2023 at 07:55)</a>:</h4>
<p>What do you mean?</p>



<a name="322447695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322447695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322447695">(Jan 20 2023 at 07:55)</a>:</h4>
<p>mathport has to guess a Lean 4 import name, from the Lean 3 name.</p>



<a name="322447719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322447719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322447719">(Jan 20 2023 at 07:56)</a>:</h4>
<p>So it is turning <code>gcd</code> into <code>Gcd</code>.</p>



<a name="322447833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322447833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322447833">(Jan 20 2023 at 07:56)</a>:</h4>
<p>And <code>start_port.sh</code> can use a little bit of sed magic to fix that into <code>GCD</code>, before the porter even runs <code>lake exe cache get</code>.</p>



<a name="322476926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322476926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322476926">(Jan 20 2023 at 10:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322427089">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="284160">Eric Rodriguez</span> Please PR the <code>Gcd/GCD</code> name change to <code>start_port.sh</code>.</p>
</blockquote>
<p>if i got the syntax correct, <a href="https://github.com/leanprover-community/mathlib4/pull/1714">mathlib4#1714</a></p>



<a name="322509237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322509237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322509237">(Jan 20 2023 at 13:11)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache/near/322447695">said</a>:</p>
<blockquote>
<p>mathport has to guess a Lean 4 import name, from the Lean 3 name.</p>
</blockquote>
<p>Got it. So it's called <code>gcd.lean</code> in Lean 3</p>



<a name="322595303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322595303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322595303">(Jan 20 2023 at 19:09)</a>:</h4>
<blockquote>
<p>But TBH I don't agree with it. I think the appropriate approach would be to assume that the imports are correct and to print a better error message if the respective file can't be found (the assumption wasn't fulfilled), but still fail in the later case.</p>
</blockquote>
<p>Let me make the case for the opposite behavior.  If a file doesn't compile (for any other reason than misspelled imports), then <code>lake exe cache get</code> will not fetch caches either---simply because Lean never produces an olean file and the <code>cache</code> will always get a 404.</p>
<p>It is only consistent to do the same for missing/mistyped imports: this is just another compile error.  It would be confusing if one kind of compile error made <code>cache</code> refuse to do anything, while another kind of compile error would just silently result in no caches with no message whatsoever.</p>



<a name="322595475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322595475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322595475">(Jan 20 2023 at 19:10)</a>:</h4>
<blockquote>
<p>Then if Lean is accepting weirdly cased imports on some machines, that should be taken care of separately</p>
</blockquote>
<p>But I completely agree with that part.</p>



<a name="322602804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/%5BCI%5D%20error%20getting%20cache/near/322602804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/.5BCI.5D.20error.20getting.20cache.html#322602804">(Jan 20 2023 at 19:51)</a>:</h4>
<p>I understand that it's more consistent, but it's also more expensive. If the computation of hashes can spot a build flaw earlier, there's no point in calling the building procedure. There is no point in downloading and decompressing anything either.</p>
<p>It's a tradeoff, but it's up to you. I would pick the early failure detection side-effect</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>