---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html">premature "goals accomplished"</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="316459875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316459875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316459875">(Dec 17 2022 at 13:43)</a>:</h4>
<p>Could we report an error (or warning) on the <code>exact</code> line?</p>



<a name="316460023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316460023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> David Renshaw <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316460023">(Dec 17 2022 at 13:44)</a>:</h4>
<p>It seems to me that the core problem is that the parsing error shows up far away from where it needs to be addressed.</p>



<a name="316461726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316461726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316461726">(Dec 17 2022 at 13:55)</a>:</h4>
<p>Mario and I just PM'd a bit about this, and I quote some of his comments with his permission.  He clarifies the proposal from the meeting on Thursday and points out that it still doesn't make "goals accomplished" work as expected in some cases:</p>
<blockquote>
<p>the proposal was basically to not use goals accomplished if there are any synthetic sorries in the goal, such as might be created by an erroring tactic</p>
</blockquote>
<blockquote>
<p>that's still a bit non-local though, for example here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">True</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="k">have</span> <span class="o">:</span> <span class="n">True</span> <span class="o">:=</span> <span class="kd">by</span>
    <span class="n">apply</span> <span class="n">id</span>
    <span class="n">exact</span> <span class="n">trivial</span>
    <span class="c1">-- here</span>
  <span class="n">apply</span> <span class="n">id</span>
  <span class="n">exact</span> <span class="n">syntax</span> <span class="n">error</span>
</code></pre></div>
<p>in this example, we will get a "goals accomplished" message at the indicated location currently, do you find this to be a good thing or a bad thing? Under the proposal this will be shown as "no goals" because of the syntax error on a later line</p>
</blockquote>



<a name="316462166"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316462166" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316462166">(Dec 17 2022 at 13:58)</a>:</h4>
<p>And regarding the <a href="#narrow/stream/113489-new-members/topic/behaviour.20of.20.60exact.60.20in.20lean4/near/307512598">example at hand</a> in this thread, he concludes as <span class="user-mention" data-user-id="243791">@David Renshaw</span> did that the premature "goals accomplished" is really a symptom, not a cause, the cause being Lean 4's "better" (i.e., more optimistic, and less dependent on separators like <code>,</code>) parser than Lean 3.</p>
<blockquote>
<p>that's because lean 3 completely falls over when there is a parse error</p>
</blockquote>
<blockquote>
<p>when there are parse errors you can't get anything useful from the goal view</p>
</blockquote>
<blockquote>
<p>so you have to be really good about putting commas and underscores when working with lean</p>
</blockquote>
<blockquote>
<p>count all the instances of <strong>don't forget the comma</strong> in NNG</p>
</blockquote>



<a name="316462747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316462747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316462747">(Dec 17 2022 at 14:02)</a>:</h4>
<p>Personally, I have come to the conclusion that there is no possibility of having a sensible "goals accomplished" in Lean 4.  It is a tradeoff, basically, and we lost it when we got rid of the commas.  I propose that we rename "goals accomplished" to "no goals" so that it seems to imply no particular promise.</p>



<a name="316462817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316462817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316462817">(Dec 17 2022 at 14:02)</a>:</h4>
<p>For teaching I would combine that with <span class="user-mention" data-user-id="243562">@Adam Topaz</span>'s suggestion of inserting <code>done</code> at the end of each exercise so that at least the errors get localised to one exercise and don't drift into the next.  (Or maybe we can bring back <code>begin</code>/<code>end</code> for teaching purposes only.)</p>



<a name="316463492"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316463492" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316463492">(Dec 17 2022 at 14:07)</a>:</h4>
<p>8 messages were moved here from <a class="stream-topic" data-stream-id="113489" href="/#narrow/stream/113489-new-members/topic/behaviour.20of.20.02klzzwxh.3A0000.03.20in.20lean4">#new members &gt; behaviour of <code>exact</code> in lean4</a> by <span class="user-mention silent" data-user-id="260507">Heather Macbeth</span>.</p>



<a name="316463805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316463805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316463805">(Dec 17 2022 at 14:09)</a>:</h4>
<p>Is wrapping exercises in <code>section</code>/<code>end</code> enough to contain errors?</p>



<a name="316463977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316463977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316463977">(Dec 17 2022 at 14:10)</a>:</h4>
<p>It is, but that's less readable than having <code>begin</code>/<code>end</code> proof blocks in my opinion.</p>



<a name="316464074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316464074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316464074">(Dec 17 2022 at 14:11)</a>:</h4>
<p>I imagine it would be quite easy to write a <code>done?</code> variant of <code>done</code> that displays <code>goals accomplished</code> if there are no metavariables and a <code>proof incomplete</code> or something otherwise</p>



<a name="316464225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316464225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316464225">(Dec 17 2022 at 14:12)</a>:</h4>
<p>And if we change the generic goals accomished message to "no goals", that would be a reasonable solution IMO</p>



<a name="316464599"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316464599" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316464599">(Dec 17 2022 at 14:15)</a>:</h4>
<p>Perhaps it doesn't even need to be a variant, this could just be the standard behaviour of <code>done</code>.</p>



<a name="316465021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465021">(Dec 17 2022 at 14:18)</a>:</h4>
<p>Or maybe we can call it <code>qed</code> (à la Coq) rather than <code>done?</code>.  With unicode <code>□</code> even!</p>



<a name="316465441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465441">(Dec 17 2022 at 14:20)</a>:</h4>
<p>I would rather have us fix our broken heuristics (if we can figure out the behavior we want) than regress the user experience</p>



<a name="316465519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465519">(Dec 17 2022 at 14:21)</a>:</h4>
<p>for example, if the issue is that <code>exact</code> reports a parse error on the next command, well let's fix that</p>



<a name="316465541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465541">(Dec 17 2022 at 14:21)</a>:</h4>
<p>...where should it report an error?</p>



<a name="316465652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465652">(Dec 17 2022 at 14:22)</a>:</h4>
<p>the parser's behavior here is very sensible, it is giving an error on the token that can't be parsed</p>



<a name="316465684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465684">(Dec 17 2022 at 14:22)</a>:</h4>
<p>which happens to be the one on the next command</p>



<a name="316465729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465729">(Dec 17 2022 at 14:22)</a>:</h4>
<p>I agree Mario, of course. But having such a <code>qed</code> tactic would be nice anyway, especially if it gives you a count of the remaining goals.</p>



<a name="316465755"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465755" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465755">(Dec 17 2022 at 14:23)</a>:</h4>
<p>now if that token happens to be to the left of the <code>position</code> mark, then it couldn't be part of the command anyway so maybe we should shift the blame earlier</p>



<a name="316465759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465759">(Dec 17 2022 at 14:23)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> To clarify, which of these proposals do you consider a regression of the user experience? The phrasing "goals accomplished" vs "no goals", or inserting <code>done</code>/<code>qed</code> so that errors don't flow on to the next declaration?</p>



<a name="316465797"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465797" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465797">(Dec 17 2022 at 14:23)</a>:</h4>
<p>the loss of "goals accomplished" in common scenarios is a regression</p>



<a name="316465852"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465852" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465852">(Dec 17 2022 at 14:23)</a>:</h4>
<p>Mario, I thought you didn't care about whether it was called "goals accomplished" or "no goals"?</p>



<a name="316465938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465938">(Dec 17 2022 at 14:24)</a>:</h4>
<p>I don't, personally, but some others do and I remember it being a big thing when it was first added to lean 3</p>



<a name="316465976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316465976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316465976">(Dec 17 2022 at 14:24)</a>:</h4>
<p>it's literally just some text but it helps with gamifying the experience</p>



<a name="316466100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316466100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316466100">(Dec 17 2022 at 14:25)</a>:</h4>
<p>inserting <code>done</code> is a fine hack if it helps you with controlling the messages, but it's clearly not where we are going long term</p>



<a name="316466370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316466370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316466370">(Dec 17 2022 at 14:27)</a>:</h4>
<p>and for me personally, I don't like having to add things like that and then remove them when the proof is done, it makes me think about whether it is worth adding in this case and that's a waste of brain cells</p>



<a name="316466508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316466508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316466508">(Dec 17 2022 at 14:28)</a>:</h4>
<p>I'd be delighted if we can get "goals accomplished" working eventually, but in the short term (until someone has time for that) I think renaming to "no goals" is a strict improvement.</p>



<a name="316466592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316466592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316466592">(Dec 17 2022 at 14:28)</a>:</h4>
<p>well I'm trying to evince a specification with these questions</p>



<a name="316466629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316466629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316466629">(Dec 17 2022 at 14:29)</a>:</h4>
<p>I think there is not much preventing us from implementing whatever in this space</p>



<a name="316466652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316466652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316466652">(Dec 17 2022 at 14:29)</a>:</h4>
<p>the server knows a lot about what is going on</p>



<a name="316466702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316466702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316466702">(Dec 17 2022 at 14:29)</a>:</h4>
<p>For such a specification, maybe <span class="user-mention" data-user-id="306577">@Matthew Ballard</span> has some good test cases from his experience teaching with Lean 4.</p>



<a name="316467354"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316467354" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316467354">(Dec 17 2022 at 14:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316465755">said</a>:</p>
<blockquote>
<p>now if that token happens to be to the left of the <code>position</code> mark, then it couldn't be part of the command anyway so maybe we should shift the blame earlier</p>
</blockquote>
<p>And certainly this seems like an excellent proposed change to <code>exact</code>.</p>



<a name="316470454"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316470454" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316470454">(Dec 17 2022 at 14:55)</a>:</h4>
<p>To be honest I see disparition of <code>begin</code>/<code>end</code> as a big regression whatever the context (teaching or not). Having the error message saying the proof isn't finished at the beginning of the proof is really annoying. I wanted to propose that we simply restore begin/end in mathlib.</p>



<a name="316470632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316470632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316470632">(Dec 17 2022 at 14:57)</a>:</h4>
<p>I simply don't understand what is the expected gain in this change. Is it the number of keystrokes? You can easily setup a 2 letters long abbreviation that VSCode turns into begin/end</p>



<a name="316471108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316471108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316471108">(Dec 17 2022 at 15:00)</a>:</h4>
<p>having had a recent need to use pascal, I can say I am really not a fan of <code>begin</code>/<code>end</code>: it is verbose, it doesn't work with bracket matching, it makes indentation around it more work unless you have a good autoformatter</p>



<a name="316472133"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316472133" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316472133">(Dec 17 2022 at 15:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316462166">said</a>:</p>
<blockquote>
<p>the premature "goals accomplished" is really a symptom, not a cause, the cause being Lean 4's "better" (i.e., more optimistic, and less dependent on separators like <code>,</code>) parser than Lean 3.</p>
</blockquote>
<p>But that would be trivial to at least take into account in the error message - something like "no goals left at this point, but errors are present in the current declaration"</p>



<a name="316472228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316472228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316472228">(Dec 17 2022 at 15:07)</a>:</h4>
<p>Personally, I could see using <code>done</code> always as a default for teaching. <code>begin ... end</code> just becomes <code>by ... done</code>. For students I think this is ideal because it forces them to claim the proof is over. Maybe there could even be an option to make it a requirement (by Lean) of some sort. Although I'm fine if <code>done</code> were omitted in mathlib.</p>



<a name="316472583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316472583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316472583">(Dec 17 2022 at 15:10)</a>:</h4>
<p>It's easy to make a linter that requires <code>done</code> on all by blocks</p>



<a name="316472794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316472794" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316472794">(Dec 17 2022 at 15:11)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> Sure, I even think "no goals" is a suggestive enough message here, and <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316462747">my proposal</a> (at least for the short term) is to rephrase "goals accomplished" to "no goals".</p>
<p>But as <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316465938">Mario points out</a>, a lot of people like the more optimistic "goals accomplished" phrasing if we can find a way to show that when it happens to be appropriate.</p>



<a name="316473124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473124">(Dec 17 2022 at 15:14)</a>:</h4>
<p>So to clarify, my proposal is to show that specific message only in the circumstance described by it</p>



<a name="316473248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473248">(Dec 17 2022 at 15:15)</a>:</h4>
<p>And even then, it probably doesn't have to be shown if all remaining error messages are "unsolved goals"</p>



<a name="316473442"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473442" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473442">(Dec 17 2022 at 15:16)</a>:</h4>
<p>Here are some cases that we might want to take into account:</p>
<ul>
<li>Goals accomplished <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span> everything is done</li>
<li>Goals accomplished, but you used <code>sorry</code></li>
<li>No goals remaining, a tactic in this block threw an error</li>
<li>Goals accomplished, but there is an error elsewhere in the proof (not in this block)</li>
<li>Subgoals accomplished, but this is a by block nested in another one (which may or may not be complete)</li>
</ul>



<a name="316473508"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473508" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473508">(Dec 17 2022 at 15:16)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> would such a linter force <code>done</code> on a subproof without an explicit <code>by</code>?</p>



<a name="316473545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473545">(Dec 17 2022 at 15:17)</a>:</h4>
<p>what does that mean?</p>



<a name="316473584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473584">(Dec 17 2022 at 15:17)</a>:</h4>
<p>Either should be implementable</p>



<a name="316473617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473617">(Dec 17 2022 at 15:17)</a>:</h4>
<p>like <code>example : 1 = 1 := rfl</code> instead of <code>example : 1 = 1 := by rfl; done</code>?</p>



<a name="316473664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jason Rute <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473664">(Dec 17 2022 at 15:17)</a>:</h4>
<p>I have a silly question.  When <code>by</code> is started, tactics have to be on the same line or on later lines and indented right?  If so, can't lean 4 find the last indented line and basically automatically run <code>done</code> there with a nice error message?</p>



<a name="316473810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473810">(Dec 17 2022 at 15:18)</a>:</h4>
<p>I think it is difficult to get vscode to highlight a span that isn't in the text</p>



<a name="316473819"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473819" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473819">(Dec 17 2022 at 15:18)</a>:</h4>
<p>No, like when you generate multiple goals and you focus (or further indent?) one of the goals. Sorry, on mobile so typing Lean is hard.</p>



<a name="316473968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316473968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316473968">(Dec 17 2022 at 15:19)</a>:</h4>
<p>like if you have</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">True</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">apply</span> <span class="n">id</span>

<span class="c1">-- ^ that line</span>
</code></pre></div>
<p>with no indentation on the last line, the span we want to highlight is not addressable by vscode line/col indexing</p>



<a name="316474250"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316474250" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316474250">(Dec 17 2022 at 15:21)</a>:</h4>
<p>it is probably fine to just put a highlight at column 0 though, or the right column provided there is an indent there</p>



<a name="316474448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316474448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316474448">(Dec 17 2022 at 15:22)</a>:</h4>
<p>vscode will round the position to the nearest addressable location no matter what we do, which isn't a horrible place to put the highlight</p>



<a name="316474453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316474453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316474453">(Dec 17 2022 at 15:22)</a>:</h4>
<p>Just to give some more context that may not be obvious: an "unsolved goals" error message actually extends over the entire block, but we tweaked its display so that the squigglies are shown on the first line only, as otherwise half your screen is red. That's why you can see the message in the "Messages" (not "All Messages") list even if your cursor is not on the squiggly itself.</p>



<a name="316474523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316474523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316474523">(Dec 17 2022 at 15:23)</a>:</h4>
<p>Huh. What though if we put the full line range of the unsolved goals error in the progress bar thingy to the left of the editor?</p>



<a name="316474570"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316474570" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316474570">(Dec 17 2022 at 15:23)</a>:</h4>
<p>what progress bar?</p>



<a name="316474641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316474641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316474641">(Dec 17 2022 at 15:24)</a>:</h4>
<p>The usually-orange progress indicator</p>



<a name="316474717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316474717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316474717">(Dec 17 2022 at 15:25)</a>:</h4>
<p>would it just highlight the error span of the currently displayed message?</p>



<a name="316474779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316474779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316474779">(Dec 17 2022 at 15:25)</a>:</h4>
<p>I think that those kind of messages are generally bugs</p>



<a name="316474807"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316474807" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316474807">(Dec 17 2022 at 15:25)</a>:</h4>
<p>so I don't want to encourage their use</p>



<a name="316474978"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316474978" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316474978">(Dec 17 2022 at 15:26)</a>:</h4>
<p>the single line highlighting is a hack to minimize the pain of an error that covers 30 lines, but it should just have a better span</p>



<a name="316475041"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316475041" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316475041">(Dec 17 2022 at 15:26)</a>:</h4>
<p>I would say all error messages should leave a red mark in the progress indicator. I think Isabelle does this as well.</p>



<a name="316475091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316475091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316475091">(Dec 17 2022 at 15:27)</a>:</h4>
<p>you already get red marks from the diagnostics</p>



<a name="316475124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316475124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316475124">(Dec 17 2022 at 15:27)</a>:</h4>
<p>the scroll bar gets little red ticks in it</p>



<a name="316475146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316475146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316475146">(Dec 17 2022 at 15:27)</a>:</h4>
<p>You mean on the scroll bar?</p>



<a name="316475300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316475300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316475300">(Dec 17 2022 at 15:29)</a>:</h4>
<p>Right, that's helpful too, but if we want to highlight multiple lines as close to the actual editor as possible without swimming in squigglies, the progress indicator seems to be the best choice</p>



<a name="316475820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316475820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316475820">(Dec 17 2022 at 15:32)</a>:</h4>
<p>I don't disagree, I think that would be a good way to handle such errors... but also we should find and remove those errors when we can</p>



<a name="316475950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316475950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316475950">(Dec 17 2022 at 15:33)</a>:</h4>
<p>I'm not sure what you mean by that. I'm assuming you don't want to get rid of all "unsolved goals" errors.</p>



<a name="316476144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316476144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316476144">(Dec 17 2022 at 15:35)</a>:</h4>
<p>I think we need to put unsolved goals errors in the right place. As pointed out up-thread they should not be at the <code>by</code> in the first place</p>



<a name="316476284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316476284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316476284">(Dec 17 2022 at 15:36)</a>:</h4>
<p>I really wish we would move forward with empty blocks already, since in that case you could just use <code>.</code> as an alternative to <code>done</code></p>



<a name="316476641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316476641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316476641">(Dec 17 2022 at 15:39)</a>:</h4>
<p>I don't mind empty blocks, but putting <code>.</code> sounds like just another workaround. Especially since there's not all that much space to put squigglies on there.</p>



<a name="316476788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316476788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316476788">(Dec 17 2022 at 15:40)</a>:</h4>
<p>In any case, both our proposals don't address the "parse error in <code>exact</code>" issue because there's no "unsolved goals" error there to begin with</p>



<a name="316477641"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316477641" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316477641">(Dec 17 2022 at 15:47)</a>:</h4>
<p>actually you're right, <code>.</code> isn't good. What should really work is Jason's suggestion, that is simply indenting to the right place</p>



<a name="316477718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316477718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316477718">(Dec 17 2022 at 15:47)</a>:</h4>
<p>because that is invariably where you end up when you are thinking about what to do next</p>



<a name="316477952"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316477952" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316477952">(Dec 17 2022 at 15:49)</a>:</h4>
<p>I just now ran into this issue with the following pattern:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="mi">1</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">∧</span> <span class="mi">2</span> <span class="bp">+</span> <span class="mi">2</span> <span class="bp">=</span> <span class="mi">4</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">constructor</span>
  <span class="bp">·</span>
  <span class="c1">--^ cursor here, 2 + 2 = 4 is displayed as the tactic state</span>
</code></pre></div>



<a name="316494968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316494968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Trebor Huang <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316494968">(Dec 17 2022 at 18:17)</a>:</h4>
<p>The rulers in VSCode do appear out of nowhere right? Like, a straight line at the 80th character. Would a similar technique allow the plugin to display something without the presence of text?</p>



<a name="316528503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316528503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jon Eugster <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316528503">(Dec 18 2022 at 00:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316472133">said</a>:</p>
<blockquote>
<p>But that would be trivial to at least take into account in the error message - something like "no goals left at this point, but errors are present in the current declaration"</p>
</blockquote>
<p>I think that would be a really good, trivial improvement: use "goals accomplished <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span>" for no goals + no errors, and "no goals" otherwise. At the moment, <span class="user-mention" data-user-id="129120">@Alexander Bentkamp</span> &amp; I are doing exactly that for our in-development Lean4-game.</p>
<p>"unsolved goals" is another issue, but I don't have a perfect suggestion for that... We're currently using a hidden <code>done</code> at the end and then modify when the message is actually displayed.</p>



<a name="316657644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316657644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316657644">(Dec 19 2022 at 02:14)</a>:</h4>
<p>I'd like to record some takeaways from this discussion in core-Lean issues, but since I'm not very experienced here I would first like to check that my summaries are correct.</p>
<p>Firstly, I gather the experts (<span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> , <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> , ...) think that sometimes what a user experiences as a "premature goals accomplished" is actually a particular tactic behaving badly: it's not throwing an error soon enough, in a situation where it is already clear that there is no valid completion. And in those cases, the tactic should be fixed.  For instance, in <a href="#narrow/stream/113489-new-members/topic/behaviour.20of.20.60exact.60.20in.20lean4/near/307512598">Damiano's example</a> </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span> <span class="n">p</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">exact</span>
</code></pre></div>
<p>both <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316465519">Mario</a> and <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316476788">Sebastian</a> apparently diagnose the problem as <code>exact</code> behaving badly: if an unfinished <code>exact</code> is followed by a de-indentation, then report the associated error on <code>exact</code> itself and not the de-indentation.  Is that correct, and if so can I open an issue for it?</p>



<a name="316657831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316657831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316657831">(Dec 19 2022 at 02:18)</a>:</h4>
<p>A small amendment: it's not actually <code>exact</code>'s job to handle this. The fix would be in the core parser infrastructure / somewhere around the <code>withPosition</code> parser combinator, and so it would affect all parsers using position handling similarly.</p>



<a name="316657861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316657861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316657861">(Dec 19 2022 at 02:18)</a>:</h4>
<p>OK, so in fact it would deal with the same problem for a number of different tactics?  That seems even better.</p>



<a name="316657929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316657929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316657929">(Dec 19 2022 at 02:19)</a>:</h4>
<p>So is there a reason that isn't already the behaviour?</p>



<a name="316658033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316658033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316658033">(Dec 19 2022 at 02:21)</a>:</h4>
<p>And another question:  Would this also solve the problem that if you have an incomplete proof, the associated red underline shows up at the beginning of the next declaration?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span> <span class="n">p</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">not_a_tactic</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">:</span> <span class="n">p</span> <span class="o">:=</span> <span class="gr">sorry</span> <span class="c1">-- error on this line</span>
</code></pre></div>



<a name="316658054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316658054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316658054">(Dec 19 2022 at 02:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316657929">said</a>:</p>
<blockquote>
<p>So is there a reason that isn't already the behaviour?</p>
</blockquote>
<p>The current behavior is also fairly natural: report an error on the first token that is invalid given what the current parser expects. So if you write <code>fun x ?? e</code> then you get an error on <code>??</code> because that's not what you are supposed to write there, and the error message will say to try <code>=&gt;</code> instead. For <code>withPosition</code> it's a similar story: if you write a token which is too far to the left it's basically the same as the <code>??</code> token in this example: we were expecting a not-too-far-to-the-left token and you didn't give me one.</p>



<a name="316658122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316658122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316658122">(Dec 19 2022 at 02:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316658033">said</a>:</p>
<blockquote>
<p>And another question:  Would this also solve the problem that if you have an incomplete proof, the associated red underline shows up at the beginning of the next declaration?</p>
</blockquote>
<p>yes</p>



<a name="316658135"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316658135" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316658135">(Dec 19 2022 at 02:23)</a>:</h4>
<p>well, it depends on the situation</p>



<a name="316658148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316658148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316658148">(Dec 19 2022 at 02:24)</a>:</h4>
<p>but if it's a by block and the <code>example</code> is not indented then yes</p>



<a name="316658453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316658453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316658453">(Dec 19 2022 at 02:29)</a>:</h4>
<p>Then, there is the proposal that we say something weaker than "goals accomplished" (maybe "no goals") under certain circumstances.  For example, <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316461726">Mario's proposal</a> that this be done </p>
<blockquote>
<p>if there are any synthetic sorries in the goal, such as might be created by an erroring tactic</p>
</blockquote>
<p>or <span class="user-mention" data-user-id="385895">@Jon Eugster</span>'s <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316528503">proposal</a> that this be done if there are no goals but also some error.  I can't tell if these are exactly the same proposal, or if they're slightly different.</p>



<a name="316659584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316659584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316659584">(Dec 19 2022 at 02:48)</a>:</h4>
<p>they are slightly different (and Jon's suggestion is probably better). A synthetic sorry means something probably went wrong (they should only be generated if an error message is produced), but an error message does not have to come with a sorry, and also you can have a failing tactic that does not contribute to the goal and hence leaves no sorry. I think one way to detect errors directly would be to look at the messages list and see if a red squiggle message was emitted</p>



<a name="316671037"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316671037" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316671037">(Dec 19 2022 at 05:51)</a>:</h4>
<p>I opened <br>
<a href="https://github.com/leanprover/lean4/issues/1970">https://github.com/leanprover/lean4/issues/1970</a><br>
<a href="https://github.com/leanprover/lean4/issues/1971">https://github.com/leanprover/lean4/issues/1971</a><br>
with the proposals from this discussion.</p>



<a name="316697002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/316697002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#316697002">(Dec 19 2022 at 09:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316657831">said</a>:</p>
<blockquote>
<p>A small amendment: it's not actually <code>exact</code>'s job to handle this. The fix would be in the core parser infrastructure / somewhere around the <code>withPosition</code> parser combinator, and so it would affect all parsers using position handling similarly.</p>
</blockquote>
<p>Attaching this to <code>withPosition</code> looks dubious. First of all,</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="n">exact</span>
<span class="n">id</span>
</code></pre></div>
<p>is (unfortunately?) perfectly valid. Second, there's no inherent reason why</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>  <span class="k">if</span>

<span class="kd">def</span>
</code></pre></div>
<p>shouldn't have its error position improved as well.</p>



<a name="317080279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/317080279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Wojciech Nawrocki <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#317080279">(Dec 21 2022 at 03:59)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110024">Sebastian Ullrich</span> <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316475300">said</a>:</p>
<blockquote>
<p>Right, that's helpful too, but if we want to highlight multiple lines as close to the actual editor as possible without swimming in squigglies, the progress indicator seems to be the best choice</p>
</blockquote>
<p>Btw, Dafny is perhaps what that <a href="https://dafny.org/images/Demo.png">looks like</a> in the limit of increasing detail (from <a href="https://dafny.org/">https://dafny.org/</a>).</p>
<div class="message_inline_image"><a href="https://dafny.org/images/Demo.png" title="looks like"><img src="https://uploads.zulipusercontent.net/b696ebc60d997202783075b6bdddd31b9010fc22/68747470733a2f2f6461666e792e6f72672f696d616765732f44656d6f2e706e67"></a></div>



<a name="320572617"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/premature%20%22goals%20accomplished%22/near/320572617" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22.html#320572617">(Jan 11 2023 at 00:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="260507">Heather Macbeth</span> <a href="#narrow/stream/287929-mathlib4/topic/premature.20.22goals.20accomplished.22/near/316671037">said</a>:</p>
<blockquote>
<p>I opened <br>
<a href="https://github.com/leanprover/lean4/issues/1970">https://github.com/leanprover/lean4/issues/1970</a><br>
<a href="https://github.com/leanprover/lean4/issues/1971">https://github.com/leanprover/lean4/issues/1971</a><br>
with the proposals from this discussion.</p>
</blockquote>
<p>I still hope that the devs will take up the "premature goals accomplished" issue eventually.  Since this looks like it might take a while, I have opened a PR<br>
<a href="https://github.com/leanprover/vscode-lean4/pull/277">https://github.com/leanprover/vscode-lean4/pull/277</a><br>
to rename "goals accomplished <span aria-label="tada" class="emoji emoji-1f389" role="img" title="tada">:tada:</span>" to "no goals" in the VS Code extension.  This is intended as a temporary measure to make the user experience less confusing.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>