---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/Data.2EList.2EBasic.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html">Data.List.Basic</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="316422117"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316422117" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316422117">(Dec 17 2022 at 09:17)</a>:</h4>
<p>This thread can serve to coordinate work on Data.List.Basic. Please write here if you would like to claim a section of it to work on (and then "unclaim" when you finish work).</p>



<a name="316427849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316427849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316427849">(Dec 17 2022 at 10:07)</a>:</h4>
<p>I just pushed the mathlib 3 source header</p>



<a name="316427989"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316427989" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316427989">(Dec 17 2022 at 10:08)</a>:</h4>
<p>Trying <code>reverseRecOn</code></p>



<a name="316428307"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316428307" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316428307">(Dec 17 2022 at 10:11)</a>:</h4>
<p>Fixed line 1036</p>



<a name="316428361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316428361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316428361">(Dec 17 2022 at 10:11)</a>:</h4>
<p>I'll claim 1037 -- 1105</p>



<a name="316429126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316429126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316429126">(Dec 17 2022 at 10:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="266304">Siddhartha Gadgil</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/316427989">said</a>:</p>
<blockquote>
<p>Trying <code>reverseRecOn</code></p>
</blockquote>
<p>done and pushed</p>



<a name="316429449"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316429449" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316429449">(Dec 17 2022 at 10:18)</a>:</h4>
<p>I'm working on <code>bidirectionalRec</code></p>



<a name="316430678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316430678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316430678">(Dec 17 2022 at 10:29)</a>:</h4>
<p>done</p>



<a name="316431069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316431069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316431069">(Dec 17 2022 at 10:32)</a>:</h4>
<p>From std:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c">/-</span><span class="cm"> @[refl] -/</span> <span class="kd">@[simp]</span> <span class="kd">theorem</span> <span class="n">Sublist.refl</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">,</span> <span class="n">l</span> <span class="bp">&lt;+</span> <span class="n">l</span>
  <span class="bp">|</span> <span class="o">[]</span> <span class="bp">=&gt;</span> <span class="bp">.</span><span class="n">slnil</span>
  <span class="bp">|</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">Sublist.refl</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">cons₂</span> <span class="n">a</span>
</code></pre></div>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I guess this commented-out <code>@[refl]</code> is intentional? It breaks a proof in <code>Data.List.Basic</code>.</p>



<a name="316431123"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316431123" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316431123">(Dec 17 2022 at 10:33)</a>:</h4>
<p>It wasn't legal at the time, in fact it probably still isn't because the refl attribute is in mathlib</p>



<a name="316431167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316431167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316431167">(Dec 17 2022 at 10:33)</a>:</h4>
<p>You can add the refl attribute in the corresponding mathlib file</p>



<a name="316431242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316431242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316431242">(Dec 17 2022 at 10:34)</a>:</h4>
<p>I guess that file is <code>Data.List.Basic</code>?</p>



<a name="316432007"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316432007" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316432007">(Dec 17 2022 at 10:40)</a>:</h4>
<p>I had to manually replace <code>sublist.cons2</code> with <code>Sublist.cons₂</code>. Is that something that mathport ought to do?<br>
(This was in the instance <code>decidableSublist</code>.)</p>



<a name="316432470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316432470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316432470">(Dec 17 2022 at 10:44)</a>:</h4>
<p>I did a global replace <code>index_of</code> -&gt; <code>indexOf</code>.</p>



<a name="316432525"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316432525" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316432525">(Dec 17 2022 at 10:44)</a>:</h4>
<p>Oops! That messed up <code>#align</code> statements. Will fix.</p>



<a name="316432736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316432736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316432736">(Dec 17 2022 at 10:47)</a>:</h4>
<p>Pushed a better replace</p>



<a name="316432783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316432783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316432783">(Dec 17 2022 at 10:47)</a>:</h4>
<p>I think we need to add an #align for sublist.cons2. (Because it is defined in Std.)</p>



<a name="316434030"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316434030" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316434030">(Dec 17 2022 at 10:57)</a>:</h4>
<p>Done <code>map_take</code>. In general I am working from the end and trying termination errors.</p>



<a name="316436333"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316436333" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316436333">(Dec 17 2022 at 11:07)</a>:</h4>
<p>globally replacing <code>erasep</code> with <code>eraseP</code></p>



<a name="316437231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316437231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316437231">(Dec 17 2022 at 11:09)</a>:</h4>
<p>Sorry that was a mistake which I undid. The first terms of <code>align</code> should ha <code>erasep</code></p>



<a name="316437337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316437337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316437337">(Dec 17 2022 at 11:10)</a>:</h4>
<p>That said a lot of fixes are this replacement and finding that stuff is already in <code>Std</code></p>



<a name="316441122"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316441122" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316441122">(Dec 17 2022 at 11:38)</a>:</h4>
<p>I recall doing at least one pass over data.list.basic and porting everything I could to std, so I would expect there to be a lot of #align-only code here</p>



<a name="316446445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316446445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316446445">(Dec 17 2022 at 12:13)</a>:</h4>
<p>Yes, most of the work is correcting cases, finding stuff is then in <code>Std</code> and keeping only the align.<br>
I am also adding attributes where things are marked <code>[simp]</code>. Is that correct? Some seemed not to be simp in Std</p>



<a name="316468827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316468827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316468827">(Dec 17 2022 at 14:45)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">indexOf_cons</span> <span class="o">(</span><span class="n">a</span> <span class="n">b</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span>
    <span class="n">indexOf</span> <span class="n">a</span> <span class="o">(</span><span class="n">b</span> <span class="o">::</span> <span class="n">l</span><span class="o">)</span> <span class="bp">=</span> <span class="k">if</span> <span class="n">a</span> <span class="bp">=</span> <span class="n">b</span> <span class="k">then</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">succ</span> <span class="o">(</span><span class="n">indexOf</span> <span class="n">a</span> <span class="n">l</span><span class="o">)</span> <span class="o">:=</span>
</code></pre></div>
<p>this used to be <code>rfl</code> but it no longer is.<br>
Is that a problem?</p>



<a name="316469320"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316469320" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316469320">(Dec 17 2022 at 14:48)</a>:</h4>
<p>let's assume not until proven otherwise</p>



<a name="316509265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316509265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316509265">(Dec 17 2022 at 20:50)</a>:</h4>
<p>In the Data.Fin.Basic thread we see that <code>0 % b = 0</code> used to be <code>rfl</code> and no longer is, and all that happens is that a bunch of proofs break and have to be fixed manually. Does that count as a problem?</p>



<a name="316509491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316509491" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316509491">(Dec 17 2022 at 20:53)</a>:</h4>
<p>that one is going to be more annoying (it's not that <code>0 % b = 0</code> was rfl but rather that the definition of <code>0 : Fin n</code> changed from <code>0</code> to <code>0 % n</code>), but I don't see much of an option without making  fin have two different <code>OfNat</code> instances, which is also a headache</p>



<a name="316519908"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316519908" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316519908">(Dec 17 2022 at 23:01)</a>:</h4>
<p>Cleaning up lines 1300 - 1500 right now (mostly good, a few spread-out errors)</p>



<a name="316527119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316527119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316527119">(Dec 18 2022 at 00:41)</a>:</h4>
<p>Moving onto 1500 - 1600</p>



<a name="316528691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316528691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316528691">(Dec 18 2022 at 00:58)</a>:</h4>
<p>Do we rename or delete <code>ext</code>? There's already <code>List.ext</code> from <code>Std</code>, but that one uses <code>get?</code> and this one uses <code>nth</code></p>



<a name="316528818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316528818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316528818">(Dec 18 2022 at 01:00)</a>:</h4>
<p>The <code>get?</code> version seems to make the subsequent theorems throw errors</p>



<a name="316529858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316529858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316529858">(Dec 18 2022 at 01:14)</a>:</h4>
<p>I've temporarily renamed it <code>ext_nth</code> in keeping with <code>ext_le</code> below it.</p>



<a name="316531140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316531140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316531140">(Dec 18 2022 at 01:35)</a>:</h4>
<p>is <code>get?</code> different from <code>nth</code>?</p>



<a name="316531648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316531648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316531648">(Dec 18 2022 at 01:44)</a>:</h4>
<p><code>List.nth</code> is identical to <code>List.get?</code>. It should be deleted and <code>#align</code>ed</p>



<a name="316532089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316532089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316532089">(Dec 18 2022 at 01:53)</a>:</h4>
<p>other definitions in Mathlib.Init.Data.List.Basic that are duplicates:</p>
<ul>
<li><code>List.map₂</code>-&gt; <code>List.zipWith</code></li>
<li><code>List.mapWithIndex</code> -&gt; <code>List.mapIdx</code></li>
<li><code>List.findIndex</code> -&gt; <code>List.findIdxₓ</code> (prop -&gt; bool)</li>
<li><code>List.updateNth</code> -&gt; <code>List.set</code></li>
<li><code>List.bor</code> -&gt; <code>List.or</code></li>
<li><code>List.band</code> -&gt; <code>List.and</code></li>
<li><code>List.repeat</code> -&gt; <code>List.replicateₓ</code> (argument order)</li>
<li><code>List.init</code> -&gt; <code>List.dropLast</code></li>
</ul>



<a name="316533791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316533791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316533791">(Dec 18 2022 at 02:24)</a>:</h4>
<p>A lot (100+) of theorems use <code>nth</code> somewhere in their name;  is it better to use <code>nth</code> as an alias for <code>get?</code> or to ctrl+F and change all of the theorem names to reference <code>get</code>? (Likewise for the other ones with significantly different names which might be referenced in theorems, I guess, but it's probably not as big a deal)</p>



<a name="316534361"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316534361" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316534361">(Dec 18 2022 at 02:35)</a>:</h4>
<p>Fixing errors in <code>indexOf</code> section (~1250 -1300)</p>



<a name="316537273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316537273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316537273">(Dec 18 2022 at 03:26)</a>:</h4>
<p>mathport is the new ctrl-F</p>



<a name="316537951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316537951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316537951">(Dec 18 2022 at 03:39)</a>:</h4>
<p>the theorems I'm talking about are all in <code>Data.List.Basic</code> already, not future files</p>



<a name="316538412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316538412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316538412">(Dec 18 2022 at 03:48)</a>:</h4>
<p>also I'm just asking a stylistic question, not saying it's difficult...like, do we want lots of theorem names to have <code>_get?_</code> in the middle? or do we want to use <code>nth</code> in those names by having an alias</p>



<a name="316547100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316547100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316547100">(Dec 18 2022 at 06:27)</a>:</h4>
<p>Ok, ported the <code>indexOf</code> section—as mentioned, the previous proofs were very short (e.g. rfl), whereas these new ones require diving into <code>findIdx.go</code>. I reordered a couple so I could use them as components. I tried to keep them more elementary than fancy, e.g. "string of rewrites" instead of <code>simp</code>—hopefully they can be golfed nonetheless, though. But in the meantime, they work! :)</p>



<a name="316562576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316562576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316562576">(Dec 18 2022 at 09:57)</a>:</h4>
<p>Ideally there are no more <code>nth</code>s at all. We're replacing it with <code>get?</code>.</p>



<a name="316624317"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316624317" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316624317">(Dec 18 2022 at 18:42)</a>:</h4>
<p>Cleaning up <code>nth_injective</code> and <code>indexOf_cons_ne</code></p>



<a name="316827247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316827247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316827247">(Dec 19 2022 at 20:38)</a>:</h4>
<p>I pushed a tiny bit more progress</p>



<a name="316836417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316836417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316836417">(Dec 19 2022 at 21:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/316562576">said</a>:</p>
<blockquote>
<p>Ideally there are no more <code>nth</code>s at all. We're replacing it with <code>get?</code>.</p>
</blockquote>
<p>I'm not entirely sure about this decision. Maybe leave the <code>nthLe</code>s there for now and tidy stuff up after mathlib is ported. It's easier to fix all in one go and minimize design changes while porting?</p>



<a name="316837196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316837196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316837196">(Dec 19 2022 at 21:48)</a>:</h4>
<p>Sorry, ignore me, that was an completely stupid thing for me to say. Of course we're not changing <code>nth</code> to <code>get?</code>.</p>



<a name="316837241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316837241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316837241">(Dec 19 2022 at 21:48)</a>:</h4>
<p>I thought this was just a rename. <span aria-label="shrug" class="emoji emoji-1f937" role="img" title="shrug">:shrug:</span></p>



<a name="316838831"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316838831" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316838831">(Dec 19 2022 at 22:01)</a>:</h4>
<p>but it is a rename?</p>



<a name="316838929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316838929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316838929">(Dec 19 2022 at 22:01)</a>:</h4>
<p><code>nth</code> is gone, long live <code>get?</code>. <code>nthLe</code> is still around though</p>



<a name="316839181"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316839181" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316839181">(Dec 19 2022 at 22:03)</a>:</h4>
<p>also to address <span class="user-mention" data-user-id="548935">@Thomas Murrills</span> 's naming question re: <code>get?</code> in the middle of theorem names: yes, it's just treated like any other name. You get names like <code>get?_of_nthLe</code> and so on</p>



<a name="316840487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316840487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316840487">(Dec 19 2022 at 22:13)</a>:</h4>
<p>If we switch every <code>nth</code> to <code>get?</code>, why would we not also switch <code>nthLe</code> to <code>get?Le</code>? isn’t <code>nthLe</code> meant to conjure up <code>nth</code>? And if there is no <code>nth</code>…</p>



<a name="316842183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316842183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316842183">(Dec 19 2022 at 22:24)</a>:</h4>
<p>there isn't an <code>le</code> in <code>nthLe</code> either, it's a bad name</p>



<a name="316842246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316842246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316842246">(Dec 19 2022 at 22:25)</a>:</h4>
<p>(I think I named it, but I don't know what I was thinking)</p>



<a name="316842323"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316842323" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316842323">(Dec 19 2022 at 22:25)</a>:</h4>
<p>but until we're ready to rename it it should just stay as is</p>



<a name="316847143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316847143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316847143">(Dec 19 2022 at 22:57)</a>:</h4>
<p>i'll <code>take'</code> on the section <code>Take'</code> (~ 2540 - 2570) right now</p>



<a name="316848044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316848044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316848044">(Dec 19 2022 at 23:04)</a>:</h4>
<p>Isn't <a href="https://leanprover-community.github.io/mathlib_docs/find/list.nth_le">docs#list.nth_le</a> ultimately obsolete in favor of <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.get#doc">docs4#List.get</a>, but we're delaying the refactor till after the port?</p>



<a name="316848085"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316848085" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316848085">(Dec 19 2022 at 23:04)</a>:</h4>
<p>I vote yes</p>



<a name="316848141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316848141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316848141">(Dec 19 2022 at 23:04)</a>:</h4>
<p>(unless someone wants to backport it to mathlib3 first, but it doesn't seem very important)</p>



<a name="316849477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316849477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316849477">(Dec 19 2022 at 23:16)</a>:</h4>
<p>there are some advantages to having them be separate arguments for induction proofs, but it can probably be marginalized to just some specialized situations</p>



<a name="316850802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316850802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316850802">(Dec 19 2022 at 23:28)</a>:</h4>
<p>if it won't be used much but is still useful occasionally, <code>get'</code>? or <code>getLT</code>?</p>



<a name="316851513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316851513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316851513">(Dec 19 2022 at 23:36)</a>:</h4>
<p>also I'm noticing that <code>take'</code> doesn't actually match with <code>takeD</code>—the new <code>takeD</code> allows any element to be specified as a default, whereas <code>take</code> required <code>[Inhabited α]</code>. should we:</p>
<ul>
<li>correspondingly generalize the theorems by adding that explicit value as an (implicit?) argument to the theorems in <code>take</code></li>
<li>just use <code>default</code> and maintain that these theorems require <code>[Inhabited α]</code></li>
</ul>



<a name="316851825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316851825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316851825">(Dec 19 2022 at 23:39)</a>:</h4>
<p><code>std</code> seems to have chosen the first option when it absorbed <code>take'_nil</code> as <code>takeD_nil</code>, so I'll do that as well if there aren't any objections.</p>



<a name="316852215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316852215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316852215">(Dec 19 2022 at 23:43)</a>:</h4>
<p>Hmm...in general, in cases like this, is it worth putting <code>porting note:</code>s in <code>/-- ... -/</code> docstrings so that people who are porting can see that we've e.g. changed the arguments required on mouseover?</p>



<a name="316853862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316853862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316853862">(Dec 20 2022 at 00:01)</a>:</h4>
<p>done (without docstrings) (I'll change it back to using <code>[Inhabited α]</code> if I made the wrong choice)</p>



<a name="316853890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316853890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316853890">(Dec 20 2022 at 00:01)</a>:</h4>
<p>The inhabited-taking version should be named <code>takeI</code></p>



<a name="316853951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316853951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316853951">(Dec 20 2022 at 00:01)</a>:</h4>
<p>Do we want to use that instead? Or have both? Currently <code>take'</code> is aligned with <code>takeD</code>. Is that a mistake?</p>



<a name="316854332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316854332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316854332">(Dec 20 2022 at 00:05)</a>:</h4>
<p>or wait. <code>takeI</code> doesn't exist yet—you're talking about in the future</p>



<a name="316854402"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316854402" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316854402">(Dec 20 2022 at 00:06)</a>:</h4>
<p>What is the type of <code>take'</code>?</p>



<a name="316854818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316854818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316854818">(Dec 20 2022 at 00:09)</a>:</h4>
<p><code>Π {α : Type u} [_inst_1 : inhabited α], ℕ → list α → list α</code></p>



<a name="316854990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316854990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316854990">(Dec 20 2022 at 00:11)</a>:</h4>
<p>then it should be renamed to <code>takeI</code></p>



<a name="316855006"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316855006" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316855006">(Dec 20 2022 at 00:11)</a>:</h4>
<p>and not aligned to <code>takeD</code> which is a different function</p>



<a name="316856408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316856408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316856408">(Dec 20 2022 at 00:27)</a>:</h4>
<p>Alright, that align is in <code>Data.List.Defs</code> (and the definition of <code>take'</code> was there too). So...I'll make a PR on a separate branch to fix <code>Data.List.Defs</code> and define <code>takeI</code> there?</p>



<a name="316856512"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316856512" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316856512">(Dec 20 2022 at 00:28)</a>:</h4>
<p>Hang on. <code>Mathlib.Data.List.Defs</code> currently depends on <code>Mathlib.Data.List.Basic</code>?? Not the other way around?</p>



<a name="316856895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316856895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316856895">(Dec 20 2022 at 00:33)</a>:</h4>
<p>I suppose I'll define <code>takeI</code> in <code>Data.List.Basic</code> until I figure out what's going on.</p>



<a name="316856928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316856928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316856928">(Dec 20 2022 at 00:33)</a>:</h4>
<p>That import is definitely an error</p>



<a name="316857009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316857009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316857009">(Dec 20 2022 at 00:34)</a>:</h4>
<p>the import of <code>Data.List.Chain</code> seems to be the issue</p>



<a name="316857048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316857048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316857048">(Dec 20 2022 at 00:35)</a>:</h4>
<p>don't work around an ad hoc port issue by adding more ad hoc port issues</p>



<a name="316857066"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316857066" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316857066">(Dec 20 2022 at 00:35)</a>:</h4>
<p>when in doubt, copy the structure of mathlib3</p>



<a name="316857827"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316857827" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316857827">(Dec 20 2022 at 00:43)</a>:</h4>
<blockquote>
<p>the import of Data.List.Chain seems to be the issue</p>
</blockquote>
<p>and in turn <code>Data.List.Pairwise</code> which imports <code>Data.List.Basic</code> directly</p>



<a name="316859120"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316859120" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316859120">(Dec 20 2022 at 00:58)</a>:</h4>
<p>Ok, here's the current state of things.</p>



<a name="316859209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316859209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316859209">(Dec 20 2022 at 00:59)</a>:</h4>
<p><code>Data.List.Defs</code> has a <code>Chain</code> section where it defines <code>decidableChain</code>, <code>decidableChain'</code>. This needs <code>chain_cons</code> and is the only reason <code>Data.List.Chain</code> is imported.</p>



<a name="316859318"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316859318" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316859318">(Dec 20 2022 at 01:00)</a>:</h4>
<p>However, things were different in mathlib3: <code>chain_cons</code> was defined in <code>data.list.defs</code>, not <code>data.list.chain</code>.</p>



<a name="316859524"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316859524" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316859524">(Dec 20 2022 at 01:02)</a>:</h4>
<p>As far as I can tell, <code>data.list.defs</code> did not depend on <code>data.list.chain</code> in mathlib3. This is a new dependency introduced in mathlib4.</p>



<a name="316860075"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316860075" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316860075">(Dec 20 2022 at 01:08)</a>:</h4>
<p>In fact, I think it was the other way around: <code>data.list.chain</code> depended on <code>data.list.defs</code>.</p>



<a name="316861380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316861380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316861380">(Dec 20 2022 at 01:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/316857066">said</a>:</p>
<blockquote>
<p>when in doubt, copy the structure of mathlib3</p>
</blockquote>



<a name="316861420"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316861420" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316861420">(Dec 20 2022 at 01:25)</a>:</h4>
<p>Move everything where it is supposed to be and everything will be resolved</p>



<a name="316868035"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316868035" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316868035">(Dec 20 2022 at 02:56)</a>:</h4>
<p>Alright, I'll try my best—the imports are totally different for lots of things in mathlib3, it's not just that one file. (For example, seems like old <code>data.list.basic</code> depended on <code>data.list.defs</code> but doesn't anymore, so that'll be a new import in <code>Data.List.Basic</code>.)</p>



<a name="316870423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316870423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316870423">(Dec 20 2022 at 03:31)</a>:</h4>
<p>The definition of <code>take'</code> (through <code>mathlib3port</code> was </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">take'</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span>
  <span class="bp">|</span> <span class="mi">0</span><span class="o">,</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="o">[]</span>
  <span class="bp">|</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">,</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">l.head</span> <span class="o">::</span> <span class="n">take'</span> <span class="n">n</span> <span class="n">l.tail</span>
</code></pre></div>
<p>The misalignment was my mistake based on an assumption that <code>D</code> = <code>Default</code> (although I got the naming convention right elsewhere)</p>
<p>The import of <code>Data.List.Chain</code> was required to port the  defs for the <code>Chain</code> section -- as noted, moving that whole section to <code>Data.List.Chain</code> will remove the dependency (but will also be a divergence from mathlib3)./</p>



<a name="316870509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316870509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316870509">(Dec 20 2022 at 03:33)</a>:</h4>
<p>I did the reverse: move <code>chain_cons</code> to Data.List.Defs. This is how it was in mathlib3</p>



<a name="316870519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316870519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316870519">(Dec 20 2022 at 03:33)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/1118">mathlib4#1118</a></p>



<a name="316870596"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316870596" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316870596">(Dec 20 2022 at 03:34)</a>:</h4>
<p>All other chain definitions previously in data.list.defs are now in std, so it was the only one that needed to be moved :)</p>



<a name="316871304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316871304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316871304">(Dec 20 2022 at 03:44)</a>:</h4>
<p>Still trying to make it build, though. Is there some reason the dependency needs to flow from <code>Data.List.Chain</code> -&gt; <code>Data.List.Defs</code> now?</p>



<a name="316871476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316871476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316871476">(Dec 20 2022 at 03:47)</a>:</h4>
<p>No idea... <code>Data.List.Chain</code> existed before the port of <code>Data.List.Defs</code></p>



<a name="316871569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316871569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316871569">(Dec 20 2022 at 03:49)</a>:</h4>
<p>Fortunately, the only reference to <code>takeD</code> is in <code>Data.List.Defs</code> so removing the align and adding <code>takeI</code> should be fine.</p>



<a name="316871696"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316871696" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316871696">(Dec 20 2022 at 03:50)</a>:</h4>
<p>I think it would be better to define <code>takeI</code> as:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">takeI</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span>
  <span class="n">List.takeD</span> <span class="n">default</span>
</code></pre></div>



<a name="316873053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316873053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316873053">(Dec 20 2022 at 04:11)</a>:</h4>
<p>I think we're on the same page—I defined it in the PR as</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">takeI</span> <span class="o">[</span><span class="n">Inhabited</span> <span class="n">α</span><span class="o">]</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="o">:=</span>
  <span class="n">takeD</span> <span class="n">n</span> <span class="n">l</span> <span class="n">default</span>
</code></pre></div>



<a name="316878233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316878233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316878233">(Dec 20 2022 at 05:32)</a>:</h4>
<p>Ok, neat; <a href="https://github.com/leanprover-community/mathlib4/pull/1118">mathlib4#1118</a> is good to go, and should fix things.</p>



<a name="316885024"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316885024" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316885024">(Dec 20 2022 at 06:53)</a>:</h4>
<p>it worked :) now fixing 2600 - 2620</p>



<a name="316890800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316890800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316890800">(Dec 20 2022 at 07:45)</a>:</h4>
<p>Did <code>foldrRecOn</code> etc.; had to work around the code generator not handling <code>List.rec</code> for now. I'll double-check the <code>IH</code>'s I manually gave tomorrow; it's late :)</p>



<a name="316901304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316901304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316901304">(Dec 20 2022 at 08:54)</a>:</h4>
<p><code>List.mem_cons</code> is in Std. What is the canonical place to add <code>#align list.mem_cons_iff List.mem_cons</code>?</p>



<a name="316901606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316901606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316901606">(Dec 20 2022 at 08:56)</a>:</h4>
<p>The first error in Data.List.Basic is on</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">nthLe_insertNth_self</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">l.length</span><span class="o">)</span>
    <span class="o">(</span><span class="n">hn'</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="n">insertNth</span> <span class="n">n</span> <span class="n">x</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">length</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">length_insertNth</span> <span class="n">_</span> <span class="n">_</span> <span class="n">hn</span><span class="o">,</span> <span class="n">Nat.lt_succ_iff</span><span class="o">])</span> <span class="o">:</span>
</code></pre></div>
<p>with error message</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">invalid</span> <span class="n">auto</span> <span class="n">tactic</span><span class="o">,</span> <span class="n">identifier</span> <span class="n">is</span> <span class="n">not</span> <span class="n">allowed</span>
</code></pre></div>
<p>on the <code>length_insertNth</code></p>



<a name="316901639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316901639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316901639">(Dec 20 2022 at 08:56)</a>:</h4>
<p>How should we do these auto tactics?</p>



<a name="316904663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316904663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316904663">(Dec 20 2022 at 09:14)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/316901304">said</a>:</p>
<blockquote>
<p><code>List.mem_cons</code> is in Std. What is the canonical place to add <code>#align list.mem_cons_iff List.mem_cons</code>?</p>
</blockquote>
<p>I see, it is already on L21. But it hasn't been used in the rest of the file yet.</p>



<a name="316923100"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316923100" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316923100">(Dec 20 2022 at 11:01)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/316901304">said</a>:</p>
<blockquote>
<p><code>List.mem_cons</code> is in Std. What is the canonical place to add <code>#align list.mem_cons_iff List.mem_cons</code>?</p>
</blockquote>
<p>The canonical place to put an <code>#align</code> is in the same place and ordering as the original mathlib3 definition, regardless of whether the lean 4 definition is in mathlib4 or upstream. If the definition is in mathlib4, it should come immediately before the <code>#align</code> unless there is a reason it has to be moved elsewhere</p>



<a name="316923365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316923365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316923365">(Dec 20 2022 at 11:03)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/316901606">said</a>:</p>
<blockquote>
<p>The first error in Data.List.Basic is on</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">nthLe_insertNth_self</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">l.length</span><span class="o">)</span>
    <span class="o">(</span><span class="n">hn'</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="n">insertNth</span> <span class="n">n</span> <span class="n">x</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">length</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">length_insertNth</span> <span class="n">_</span> <span class="n">_</span> <span class="n">hn</span><span class="o">,</span> <span class="n">Nat.lt_succ_iff</span><span class="o">])</span> <span class="o">:</span>
</code></pre></div>
<p>with error message</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">invalid</span> <span class="n">auto</span> <span class="n">tactic</span><span class="o">,</span> <span class="n">identifier</span> <span class="n">is</span> <span class="n">not</span> <span class="n">allowed</span>
</code></pre></div>
<p>on the <code>length_insertNth</code></p>
</blockquote>
<p>How did that happen? Mathport will not generate autoparams like that</p>



<a name="316925209"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316925209" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316925209">(Dec 20 2022 at 11:13)</a>:</h4>
<p>No idea... but that's the code I found on the branch</p>



<a name="316938271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316938271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316938271">(Dec 20 2022 at 12:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/316923100">said</a>:</p>
<blockquote>
<p>The canonical place to put an <code>#align</code> is in the same place and ordering as the original mathlib3 definition, regardless of whether the lean 4 definition is in mathlib4 or upstream. If the definition is in mathlib4, it should come immediately before the <code>#align</code> unless there is a reason it has to be moved elsewhere</p>
</blockquote>
<p>But somehow a lot of <code>#align</code>s are missing, when the definitions ended up in Std.</p>



<a name="316938423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316938423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316938423">(Dec 20 2022 at 12:27)</a>:</h4>
<p>I think Data.List.Basic is quite a mess. E.g., apparently those autoparams are also garbage that shouldn't roll out of mathport.</p>



<a name="316938465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316938465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316938465">(Dec 20 2022 at 12:27)</a>:</h4>
<p>And because of all the missing <code>#align</code>s there are many names that need tweaking and fixing.</p>



<a name="316938597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316938597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316938597">(Dec 20 2022 at 12:28)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  Do you think you could take a look? And maybe use some oneshot magic trickery to get this file to behave?</p>



<a name="316938705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316938705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316938705">(Dec 20 2022 at 12:28)</a>:</h4>
<p>Roughly 2900 lines are now error free. But there's another 2400 lines in that file.</p>



<a name="316938760"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316938760" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316938760">(Dec 20 2022 at 12:29)</a>:</h4>
<p>Was the port botched in some way? Do we need to start over from mathport output?</p>



<a name="316938818"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316938818" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316938818">(Dec 20 2022 at 12:29)</a>:</h4>
<p>I dunno. Throwing away 3000 lines of porting effort also feels sad.</p>



<a name="316938879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316938879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316938879">(Dec 20 2022 at 12:29)</a>:</h4>
<p>well it's fine if they are good code, I'm not sure exactly what the problem is here</p>



<a name="316938988"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316938988" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316938988">(Dec 20 2022 at 12:30)</a>:</h4>
<p>I'll take a look, data.rat.order needs a review</p>



<a name="316952510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316952510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316952510">(Dec 20 2022 at 13:40)</a>:</h4>
<p>For anyone else who is working on this file: I'm currently doing major brain surgery on it, you might want to wait until afterwards and hopefully you already committed any changes you had</p>



<a name="316964248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316964248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316964248">(Dec 20 2022 at 14:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/316923365">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/316901606">said</a>:</p>
<blockquote>
<p>The first error in Data.List.Basic is on</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">nthLe_insertNth_self</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">l.length</span><span class="o">)</span>
    <span class="o">(</span><span class="n">hn'</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="n">insertNth</span> <span class="n">n</span> <span class="n">x</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">length</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">length_insertNth</span> <span class="n">_</span> <span class="n">_</span> <span class="n">hn</span><span class="o">,</span> <span class="n">Nat.lt_succ_iff</span><span class="o">])</span> <span class="o">:</span>
</code></pre></div>
<p>with error message</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">invalid</span> <span class="n">auto</span> <span class="n">tactic</span><span class="o">,</span> <span class="n">identifier</span> <span class="n">is</span> <span class="n">not</span> <span class="n">allowed</span>
</code></pre></div>
<p>on the <code>length_insertNth</code></p>
</blockquote>
<p>How did that happen? Mathport will not generate autoparams like that</p>
</blockquote>
<p>I ran across this issue while going over mathport's data.list.basic output again. I see what happened now: in lean 3 the proof looked like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">nth_le_insert_nth_self</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">list</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span>
  <span class="o">(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">≤</span> <span class="n">l.length</span><span class="o">)</span> <span class="o">(</span><span class="n">hn'</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="o">(</span><span class="n">insert_nth</span> <span class="n">n</span> <span class="n">x</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">length</span> <span class="o">:=</span>
    <span class="kd">by</span> <span class="n">rwa</span> <span class="o">[</span><span class="n">length_insert_nth</span> <span class="n">_</span> <span class="n">_</span> <span class="n">hn</span><span class="o">,</span> <span class="n">nat.lt_succ_iff</span><span class="o">])</span> <span class="o">:</span>
  <span class="o">(</span><span class="n">insert_nth</span> <span class="n">n</span> <span class="n">x</span> <span class="n">l</span><span class="o">)</span><span class="bp">.</span><span class="n">nth_le</span> <span class="n">n</span> <span class="n">hn'</span> <span class="bp">=</span> <span class="n">x</span> <span class="o">:=</span>
</code></pre></div>
<p>That is, there is an opt param whose value is given by a <code>by</code> block. In lean 4 this syntax (that is, <code>(x : ty := by tac)</code> has been reappropriated for auto params (in which <code>:= by</code> is a composite keyword), and if you want an opt param whose value is a by block you have to write <code>(x : ty := (by tac))</code> instead. Pinging <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> since this is another parenthesizer bug that isn't about precedence</p>



<a name="316997612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316997612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316997612">(Dec 20 2022 at 17:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/316964248">said</a>:</p>
<blockquote>
<p>another parenthesizer bug that isn't about precedence</p>
</blockquote>
<p>Yes, and because of that I don't think the general parenthesizer framework should solve this, or at least I don't see any reasonable way short of some crazy grammar analysis. But this specific case (and I already forgot the other one) is easy enough to fix. <a href="https://github.com/leanprover/lean4/commit/96ccf192e8a5fe216bbc63c688a06b2032bd14f5">https://github.com/leanprover/lean4/commit/96ccf192e8a5fe216bbc63c688a06b2032bd14f5</a></p>



<a name="316998968"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316998968" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316998968">(Dec 20 2022 at 17:20)</a>:</h4>
<p>I don't think we should have crazy grammar analysis, I think we should have special case parenthesizers which handle this stuff</p>



<a name="316999121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/316999121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#316999121">(Dec 20 2022 at 17:21)</a>:</h4>
<p>the other one is <code>(try foo); bar</code> turning into <code>try foo; bar</code></p>



<a name="317012839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317012839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317012839">(Dec 20 2022 at 18:30)</a>:</h4>
<p>Okay, I'm releasing my hold on Data.List.Basic. I did the first 2900 lines, plus renaming stuff for the part that still hasn't been touched yet.</p>



<a name="317029720"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317029720" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317029720">(Dec 20 2022 at 20:00)</a>:</h4>
<p>fixing 2900-2970</p>



<a name="317034372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317034372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317034372">(Dec 20 2022 at 20:30)</a>:</h4>
<p>Hmm, <code>foldrM_cons</code> was moved to std, but now requires an instance of <code>LawfulMonad</code> which was not previously assumed for the <code>Data.List.Basic</code> version of it.</p>
<p>How should we proceed? Make all of the downstream theorems also depend on a <code>LawfulMonad</code> instance, or use a different name?</p>



<a name="317034680"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317034680" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317034680">(Dec 20 2022 at 20:32)</a>:</h4>
<p>yes, the downstream theorems are almost certainly assuming <code>LawfulMonad</code> anyway</p>



<a name="317034717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317034717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317034717">(Dec 20 2022 at 20:32)</a>:</h4>
<p>it's not true without the assumption anymore</p>



<a name="317079141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317079141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317079141">(Dec 21 2022 at 03:42)</a>:</h4>
<p>working on <code>splitAt_eq_take_drop</code></p>



<a name="317082121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317082121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317082121">(Dec 21 2022 at 04:29)</a>:</h4>
<p><code>splitOnP</code> now takes a <code>Bool</code>-valued predicate instead of a <code>Prop</code>-valued one—we're rewriting everything related to <code>splitOnP</code> to match, not keeping a separate <code>Prop</code>-predicate version of <code>splitOnP</code>, right? just checking.</p>



<a name="317085536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317085536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317085536">(Dec 21 2022 at 05:26)</a>:</h4>
<p>Seems reasonable. You'll want to #align with an <code>ₓ</code>.</p>



<a name="317157743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317157743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317157743">(Dec 21 2022 at 13:27)</a>:</h4>
<p>Having trouble proving things about the new definition of <code>splitOnP</code>. Can't even seem to prove the equation lemmas for <code>splitOnP.go</code></p>



<a name="317222608"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317222608" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317222608">(Dec 21 2022 at 18:30)</a>:</h4>
<p>I'll try to work on it rn (~3000 - 3220)</p>



<a name="317228972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317228972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317228972">(Dec 21 2022 at 19:03)</a>:</h4>
<p>Can we safely get rid of theorems of the form <code>split_on_p_aux*</code>? It seems like they're only used to help prove facts about <code>splitOnP</code>, and it might be easier to prove those from scratch due to the new plumbing in <code>splitOnP</code>. (I can't find any occurrences for each of them anywhere else in mathlib3.)</p>



<a name="317261841"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317261841" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317261841">(Dec 21 2022 at 22:45)</a>:</h4>
<p>I think so</p>



<a name="317276076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317276076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317276076">(Dec 22 2022 at 01:22)</a>:</h4>
<p>Ok, I think I’ve broken through the worst of the <code>go</code>’s—whew! haven’t committed because I’ve got a bunch of false starts lying around, and don’t want to subject anyone else to the mess :) I’ll resume in a couple hours and try to get a clean commit in for this section.</p>



<a name="317378228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317378228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317378228">(Dec 22 2022 at 14:27)</a>:</h4>
<p>Is the general consensus for this file that lemmas about e.g. <code>filter</code> should take as argument <code>p : α → Bool</code> and not <code>α → Prop</code>?</p>



<a name="317378591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317378591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317378591">(Dec 22 2022 at 14:28)</a>:</h4>
<p>It seems to be really hard to apply versions with <code>Prop</code> in situations where you have <code>Bool</code>, because the <code>p</code> in <code>filter p</code> is not actually the variable like it appears</p>



<a name="317378766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317378766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317378766">(Dec 22 2022 at 14:29)</a>:</h4>
<p>I think the lemmas should use <code>A -&gt; Bool</code> iff the function does</p>



<a name="317378857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317378857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317378857">(Dec 22 2022 at 14:29)</a>:</h4>
<p>it doesn't make any sense for them not to match</p>



<a name="317379795"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317379795" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317379795">(Dec 22 2022 at 14:33)</a>:</h4>
<p>And if the lemma also involves an <code>if</code> about <code>p x</code> where <code>p : A -&gt; Bool</code>, then should it be changed to <code>bif</code>?</p>



<a name="317385290"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317385290" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317385290">(Dec 22 2022 at 14:57)</a>:</h4>
<p>Seems like maybe sticking with <code>if</code> is better, since <code>if</code> is used in a lot of other places?</p>



<a name="317387542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317387542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317387542">(Dec 22 2022 at 15:07)</a>:</h4>
<p>We may or may not want two versions in those cases. I think <code>if</code> is handled a bit better than <code>bif</code>, which is really just syntax for <code>cond</code> and doesn't get special handling by the <code>split</code>/<code>split_ifs</code> tactics</p>



<a name="317448520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317448520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317448520">(Dec 22 2022 at 20:43)</a>:</h4>
<p>finished <code>splitOnP</code>! moving onto <code>lookmap</code>—it seems to be the same sort of <code>go</code>-wrangling.</p>



<a name="317458706"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317458706" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317458706">(Dec 22 2022 at 21:56)</a>:</h4>
<p>Oh, I wanted to ask: I proved a couple of thorny theorems about <code>modifyLast</code> that dive into <code>modifyLast.go</code>, but didn’t wind up needing them. Though, they fit pretty well in <code>Data.List.Basic</code> and are natural equalities to want (<code>modifyLast f (l ++ [a]) = l ++ [f a]</code> and <code>modifyLast f (l₁ ++ l₂) = l₁ ++ modifyLast f l₂</code> given <code>l₂ ≠ []</code>).</p>
<p>Should I leave them in their own new section as they are now, or save them til after the port/discard them?</p>



<a name="317460090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460090">(Dec 22 2022 at 22:09)</a>:</h4>
<p>Lean complains on L4128 (the first error in the file)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">#</span><span class="n">align</span> <span class="n">list.erasep</span> <span class="n">List.erasePₓ</span> <span class="c1">-- prop -&gt; bool</span>
<span class="c1">-- list.erasep has already been aligned (to List.erasep)</span>
</code></pre></div>



<a name="317460112"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460112" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460112">(Dec 22 2022 at 22:09)</a>:</h4>
<p>Can we just erase it?</p>



<a name="317460266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460266">(Dec 22 2022 at 22:10)</a>:</h4>
<p>I guess so. The align is done in <code>Data.List.Defs</code>.</p>



<a name="317460272"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460272" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460272">(Dec 22 2022 at 22:10)</a>:</h4>
<p>Pushed a minifix</p>



<a name="317460283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460283">(Dec 22 2022 at 22:10)</a>:</h4>
<p>I think something else should be done: it's currently aligned to something that doesn't change <code>prop</code> to <code>Bool</code></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- `erasep p l` removes the first element of `l` satisfying the predicate `p`. -/</span>
<span class="kd">def</span> <span class="n">erasep</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Prop</span><span class="o">)</span> <span class="o">[</span><span class="n">DecidablePred</span> <span class="n">p</span><span class="o">]</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span>
  <span class="bp">|</span> <span class="o">[]</span> <span class="bp">=&gt;</span> <span class="o">[]</span>
  <span class="bp">|</span> <span class="n">a</span> <span class="o">::</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="k">if</span> <span class="n">p</span> <span class="n">a</span> <span class="k">then</span> <span class="n">l</span> <span class="k">else</span> <span class="n">a</span> <span class="o">::</span> <span class="n">erasep</span> <span class="n">p</span> <span class="n">l</span>
<span class="bp">#</span><span class="n">align</span> <span class="n">list.erasep</span> <span class="n">List.erasep</span>
</code></pre></div>



<a name="317460329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460329">(Dec 22 2022 at 22:11)</a>:</h4>
<p>Note the name: <code>erasep</code> vs. <code>eraseP</code>, the latter of which is in Std and makes the switch from <code>Prop</code> to <code>Bool</code></p>



<a name="317460336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460336">(Dec 22 2022 at 22:11)</a>:</h4>
<p>First error is now on L4313. Second error on L4729. Getting close!</p>



<a name="317460359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460359">(Dec 22 2022 at 22:11)</a>:</h4>
<p>I think <code>erasep</code> should be deleted from <code>Data.List.Defs</code></p>



<a name="317460416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460416">(Dec 22 2022 at 22:12)</a>:</h4>
<p>Aha, that sounds sensible!</p>



<a name="317460426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460426">(Dec 22 2022 at 22:12)</a>:</h4>
<p>Feel free to revert my minifix</p>



<a name="317460771"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317460771" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317460771">(Dec 22 2022 at 22:15)</a>:</h4>
<p>I'm not seeing your minifix on github; I'll just fix it as-is and hope it goes through <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="317672257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317672257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317672257">(Dec 24 2022 at 04:20)</a>:</h4>
<p>What's the canonical place for <code>#align</code>s between Lean 3 core and Std? (Here the relevant aligns were <code>ball_cons</code> to <code>forall_mem_cons</code> and <code>ball_nil</code> to <code>forall_mem_nil</code>, all in the namespace <code>list</code>/<code>List</code>)</p>



<a name="317672779"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317672779" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317672779">(Dec 24 2022 at 04:33)</a>:</h4>
<p>in the relevant mathlib4 file</p>



<a name="317672857"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317672857" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317672857">(Dec 24 2022 at 04:35)</a>:</h4>
<p><code>ball_cons</code> is in <code>init.data.list.lemmas</code>, so the <code>#align ball_cons forall_mem_cons</code> should go in <code>Mathlib.Init.Data.List.Lemmas</code> (in the same order as the lean 3 declarations)</p>



<a name="317673505"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317673505" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317673505">(Dec 24 2022 at 04:48)</a>:</h4>
<p>I see, I didn't realize Lean core had that sort of correspondence with mathlib—makes sense now that I do :)</p>



<a name="317718573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317718573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317718573">(Dec 24 2022 at 12:37)</a>:</h4>
<p>I don't want to get anyone too excited but Data.List.Basic now compiles without errors.</p>



<a name="317718584"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317718584" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317718584">(Dec 24 2022 at 12:37)</a>:</h4>
<p>What now?</p>



<a name="317734465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317734465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317734465">(Dec 24 2022 at 14:39)</a>:</h4>
<p>I read through the whole file and it seems to be in pretty good shape actually. Some remaining questions:</p>
<ul>
<li>Should we align <code>list.repeat</code> and <code>List.replicate</code>?</li>
<li>Are we really adding <code>instance : Monad List</code>?</li>
<li>We don't want to keep these enormous "dubious translation" comments, do we?</li>
<li>Do we need to add dozens of xs, e.g. on all the lemmas about <code>filter</code>? How?</li>
</ul>



<a name="317736467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317736467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317736467">(Dec 24 2022 at 14:55)</a>:</h4>
<p>I think the answers to the first and third ones are "no".</p>



<a name="317738955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317738955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317738955">(Dec 24 2022 at 15:15)</a>:</h4>
<p>Repeat and replicate have the arguments in the opposite order, so I think not</p>



<a name="317740744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317740744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317740744">(Dec 24 2022 at 15:29)</a>:</h4>
<p>The suggestion elsewhere was to backport the argument reorder</p>



<a name="317741718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317741718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317741718">(Dec 24 2022 at 15:40)</a>:</h4>
<p>Right. So presumably that doesn't require any action in mathlib4 for now</p>



<a name="317747316"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317747316" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317747316">(Dec 24 2022 at 16:39)</a>:</h4>
<p>If we backport first then we can align and not have to merge things later</p>



<a name="317748487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317748487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317748487">(Dec 24 2022 at 16:55)</a>:</h4>
<p>Hmm, I'd almost rather not backport/align at all</p>



<a name="317752931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317752931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317752931">(Dec 24 2022 at 18:00)</a>:</h4>
<p>We can also not backport and <code>#align</code> with x. The resulting files will not compile because they will e.g. call List.replicate with arguments in the wrong order, but that might be good enough for manual porting work, since we've probably already seen most of the uses of this function in this file</p>



<a name="317759867"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317759867" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317759867">(Dec 24 2022 at 19:48)</a>:</h4>
<p>Ad <code>Monad List</code>, does <code>attribute [local instance]</code> work in Lean 4?</p>



<a name="317759897"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317759897" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317759897">(Dec 24 2022 at 19:48)</a>:</h4>
<p>Maybe we can just make a <code>def</code> and locally make it an instance to state its API lemmas and wherever else the instance is needed in mathlib</p>



<a name="317760121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317760121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317760121">(Dec 24 2022 at 19:52)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">class</span> <span class="n">foo</span> <span class="o">(</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Type</span><span class="o">)</span> <span class="n">where</span>

<span class="kd">def</span> <span class="n">bar</span> <span class="o">:</span> <span class="n">foo</span> <span class="n">Nat</span> <span class="o">:=</span> <span class="o">{</span> <span class="o">}</span>

<span class="bp">#</span><span class="n">synth</span> <span class="n">foo</span> <span class="n">Nat</span> <span class="c1">-- fails</span>

<span class="kn">attribute</span> <span class="o">[</span><span class="kn">local</span> <span class="kd">instance</span><span class="o">]</span> <span class="n">bar</span>

<span class="bp">#</span><span class="n">synth</span> <span class="n">foo</span> <span class="n">Nat</span> <span class="c1">-- works</span>
</code></pre></div>
<p>Looks like it's OK</p>



<a name="317761016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317761016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317761016">(Dec 24 2022 at 20:04)</a>:</h4>
<p>We could make <code>Monad List</code> a scoped instance</p>



<a name="317928748"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317928748" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317928748">(Dec 26 2022 at 09:39)</a>:</h4>
<p>I fixed the non simp_nf linting errors</p>



<a name="317931820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317931820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317931820">(Dec 26 2022 at 10:08)</a>:</h4>
<p>Scoped to <code>List</code>, or to something more specific (<code>ListMonad</code>?)?</p>



<a name="317932648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317932648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317932648">(Dec 26 2022 at 10:14)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- somewhere in Std</span>
<span class="kd">@[simp]</span> <span class="kd">theorem</span> <span class="n">getLast_eq_getLastD</span> <span class="o">(</span><span class="n">a</span> <span class="n">l</span> <span class="n">h</span><span class="o">)</span> <span class="o">:</span> <span class="bp">@</span><span class="n">getLast</span> <span class="n">α</span> <span class="o">(</span><span class="n">a</span><span class="o">::</span><span class="n">l</span><span class="o">)</span> <span class="n">h</span> <span class="bp">=</span> <span class="n">getLastD</span> <span class="n">l</span> <span class="n">a</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">cases</span> <span class="n">l</span> <span class="bp">&lt;;&gt;</span> <span class="n">rfl</span>
</code></pre></div>
<p>Is this a good simp lemma? Should <code>getLastD</code> be the snf?</p>



<a name="317935251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317935251" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317935251">(Dec 26 2022 at 10:38)</a>:</h4>
<p>What should we do with lint errors like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="bp">@</span><span class="n">List.mem_map_swap</span> <span class="c">/-</span><span class="cm"> Left-hand side simplifies from</span>
<span class="cm">  (y, x) ∈ List.map Prod.swap xs</span>
<span class="cm">to</span>
<span class="cm">  Exists fun a ↦ Exists fun b ↦ (a, b) ∈ xs ∧ b = y ∧ a = x</span>
<span class="cm">using</span>
<span class="cm">  simp only [List.mem_map', Prod.exists, Prod.swap_prod_mk, Prod.mk.injEq]</span>
<span class="cm">Try to change the left-hand side to the simplified term!</span>
<span class="cm"> -/</span>
</code></pre></div>



<a name="317935315"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317935315" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317935315">(Dec 26 2022 at 10:39)</a>:</h4>
<p>Should we</p>
<ol>
<li>remove the <code>@[simp]</code> and do nothing else</li>
<li>remove the <code>@[simp]</code> and create a new simp-lemma with a simplified LHS as instructed by the linter</li>
<li>just modify the statement, as instructed</li>
</ol>



<a name="317935448"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317935448" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317935448">(Dec 26 2022 at 10:40)</a>:</h4>
<p>I've fixed all the trivial linting errors. The remaining ones are variations on <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="317935568"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317935568" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317935568">(Dec 26 2022 at 10:41)</a>:</h4>
<p>I guess maybe the first question is what is the situation in mathlib 3? Does the LHS not simplify with mathlib's simp set?</p>



<a name="317935664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317935664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317935664">(Dec 26 2022 at 10:42)</a>:</h4>
<p>I think <code>Std</code> introduces a bunch of simp lemmas that diverge from the mathlib3 simpset</p>



<a name="317937167"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317937167" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317937167">(Dec 26 2022 at 10:56)</a>:</h4>
<p>Both of the examples look like reasonable simp lemmas. <code>List.map_mem_swap</code> less so</p>



<a name="317937401"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/317937401" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#317937401">(Dec 26 2022 at 10:58)</a>:</h4>
<p><code>getLastD</code> has better defeqs than <code>getLast</code></p>



<a name="319317813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319317813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jihoon Hyun <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319317813">(Jan 04 2023 at 03:24)</a>:</h4>
<p>Hello, I'd like to contribute to Data.List.Basic or its successor. I could find that there were intense discussions on linting Data.List.Basic, and the only work left is about linting. As I'm still kind of new here, I'd like to ask if I can start porting the successor like Data.List.TFAE, or it should start after every linting errors are corrected.</p>



<a name="319321365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319321365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319321365">(Jan 04 2023 at 04:27)</a>:</h4>
<p>You can always work on a file which is still in PR stage, you just need to make your PR dependent on that one. If it's still giving linting errors then you will most likely see those same errors in CI for your branch, so it won't be able to be merged either until the other one is fixed and your branch merges the fixes in, but otherwise it shouldn't be a blocker to preparing the PR</p>



<a name="319469499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319469499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319469499">(Jan 04 2023 at 20:41)</a>:</h4>
<p>For the record, this is what's left here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Found 4 errors in 25005 declarations (plus 59456 automatically generated ones) in mathlib with 13 linters</span>

<span class="c">/-</span><span class="cm"> The `simpNF` linter reports:</span>
<span class="cm">SOME SIMP LEMMAS ARE NOT IN SIMP-NORMAL FORM.</span>
<span class="cm">see note [simp-normal form] for tips how to debug this.</span>
<span class="cm">https://leanprover-community.github.io/mathlib_docs/notes.html#simp-normal%20form -/</span>
<span class="c1">-- Mathlib.Data.List.Basic</span>
<span class="k">#check</span> <span class="n">List.get_insertNth_self.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="c">/-</span><span class="cm"> Left-hand side does not simplify, when using the simp lemma on itself.</span>
<span class="cm">This usually means that it will never apply.</span>
<span class="cm"> -/</span>
<span class="k">#check</span> <span class="n">List.nthLe_insertNth_self.</span><span class="o">{</span><span class="n">u</span><span class="o">}</span> <span class="c">/-</span><span class="cm"> Left-hand side does not simplify, when using the simp lemma on itself.</span>
<span class="cm">This usually means that it will never apply.</span>
<span class="cm"> -/</span>
<span class="k">#check</span> <span class="n">List.init_cons_of_ne_nil.</span><span class="o">{</span><span class="n">u_1</span><span class="o">}</span> <span class="c">/-</span><span class="cm"> simp can prove this:</span>
<span class="cm">  by simp only [_private.Std.Data.List.Init.Lemmas.0.List.dropLast._eq_3]</span>
<span class="cm">One of the lemmas above could be a duplicate.</span>
<span class="cm">If that's not the case try reordering lemmas or adding @[priority].</span>
<span class="cm"> -/</span>
<span class="k">#check</span> <span class="n">List.attach_map_coe'.</span><span class="o">{</span><span class="n">u</span><span class="o">,</span> <span class="n">v</span><span class="o">}</span> <span class="c">/-</span><span class="cm"> Left-hand side does not simplify, when using the simp lemma on itself.</span>
<span class="cm">This usually means that it will never apply.</span>
<span class="cm"> -/</span>
</code></pre></div>



<a name="319469626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319469626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319469626">(Jan 04 2023 at 20:42)</a>:</h4>
<p>These seem to be final end-bosses.</p>



<a name="319505510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319505510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319505510">(Jan 05 2023 at 02:19)</a>:</h4>
<p>Does it make sense to delete <code>init_cons_of_ne_nil</code> and <code>#noalign</code> it? It seems it can replaced in a <code>simp</code> call by <code>simp only [dropLast]</code> now. Or do we align it with the equation for <code>dropLast</code>, if that's possible?</p>



<a name="319505598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319505598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319505598">(Jan 05 2023 at 02:19)</a>:</h4>
<p>if the theorem is still true I don't see any reason to remove it</p>



<a name="319505656"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319505656" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319505656">(Jan 05 2023 at 02:20)</a>:</h4>
<p>ok! so just remove <code>@[simp]</code> from it?</p>



<a name="319505789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319505789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319505789">(Jan 05 2023 at 02:22)</a>:</h4>
<p>is <code>dropLast</code> marked as simp?</p>



<a name="319505849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319505849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319505849">(Jan 05 2023 at 02:23)</a>:</h4>
<p>ah...no, it's not.</p>



<a name="319506106"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319506106" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319506106">(Jan 05 2023 at 02:26)</a>:</h4>
<p>however, <code>example {α : Type _} {x : α} {l : List α} (_ : l ≠ []) : (x :: l).dropLast = x :: l.dropLast := by simp</code> works and the trace shows that it uses a <code>dropLast</code> definition lemma (<code>@List.dropLast._eq_3</code>, as expected)</p>



<a name="319506364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319506364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319506364">(Jan 05 2023 at 02:30)</a>:</h4>
<p>(maybe I don't know the appropriate way to check if <code>dropLast</code> is marked as simp...all I know is <code>@[simp]</code> doesn't appear above the declaration)</p>



<a name="319507149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319507149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319507149">(Jan 05 2023 at 02:42)</a>:</h4>
<p>There's an <code>attribute [simp] dropLast</code> in std4.</p>



<a name="319507372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319507372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319507372">(Jan 05 2023 at 02:45)</a>:</h4>
<p>(ah, ok, I see how it works now!)</p>



<a name="319523225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319523225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319523225">(Jan 05 2023 at 06:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110043">Gabriel Ebner</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/319507149">said</a>:</p>
<blockquote>
<p>There's an <code>attribute [simp] dropLast</code> in std4.</p>
</blockquote>
<p>Wait, I thought those weren't global? Am I mistaken?</p>



<a name="319533212"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319533212" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319533212">(Jan 05 2023 at 08:13)</a>:</h4>
<p><code>attribute [simp]</code> is global, but <code>attribute [local simp]</code> and <code>attribute [-simp]</code> are not</p>



<a name="319533972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319533972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319533972">(Jan 05 2023 at 08:20)</a>:</h4>
<p>oooh! I see. That's not what I expected.</p>



<a name="319536440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319536440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319536440">(Jan 05 2023 at 08:42)</a>:</h4>
<p>That certainly is a bit confusing. Is there a hover or something else that will teach people this?</p>



<a name="319543991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319543991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319543991">(Jan 05 2023 at 09:31)</a>:</h4>
<p>This file is now passing the linter! Thanks <span class="user-mention" data-user-id="110049">@Mario Carneiro</span></p>



<a name="319594659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319594659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319594659">(Jan 05 2023 at 14:16)</a>:</h4>
<p>What do we do here?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">nthLe_reverse'</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">(</span><span class="n">hn</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">&lt;</span> <span class="n">l.reverse.length</span><span class="o">)</span> <span class="o">(</span><span class="n">hn'</span><span class="o">)</span> <span class="o">:</span>
    <span class="n">l.reverse.nthLe</span> <span class="n">n</span> <span class="n">hn</span> <span class="bp">=</span> <span class="n">l.nthLe</span> <span class="o">(</span><span class="n">l.length</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">n</span><span class="o">)</span> <span class="n">hn'</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">rw</span> <span class="o">[</span><span class="n">eq_comm</span><span class="o">]</span>
  <span class="n">convert</span> <span class="n">nthLe_reverse</span> <span class="n">l.reverse</span> <span class="n">n</span> <span class="o">(</span><span class="kd">by</span> <span class="n">simpa</span><span class="o">)</span> <span class="n">hn</span> <span class="n">using</span> <span class="mi">1</span>
  <span class="n">simp</span>
<span class="bp">#</span><span class="n">align</span> <span class="n">list.nth_le_reverse'</span> <span class="n">List.nthLe_reverse'</span>

<span class="kd">theorem</span> <span class="n">get_reverse'</span> <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">hn'</span><span class="o">)</span> <span class="o">:</span>
    <span class="n">l.reverse.get</span> <span class="n">n</span> <span class="bp">=</span> <span class="n">l.get</span> <span class="o">⟨</span><span class="n">l.length</span> <span class="bp">-</span> <span class="mi">1</span> <span class="bp">-</span> <span class="n">n</span><span class="o">,</span> <span class="n">hn'</span><span class="o">⟩</span> <span class="o">:=</span> <span class="n">nthLe_reverse'</span> <span class="bp">..</span>

<span class="c1">-- FIXME: prove it the other way around</span>
<span class="kn">attribute</span> <span class="o">[</span><span class="n">deprecated</span> <span class="n">get_reverse'</span><span class="o">]</span> <span class="n">nthLe_reverse'</span>
</code></pre></div>



<a name="319594817"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319594817" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319594817">(Jan 05 2023 at 14:17)</a>:</h4>
<p>Note that the types don't line up:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="n">nthLe_reverse'</span>
<span class="c1">-- List.nthLe_reverse'.{u} {α : Type u} (l : List α) (n : ℕ) (hn : n &lt; length (reverse l))</span>
<span class="c1">--   (hn' : length l - 1 - n &lt; length l) : nthLe (reverse l) n hn = nthLe l (length l - 1 - n) hn'</span>
<span class="k">#check</span> <span class="n">get_reverse'</span>
<span class="c1">-- List.get_reverse'.{u} {α : Type u} (l : List α) (n : Fin (length (reverse l))) (hn' : length l - 1 - ↑n &lt; length l) :</span>
<span class="c1">--   get (reverse l) n = get l { val := length l - 1 - ↑n, isLt := hn' }</span>
</code></pre></div>



<a name="319594913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319594913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319594913">(Jan 05 2023 at 14:17)</a>:</h4>
<p>So I'm questioning whether the <code>attribute [deprecated]</code> is even correct.</p>



<a name="319595373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319595373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319595373">(Jan 05 2023 at 14:19)</a>:</h4>
<p>Ooh, I guess this is just a very general thing about <code>nthLe</code> vs <code>get</code>?</p>



<a name="319595518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319595518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319595518">(Jan 05 2023 at 14:20)</a>:</h4>
<p>I'm not sure we should have deprecated <code>nthLe</code> in that case. Sounds like something that should better be done after the port.</p>



<a name="319595546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319595546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319595546">(Jan 05 2023 at 14:20)</a>:</h4>
<p>We're doing too many refactors on the fly.</p>



<a name="319599567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319599567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319599567">(Jan 05 2023 at 14:40)</a>:</h4>
<p>I fixed two of the <code>FIXME</code>s in the file. What remains is very non-urgent.</p>



<a name="319599619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319599619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319599619">(Jan 05 2023 at 14:40)</a>:</h4>
<p>I'm going to kick this on the queue.</p>



<a name="319599688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319599688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319599688">(Jan 05 2023 at 14:40)</a>:</h4>
<p>Ooh, <span class="user-mention" data-user-id="110044">@Chris Hughes</span> was faster (-;</p>



<a name="319604153"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319604153" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319604153">(Jan 05 2023 at 15:03)</a>:</h4>
<p><img alt=":merge:" class="emoji" src="https://zulip-avatars.s3.amazonaws.com/3121/emoji/images/18527.png" title="merge"> done <span aria-label="octopus" class="emoji emoji-1f419" role="img" title="octopus">:octopus:</span></p>



<a name="319657918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319657918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319657918">(Jan 05 2023 at 19:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EList.2EBasic/near/319595546">said</a>:</p>
<blockquote>
<p>We're doing too many refactors on the fly.</p>
</blockquote>
<p><code>deprecated</code> is explicitly <em>not</em> a refactor. It is a marker which is used to prepare the library for a future refactor. Importantly, the original lemmas still exist and still have the types required for downstream stuff.</p>



<a name="319658089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319658089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319658089">(Jan 05 2023 at 19:33)</a>:</h4>
<p>the <code>nthLe</code> refactor cannot proceed until we have at least the majority of code using <code>nthLe</code> available, which means it will not be removed / reassessed until after the port</p>



<a name="319658359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319658359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319658359">(Jan 05 2023 at 19:35)</a>:</h4>
<p>in general <code>deprecated</code> is being used when the replacement lemma is more than a little different, such that it would be too much to do the refactor on the fly</p>



<a name="319662931"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319662931" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319662931">(Jan 05 2023 at 20:01)</a>:</h4>
<p>but the deprecated linter can be an annoying speedbump. Should we be lax about nolinting in that case?</p>



<a name="319674368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319674368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319674368">(Jan 05 2023 at 21:18)</a>:</h4>
<p>nolint doesn't work on the deprecated linter, since it's not a real linter but just a warning that is thrown up when you use a deprecated definition directly during elaboration. You have to use <code>set_option linter.deprecated false</code> to turn it off or else CI will complain</p>



<a name="319676080"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319676080" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319676080">(Jan 05 2023 at 21:31)</a>:</h4>
<p>So should we be lax with that option?</p>



<a name="319678331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319678331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319678331">(Jan 05 2023 at 21:47)</a>:</h4>
<p>yes</p>



<a name="319678353"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319678353" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319678353">(Jan 05 2023 at 21:47)</a>:</h4>
<p>I mean it's a requirement in any case</p>



<a name="319679298"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319679298" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319679298">(Jan 05 2023 at 21:53)</a>:</h4>
<p>Or you rewrite the proof... which can be tedious.</p>



<a name="319679627"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319679627" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319679627">(Jan 05 2023 at 21:56)</a>:</h4>
<p>for a theorem which mentions <code>nthLe</code> rewriting the proof isn't an option</p>



<a name="319679732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319679732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319679732">(Jan 05 2023 at 21:56)</a>:</h4>
<p>sure, but I've seen examples where only the proof used deprecated decls.</p>



<a name="319679759"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319679759" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319679759">(Jan 05 2023 at 21:56)</a>:</h4>
<p>I vote for allowing those during the port.</p>



<a name="319679791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319679791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319679791">(Jan 05 2023 at 21:57)</a>:</h4>
<p>for theorems which use <code>nthLe</code> internally but not in the statement, I will leave it up to the porter whether they want to try removing it or not</p>



<a name="319679828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.List.Basic/near/319679828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EList.2EBasic.html#319679828">(Jan 05 2023 at 21:57)</a>:</h4>
<p>leaving it alone is totally fine</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>