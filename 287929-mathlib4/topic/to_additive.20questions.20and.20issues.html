---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html">to_additive questions and issues</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="315628345"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315628345" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315628345">(Dec 13 2022 at 16:17)</a>:</h4>
<p>I'm looking at the mathport file <code>GroupTheory.GroupAction.Prod</code> and I have some questions and issues around <code>to_additive</code>.</p>
<p>First, we have </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variable</span> <span class="o">[</span><span class="n">SMul</span> <span class="n">M</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">SMul</span> <span class="n">M</span> <span class="n">β</span><span class="o">]</span> <span class="o">[</span><span class="n">SMul</span> <span class="n">N</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">SMul</span> <span class="n">N</span> <span class="n">β</span><span class="o">]</span> <span class="o">(</span><span class="n">a</span> <span class="o">:</span> <span class="n">M</span><span class="o">)</span> <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span>

<span class="kd">@[to_additive Prod.hasVadd]</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">SMul</span> <span class="n">M</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span>
  <span class="o">⟨</span><span class="k">fun</span> <span class="n">a</span> <span class="n">p</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">a</span> <span class="bp">•</span> <span class="n">p.1</span><span class="o">,</span> <span class="n">a</span> <span class="bp">•</span> <span class="n">p.2</span><span class="o">)⟩</span>

<span class="kd">@[simp, to_additive]</span>
<span class="kd">theorem</span> <span class="n">smul_fst</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">•</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">•</span> <span class="n">x.1</span> <span class="o">:=</span>
  <span class="n">rfl</span>
<span class="bp">#</span><span class="n">align</span> <span class="n">prod.smul_fst</span> <span class="n">Prod.smul_fst</span>
</code></pre></div>
<p>Should the line </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">#</span><span class="n">align</span> <span class="n">prod.vadd_fst</span> <span class="n">Prod.vadd_fst</span>
</code></pre></div>
<p>be added under the align command above?</p>
<p>In general, what's the procedure for handling <code>align</code> commands in conjunction with <code>to_additive</code>?</p>
<p>Now for the issue. The following results in an error</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[to_additive SMul]</span>
<span class="kd">instance</span> <span class="n">hasPow</span> <span class="o">:</span> <span class="n">Pow</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="n">E</span> <span class="n">where</span> <span class="n">pow</span> <span class="n">p</span> <span class="n">c</span> <span class="o">:=</span> <span class="o">(</span><span class="n">p.1</span> <span class="bp">^</span> <span class="n">c</span><span class="o">,</span> <span class="n">p.2</span> <span class="bp">^</span> <span class="n">c</span><span class="o">)</span>
<span class="bp">#</span><span class="n">align</span> <span class="n">prod.has_pow</span> <span class="n">Prod.hasPow</span>
</code></pre></div>
<p>with the following error</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">application</span> <span class="n">type</span> <span class="n">mismatch</span>
  <span class="o">{</span> <span class="n">smul</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">p</span> <span class="n">c</span> <span class="bp">↦</span> <span class="o">(</span><span class="n">c</span> <span class="bp">•</span> <span class="n">p.fst</span><span class="o">,</span> <span class="n">c</span> <span class="bp">•</span> <span class="n">p.snd</span><span class="o">)</span> <span class="o">}</span>
<span class="n">argument</span> <span class="n">has</span> <span class="n">type</span>
  <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">E</span> <span class="bp">→</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span>
<span class="n">but</span> <span class="n">function</span> <span class="n">has</span> <span class="n">type</span>
  <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span> <span class="bp">→</span> <span class="n">E</span> <span class="bp">→</span> <span class="n">E</span><span class="o">)</span> <span class="bp">→</span> <span class="n">SMul</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="n">E</span>
</code></pre></div>
<p>Is this an issue with Mathlib4's <code>to_additive</code>?</p>



<a name="315628687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315628687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315628687">(Dec 13 2022 at 16:18)</a>:</h4>
<p>Yes, please duplicate the <code>#align</code> for the additive versions. It would be nice if mathport could do this automatically, but currently it can't.</p>



<a name="315628851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315628851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315628851">(Dec 13 2022 at 16:19)</a>:</h4>
<p>Mathport can do this automatically, although I think the PR is blocked on something</p>



<a name="315628864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315628864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315628864">(Dec 13 2022 at 16:19)</a>:</h4>
<p><span class="user-mention" data-user-id="111080">@Floris van Doorn</span> what about other automatically generated lemmas, like those generated by <code>simps</code> for example? (This isn't an issue for this file, I'm just thinking ahead)</p>



<a name="315628984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315628984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315628984">(Dec 13 2022 at 16:20)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathport/pull/209">mathport#209</a></p>



<a name="315629101"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315629101" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315629101">(Dec 13 2022 at 16:20)</a>:</h4>
<p>I think we want to align those too. They won't be written down very often, so it doesn't matter too much if they're missing, but it would be nice if they could be given automatically by mathport.</p>



<a name="315629124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315629124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315629124">(Dec 13 2022 at 16:20)</a>:</h4>
<p>That PR doesn't support simps, and the general case is quite hard because we don't have any information about what environment declarations correspond to what syntax</p>



<a name="315629147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315629147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315629147">(Dec 13 2022 at 16:20)</a>:</h4>
<p>ooohh.... maybe I'll just wait until that PR gets merged before porting this file (since literally every single lemma in this file is tagged with <code>to_additive</code>)</p>



<a name="315629373"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315629373" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315629373">(Dec 13 2022 at 16:21)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span class="user-mention" data-user-id="111080">@Floris van Doorn</span> any advice regarding the error I mentioned?</p>



<a name="315629869"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315629869" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315629869">(Dec 13 2022 at 16:23)</a>:</h4>
<p>it looks like we need to swap the lambdas in the <code>smul</code> argument</p>



<a name="315629923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315629923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315629923">(Dec 13 2022 at 16:24)</a>:</h4>
<p>did lean 3 handle this?</p>



<a name="315629935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315629935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315629935">(Dec 13 2022 at 16:24)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> I could try to make an attribute (or some other information) in the Lean 3 environment that contains the information which lemmas are generated by <code>simps</code>. E.g. I could make <code>simps</code> automatically give an attribute, e.g. <code>generated_by_simps [equiv.prod_coe, equiv.prod_symm_coe]</code> for <code>equiv.prod</code></p>



<a name="315629986"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315629986" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315629986">(Dec 13 2022 at 16:24)</a>:</h4>
<p>Both Lean 3 and Lean 4 should handle swapping arguments.</p>



<a name="315630022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630022">(Dec 13 2022 at 16:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues/near/315629923">said</a>:</p>
<blockquote>
<p>did lean 3 handle this?</p>
</blockquote>
<p>I guess it did?</p>



<a name="315630107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630107">(Dec 13 2022 at 16:24)</a>:</h4>
<p>swapping arguments <em>to</em> a function, yes, but I don't remember anything about swapping lambdas</p>



<a name="315630224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630224">(Dec 13 2022 at 16:25)</a>:</h4>
<p>actually I'm confused. the mathlib3 file has both </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[to_additive prod.has_vadd]</span> <span class="kd">instance</span> <span class="o">:</span> <span class="n">has_smul</span> <span class="n">M</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="o">:=</span> <span class="o">⟨</span><span class="bp">λ</span><span class="n">a</span> <span class="n">p</span><span class="o">,</span> <span class="o">(</span><span class="n">a</span> <span class="bp">•</span> <span class="n">p.1</span><span class="o">,</span> <span class="n">a</span> <span class="bp">•</span> <span class="n">p.2</span><span class="o">)⟩</span>
</code></pre></div>
<p>and </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[to_additive has_smul]</span> <span class="kd">instance</span> <span class="n">has_pow</span> <span class="o">:</span> <span class="n">has_pow</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="n">E</span> <span class="o">:=</span>
<span class="o">{</span> <span class="n">pow</span> <span class="o">:=</span> <span class="bp">λ</span> <span class="n">p</span> <span class="n">c</span><span class="o">,</span> <span class="o">(</span><span class="n">p.1</span> <span class="bp">^</span> <span class="n">c</span><span class="o">,</span> <span class="n">p.2</span> <span class="bp">^</span> <span class="n">c</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div>



<a name="315630282"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630282" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630282">(Dec 13 2022 at 16:25)</a>:</h4>
<p>that sounds like it didn't do this automatically</p>



<a name="315630309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630309">(Dec 13 2022 at 16:26)</a>:</h4>
<p>Oh, it's missing a <code>to_additive_reorder</code> attribute.</p>



<a name="315630363"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630363" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630363">(Dec 13 2022 at 16:26)</a>:</h4>
<p>Lean 4 since recently also swaps lambdas, but only of the outermost function. Maybe Lean 4 can do this automatically now.</p>



<a name="315630411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630411">(Dec 13 2022 at 16:26)</a>:</h4>
<p>Did the Lean 3 version have a <code>to_additive_reorder</code> attribute?</p>



<a name="315630450"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630450" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630450">(Dec 13 2022 at 16:26)</a>:</h4>
<p>no the lean3 version is above</p>



<a name="315630468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630468">(Dec 13 2022 at 16:26)</a>:</h4>
<p>The new syntax is <code>@[to_additive (reorder := ...)]</code> and that should take care of swapping lambdas.</p>



<a name="315630498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630498">(Dec 13 2022 at 16:26)</a>:</h4>
<p>I don't understand what the lean3 version is actually doing!</p>



<a name="315630678"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630678" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630678">(Dec 13 2022 at 16:27)</a>:</h4>
<p>In Lean 3 the <code>to_additive</code> is doing basically nothing, except recording that the two declarations you gave are a multiplicative,additive pair</p>



<a name="315630742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630742">(Dec 13 2022 at 16:27)</a>:</h4>
<p>I see</p>



<a name="315630774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630774">(Dec 13 2022 at 16:27)</a>:</h4>
<p>So what's the way forward with Lean4?</p>



<a name="315630775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315630775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315630775">(Dec 13 2022 at 16:27)</a>:</h4>
<p>If you don't give an <code>SMul</code> version in Lean 4, it will actually try to generate an <code>smul</code> version, which is of course harder.</p>



<a name="315631110"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315631110" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315631110">(Dec 13 2022 at 16:29)</a>:</h4>
<p>Just to add to the confusion: the mathlib3 version has </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp, to_additive]</span> <span class="kd">theorem</span> <span class="n">smul_fst</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">•</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">•</span> <span class="n">x.1</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="kd">@[simp, to_additive]</span> <span class="kd">theorem</span> <span class="n">smul_snd</span> <span class="o">:</span> <span class="o">(</span><span class="n">a</span> <span class="bp">•</span> <span class="n">x</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span> <span class="bp">=</span> <span class="n">a</span> <span class="bp">•</span> <span class="n">x.2</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>
<p>and </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp, to_additive smul_snd, to_additive_reorder 6]</span>
<span class="kd">lemma</span> <span class="n">pow_fst</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="bp">^</span> <span class="n">c</span><span class="o">)</span><span class="bp">.</span><span class="n">fst</span> <span class="bp">=</span> <span class="n">p.fst</span> <span class="bp">^</span> <span class="n">c</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="kd">@[simp, to_additive smul_snd, to_additive_reorder 6]</span>
<span class="kd">lemma</span> <span class="n">pow_snd</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="o">(</span><span class="n">c</span> <span class="o">:</span> <span class="n">E</span><span class="o">)</span> <span class="o">:</span> <span class="o">(</span><span class="n">p</span> <span class="bp">^</span> <span class="n">c</span><span class="o">)</span><span class="bp">.</span><span class="n">snd</span> <span class="bp">=</span> <span class="n">p.snd</span> <span class="bp">^</span> <span class="n">c</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>



<a name="315631159"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315631159" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315631159">(Dec 13 2022 at 16:29)</a>:</h4>
<p><span class="user-mention silent" data-user-id="111080">Floris van Doorn</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues/near/315629935">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> I could try to make an attribute (or some other information) in the Lean 3 environment that contains the information which lemmas are generated by <code>simps</code>. E.g. I could make <code>simps</code> automatically give an attribute, e.g. <code>generated_by_simps [equiv.prod_coe, equiv.prod_symm_coe]</code> for <code>equiv.prod</code></p>
</blockquote>
<p>Yes that will work (although it is blocked on the same thing as <a href="https://github.com/leanprover-community/mathport/pull/209">mathport#209</a>)</p>



<a name="315631196"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315631196" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315631196">(Dec 13 2022 at 16:29)</a>:</h4>
<p>the fact that <code>smul_snd</code> appears twice in the second code block is not a typo</p>



<a name="315631288"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315631288" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315631288">(Dec 13 2022 at 16:29)</a>:</h4>
<p>I suppose the <code>to_additive smul_snd</code>s don't actually do anything here either?</p>



<a name="315631723"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315631723" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315631723">(Dec 13 2022 at 16:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="111080">Floris van Doorn</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues/near/315630468">said</a>:</p>
<blockquote>
<p>The new syntax is <code>@[to_additive (reorder := ...)]</code> and that should take care of swapping lambdas.</p>
</blockquote>
<p>I guess that needs to be reflected in mathport? I don't recall writing something like that, so it's probably still generating uses of the <code>to_additive_reorder</code> attribute</p>



<a name="315632012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315632012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315632012">(Dec 13 2022 at 16:32)</a>:</h4>
<p>currently the <code>to_additive_reorder</code> attribute gives a warning message asking you to change it to <code>@[to_additive (reorder := ...)]</code><br>
Since this attribute only occurs occasionally, I don't think it's high priority to implement this in mathport.</p>



<a name="315632141"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315632141" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315632141">(Dec 13 2022 at 16:33)</a>:</h4>
<p>the reorder attribute isn't the heart of the issue I'm having.</p>



<a name="315632146"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315632146" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315632146">(Dec 13 2022 at 16:33)</a>:</h4>
<p>I think something is wrong with the invocation <code>attribute [to_additive (reorder := 1 4)] Pow.pow</code> in <code>Algebra.Group.Defs</code>. I'll investigate and try to fix.</p>



<a name="315632191"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315632191" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315632191">(Dec 13 2022 at 16:33)</a>:</h4>
<p>Thanks!</p>



<a name="315632303"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315632303" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315632303">(Dec 13 2022 at 16:33)</a>:</h4>
<p>The reorder attribute is at the heart of your issue: I think another declaration has the wrong <code>reorder</code> attribute, or there is a bug in the implementation of <code>to_additive</code>.</p>



<a name="315632456"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315632456" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315632456">(Dec 13 2022 at 16:34)</a>:</h4>
<p>well, in this case <code>Prod.SMul</code> is defined by hand, while <code>Prod.Pow</code> has a <code>to_additive</code> attribute</p>



<a name="315632466"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315632466" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315632466">(Dec 13 2022 at 16:34)</a>:</h4>
<p>presumably the relevant function is <code>has_pow.mk</code></p>



<a name="315632561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315632561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315632561">(Dec 13 2022 at 16:35)</a>:</h4>
<p>I think you're right</p>



<a name="315633245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315633245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315633245">(Dec 13 2022 at 16:38)</a>:</h4>
<p><span class="user-mention" data-user-id="243562">@Adam Topaz</span> the easiest thing for now is to just port both the <code>Pow</code> and <code>SMul</code> instances (which I think you already do), and then use <code>@[to_additive &lt;name_of_SMul_instance&gt;]</code>.</p>



<a name="315633332"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315633332" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315633332">(Dec 13 2022 at 16:38)</a>:</h4>
<p>The different thing you're trying to do compared to Lean 3 is that you're auto-generating the <code>SMul</code> instance, because the name of the <code>SMul</code> instance has changed.</p>



<a name="315633486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315633486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315633486">(Dec 13 2022 at 16:39)</a>:</h4>
<p>I think <code>to_additive</code> could automatically generate the <code>SMul</code> instance in Lean 4, but <code>to_additive</code> might need a new feature for that.</p>



<a name="315634002"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315634002" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315634002">(Dec 13 2022 at 16:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues/near/315631288">said</a>:</p>
<blockquote>
<p>I suppose the <code>to_additive smul_snd</code>s don't actually do anything here either?</p>
</blockquote>
<p>It will only generate the dictionary entry. In particular this will mean that additivizing any lemma that using <code>pow_fst</code> will fail, since it will try to replace it by <code>smul_snd</code> and then you'll get a type mismatch.</p>



<a name="315634419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315634419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315634419">(Dec 13 2022 at 16:43)</a>:</h4>
<p>What's the porting procedure for naming instances such as this?</p>



<a name="315634476"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315634476" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315634476">(Dec 13 2022 at 16:44)</a>:</h4>
<p>the automatically generated name is <code>Prod.instSMulProd</code>.</p>



<a name="315634688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315634688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315634688">(Dec 13 2022 at 16:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="111080">Floris van Doorn</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues/near/315633486">said</a>:</p>
<blockquote>
<p>I think <code>to_additive</code> could automatically generate the <code>SMul</code> instance in Lean 4, but <code>to_additive</code> might need a new feature for that.</p>
</blockquote>
<p>The issue with this is that the <code>to_additive</code> tag for <code>SMul</code> makes the <code>VAdd</code> instance, so <code>SMul</code> does need to be defined by hand.</p>



<a name="315634712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315634712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315634712">(Dec 13 2022 at 16:45)</a>:</h4>
<p>I don't know. I think we can keep the automatically generated names.</p>



<a name="315634970"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315634970" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315634970">(Dec 13 2022 at 16:46)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues/near/315634688">said</a>:</p>
<blockquote>
<p>The issue with this is that the <code>to_additive</code> tag for <code>SMul</code> makes the <code>VAdd</code> instance, so <code>SMul</code> does need to be defined by hand.</p>
</blockquote>
<p>Not necessarily. For some declarations we now use the following to generate <code>pow_lemma</code>, <code>smul_lemma</code> and <code>vadd_lemma</code></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[to_additive (reorder := ...)]</span> <span class="n">pow_lemma</span> <span class="bp">...</span>
<span class="kn">attribute</span> <span class="o">[</span><span class="n">to_additive</span><span class="o">]</span> <span class="n">smul_lemma</span>
</code></pre></div>
<p>(and we could of course make this easier to type if we want)</p>



<a name="315635552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315635552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315635552">(Dec 13 2022 at 16:49)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues/near/315631159">said</a>:</p>
<blockquote>
<p>Yes that will work (although it is blocked on the same thing as <a href="https://github.com/leanprover-community/mathport/pull/209">mathport#209</a>)</p>
</blockquote>
<p>Ok, I'll put that on my todo list (though no promises it will happen this year).</p>



<a name="315636573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315636573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315636573">(Dec 13 2022 at 16:53)</a>:</h4>
<p>ruuuuuuggghhhh this file has other issues...<br>
The def</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[to_additive instSMulProd]</span>
<span class="kd">instance</span> <span class="o">:</span> <span class="n">Pow</span> <span class="o">(</span><span class="n">α</span> <span class="bp">×</span> <span class="n">β</span><span class="o">)</span> <span class="n">E</span> <span class="n">where</span> <span class="n">pow</span> <span class="n">p</span> <span class="n">c</span> <span class="o">:=</span> <span class="bp">...</span>
</code></pre></div>
<p>has the following context:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">M</span><span class="o">:</span> <span class="kt">Type</span> <span class="bp">?</span><span class="n">u.5487</span>
<span class="n">N</span><span class="o">:</span> <span class="kt">Type</span> <span class="bp">?</span><span class="n">u.5490</span>
<span class="n">P</span><span class="o">:</span> <span class="kt">Type</span> <span class="bp">?</span><span class="n">u.5493</span>
<span class="n">E</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u_1</span>
<span class="n">α</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u_2</span>
<span class="n">β</span><span class="o">:</span> <span class="kt">Type</span> <span class="n">u_3</span>
<span class="n">inst</span><span class="bp">✝⁵</span><span class="o">:</span> <span class="n">SMul</span> <span class="n">M</span> <span class="n">α</span>
<span class="n">inst</span><span class="bp">✝⁴</span><span class="o">:</span> <span class="n">SMul</span> <span class="n">M</span> <span class="n">β</span>
<span class="n">inst</span><span class="bp">✝³</span><span class="o">:</span> <span class="n">SMul</span> <span class="n">N</span> <span class="n">α</span>
<span class="n">inst</span><span class="bp">✝²</span><span class="o">:</span> <span class="n">SMul</span> <span class="n">N</span> <span class="n">β</span>
<span class="n">a</span><span class="o">:</span> <span class="n">M</span>
<span class="n">x</span><span class="o">:</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span>
<span class="n">inst</span><span class="bp">✝¹</span><span class="o">:</span> <span class="n">Pow</span> <span class="n">α</span> <span class="n">E</span>
<span class="n">inst</span><span class="bp">✝</span><span class="o">:</span> <span class="n">Pow</span> <span class="n">β</span> <span class="n">E</span>
<span class="n">p</span><span class="o">:</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span>
<span class="n">c</span><span class="o">:</span> <span class="n">E</span>
<span class="bp">⊢</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">β</span>
</code></pre></div>



<a name="315636866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315636866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315636866">(Dec 13 2022 at 16:55)</a>:</h4>
<p>It uses all variables? I wonder why... Is it because of the <code>where</code> syntax?</p>



<a name="315636997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315636997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315636997">(Dec 13 2022 at 16:55)</a>:</h4>
<p>oh nevermind the additional instances are removed once the definition is completed.</p>



<a name="315637565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315637565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315637565">(Dec 13 2022 at 16:58)</a>:</h4>
<p>By the way, does Lean4's <code>to_additive</code> support the following syntax? <code>to_additive (reorder := 6) foobar</code>?</p>



<a name="315637607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315637607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315637607">(Dec 13 2022 at 16:58)</a>:</h4>
<p>it seems that it does not!</p>



<a name="315640416"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315640416" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315640416">(Dec 13 2022 at 17:10)</a>:</h4>
<p>It does, the reorder argument comes second</p>



<a name="315640567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315640567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315640567">(Dec 13 2022 at 17:11)</a>:</h4>
<p>I think that should be changed BTW, the usual convention is for config args to come first</p>



<a name="315640623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315640623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315640623">(Dec 13 2022 at 17:11)</a>:</h4>
<p>oh I see</p>



<a name="315640638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315640638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315640638">(Dec 13 2022 at 17:11)</a>:</h4>
<p>yes that's confusing</p>



<a name="315640861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315640861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315640861">(Dec 13 2022 at 17:12)</a>:</h4>
<p>ok, I can change that</p>



<a name="315642033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/315642033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Adam Topaz <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#315642033">(Dec 13 2022 at 17:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="243562">Adam Topaz</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues/near/315631196">said</a>:</p>
<blockquote>
<p>the fact that <code>smul_snd</code> appears twice in the second code block is not a typo</p>
</blockquote>
<p>In the meantime: <a href="https://github.com/leanprover-community/mathlib/pull/17930">#17930</a></p>



<a name="316265223"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/316265223" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#316265223">(Dec 16 2022 at 13:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues/near/315631159">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="111080">Floris van Doorn</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues/near/315629935">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> I could try to make an attribute (or some other information) in the Lean 3 environment that contains the information which lemmas are generated by <code>simps</code>. E.g. I could make <code>simps</code> automatically give an attribute, e.g. <code>generated_by_simps [equiv.prod_coe, equiv.prod_symm_coe]</code> for <code>equiv.prod</code></p>
</blockquote>
<p>Yes that will work (although it is blocked on the same thing as <a href="https://github.com/leanprover-community/mathport/pull/209">mathport#209</a>)</p>
</blockquote>
<p><a href="https://github.com/leanprover-community/mathlib/pull/17964">#17964</a> adds this information to an attribute (if useful I can change the presentation, e.g. to a single cache).</p>



<a name="316265341"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/316265341" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#316265341">(Dec 16 2022 at 13:24)</a>:</h4>
<p>Also, <a href="https://github.com/leanprover-community/mathport/pull/209">mathport#209</a> should be unblocked now.</p>



<a name="316437249"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20questions%20and%20issues/near/316437249" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20questions.20and.20issues.html#316437249">(Dec 17 2022 at 11:09)</a>:</h4>
<p>I think mathlib is still on 3.49.1, since the 3.50.0 release got yanked, see <a href="https://github.com/leanprover-community/mathlib/pull/17591">#17591</a>.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>