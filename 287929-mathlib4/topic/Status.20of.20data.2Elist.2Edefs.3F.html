---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html">Status of data.list.defs?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="312674954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/312674954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#312674954">(Nov 28 2022 at 17:03)</a>:</h4>
<p>This one shows up in the dependency graph all over the place. It's spuriously "blocked" by <code>RBTree</code>/<code>RBMap</code>, I think (these are now upstream).</p>
<p>When I look at this file, it has a bunch of commented out lines that I haven't investigated -- my supposition is that these are method that are implemented upstream as well?</p>



<a name="312677851"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/312677851" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#312677851">(Nov 28 2022 at 17:16)</a>:</h4>
<p>Most of the definitions are in Lean 4 core.</p>



<a name="312678011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/312678011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#312678011">(Nov 28 2022 at 17:17)</a>:</h4>
<p>The first exception I found was <a href="https://leanprover-community.github.io/mathlib_docs/find/list.nth_le">docs#list.nth_le</a>. There is <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=List.get#doc">docs4#List.get</a> but it bundles the arguments.</p>



<a name="312678182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/312678182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#312678182">(Nov 28 2022 at 17:18)</a>:</h4>
<p>So, we need to either introduce <code>List.get'</code> or migrate <code>mathlib</code> to the Lean 4-style API.</p>



<a name="312678312"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/312678312" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#312678312">(Nov 28 2022 at 17:18)</a>:</h4>
<p>Also, you can start migrating files that depend on <code>data.list.defs</code> and hope that all the required definitions are in the Std library.</p>



<a name="312707886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/312707886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#312707886">(Nov 28 2022 at 19:44)</a>:</h4>
<p>Let's introduce primed versions to make porting easy. We can eventually add a @[deprecated] tag and do a rename PR.</p>



<a name="312745138"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/312745138" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#312745138">(Nov 29 2022 at 00:09)</a>:</h4>
<p><span class="user-mention" data-user-id="214703">@Yury G. Kudryashov</span>  -- are you working on this? I'm wading through &amp; happy to do the dirty work with you as a reviewer. I'm trying to cross align through name changes, etc.</p>



<a name="312749876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/312749876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#312749876">(Nov 29 2022 at 01:03)</a>:</h4>
<p>No, I'm not working. I had a look, then decided not to start actual work.</p>



<a name="313189646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313189646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313189646">(Dec 01 2022 at 01:39)</a>:</h4>
<p><span class="user-mention" data-user-id="214703">@Yury G. Kudryashov</span>  this is ready for review in <a href="https://github.com/leanprover-community/mathlib4/pull/803">mathlib4#803</a></p>
<p>There are still a few typing issues that are eluding me, and some comments I've mostly marked with "porting notes" or "TODO" that might require review.</p>



<a name="313566638"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313566638" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313566638">(Dec 02 2022 at 18:49)</a>:</h4>
<p>This branch doesn't compile for me; <code>PermutationsAux.rec</code> can't prove that it terminates and I've just spent over an hour banging my head against a wall trying to figure out how <code>termination_by</code> works :-(</p>



<a name="313567891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313567891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313567891">(Dec 02 2022 at 18:56)</a>:</h4>
<p>what's the declaration?</p>



<a name="313568395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313568395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313568395">(Dec 02 2022 at 18:59)</a>:</h4>
<p>looking at <a href="https://leanprover-community.github.io/mathlib_docs/find/list.permutations_aux.rec/src">src#list.permutations_aux.rec</a> (which I assume is what you are talking about), it looks like the termination metric is <code>(length l + length i, length l)</code>, so something along the lines of <code>termination_by _ ts is =&gt; (length ts + length is, length ts)</code> should work</p>



<a name="313568583"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313568583" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313568583">(Dec 02 2022 at 19:00)</a>:</h4>
<p>FYI, the lean 4 name of that definition should be <code>List.permutationsAux.rec</code>. The <code>permutationsAux</code> part should not be upcased because this is an inner function</p>



<a name="313569097"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569097" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569097">(Dec 02 2022 at 19:02)</a>:</h4>
<p>Yeah, Scott already observed that in the PR. Your suggestion doesn't work; Lean can't prove the false goal <code>length ts + succ (length is) &lt; succ (length ts) + length is</code></p>



<a name="313569219"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569219" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569219">(Dec 02 2022 at 19:03)</a>:</h4>
<p>I'm not sure what the default order is on Nat x Nat but I want to use prod.lex</p>



<a name="313569258"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569258" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569258">(Dec 02 2022 at 19:03)</a>:</h4>
<p>that should be the default order</p>



<a name="313569388"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569388" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569388">(Dec 02 2022 at 19:04)</a>:</h4>
<p>if you want to use a relation directly instead of a type that happens to be well founded, you should use <code>termination_by'</code> (which should have been the output of mathport)</p>



<a name="313569435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569435">(Dec 02 2022 at 19:04)</a>:</h4>
<p>Oh is that actually a thing?</p>



<a name="313569461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569461">(Dec 02 2022 at 19:04)</a>:</h4>
<p>I assumed it was a bug!</p>



<a name="313569467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569467">(Dec 02 2022 at 19:04)</a>:</h4>
<p>do you have a MWE?</p>



<a name="313569491"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569491" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569491">(Dec 02 2022 at 19:04)</a>:</h4>
<p>addressed naming</p>
<p>Working on <a href="https://leanprover-community.github.io/mwe.html">#mwe</a></p>



<a name="313569520"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569520" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569520">(Dec 02 2022 at 19:04)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/803">mathlib4#803</a></p>



<a name="313569561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569561">(Dec 02 2022 at 19:05)</a>:</h4>
<p>MWE</p>



<a name="313569622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569622">(Dec 02 2022 at 19:05)</a>:</h4>
<p>I assume the declaration on its own works as such</p>



<a name="313569658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569658">(Dec 02 2022 at 19:05)</a>:</h4>
<p>since we're talking about data.list.defs here</p>



<a name="313569719"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569719" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569719">(Dec 02 2022 at 19:05)</a>:</h4>
<p>ironically the only reason I was trying to get this file fixed was to get hold of <code>List.nthLe</code> which doesn't seem to be in this file anyway</p>



<a name="313569820"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313569820" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313569820">(Dec 02 2022 at 19:06)</a>:</h4>
<p>Talking of which, has anyone seen <code>List.map₂</code>?</p>



<a name="313570058"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313570058" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313570058">(Dec 02 2022 at 19:07)</a>:</h4>
<p>what about it?</p>



<a name="313570174"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313570174" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313570174">(Dec 02 2022 at 19:08)</a>:</h4>
<p>I was trying to port <code>lean_core.data.vector</code> but it needs <code>List.nthLe</code> and <code>List.map₂</code></p>



<a name="313570308"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313570308" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313570308">(Dec 02 2022 at 19:09)</a>:</h4>
<p>that's zipWith isn't it?</p>



<a name="313570350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313570350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313570350">(Dec 02 2022 at 19:09)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/list.map₂/src">src#list.map₂</a> <a href="https://leanprover-community.github.io/mathlib_docs/find/list.zip_with/src">src#list.zip_with</a></p>



<a name="313570509"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313570509" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313570509">(Dec 02 2022 at 19:10)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Std.Data.Nat.Lemmas</span>
<span class="kn">open</span> <span class="n">List</span>
<span class="kn">open</span> <span class="n">Nat</span>

<span class="kn">private</span> <span class="kd">def</span> <span class="n">meas</span> <span class="o">:</span> <span class="o">(</span><span class="bp">Σ'</span><span class="n">_</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">,</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">Nat</span> <span class="bp">×</span> <span class="n">Nat</span>
  <span class="bp">|</span> <span class="o">⟨</span><span class="n">l</span><span class="o">,</span> <span class="n">i</span><span class="o">⟩</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">length</span> <span class="n">l</span> <span class="bp">+</span> <span class="n">length</span> <span class="n">i</span><span class="o">,</span> <span class="n">length</span> <span class="n">l</span><span class="o">)</span>

<span class="sd">/-- Local notation for termination relationship used in `rec` below</span>
<span class="sd">-/</span>
<span class="kn">local</span> <span class="kd">infixl</span><span class="o">:</span><span class="mi">50</span> <span class="s2">" ≺ "</span> <span class="bp">=&gt;</span> <span class="n">InvImage</span> <span class="o">(</span><span class="n">Prod.Lex</span> <span class="o">(</span><span class="bp">·</span> <span class="bp">&lt;</span> <span class="bp">·</span><span class="o">)</span> <span class="o">(</span><span class="bp">·</span> <span class="bp">&lt;</span> <span class="bp">·</span><span class="o">))</span> <span class="n">meas</span>

<span class="sd">/-- A recursor for pairs of lists. To have `C l₁ l₂` for all `l₁`, `l₂`, it suffices to have it for</span>
<span class="sd">`l₂ = []` and to be able to pour the elements of `l₁` into `l₂`. -/</span>
<span class="kd">@[elab_as_elim]</span>
<span class="kd">def</span> <span class="n">permutationsAux.rec</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">H0</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">is</span><span class="o">,</span> <span class="n">C</span> <span class="o">[]</span> <span class="n">is</span><span class="o">)</span>
    <span class="o">(</span><span class="n">H1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">is</span><span class="o">,</span> <span class="n">C</span> <span class="n">ts</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">is</span><span class="o">)</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">is</span> <span class="o">[]</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">)</span> <span class="n">is</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">l₁</span> <span class="n">l₂</span><span class="o">,</span> <span class="n">C</span> <span class="n">l₁</span> <span class="n">l₂</span>
  <span class="bp">|</span> <span class="o">[],</span> <span class="n">is</span> <span class="bp">=&gt;</span> <span class="n">H0</span> <span class="n">is</span>
  <span class="bp">|</span> <span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">,</span> <span class="n">is</span> <span class="bp">=&gt;</span>
    <span class="k">have</span> <span class="n">h1</span> <span class="o">:</span> <span class="o">⟨</span><span class="n">ts</span><span class="o">,</span> <span class="n">t</span> <span class="o">::</span> <span class="n">is</span><span class="o">⟩</span> <span class="bp">≺</span> <span class="o">⟨</span><span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">,</span> <span class="n">is</span><span class="o">⟩</span> <span class="o">:=</span>
      <span class="k">show</span> <span class="n">Prod.Lex</span> <span class="n">_</span> <span class="n">_</span>
           <span class="o">(</span><span class="n">succ</span> <span class="o">(</span><span class="n">length</span> <span class="n">ts</span> <span class="bp">+</span> <span class="n">length</span> <span class="n">is</span><span class="o">),</span> <span class="n">length</span> <span class="n">ts</span><span class="o">)</span>
           <span class="o">(</span><span class="n">succ</span> <span class="o">(</span><span class="n">length</span> <span class="n">ts</span><span class="o">)</span> <span class="bp">+</span> <span class="n">length</span> <span class="n">is</span><span class="o">,</span> <span class="n">length</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">))</span> <span class="kd">by</span>
        <span class="n">rw</span> <span class="o">[</span><span class="n">Nat.succ_add</span><span class="o">]</span> <span class="bp">&lt;;&gt;</span> <span class="n">exact</span> <span class="n">Prod.Lex.right</span> <span class="n">_</span> <span class="o">(</span><span class="n">lt_succ_self</span> <span class="n">_</span><span class="o">)</span>
    <span class="k">have</span> <span class="n">h2</span> <span class="o">:</span> <span class="o">⟨</span><span class="n">is</span><span class="o">,</span> <span class="o">[]⟩</span> <span class="bp">≺</span> <span class="o">⟨</span><span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">,</span> <span class="n">is</span><span class="o">⟩</span> <span class="o">:=</span> <span class="n">Prod.Lex.left</span> <span class="n">_</span> <span class="n">_</span> <span class="o">(</span><span class="n">Nat.lt_add_of_pos_left</span> <span class="o">(</span><span class="n">succ_pos</span> <span class="n">_</span><span class="o">))</span>
    <span class="n">H1</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">is</span> <span class="o">(</span><span class="n">permutationsAux.rec</span> <span class="n">H0</span> <span class="n">H1</span> <span class="n">ts</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">is</span><span class="o">))</span> <span class="o">(</span><span class="n">permutationsAux.rec</span> <span class="n">H0</span> <span class="n">H1</span> <span class="n">is</span> <span class="o">[])</span>
    <span class="n">termination_by'</span>
      <span class="o">⟨(</span><span class="bp">·</span> <span class="bp">≺</span> <span class="bp">·</span><span class="o">),</span> <span class="bp">@</span><span class="n">InvImage.wf</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="n">meas</span> <span class="o">(</span><span class="n">Prod.instWellFoundedRelationProd</span> <span class="n">lt_wfRel</span> <span class="n">lt_wfRel</span><span class="o">)⟩</span>
</code></pre></div>



<a name="313570688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313570688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313570688">(Dec 02 2022 at 19:11)</a>:</h4>
<p>I think both <span class="user-mention" data-user-id="110038">@Kevin Buzzard</span>  and <span class="user-mention" data-user-id="307953">@Ruben Van de Velde</span> have tried to crack this one...</p>



<a name="313571487"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313571487" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313571487">(Dec 02 2022 at 19:15)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">permutationsAux.rec</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">H0</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">is</span><span class="o">,</span> <span class="n">C</span> <span class="o">[]</span> <span class="n">is</span><span class="o">)</span>
    <span class="o">(</span><span class="n">H1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">is</span><span class="o">,</span> <span class="n">C</span> <span class="n">ts</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">is</span><span class="o">)</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">is</span> <span class="o">[]</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">)</span> <span class="n">is</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">l₁</span> <span class="n">l₂</span><span class="o">,</span> <span class="n">C</span> <span class="n">l₁</span> <span class="n">l₂</span>
  <span class="bp">|</span> <span class="o">[],</span> <span class="n">is</span> <span class="bp">=&gt;</span> <span class="n">H0</span> <span class="n">is</span>
  <span class="bp">|</span> <span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">,</span> <span class="n">is</span> <span class="bp">=&gt;</span>
    <span class="n">H1</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">is</span> <span class="o">(</span><span class="n">permutationsAux.rec</span> <span class="n">H0</span> <span class="n">H1</span> <span class="n">ts</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">is</span><span class="o">))</span> <span class="o">(</span><span class="n">permutationsAux.rec</span> <span class="n">H0</span> <span class="n">H1</span> <span class="n">is</span> <span class="o">[])</span>
<span class="n">termination_by</span> <span class="n">_</span> <span class="n">ts</span> <span class="n">is</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">length</span> <span class="n">ts</span> <span class="bp">+</span> <span class="n">length</span> <span class="n">is</span><span class="o">,</span> <span class="n">length</span> <span class="n">ts</span><span class="o">)</span>
<span class="n">decreasing_by</span> <span class="n">simp_wf</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">Nat.succ_add</span><span class="o">]</span><span class="bp">;</span> <span class="n">decreasing_tactic</span>
</code></pre></div>



<a name="313571645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313571645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313571645">(Dec 02 2022 at 19:16)</a>:</h4>
<p>alternatively:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">attribute</span> <span class="o">[</span><span class="kn">local</span> <span class="n">simp</span><span class="o">]</span> <span class="n">Nat.succ_add</span> <span class="k">in</span>
<span class="sd">/-- A recursor for pairs of lists. To have `C l₁ l₂` for all `l₁`, `l₂`, it suffices to have it for</span>
<span class="sd">`l₂ = []` and to be able to pour the elements of `l₁` into `l₂`. -/</span>
<span class="kd">def</span> <span class="n">permutationsAux.rec</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">H0</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">is</span><span class="o">,</span> <span class="n">C</span> <span class="o">[]</span> <span class="n">is</span><span class="o">)</span>
    <span class="o">(</span><span class="n">H1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">is</span><span class="o">,</span> <span class="n">C</span> <span class="n">ts</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">is</span><span class="o">)</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">is</span> <span class="o">[]</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">)</span> <span class="n">is</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">l₁</span> <span class="n">l₂</span><span class="o">,</span> <span class="n">C</span> <span class="n">l₁</span> <span class="n">l₂</span>
  <span class="bp">|</span> <span class="o">[],</span> <span class="n">is</span> <span class="bp">=&gt;</span> <span class="n">H0</span> <span class="n">is</span>
  <span class="bp">|</span> <span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">,</span> <span class="n">is</span> <span class="bp">=&gt;</span>
    <span class="n">H1</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">is</span> <span class="o">(</span><span class="n">permutationsAux.rec</span> <span class="n">H0</span> <span class="n">H1</span> <span class="n">ts</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">is</span><span class="o">))</span> <span class="o">(</span><span class="n">permutationsAux.rec</span> <span class="n">H0</span> <span class="n">H1</span> <span class="n">is</span> <span class="o">[])</span>
<span class="n">termination_by</span> <span class="n">_</span> <span class="n">ts</span> <span class="n">is</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">length</span> <span class="n">ts</span> <span class="bp">+</span> <span class="n">length</span> <span class="n">is</span><span class="o">,</span> <span class="n">length</span> <span class="n">ts</span><span class="o">)</span>
</code></pre></div>



<a name="313571950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313571950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313571950">(Dec 02 2022 at 19:18)</a>:</h4>
<p>Now it just doesn't like <code>[elab_as_elim]</code></p>



<a name="313571979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313571979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313571979">(Dec 02 2022 at 19:18)</a>:</h4>
<p>note that I removed it</p>



<a name="313572082"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313572082" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313572082">(Dec 02 2022 at 19:18)</a>:</h4>
<p>lean 4 is more picky about elab_as_elim declarations</p>



<a name="313572092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313572092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313572092">(Dec 02 2022 at 19:18)</a>:</h4>
<p>Will add as porting comment</p>



<a name="313572749"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313572749" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313572749">(Dec 02 2022 at 19:22)</a>:</h4>
<p>Where is <code>decreasing_tactic</code> documented? I was so close on this....</p>



<a name="313573661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313573661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313573661">(Dec 02 2022 at 19:28)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=tacticDecreasing_tactic#doc">docs4#tacticDecreasing_tactic</a></p>



<a name="313573974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313573974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313573974">(Dec 02 2022 at 19:30)</a>:</h4>
<p>basically, if you don't provide a <code>decreasing_by</code> clause then it acts like <code>decreasing_by decreasing_tactic</code>, which calls <code>simp</code> and a few other simple things for reducing common WF proof goals</p>



<a name="313574052"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313574052" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313574052">(Dec 02 2022 at 19:31)</a>:</h4>
<p>and if it fails it prints the big error message you can see at <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=tacticDecreasing_with_#src">src4#tacticDecreasing_with_</a></p>



<a name="313585380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313585380" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313585380">(Dec 02 2022 at 20:42)</a>:</h4>
<p>The last issue here is making my eyes cross:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Std.Data.Nat.Lemmas</span>

<span class="kn">open</span> <span class="n">List</span>
<span class="kn">open</span> <span class="n">Nat</span>

<span class="kd">def</span> <span class="n">permutationsAux2</span> <span class="o">(</span><span class="n">t</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">ts</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">(</span><span class="n">r</span> <span class="o">:</span> <span class="n">List</span> <span class="n">β</span><span class="o">)</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="o">(</span><span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">β</span><span class="o">)</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">×</span> <span class="n">List</span> <span class="n">β</span>
  <span class="bp">|</span> <span class="o">[],</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">ts</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">y</span> <span class="o">::</span> <span class="n">ys</span><span class="o">,</span> <span class="n">f</span> <span class="bp">=&gt;</span>
    <span class="k">let</span> <span class="o">(</span><span class="n">us</span><span class="o">,</span> <span class="n">zs</span><span class="o">)</span> <span class="o">:=</span> <span class="n">permutationsAux2</span> <span class="n">t</span> <span class="n">ys</span> <span class="n">r</span> <span class="n">ys</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span><span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">=&gt;</span> <span class="n">f</span> <span class="o">(</span><span class="n">y</span> <span class="o">::</span> <span class="n">x</span><span class="o">))</span>
    <span class="o">(</span><span class="n">y</span> <span class="o">::</span> <span class="n">us</span><span class="o">,</span> <span class="n">f</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">y</span> <span class="o">::</span> <span class="n">us</span><span class="o">)</span> <span class="o">::</span> <span class="n">zs</span><span class="o">)</span>

<span class="sd">/-- A recursor for pairs of lists. To have `C l₁ l₂` for all `l₁`, `l₂`, it suffices to have it for</span>
<span class="sd">`l₂ = []` and to be able to pour the elements of `l₁` into `l₂`. -/</span>
<span class="kd">def</span> <span class="n">permutationsAux.rec</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">v</span><span class="o">}</span> <span class="o">(</span><span class="n">H0</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">is</span><span class="o">,</span> <span class="n">C</span> <span class="o">[]</span> <span class="n">is</span><span class="o">)</span>
    <span class="o">(</span><span class="n">H1</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">is</span><span class="o">,</span> <span class="n">C</span> <span class="n">ts</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">is</span><span class="o">)</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">is</span> <span class="o">[]</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">)</span> <span class="n">is</span><span class="o">)</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">l₁</span> <span class="n">l₂</span><span class="o">,</span> <span class="n">C</span> <span class="n">l₁</span> <span class="n">l₂</span>
  <span class="bp">|</span> <span class="o">[],</span> <span class="n">is</span> <span class="bp">=&gt;</span> <span class="n">H0</span> <span class="n">is</span>
  <span class="bp">|</span> <span class="n">t</span> <span class="o">::</span> <span class="n">ts</span><span class="o">,</span> <span class="n">is</span> <span class="bp">=&gt;</span>
    <span class="n">H1</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">is</span> <span class="o">(</span><span class="n">permutationsAux.rec</span> <span class="n">H0</span> <span class="n">H1</span> <span class="n">ts</span> <span class="o">(</span><span class="n">t</span> <span class="o">::</span> <span class="n">is</span><span class="o">))</span> <span class="o">(</span><span class="n">permutationsAux.rec</span> <span class="n">H0</span> <span class="n">H1</span> <span class="n">is</span> <span class="o">[])</span>
  <span class="n">termination_by</span> <span class="n">_</span> <span class="n">ts</span> <span class="n">is</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">length</span> <span class="n">ts</span> <span class="bp">+</span> <span class="n">length</span> <span class="n">is</span><span class="o">,</span> <span class="n">length</span> <span class="n">ts</span><span class="o">)</span>
  <span class="n">decreasing_by</span> <span class="n">simp_wf</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">Nat.succ_add</span><span class="o">]</span><span class="bp">;</span> <span class="n">decreasing_tactic</span>


<span class="sd">/-- An auxiliary function for defining `permutations`. `permutations_aux ts is` is the set of all</span>
<span class="sd">permutations of `is ++ ts` that do not fix `ts`. -/</span>
<span class="kd">def</span> <span class="n">permutationsAux</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="o">(</span><span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
  <span class="bp">@</span><span class="n">permutationsAux.rec</span> <span class="o">(</span><span class="k">fun</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">List</span> <span class="o">(</span><span class="n">List</span> <span class="n">α</span><span class="o">))</span> <span class="o">(</span><span class="k">fun</span> <span class="n">is</span> <span class="bp">=&gt;</span> <span class="o">[])</span> <span class="k">fun</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">is</span> <span class="n">IH1</span> <span class="n">IH2</span> <span class="bp">=&gt;</span>
    <span class="n">foldr</span> <span class="o">(</span><span class="k">fun</span> <span class="n">y</span> <span class="n">r</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">permutationsAux2</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">r</span> <span class="n">y</span> <span class="n">id</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span> <span class="n">IH1</span> <span class="o">(</span><span class="n">is</span> <span class="o">::</span> <span class="n">IH2</span><span class="o">)</span>
</code></pre></div>
<p>The <code>fun _ _ =&gt; List (List α)</code> bit is a direct translation from <code>mathlib</code>, but fails here with what looks like a universe issue:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">application</span> <span class="n">type</span> <span class="n">mismatch</span>
  <span class="bp">@</span><span class="n">permutationsAux.rec</span> <span class="k">fun</span> <span class="n">x</span> <span class="n">x</span> <span class="bp">↦</span> <span class="n">List</span> <span class="o">(</span><span class="n">List</span> <span class="n">α</span><span class="o">)</span>
<span class="n">argument</span>
  <span class="k">fun</span> <span class="n">x</span> <span class="n">x</span> <span class="bp">↦</span> <span class="n">List</span> <span class="o">(</span><span class="n">List</span> <span class="n">α</span><span class="o">)</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="o">(</span><span class="n">x</span> <span class="o">:</span> <span class="bp">?</span><span class="n">m.45085</span><span class="o">)</span> <span class="bp">→</span> <span class="bp">?</span><span class="n">m.45092</span> <span class="n">x</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="bp">?</span><span class="n">u.45055</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="o">(</span><span class="n">max</span> <span class="o">(</span><span class="n">max</span> <span class="bp">?</span><span class="n">u.45084</span> <span class="bp">?</span><span class="n">u.45087</span><span class="o">)</span> <span class="o">(</span><span class="bp">?</span><span class="n">u.45055</span> <span class="bp">+</span> <span class="mi">2</span><span class="o">))</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="bp">?</span><span class="n">u.45082</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="bp">?</span><span class="n">u.45082</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span>
</code></pre></div>
<p>If I provide more inference hints (<code>(fun (xs: List α) (ys: List α) =&gt; List (List α))</code>), I get a different type issue:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">application</span> <span class="n">type</span> <span class="n">mismatch</span>
  <span class="bp">@</span><span class="n">permutationsAux.rec</span> <span class="k">fun</span> <span class="n">xs</span> <span class="n">ys</span> <span class="bp">↦</span> <span class="n">List</span> <span class="o">(</span><span class="n">List</span> <span class="n">α</span><span class="o">)</span>
<span class="n">argument</span>
  <span class="k">fun</span> <span class="n">xs</span> <span class="n">ys</span> <span class="bp">↦</span> <span class="n">List</span> <span class="o">(</span><span class="n">List</span> <span class="n">α</span><span class="o">)</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Type</span> <span class="bp">?</span><span class="n">u.45055</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="bp">?</span><span class="n">u.45055</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span>
<span class="n">but</span> <span class="n">is</span> <span class="n">expected</span> <span class="n">to</span> <span class="k">have</span> <span class="n">type</span>
  <span class="kt">Type</span> <span class="bp">?</span><span class="n">u.45082</span> <span class="o">:</span> <span class="kt">Type</span> <span class="o">(</span><span class="bp">?</span><span class="n">u.45082</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">)</span>
</code></pre></div>
<p>where we are in the same universe at least.</p>



<a name="313585836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313585836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313585836">(Dec 02 2022 at 20:45)</a>:</h4>
<p>The more that I look at that <code>fun</code> the less I understand what it even wants to do</p>



<a name="313586144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313586144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313586144">(Dec 02 2022 at 20:47)</a>:</h4>
<p>Or how it was supposed to work in Lean 3 -- it looks like I'm taking two lists and producing a type...</p>



<a name="313597157"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313597157" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313597157">(Dec 02 2022 at 22:05)</a>:</h4>
<p>I think there are just earlier arguments that you need to specify if you're using <code>@</code>?</p>



<a name="313598967"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Status%20of%20data.list.defs%3F/near/313598967" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Status.20of.20data.2Elist.2Edefs.3F.html#313598967">(Dec 02 2022 at 22:19)</a>:</h4>
<p>That did it!</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- An auxiliary function for defining `permutations`. `permutations_aux ts is` is the set of all</span>
<span class="sd">permutations of `is ++ ts` that do not fix `ts`. -/</span>
<span class="kd">def</span> <span class="n">permutationsAux</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="n">α</span> <span class="bp">→</span> <span class="n">List</span> <span class="o">(</span><span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="o">:=</span>
  <span class="n">permutationsAux.rec</span> <span class="o">(</span><span class="k">fun</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="o">[])</span> <span class="k">fun</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">is</span> <span class="n">IH1</span> <span class="n">IH2</span> <span class="bp">=&gt;</span>
    <span class="n">foldr</span> <span class="o">(</span><span class="k">fun</span> <span class="n">y</span> <span class="n">r</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">permutationsAux2</span> <span class="n">t</span> <span class="n">ts</span> <span class="n">r</span> <span class="n">y</span> <span class="n">id</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span><span class="o">)</span> <span class="n">IH1</span> <span class="o">(</span><span class="n">is</span> <span class="o">::</span> <span class="n">IH2</span><span class="o">)</span>
<span class="bp">#</span><span class="n">align</span> <span class="n">list.permutations_aux</span> <span class="n">List.permutationsAux</span>
</code></pre></div>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>