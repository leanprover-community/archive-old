---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html">mathport depending on mathlib</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="255109389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255109389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255109389">(Sep 27 2021 at 19:50)</a>:</h4>
<p>Probably many rough edges still, but it seems to be working. The release at <a href="https://github.com/leanprover/mathport/releases/tag/v0.0.0.0">https://github.com/leanprover/mathport/releases/tag/v0.0.0.0</a> now includes "fake" lake packages for <code>Lean3</code> and <code>Mathbin</code>. Note: I changed the name from <code>Mathlib</code> to <code>Mathbin</code> to avoid confusion with the existing mathlib4 package. Unless I left a stray reference to my filesystem somewhere by accident, the following should work:</p>
<ul>
<li>download the release</li>
<li>create a new directory <code>TestMathbin</code> with:</li>
</ul>
<ol>
<li><code>package.lean</code></li>
</ol>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Lake.Package</span>

<span class="kn">open</span> <span class="n">Lake</span> <span class="n">System</span>

<span class="kd">def</span> <span class="n">package</span> <span class="o">:</span> <span class="n">Lake.PackageConfig</span> <span class="o">:=</span> <span class="o">{</span>
  <span class="n">name</span> <span class="o">:=</span> <span class="s2">"TestMathbin"</span>
  <span class="n">version</span> <span class="o">:=</span> <span class="s2">"0.1"</span>
  <span class="n">dependencies</span> <span class="o">:=</span> <span class="o">[</span>
    <span class="o">{</span> <span class="n">name</span> <span class="o">:=</span> <span class="s2">"Mathbin"</span><span class="o">,</span> <span class="n">src</span> <span class="o">:=</span> <span class="n">Lake.Source.path</span> <span class="o">(</span><span class="n">FilePath.mk</span> <span class="s2">"&lt;path-to-Lib4&gt;/Mathbin"</span><span class="o">)</span> <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre></div>
<ol start="2">
<li><code>TestMathbin.lean</code> with (say) something like:</li>
</ol>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathlib</span>
<span class="kn">import</span> <span class="n">Mathbin</span>

<span class="k">#check</span> <span class="n">Semiring</span>
<span class="bp">#</span><span class="n">lookup3</span> <span class="n">semiring</span>
<span class="k">#check</span> <span class="n">Semiring_'</span>

<span class="kd">example</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">n</span> <span class="bp">+</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">2</span> <span class="bp">*</span> <span class="n">n</span> <span class="o">:=</span> <span class="kd">by</span> <span class="n">ring</span>
</code></pre></div>
<ol start="3">
<li><code>lean-toolchain</code> with <code>leanprover/lean4:nightly-2021-09-24</code></li>
</ol>
<ul>
<li><code>lake build</code> should successfully run and print out a few things</li>
<li>It should also show the LEAN_PATH it used, which can then be used to have the right emacs/vscode setup. For now, I suggest putting <code>export MATHBIN_PATH=&lt;that path&gt;</code> into <code>~/.bashrc</code> and then e.g. <code>LEAN_PATH=$MATHBIN_PATH emacs . &amp;</code></li>
</ul>
<p>The main <em>known</em> rough edge is that we aren't getting errors when Mathport declares new syntax that shadows syntax in Mathlib4. So, some tactics might work when importing <code>Mathlib</code> alone but fail when <code>Mathbin</code> is imported as well. The solution is just to manually remove the syntax declaration from Mathport (e.g. from <a href="https://github.com/leanprover/mathport/blob/master/Mathport/Prelude/Syntax.lean#L144">https://github.com/leanprover/mathport/blob/master/Mathport/Prelude/Syntax.lean#L144</a>).</p>
<p>One other rough edge: due to new name clashes introduced by a weird idiosyncracy of the import graph, I could no longer just add <code>'</code> at the end of a name to avoid clashes. So, for now I add the more cumbersome <code>_'</code> as in <code>Semiring_'</code> above.</p>



<a name="255109800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255109800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255109800">(Sep 27 2021 at 19:53)</a>:</h4>
<p>Oh and there are many rough edges arises from the old-vs-new structure clashes. For example, there is no instance yet for <code>Semiring_'</code> implying <code>Semiring</code>.</p>



<a name="255113772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255113772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255113772">(Sep 27 2021 at 20:21)</a>:</h4>
<p>(in the process of fixing a few other loose ends...)</p>



<a name="255116752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255116752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255116752">(Sep 27 2021 at 20:43)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> You may want to mention which revision of Lake you are using. Especially since you are neither using the latest stable release (i.e. <code>v2.1.0</code>) nor <code>master</code>.</p>



<a name="255117177"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255117177" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255117177">(Sep 27 2021 at 20:46)</a>:</h4>
<p>Thanks. I see, I hadn't noticed how active lake development has been recently. I am currently using the arbitrary 67470479deaf9f3abe6777c1fb973d7cdbd94182. I will upgrade to v2.1.0 soon (would need to re-run the pipeline to test it).</p>



<a name="255117513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255117513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255117513">(Sep 27 2021 at 20:48)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> you are actually using a commit <strong><em>after</em></strong> v2.1.0 (glob support came afterwards), so the only option for upgrading currently is <code>master</code>.</p>



<a name="255150943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255150943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255150943">(Sep 28 2021 at 02:19)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> what is that idiosyncrasy of the import graph? Can we just fix it in mathlib?</p>



<a name="255151477"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151477" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151477">(Sep 28 2021 at 02:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255150943">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> what is that idiosyncrasy of the import graph? Can we just fix it in mathlib?</p>
</blockquote>
<p>If I recall, the issue I hit was related to <code>mul_right_cancel</code>, but there might be more that will only be exposed after fixing that one. I can re-run without the <code>_'</code> change but my guess from grepping is that one of these doesn't import an upstream one:</p>
<p>src/algebra/group/defs.lean:164:lemma mul_right_cancel<br>
src/algebra/group_with_zero/defs.lean:88:lemma mul_right_cancel' <br>
src/algebra/ordered_monoid_lemmas.lean:373:lemma mul_right_cancel''</p>
<p>We can also fix the issue by having a special case in <code>mathport</code> that only uses <code>_'</code> for names in a list.</p>



<a name="255151587"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151587" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151587">(Sep 28 2021 at 02:29)</a>:</h4>
<p>Are you assuming that adding a <code>'</code> will make it not collide? Mathlib uses names involving <code>'</code>, so you should instead recursively add <code>'</code> until it is not colliding</p>



<a name="255151712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151712">(Sep 28 2021 at 02:31)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255151587">said</a>:</p>
<blockquote>
<p>Are you assuming that adding a <code>'</code> will make it not collide? Mathlib uses names involving <code>'</code>, so you should instead recursively add <code>'</code> until it is not colliding</p>
</blockquote>
<p>I was recursively adding <code>'</code>. The problem is that <code>foo</code> might translate to <code>Foo'</code>, but a <code>foo'</code> in mathlib that doesn't import the original <code>foo</code> might translate to <code>Foo'</code> as well. Basically, the recursive <code>'</code>-adding is only relative to the current environment when the declaration is being processed.</p>



<a name="255151805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151805">(Sep 28 2021 at 02:32)</a>:</h4>
<p>can we give a local name override?</p>



<a name="255151835"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151835" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151835">(Sep 28 2021 at 02:32)</a>:</h4>
<p>Alternatively, can we lint for this in mathlib? Make sure that wherever <code>foo'</code> is declared, <code>foo</code> is already in the environment?</p>



<a name="255151874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151874">(Sep 28 2021 at 02:33)</a>:</h4>
<p>I don't think we should demand that in mathlib, but it would be good to collect the list of violators anyway so that mathport can special case them</p>



<a name="255151885"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151885" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151885">(Sep 28 2021 at 02:33)</a>:</h4>
<p>It's not like it hurts us overall to do some cleaning up of the <code>foo'</code> messes we have in mathlib. :-)</p>



<a name="255151951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151951">(Sep 28 2021 at 02:34)</a>:</h4>
<p>This example seems like a pretty good argument for why that might occur: group and group_with_zero don't directly need each other, but they need to be importable together so one of the names dodges the other</p>



<a name="255151953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151953">(Sep 28 2021 at 02:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255151835">said</a>:</p>
<blockquote>
<p>Alternatively, can we lint for this in mathlib? Make sure that wherever <code>foo'</code> is declared, <code>foo</code> is already in the environment?</p>
</blockquote>
<p>It might not work if mathlib3 and mathlib4 differ in relevant ways. Recall that I did not hit this issue until mathport started depending on mathlib4. If there is interest I can re-run without <code>_'</code> and figure out exactly what is going wrong.</p>



<a name="255151981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151981">(Sep 28 2021 at 02:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255151805">said</a>:</p>
<blockquote>
<p>can we give a local name override?</p>
</blockquote>
<p>Do you mean in mathport? Yes, there is a map in the configuration file for forced renames.</p>



<a name="255151997"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255151997" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255151997">(Sep 28 2021 at 02:35)</a>:</h4>
<p>How did mathlib4 affect this issue? Why didn't you hit this already in mathlib?</p>



<a name="255152083"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152083" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152083">(Sep 28 2021 at 02:36)</a>:</h4>
<p>Ah, because mathlib3's <code>mul_right_cancel</code> probably clashes with the mathlib4 one, and so became a <code>mul_right_cancel'</code>, causing a cascade.</p>



<a name="255152111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152111">(Sep 28 2021 at 02:36)</a>:</h4>
<p>I am guessing that before, there were no clashes, and so each of the declarations kept their original names.</p>



<a name="255152124"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152124" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152124">(Sep 28 2021 at 02:37)</a>:</h4>
<p>that sounds like an issue with missing alignments</p>



<a name="255152147"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152147" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152147">(Sep 28 2021 at 02:37)</a>:</h4>
<p>presumably we want mathlib3's <code>mul_right_cancel</code> to become mathlib4's <code>mul_right_cancel</code></p>



<a name="255152233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152233">(Sep 28 2021 at 02:38)</a>:</h4>
<p>aren't the underlying classes implemented differently? we haven't tackled the non-defeq-alignment yet at all.</p>



<a name="255152245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152245">(Sep 28 2021 at 02:38)</a>:</h4>
<p>Even if they are, we want them to align</p>



<a name="255152267"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152267" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152267">(Sep 28 2021 at 02:39)</a>:</h4>
<p>we could backport if needed</p>



<a name="255152359"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152359" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152359">(Sep 28 2021 at 02:40)</a>:</h4>
<p>how well can we handle just failing when the non-defeq causes problems, without breaking the build?</p>



<a name="255152613"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152613" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152613">(Sep 28 2021 at 02:43)</a>:</h4>
<p>the build is pretty robust, but everything downstream of a failed decl will fail as well. I could handle theorems differently, so if the decl fails it falls back on trying it as an axiom before giving up.</p>



<a name="255152686"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152686" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152686">(Sep 28 2021 at 02:44)</a>:</h4>
<p>is it possible to use strategic <code>sorry</code> to recover from failed subterms?</p>



<a name="255152765"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152765" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152765">(Sep 28 2021 at 02:46)</a>:</h4>
<p>One possibility is to record that you know a certain alignment is non-defeq, and then whenever that alignment is used you just use <code>sorry</code> instead of creating a known bad term</p>



<a name="255152825"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152825" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152825">(Sep 28 2021 at 02:46)</a>:</h4>
<blockquote>
<p>is it possible to use strategic sorry to recover from failed subterms?</p>
</blockquote>
<p>It would not be straightforward in the current design, since I am only getting a kernel error (<a href="https://github.com/leanprover/mathport/blob/master/Mathport/Binary/Apply.lean#L47">https://github.com/leanprover/mathport/blob/master/Mathport/Binary/Apply.lean#L47</a>) which doesn't return any kind of position information.</p>



<a name="255152850"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152850" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152850">(Sep 28 2021 at 02:46)</a>:</h4>
<p>so the alignment would only be used in e.g. synport</p>



<a name="255152942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255152942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255152942">(Sep 28 2021 at 02:47)</a>:</h4>
<p>Or I suppose you could try to use the alignment at first, and if it fails then fall back to the <code>sorry</code> approach</p>



<a name="255153255"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153255" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153255">(Sep 28 2021 at 02:51)</a>:</h4>
<p>I don't know what the best path is. Nailing non-def-eq alignment will probably be a lot of work (at best), and may not be that relevant if the port goes bottom-up anyway. If we go bottom-up, synport matters much more than binport. We could even refactor so synport only imports mathlib4 oleans instead of binport oleans.</p>



<a name="255153421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153421">(Sep 28 2021 at 02:54)</a>:</h4>
<p>There's also the argument that having <code>mul_right_cancel</code> and <code>mul_right_cancel'</code> in the first place is confusing as anything. It requires the humans to maintain an internal lookup table of "number of primes" to "mathematical context". I'd be much happier personally with either <code>mul_right_cancel_with_zero</code> or <code>group_with_zero.mul_right_cancel</code>.</p>



<a name="255153543"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153543" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153543">(Sep 28 2021 at 02:55)</a>:</h4>
<p>I'm sympathetic to this but it seems to penalize use of <code>group_with_zero.mul_right_cancel</code> far too much</p>



<a name="255153565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153565">(Sep 28 2021 at 02:55)</a>:</h4>
<p>So I'd just advocate making whatever changes to mathlib make life easiest for binport+synport.</p>



<a name="255153576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153576">(Sep 28 2021 at 02:55)</a>:</h4>
<p>what about <code>mul_right_cancel\0</code>?</p>



<a name="255153580"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153580" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153580">(Sep 28 2021 at 02:55)</a>:</h4>
<p>Great!</p>



<a name="255153628"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153628" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153628">(Sep 28 2021 at 02:56)</a>:</h4>
<p>I'm sympathetic to this but it seems to penalize use of <code>group_with_zero.mul_right_cancel</code> far too much</p>



<a name="255153631"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153631" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153631">(Sep 28 2021 at 02:56)</a>:</h4>
<p>what about <code>mul_right_cancelâ‚€</code>?</p>



<a name="255153633"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153633" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153633">(Sep 28 2021 at 02:56)</a>:</h4>
<p>I think if the two of you say "this will make life easier for us", that can trump anything else.</p>



<a name="255153747"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153747" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153747">(Sep 28 2021 at 02:58)</a>:</h4>
<p>We could also refactor/extend synport so that every proof is replaced by <code>sorry /- proof in comments -/</code>. Then the port could be two passes:</p>
<ol>
<li>[bottom-up] get the synported files to elaborate in bottom-up order, which will require diagnosing a bunch of not-yet-exhausted elaborator mismatch issues</li>
<li>[parallel] removing the sorries in parallel</li>
</ol>



<a name="255153773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153773">(Sep 28 2021 at 02:58)</a>:</h4>
<p>We are working on automation to help with (2), but (1) is essentially unblocked already.</p>



<a name="255153943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153943">(Sep 28 2021 at 03:00)</a>:</h4>
<p>One way to achieve (1) is to declare a <code>def'</code> command that ignores its proof argument</p>



<a name="255153985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255153985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255153985">(Sep 28 2021 at 03:01)</a>:</h4>
<p>Nice. <code>theorem_ax</code>?</p>



<a name="255154018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154018">(Sep 28 2021 at 03:01)</a>:</h4>
<p>or even does something more interesting, for example: try to elaborate <code>type := proof</code>, fall back on <code>type := sorry</code>, then on <code>sorry := sorry</code></p>



<a name="255154081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154081">(Sep 28 2021 at 03:02)</a>:</h4>
<p>and use info/warn to indicate how successful it was</p>



<a name="255154148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154148">(Sep 28 2021 at 03:03)</a>:</h4>
<p>I like the idea that it does its best, but I think it would be disastrous not to have the invariant that all non-proofs were correct. How about only for theorems, and only trying the <code>type := sorry</code> fallback?</p>



<a name="255154169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154169">(Sep 28 2021 at 03:03)</a>:</h4>
<p>(and warning if it needed to falllback on sorry, as you suggested)</p>



<a name="255154225"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154225" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154225">(Sep 28 2021 at 03:04)</a>:</h4>
<p>If the type uses tactics or something that doesn't exist we're screwed anyway</p>



<a name="255154237"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154237" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154237">(Sep 28 2021 at 03:04)</a>:</h4>
<p>the point here is to keep going no matter what</p>



<a name="255154257"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154257" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154257">(Sep 28 2021 at 03:04)</a>:</h4>
<p>I was suggesting that (1) be a manual process of touching up the synported files in bottom-up order until they elaborate modulo sorried-proofs.</p>



<a name="255154294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154294">(Sep 28 2021 at 03:05)</a>:</h4>
<p>So, when hitting a type with a NYI tactic, somebody would write the tactic at that point before moving on.</p>



<a name="255154364"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154364" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154364">(Sep 28 2021 at 03:06)</a>:</h4>
<p>and individual failures might not be a big problem, depending on how much they are used downstream</p>



<a name="255154393"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154393" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154393">(Sep 28 2021 at 03:06)</a>:</h4>
<p>obviously it's something we would prefer not to deal with but a full stop somewhere in the middle seems like the worst possible response to an error</p>



<a name="255154403"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154403" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154403">(Sep 28 2021 at 03:07)</a>:</h4>
<p>Maybe, but I think it would be a disaster if somebody is trying to do (1) on a file, and struggling for 30m before realizing that the problem is due to some sorry in a definition in a file they have never heard of.</p>



<a name="255154435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154435">(Sep 28 2021 at 03:07)</a>:</h4>
<p>How many tactics are used in types/defs? We could also just implement those before we start (1).</p>



<a name="255154438"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154438" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154438">(Sep 28 2021 at 03:07)</a>:</h4>
<p>maybe we can highlight uses of a definition that we know to be broken?</p>



<a name="255154527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154527">(Sep 28 2021 at 03:09)</a>:</h4>
<p>we probably won't have to do anything special anyway, if the <code>theorem_ax</code> command reports the errors it encounters during elaboration</p>



<a name="255154573"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154573" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154573">(Sep 28 2021 at 03:09)</a>:</h4>
<p>I am still a little skeptical that we couldn't just implement most/all the necessary tactics for types/defs ahead of time.</p>



<a name="255154579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154579">(Sep 28 2021 at 03:10)</a>:</h4>
<p>if you mouse over a definition and it says the type is <code>sorry</code> that should be a pretty strong indicator that something is wrong upstream</p>



<a name="255154671"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154671" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154671">(Sep 28 2021 at 03:11)</a>:</h4>
<blockquote>
<p>I am still a little skeptical that we couldn't just implement most/all the necessary tactics for types/defs ahead of time.</p>
</blockquote>
<p>I think we can and should, but the best way to find and prioritize those tactics is to have a source file that indicates what needs to be done</p>



<a name="255154675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154675">(Sep 28 2021 at 03:11)</a>:</h4>
<p>There are going to be lots of genuine errors that have nothing to do with upstream sorries, e.g. due to failure to synthesize or timeouts in isDefEq. It might take some work to notice that a synthesis call failed because some sorry emerged deep in the trace.</p>



<a name="255154887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154887">(Sep 28 2021 at 03:14)</a>:</h4>
<p>I agree that this situation is not great, but it's probably the best we can do after an upstream failure. The situation where those files are just completely broken and you can't even look at them is worse</p>



<a name="255154912"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154912" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154912">(Sep 28 2021 at 03:15)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255154671">said</a>:</p>
<blockquote>
<blockquote>
<p>I am still a little skeptical that we couldn't just implement most/all the necessary tactics for types/defs ahead of time.</p>
</blockquote>
<p>I think we can and should, but the best way to find and prioritize those tactics is to have a source file that indicates what needs to be done</p>
</blockquote>
<p>I will defer to you two on how best to find/prioritize these. I assumed (perhaps incorrectly) that there was a short, known list of tactics used in defs/types, or if not known, at least findable on the lean3 side.</p>



<a name="255154935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255154935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255154935">(Sep 28 2021 at 03:15)</a>:</h4>
<p>it should be possible to instrument synport to gather this data</p>



<a name="255155131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255155131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255155131">(Sep 28 2021 at 03:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255154887">said</a>:</p>
<blockquote>
<p>I agree that this situation is not great, but it's probably the best we can do after an upstream failure. The situation where those files are just completely broken and you can't even look at them is worse</p>
</blockquote>
<p>I am fine with having some people plow past sorries in defs/types and keep porting bottom-up, as long as they are adequately informed of the risk that subtle problems might turn out to be caused by upstream sorries.</p>



<a name="255172527"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255172527" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255172527">(Sep 28 2021 at 07:18)</a>:</h4>
<p>Hopefully <a href="https://github.com/leanprover-community/mathlib/issues/9424">#9424</a> will help a bit.</p>



<a name="255172743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255172743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255172743">(Sep 28 2021 at 07:20)</a>:</h4>
<p>Thanks!</p>



<a name="255172761"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255172761" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255172761">(Sep 28 2021 at 07:20)</a>:</h4>
<p>Let's wait for CI, and then merge it.</p>



<a name="255351772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255351772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255351772">(Sep 29 2021 at 07:01)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> would you mind documenting somewhere how to run the pipeline? I'd like to get up to speed on this!</p>
<p>I got as far as building <code>lake</code> from source, and cloning <code>https://github.com/leanprover/mathport</code>, but I'm not too sure what to do next. None of the <code>make</code> targets seem to work. I tried running <code>lake build</code> / <code>lake build-lib</code> / <code>lake build-bin</code> in various of the subdirectories that have <code>lakefile.lean</code> files, but without further success.</p>



<a name="255356969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255356969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255356969">(Sep 29 2021 at 07:53)</a>:</h4>
<p>last I checked, <code>lake build-bin</code> in the root directory should work</p>



<a name="255357523"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255357523" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255357523">(Sep 29 2021 at 07:59)</a>:</h4>
<p>nevermind, I can't build master</p>



<a name="255357657"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255357657" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255357657">(Sep 29 2021 at 08:00)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span> I get the following on mathport master / lake master:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">lake</span> <span class="n">build</span><span class="bp">-</span><span class="n">bin</span>
<span class="bp">./</span><span class="n">lakefile.lean</span><span class="o">:</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">could</span> <span class="n">not</span> <span class="n">find</span> <span class="n">native</span> <span class="n">implementation</span> <span class="n">of</span> <span class="n">external</span> <span class="n">declaration</span> <span class="bp">'</span><span class="n">UInt64.ofNatCore'</span> <span class="o">(</span><span class="n">symbols</span> <span class="bp">'</span><span class="n">l_UInt64_ofNatCore___boxed'</span> <span class="n">or</span> <span class="bp">'</span><span class="n">l_UInt64_ofNatCore'</span><span class="o">)</span>
<span class="bp">./</span><span class="n">lakefile.lean</span><span class="o">:</span><span class="mi">3</span><span class="o">:</span><span class="mi">0</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">unknown</span> <span class="kn">namespace</span> <span class="bp">'</span><span class="n">Lake'</span>
<span class="bp">./</span><span class="n">lakefile.lean</span><span class="o">:</span><span class="mi">11</span><span class="o">:</span><span class="mi">4</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">expected</span> <span class="sc">'â†’'</span><span class="o">,</span> <span class="bp">'-&gt;'</span>
<span class="n">error</span><span class="o">:</span> <span class="n">package</span> <span class="n">configuration</span> <span class="o">(</span><span class="n">at</span> <span class="bp">./</span><span class="n">lakefile.lean</span><span class="o">)</span> <span class="n">has</span> <span class="n">errors</span>
</code></pre></div>



<a name="255358560"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255358560" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255358560">(Sep 29 2021 at 08:09)</a>:</h4>
<p>Sorry, should have been clearer. <code>lake build-bin</code> in the root directory does indeed work for me (to build mathport), but I then don't know how to actually run <code>mathport</code> to process mathlib3.</p>



<a name="255358773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255358773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255358773">(Sep 29 2021 at 08:11)</a>:</h4>
<p>(In particular, I don't get the error that you just reported, <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>.)</p>



<a name="255358946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255358946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255358946">(Sep 29 2021 at 08:12)</a>:</h4>
<p>I believe the invocation is something like <code>LEAN_PATH=Lib4 build/bin/Mathport config.json Mathlib::all</code></p>



<a name="255359694"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255359694" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255359694">(Sep 29 2021 at 08:19)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">$</span> <span class="n">LEAN_PATH</span><span class="bp">=</span><span class="n">Lib4</span> <span class="n">build</span><span class="bp">/</span><span class="n">bin</span><span class="bp">/</span><span class="n">Mathport</span> <span class="n">config.json</span> <span class="n">Mathlib</span><span class="o">::</span><span class="n">all</span>
<span class="o">[</span><span class="n">paths</span><span class="o">]</span> <span class="o">[{</span> <span class="n">package</span> <span class="o">:=</span> <span class="s2">"Mathlib"</span><span class="o">,</span> <span class="n">mod3</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">all</span> <span class="o">}]</span>
<span class="o">[</span><span class="n">visit</span><span class="o">]</span> <span class="o">{</span> <span class="n">package</span> <span class="o">:=</span> <span class="s2">"Mathlib"</span><span class="o">,</span> <span class="n">mod3</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">all</span> <span class="o">}</span>
<span class="n">PANIC</span> <span class="n">at</span> <span class="n">Std.HashMap.find</span><span class="bp">!</span> <span class="n">Std.Data.HashMap</span><span class="o">:</span><span class="mi">177</span><span class="o">:</span><span class="mi">14</span><span class="o">:</span> <span class="n">key</span> <span class="n">is</span> <span class="n">not</span> <span class="k">in</span> <span class="n">the</span> <span class="n">map</span>
<span class="n">uncaught</span> <span class="n">exception</span><span class="o">:</span> <span class="n">no</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span> <span class="o">(</span><span class="n">error</span> <span class="n">code</span><span class="o">:</span> <span class="mi">2</span><span class="o">)</span>
  <span class="n">file</span><span class="o">:</span> <span class="bp">/</span><span class="n">all.tlean</span>
</code></pre></div>



<a name="255359891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255359891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255359891">(Sep 29 2021 at 08:21)</a>:</h4>
<p>You need to get the tleans from the mathport release or build them from mathlib</p>



<a name="255359985"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255359985" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255359985">(Sep 29 2021 at 08:22)</a>:</h4>
<p>How do I build them?</p>



<a name="255360009"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255360009" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255360009">(Sep 29 2021 at 08:22)</a>:</h4>
<p>I think it's something like <code>lean --make --tlean</code></p>



<a name="255360102"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255360102" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255360102">(Sep 29 2021 at 08:23)</a>:</h4>
<p>from the makefile:</p>
<div class="codehilite" data-code-language="Makefile"><pre><span></span><code>    <span class="nv">LEAN_PATH</span><span class="o">=</span><span class="k">$(</span>LEAN3_LIB<span class="k">)</span>:<span class="k">$(</span>MATHLIB3_SRC<span class="k">)</span>  <span class="k">$(</span>LEAN3_BIN<span class="k">)</span>/lean --make --recursive --ast   <span class="k">$(</span>MATHLIB3_SRC<span class="k">)</span>
    <span class="nv">LEAN_PATH</span><span class="o">=</span><span class="k">$(</span>LEAN3_LIB<span class="k">)</span>:<span class="k">$(</span>MATHLIB3_SRC<span class="k">)</span>  <span class="k">$(</span>LEAN3_BIN<span class="k">)</span>/lean --make --recursive --tlean <span class="k">$(</span>MATHLIB3_SRC<span class="k">)</span>
    cp -r <span class="k">$(</span>MATHLIB3_SRC<span class="k">)</span> PreData/Mathlib3
</code></pre></div>



<a name="255360412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255360412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255360412">(Sep 29 2021 at 08:25)</a>:</h4>
<p>oh, I see, the makefile isn't meant to work unless you set <code>LEAN3_BIN</code> manually?</p>



<a name="255360494"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255360494" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255360494">(Sep 29 2021 at 08:26)</a>:</h4>
<p>You don't have to copy mathlib into <code>PreData/Mathlib3</code> if you modify the <code>config.json</code> file to point at the directory containing <code>.ast.json</code> and <code>.tlean</code> files for mathlib</p>



<a name="255360552"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255360552" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255360552">(Sep 29 2021 at 08:27)</a>:</h4>
<p>I guess, I don't use the makefile myself since I think Daniel's setup is too specific</p>



<a name="255360597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255360597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255360597">(Sep 29 2021 at 08:27)</a>:</h4>
<p>I'm just following it as the only source for knowing how mathport is meant to be used. :-)</p>



<a name="255360839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255360839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255360839">(Sep 29 2021 at 08:29)</a>:</h4>
<p>it looks like <code>LEAN3_BIN</code>, <code>LEAN3_PKG</code> and <code>MATHLIB3_SRC</code> at least need to be set externally</p>



<a name="255360873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255360873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255360873">(Sep 29 2021 at 08:29)</a>:</h4>
<p>I would just set them in the makefile</p>



<a name="255361355"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255361355" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255361355">(Sep 29 2021 at 08:32)</a>:</h4>
<p>It seems strange to even set LEAN3_BIN. Better would just be to change into the right directory and call <code>lean</code>, and let <code>elan</code> pick up the relevant version?</p>



<a name="255361417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255361417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255361417">(Sep 29 2021 at 08:33)</a>:</h4>
<p>I think daniel has this all set up to call master versions of everything</p>



<a name="255361451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255361451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255361451">(Sep 29 2021 at 08:33)</a>:</h4>
<p>Is <code>MATHLIB3_SRC</code> intended to be an external copy of mathlib? There's no part of the build script that takes care of pulling mathlib3?</p>



<a name="255361569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255361569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255361569">(Sep 29 2021 at 08:34)</a>:</h4>
<p>yes, it's mathlib master</p>



<a name="255361773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255361773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255361773">(Sep 29 2021 at 08:36)</a>:</h4>
<p>nothing pulls mathlib3 because it's tied to his local copy</p>



<a name="255361922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255361922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255361922">(Sep 29 2021 at 08:37)</a>:</h4>
<p>I think this setup is a bad idea because it's bad for reproducibility, but it's changed a lot recently and I can't quite keep track where it is at</p>



<a name="255362158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255362158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255362158">(Sep 29 2021 at 08:39)</a>:</h4>
<p>Ok. Maybe timezones will mesh and I'll be online at the same time as Daniel. :-)</p>



<a name="255362370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255362370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255362370">(Sep 29 2021 at 08:40)</a>:</h4>
<p>It would be great if I could clone <code>mathport</code>, read the README, and then run one command to go do a complete run of mathport on the current mathlib3. I was hoping I could update the README file myself to explain this, but it looks like it will take a bit more time.</p>



<a name="255362565"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255362565" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255362565">(Sep 29 2021 at 08:42)</a>:</h4>
<p>The mathlib steps should work as long as you have any lean/mathlib install</p>



<a name="255362649"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255362649" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255362649">(Sep 29 2021 at 08:42)</a>:</h4>
<p>that is <code>lean --make --recursive --ast </code> from the <code>src</code> folder in mathlib</p>



<a name="255362766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255362766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255362766">(Sep 29 2021 at 08:43)</a>:</h4>
<p>You might be able to run ast and tlean at the same time, which should be a lot faster</p>



<a name="255362854"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255362854" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255362854">(Sep 29 2021 at 08:44)</a>:</h4>
<p><code>lean --make --recursive --ast --tlean</code></p>



<a name="255362861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255362861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255362861">(Sep 29 2021 at 08:44)</a>:</h4>
<p>Ok. I'll try that later, then see if I can get it working all inside mathport.</p>



<a name="255396001"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255396001" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255396001">(Sep 29 2021 at 13:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255351772">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> would you mind documenting somewhere how to run the pipeline? I'd like to get up to speed on this!</p>
</blockquote>
<p>Yes, and sorry for the headaches you already suffered trying to run it. I had a Dockerfile to do exactly this not so long ago (<a href="https://github.com/leanprover/mathport/blob/bfef2071f38728e00a9016e1c547146278469365/docker/Dockerfile">https://github.com/leanprover/mathport/blob/bfef2071f38728e00a9016e1c547146278469365/docker/Dockerfile</a>) but it went slightly stale so I removed it temporarily. I will revive it this morning.</p>



<a name="255399822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255399822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255399822">(Sep 29 2021 at 13:36)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I haven't re-run the pipeline in a while, and sadly there is some staleness currently in the Makefile. I will re-run and fix right now.</p>



<a name="255438863"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255438863" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255438863">(Sep 29 2021 at 17:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255357657">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> I get the following on mathport master / lake master:</p>
</blockquote>
<p>Are you still having trouble? If so, it seems like the issue is that your Lean and Lake versions are probably not aligned with one another. You can verify if this is the case by running <code>lake self-check</code>. If it returns nothing everything is order, if it errors out, then you have problem with version alignment.</p>



<a name="255447902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255447902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255447902">(Sep 29 2021 at 18:18)</a>:</h4>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255399822">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> I haven't re-run the pipeline in a while, and sadly there is some staleness currently in the Makefile. I will re-run and fix right now.</p>
</blockquote>
<p>I fixed a bunch of little issues, pushed, re-ran, and posted the lean3 export data, the lean4 output packages, and the logs to <a href="https://github.com/leanprover/mathport/releases/tag/v0.0.0.0">https://github.com/leanprover/mathport/releases/tag/v0.0.0.0</a></p>
<p>For now, in the absence of CI, I would recommend against trying to re-run this yourself and instead just using the releases (and bugging me to re-run whenever there is an important change in one of the many repositories involved).</p>



<a name="255465689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255465689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255465689">(Sep 29 2021 at 20:07)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span> You may wish to update the commit the <code>v0.0.0.0</code> tag points to as it currently references one from July 27 which I am sure is not using what is described in the release. <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>



<a name="255466095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255466095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255466095">(Sep 29 2021 at 20:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255465689">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> You may wish to update the commit the <code>v0.0.0.0</code> tag points to as it currently references one from July 27 which I am sure is not using what is described in the release. <span aria-label="wink" class="emoji emoji-1f609" role="img" title="wink">:wink:</span></p>
</blockquote>
<p>Thanks. I have found it (albeit only slightly) convenient to continue updating the same release, so for now I just added the mathport commit to the release description (<a href="https://github.com/leanprover/mathport/releases/tag/v0.0.0.0">https://github.com/leanprover/mathport/releases/tag/v0.0.0.0</a>).</p>



<a name="255502173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502173">(Sep 30 2021 at 01:19)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span>, the new release doesn't seem to include any olean files in the <code>.tar.gz</code>.</p>



<a name="255502326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502326">(Sep 30 2021 at 01:21)</a>:</h4>
<p>Do you mean Lean4 oleans or Lean3 oleans? I know they don't contain Lean3 oleans (do you need them?) but I thought they contained the mathported Lean4 oleans.</p>



<a name="255502405"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502405" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502405">(Sep 30 2021 at 01:22)</a>:</h4>
<p>No oleans at all.</p>



<a name="255502447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502447">(Sep 30 2021 at 01:23)</a>:</h4>
<p>Sorry, something is wrong.</p>



<a name="255502548"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502548" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502548">(Sep 30 2021 at 01:24)</a>:</h4>
<p>It's just VSCode hiding them from me, sorry. :-(</p>



<a name="255502579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502579">(Sep 30 2021 at 01:25)</a>:</h4>
<p>I am having another problem, however, that perhaps is real: when I run <code>lake build</code>, I get lots of errors of the form:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">write</span> <span class="bp">'./</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">Mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">Mathlib</span><span class="bp">/</span><span class="n">Tactic</span><span class="bp">/</span><span class="n">NormNum.olean'</span><span class="o">:</span> <span class="mi">2</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span>
</code></pre></div>



<a name="255502582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502582">(Sep 30 2021 at 01:25)</a>:</h4>
<p>They are there, but perhaps a little hidden (inside a directory that is usually git-ignored)</p>



<a name="255502600"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502600" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502600">(Sep 30 2021 at 01:25)</a>:</h4>
<p>This is perhaps a case sensitivity issue.</p>



<a name="255502625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502625">(Sep 30 2021 at 01:25)</a>:</h4>
<p>I have <code>./Lib4/mathbin/</code>, not <code>./Lib4/Mathbin/</code>.</p>



<a name="255502721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502721">(Sep 30 2021 at 01:27)</a>:</h4>
<p>Where are you running <code>lake build</code>? Give me a minute, I will post a <code>.tar.gz</code> of my "TestImport" lake project.</p>



<a name="255502741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502741">(Sep 30 2021 at 01:27)</a>:</h4>
<p>Ah, great, I was just preparing a git repo with the same purpose. :-)</p>



<a name="255502815"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502815" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502815">(Sep 30 2021 at 01:28)</a>:</h4>
<p>In fact, the case sensitivity issues appear to cut both ways: instead of</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">./</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">Mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span>
</code></pre></div>
<p>I have</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">./</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">Mathlib</span><span class="bp">/</span>
       <span class="bp">^</span>                                                             <span class="bp">^</span>
</code></pre></div>



<a name="255502921"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255502921" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255502921">(Sep 30 2021 at 01:30)</a>:</h4>
<p>I'm running <code>lake build</code> in a directory that contains <code>Lib4</code>, <code>PreData</code>, and <code>Logs</code>, which were creating by unpacking your release file.</p>



<a name="255503028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255503028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255503028">(Sep 30 2021 at 01:31)</a>:</h4>
<p>Here: <a href="/user_uploads/3121/H5xkr1l0SJq2gcU9V5Y7bB4C/TestImportMathbin.tar.gz">TestImportMathbin.tar.gz</a>. You should only need to change the path to liquidbin in the lakefile, and then <code>lake build</code> should work and print out something about semirings.  If this doesn't work, can you please double-check your lake version against the one in the release description, and also please try downloading the release again (just in case you downloaded in a small window earlier today with a different tar file sitting in the same release)?</p>



<a name="255503129"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255503129" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255503129">(Sep 30 2021 at 01:33)</a>:</h4>
<p>(I only changed all the package names to be lowercase earlier today, so it is probably just some thing in the pipeline that is a tiny bit stale)</p>



<a name="255503387"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255503387" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255503387">(Sep 30 2021 at 01:36)</a>:</h4>
<p>Oh also, I am not sure how smart <code>lake</code> is currently regarding stale package dependencies. You might also try removing all <code>lean_packages</code> directories in all the relevant folders.</p>



<a name="255505975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255505975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255505975">(Sep 30 2021 at 02:11)</a>:</h4>
<p>Okay, after rebuilding <code>lake</code> at <code>edda065c2fca1495709f9f6c0ad493524b25c574</code>, discarding everything and starting over, running <code>lake build</code> from a directory containing <code>Lib4</code> and the contents of your <code>TestImportMathbin.tar.gz</code>, I still get error messages like:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">failed</span> <span class="n">to</span> <span class="n">write</span> <span class="bp">'././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">Mathlib</span><span class="bp">/</span><span class="n">Tactic</span><span class="bp">/</span><span class="n">Basic.olean'</span><span class="o">:</span> <span class="mi">2</span> <span class="n">No</span> <span class="n">such</span> <span class="n">file</span> <span class="n">or</span> <span class="n">directory</span>
</code></pre></div>
<p>I'm not sure what's going on. As far as I can see that directory, and indeed that file, exist.</p>



<a name="255506176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255506176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255506176">(Sep 30 2021 at 02:13)</a>:</h4>
<p>For hopefully complete reproducibility, my setup is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">community</span><span class="bp">/</span><span class="n">test</span><span class="bp">-</span><span class="n">mathport</span>
<span class="n">cd</span> <span class="n">test</span><span class="bp">-</span><span class="n">mathport</span>
<span class="n">make</span>
</code></pre></div>



<a name="255506331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255506331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255506331">(Sep 30 2021 at 02:15)</a>:</h4>
<p>I guess that doesn't reproduce compiling <code>lake</code>.</p>



<a name="255506430"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255506430" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255506430">(Sep 30 2021 at 02:16)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I have observed a lot of Heisenbug-like issues similar to the one you just posted, that I think are related to <code>lake</code>. Can you just try continuing to type <code>lake build</code> in the <code>TestImportMathbin</code> directory? I just tried from scratch and it took four consecutives builds to work for me.</p>



<a name="255506676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255506676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255506676">(Sep 30 2021 at 02:19)</a>:</h4>
<p>Oh dear -- I just checked, and <code>lake</code> is spawning about a dozen separate <code>lean</code> processes. That can't be good. Perhaps these <code>failed to write</code> errors are contentions between different <code>lean</code> processes trying to do the same thing.</p>



<a name="255506752"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255506752" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255506752">(Sep 30 2021 at 02:20)</a>:</h4>
<p>(Would also be consistent with Heisenbugs.)</p>



<a name="255506875"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255506875" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255506875">(Sep 30 2021 at 02:22)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255506676">said</a>:</p>
<blockquote>
<p>Oh dear -- I just checked, and <code>lake</code> is spawning about a dozen separate <code>lean</code> processes. That can't be good. Perhaps these <code>failed to write</code> errors are contentions between different <code>lean</code> processes trying to do the same thing.</p>
</blockquote>
<p>CC: <span class="user-mention" data-user-id="315577">@Mac</span></p>



<a name="255506942"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255506942" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255506942">(Sep 30 2021 at 02:23)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> Were you able to get TestImportMathbin to work eventually? If so, can you please confirm that by copying the LEAN_PATH that lake prints out, you can import from your editor as well?</p>



<a name="255507055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255507055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255507055">(Sep 30 2021 at 02:24)</a>:</h4>
<p>Still running <code>lake build</code> repeatedly to see if it stabilises. Some of the stray Lean processes keep running after <code>lake</code> returns to the command line, so I'm waiting for those to end too. Bit of a slow process. :-)</p>



<a name="255507722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255507722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255507722">(Sep 30 2021 at 02:33)</a>:</h4>
<p>Oh, exciting variety of errors:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">libc</span><span class="bp">++</span><span class="n">abi.dylib</span><span class="o">:</span> <span class="n">terminating</span> <span class="k">with</span> <span class="n">uncaught</span> <span class="n">exception</span> <span class="n">of</span> <span class="n">type</span> <span class="n">std</span><span class="o">::</span><span class="n">__1</span><span class="o">::</span><span class="n">system_error</span><span class="o">:</span> <span class="n">mutex</span> <span class="n">lock</span> <span class="n">failed</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">argument</span>
</code></pre></div>



<a name="255508306"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255508306" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255508306">(Sep 30 2021 at 02:41)</a>:</h4>
<p><span class="user-mention" data-user-id="230999">@Daniel Selsam</span>  <code>lake</code> tries to build as many modules as it can in parallel, so spawning many <code>lean</code> processes can be reasonable. While I have encountered some Hisenbugs of my own with <code>lake</code>, I suspect that they are actually <code>lean</code> bugs that emerge when many <code>lean</code> process are trying to load the same <code>.olean</code>s.  I have mostly ignored them because, as Hisenbugs, I have no clue how to debug them. The Hisenbugs I have encountered also only seem to appear one Windows (further my suspicion that is due to some race condition with memory mapped oleans).</p>
<p>However, the bugs I have seen are not like yours <span class="user-mention" data-user-id="110087">@Scott Morrison</span> , so I am not quite sure what is going wrong there. Though again, as <code>lake</code> itself is not trying to acquire any locks directly, I would expect either <code>lean</code> has a bug or I am someone violating an invariant of  some <code>lean</code> function that I was not aware of.</p>



<a name="255508411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255508411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255508411">(Sep 30 2021 at 02:42)</a>:</h4>
<p>(I'm on macos here.)</p>



<a name="255508421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255508421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255508421">(Sep 30 2021 at 02:42)</a>:</h4>
<p>(I'm on linux :))</p>



<a name="255508483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255508483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255508483">(Sep 30 2021 at 02:43)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span>, I don't know anything yet about how <code>lake</code> is working: is it starting a separate <code>lean</code> process for each <code>.lean</code> file that needs to be compiled to an <code>.olean</code>?</p>



<a name="255508585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255508585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255508585">(Sep 30 2021 at 02:44)</a>:</h4>
<p>Would you be interested in trying </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">community</span><span class="bp">/</span><span class="n">test</span><span class="bp">-</span><span class="n">mathport</span>
<span class="n">cd</span> <span class="n">test</span><span class="bp">-</span><span class="n">mathport</span>
<span class="n">make</span>
</code></pre></div>
<p>to see if you can reproduce?</p>



<a name="255508895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255508895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255508895">(Sep 30 2021 at 02:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255508483">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="315577">Mac</span>, I don't know anything yet about how <code>lake</code> is working: is it starting a separate <code>lean</code> process for each <code>.lean</code> file that needs to be compiled to an <code>.olean</code>?</p>
</blockquote>
<p>That's how lean 4 works - it does separate compilation and relies on the build tool to orchestrate the calls</p>



<a name="255509076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255509076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255509076">(Sep 30 2021 at 02:51)</a>:</h4>
<p>Great, that's what I thought. I'm just trying to guess how there could be a contention on an <code>.olean</code> file in this setup.</p>



<a name="255509242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255509242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255509242">(Sep 30 2021 at 02:54)</a>:</h4>
<p>Note for me this is a pretty reliable heisenbug: <code>lake build</code> is failing every time, albeit with different error messages on different runs.</p>



<a name="255515824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255515824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255515824">(Sep 30 2021 at 04:30)</a>:</h4>
<p>I think this might be something to do with it: it seems <code>lake</code> is updating the same dependency multiple times:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">mathlib</span><span class="o">:</span> <span class="n">cloning</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">dselsam</span><span class="bp">/</span><span class="n">mathlib4.git</span> <span class="n">to</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span>
<span class="n">mathport</span><span class="o">:</span> <span class="n">cloning</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">/</span><span class="n">mathport.git</span> <span class="n">to</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">lake</span>
<span class="n">mathport</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">master</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">lake</span>
<span class="n">mathport</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">master</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">lake</span>
<span class="n">mathport</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">master</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">lake</span>
<span class="n">mathport</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">master</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">lake</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">lake</span>
<span class="n">mathport</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">master</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">lake</span>
<span class="n">mathport</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">master</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">lake</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathport</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">lake</span>
<span class="n">mathlib</span><span class="o">:</span> <span class="n">trying</span> <span class="n">to</span> <span class="n">update</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span> <span class="n">to</span> <span class="n">revision</span> <span class="n">lake</span>
</code></pre></div>



<a name="255515884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255515884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255515884">(Sep 30 2021 at 04:30)</a>:</h4>
<p>I've snipped out interspersed output of the form</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="n">lean</span> <span class="bp">-</span><span class="n">R</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/./.</span> <span class="bp">-</span><span class="n">o</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="bp">/</span><span class="n">Mathlib</span><span class="bp">/</span><span class="n">Algebra</span><span class="bp">/</span><span class="n">Ring</span><span class="bp">/</span><span class="n">Basic.olean</span> <span class="bp">-</span><span class="n">c</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/./</span><span class="n">build</span><span class="bp">/</span><span class="n">ir</span><span class="bp">/</span><span class="n">Mathlib</span><span class="bp">/</span><span class="n">Algebra</span><span class="bp">/</span><span class="n">Ring</span><span class="bp">/</span><span class="n">Basic.c</span> <span class="bp">././</span><span class="n">Lib4</span><span class="bp">/</span><span class="n">liquidbin</span><span class="bp">/./../</span><span class="n">mathbin</span><span class="bp">/./../</span><span class="n">leanbin</span><span class="bp">/./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/././</span><span class="n">Mathlib</span><span class="bp">/</span><span class="n">Algebra</span><span class="bp">/</span><span class="n">Ring</span><span class="bp">/</span><span class="n">Basic.lean</span>
</code></pre></div>



<a name="255517081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255517081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255517081">(Sep 30 2021 at 04:48)</a>:</h4>
<p>@Mac, this <code>Dockerfile</code> also reproduces the problem.</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">FROM</span> <span class="n">ubuntu</span>

<span class="n">USER</span> <span class="n">root</span>

<span class="bp">#</span> <span class="n">Set</span> <span class="n">timezone</span> <span class="n">to</span> <span class="n">UTC</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">prompts</span> <span class="k">from</span> <span class="n">tzdata.</span>
<span class="n">RUN</span> <span class="n">TZ</span><span class="bp">=</span><span class="n">UTC</span> <span class="n">ln</span> <span class="bp">-</span><span class="n">snf</span> <span class="bp">/</span><span class="n">usr</span><span class="bp">/</span><span class="n">share</span><span class="bp">/</span><span class="n">zoneinfo</span><span class="bp">/$</span><span class="n">TZ</span> <span class="bp">/</span><span class="n">etc</span><span class="bp">/</span><span class="n">localtime</span> <span class="bp">&amp;&amp;</span> <span class="n">echo</span> <span class="bp">$</span><span class="n">TZ</span> <span class="bp">&gt;</span> <span class="bp">/</span><span class="n">etc</span><span class="bp">/</span><span class="n">timezone</span>
<span class="bp">#</span> <span class="n">Install</span> <span class="n">prerequisites.</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="bp">-</span><span class="n">get</span> <span class="n">update</span> <span class="bp">&amp;&amp;</span> <span class="bp">\</span>
    <span class="bp">#</span> <span class="n">Lean4</span> <span class="n">prerequisites</span><span class="o">:</span>
    <span class="n">apt</span><span class="bp">-</span><span class="n">get</span> <span class="n">install</span> <span class="bp">-</span><span class="n">y</span> <span class="n">git</span> <span class="n">libgmp</span><span class="bp">-</span><span class="n">dev</span> <span class="n">cmake</span> <span class="n">ccache</span> <span class="n">gcc</span><span class="bp">-</span><span class="mi">10</span> <span class="n">g</span><span class="bp">++-</span><span class="mi">10</span> <span class="bp">&amp;&amp;</span> <span class="bp">\</span>
    <span class="n">apt</span><span class="bp">-</span><span class="n">get</span> <span class="n">clean</span>
<span class="bp">#</span> <span class="n">We</span> <span class="n">need</span> <span class="n">curl</span> <span class="n">to</span> <span class="n">download</span> <span class="n">elan</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="bp">-</span><span class="n">get</span> <span class="n">install</span> <span class="bp">-</span><span class="n">y</span> <span class="n">curl</span>
<span class="bp">#</span> <span class="n">Lake</span> <span class="n">additionally</span> <span class="n">requires</span> <span class="n">some</span> <span class="n">header</span> <span class="n">files</span> <span class="n">for</span> <span class="n">the</span> <span class="n">compiler</span><span class="o">:</span>
<span class="n">RUN</span> <span class="n">apt</span><span class="bp">-</span><span class="n">get</span> <span class="n">install</span> <span class="bp">-</span><span class="n">y</span> <span class="n">build</span><span class="bp">-</span><span class="n">essential</span>

<span class="bp">#</span> <span class="n">create</span> <span class="n">a</span> <span class="n">non</span><span class="bp">-</span><span class="n">root</span> <span class="n">user</span>
<span class="n">RUN</span> <span class="n">useradd</span> <span class="bp">-</span><span class="n">m</span> <span class="n">lean</span>

<span class="n">USER</span> <span class="n">lean</span>
<span class="n">WORKDIR</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">lean</span>

<span class="n">SHELL</span> <span class="o">[</span><span class="s2">"/bin/bash"</span><span class="o">,</span> <span class="s2">"-c"</span><span class="o">]</span>
<span class="bp">#</span> <span class="n">set</span> <span class="n">the</span> <span class="n">entrypoint</span> <span class="n">to</span> <span class="n">be</span> <span class="n">a</span> <span class="n">login</span> <span class="n">shell</span><span class="o">,</span> <span class="n">so</span> <span class="n">everything</span> <span class="n">is</span> <span class="n">on</span> <span class="n">the</span> <span class="n">PATH</span>
<span class="n">ENTRYPOINT</span> <span class="o">[</span><span class="s2">"/bin/bash"</span><span class="o">,</span> <span class="s2">"-l"</span><span class="o">]</span>

<span class="bp">#</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">binaries</span> <span class="n">are</span> <span class="n">available</span> <span class="n">even</span> <span class="k">in</span> <span class="n">non</span><span class="bp">-</span><span class="n">login</span> <span class="n">shells</span>
<span class="n">ENV</span> <span class="n">PATH</span><span class="bp">=</span><span class="s2">"/home/lean/.elan/bin:/home/lean/.local/bin:$PATH"</span>

<span class="bp">#</span> <span class="n">install</span> <span class="n">elan</span>
<span class="n">RUN</span> <span class="n">curl</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">raw.githubusercontent.com</span><span class="bp">/</span><span class="n">Kha</span><span class="bp">/</span><span class="n">elan</span><span class="bp">/</span><span class="n">master</span><span class="bp">/</span><span class="n">elan</span><span class="bp">-</span><span class="n">init.sh</span> <span class="bp">-</span><span class="n">sSf</span> <span class="bp">|</span> <span class="n">sh</span> <span class="bp">-</span><span class="n">s</span> <span class="c1">-- -y &amp;&amp; \</span>
    <span class="bp">.</span> <span class="bp">~/.</span><span class="n">profile</span> <span class="bp">&amp;&amp;</span> <span class="bp">\</span>
    <span class="n">elan</span> <span class="n">toolchain</span> <span class="n">uninstall</span> <span class="n">stable</span>

<span class="n">RUN</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">/</span><span class="n">lake</span> <span class="bp">&amp;&amp;</span> <span class="bp">\</span>
    <span class="n">cd</span> <span class="n">lake</span> <span class="bp">&amp;&amp;</span> <span class="bp">\</span>
    <span class="bp">./</span><span class="n">build.sh</span>

<span class="n">ENV</span> <span class="n">PATH</span><span class="bp">=</span><span class="s2">"/home/lean/lake/build/bin/:$PATH"</span>

<span class="bp">#</span> <span class="n">Clone</span> <span class="n">the</span> <span class="bp">`</span><span class="n">test</span><span class="bp">-</span><span class="n">mathport</span><span class="bp">`</span> <span class="n">repository.</span>
<span class="n">RUN</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="o">:</span><span class="bp">//</span><span class="n">github.com</span><span class="bp">/</span><span class="n">leanprover</span><span class="bp">-</span><span class="n">community</span><span class="bp">/</span><span class="n">test</span><span class="bp">-</span><span class="n">mathport</span>
<span class="n">WORKDIR</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">lean</span><span class="bp">/</span><span class="n">test</span><span class="bp">-</span><span class="n">mathport</span>

<span class="n">RUN</span> <span class="n">make</span> <span class="n">download</span><span class="bp">-</span><span class="n">release</span>
<span class="n">RUN</span> <span class="n">lake</span> <span class="n">build</span>
</code></pre></div>



<a name="255517126"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255517126" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255517126">(Sep 30 2021 at 04:49)</a>:</h4>
<p>(Perhaps it's better to remove the last line, then create a terminal in the generated image and run <code>lake build</code> by hand.)</p>



<a name="255520072"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255520072" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255520072">(Sep 30 2021 at 05:31)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span> I'll try to take a look at this and debug what I can tomorrow (i.e., in ~10-12 hours).</p>



<a name="255520107"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255520107" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255520107">(Sep 30 2021 at 05:31)</a>:</h4>
<p>Thanks. If there's anything I should try out or investigate, please tell me. I know no one likes a heisenbug. :-(</p>



<a name="255520185"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255520185" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255520185">(Sep 30 2021 at 05:32)</a>:</h4>
<p>is it possible / does it help to run in single threaded mode?</p>



<a name="255520210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255520210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255520210">(Sep 30 2021 at 05:33)</a>:</h4>
<p>not even sure if lake has an option for that</p>



<a name="255520216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255520216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255520216">(Sep 30 2021 at 05:33)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> that is not possible with <code>lake</code> currently</p>



<a name="255520217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255520217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255520217">(Sep 30 2021 at 05:33)</a>:</h4>
<p><code>lake -j 1</code> says it doesn't know about <code>-j</code>.</p>



<a name="255579335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255579335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255579335">(Sep 30 2021 at 14:04)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span> FYI here are a few other issues I hit with Lake. I didn't take the time to make repros in case they are easy to fix, but happy to if it would help:</p>
<ul>
<li><code>lake clean</code> throws an error if build directory doesn't exist yet</li>
<li>I sometimes need to manually link against a lean dependency, despite it being listed as a dependency</li>
<li>when depending on a cpp project, I need to manually extend CPATH to include the include directory of the relevant lean version</li>
<li>lake doesn't seem to return an error when builds fail. This one has burned me a bunch of times, because I usually have commands like <code>make &amp;&amp; reset &amp;&amp; do-thing-that-might-fail-in-20m</code>. And then it fails in 20m for the same reason it failed last time and I don't even see the compiler errors.</li>
<li>minor/cosmetic: <code>lake build bin</code> silently doesn't build the binary, same with build lib. This causes the same kind of issue as the previous point where I don't know my binary is stale.</li>
</ul>



<a name="255632959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255632959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255632959">(Sep 30 2021 at 19:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255579335">said</a>:</p>
<blockquote>
<ul>
<li><code>lake clean</code> throws an error if build directory doesn't exist yet</li>
</ul>
</blockquote>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> is that how <code>IO.removeDirAll</code> is intended to work? I was under the impression it was served as a <code>rm -rf</code> not a <code>rm -r</code> (i.e., it be the inverse of <code>IO.createDIrAll</code>). I can of course fix this (by checking the directory exists), but I just wanted to verify that this was the intent for <code>IO.removeDirAll</code> (and if so, that should also probably be included in the comment for the function).</p>



<a name="255633484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255633484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255633484">(Sep 30 2021 at 19:29)</a>:</h4>
<p>Sounds like a bug</p>



<a name="255634488"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255634488" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255634488">(Sep 30 2021 at 19:35)</a>:</h4>
<p>Wait no I misunderstood, even the argument path does not exist? I'd expect it to fail then, yes. I'd have to check if the corresponding Rust API, and others, does so as well.</p>



<a name="255634607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255634607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255634607">(Sep 30 2021 at 19:36)</a>:</h4>
<p>Technically speaking, the act of removal cannot succeed if the thing to be removed does not exist</p>



<a name="255634705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255634705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255634705">(Sep 30 2021 at 19:36)</a>:</h4>
<p><span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> okay, makes sense, just wanted to verify</p>



<a name="255634929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255634929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255634929">(Sep 30 2021 at 19:38)</a>:</h4>
<p>For real fun, see <a href="https://github.com/rust-lang/rust/issues/29497">https://github.com/rust-lang/rust/issues/29497</a></p>



<a name="255665959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255665959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255665959">(Sep 30 2021 at 23:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255579335">said</a>:</p>
<blockquote>
<ul>
<li>I sometimes need to manually link against a lean dependency, despite it being listed as a dependency</li>
<li>when depending on a cpp project, I need to manually extend CPATH to include the include directory of the relevant lean version</li>
</ul>
</blockquote>
<p>Could you make issues for these two? I need a mwe for the first one to figure out what is happening there and the later is a feature request that I will need to decide how (and if) I will address it.</p>



<a name="255666347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255666347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255666347">(Sep 30 2021 at 23:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255665959">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255579335">said</a>:</p>
<blockquote>
<ul>
<li>I sometimes need to manually link against a lean dependency, despite it being listed as a dependency</li>
<li>when depending on a cpp project, I need to manually extend CPATH to include the include directory of the relevant lean version</li>
</ul>
</blockquote>
<p>Could you make issues for these two? I need a mwe for the first one to figure out what is happening there and the later is a feature request that I will need to decide how (and if) I will address it.</p>
</blockquote>
<p>I will try. The second is easy but the first is triggered by a complex project currently.</p>



<a name="255667515"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255667515" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255667515">(Sep 30 2021 at 23:49)</a>:</h4>
<p>I made <a href="https://github.com/leanprover/lake/issues/17">https://github.com/leanprover/lake/issues/17</a> to track my problem with running <code>lake build</code> on the mathport artifacts.</p>



<a name="255672089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255672089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255672089">(Oct 01 2021 at 00:38)</a>:</h4>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255579335">said</a>:</p>
<blockquote>
<ul>
<li><code>lake clean</code> throws an error if build directory doesn't exist yet</li>
<li>lake doesn't seem to return an error when builds fail. This one has burned me a bunch of times, because I usually have commands like <code>make &amp;&amp; reset &amp;&amp; do-thing-that-might-fail-in-20m</code>. And then it fails in 20m for the same reason it failed last time and I don't even see the compiler errors.</li>
<li>minor/cosmetic: <code>lake build bin</code> silently doesn't build the binary, same with build lib. This causes the same kind of issue as the previous point where I don't know my binary is stale.</li>
</ul>
</blockquote>
<p>These 3 are now fixed in master.</p>



<a name="255672460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20depending%20on%20mathlib/near/255672460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Daniel Selsam <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib.html#255672460">(Oct 01 2021 at 00:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="315577">Mac</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255665959">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="230999">Daniel Selsam</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20depending.20on.20mathlib/near/255579335">said</a>:</p>
<blockquote>
<ul>
<li>I sometimes need to manually link against a lean dependency, despite it being listed as a dependency</li>
</ul>
</blockquote>
<p>I need a mwe for the first one to figure out what is happening there</p>
</blockquote>
<p>Unfortunately, I can now remove the extra linking argument in my project and it still builds. I have no idea how to reproduce it any more. Maybe it was accidentally fixed in a lake commit between what I am running now and what I was running when I hit the error.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>