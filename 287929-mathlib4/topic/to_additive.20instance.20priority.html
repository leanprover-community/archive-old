---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/to_additive.20instance.20priority.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html">to_additive instance priority</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="312564094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312564094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312564094">(Nov 28 2022 at 06:42)</a>:</h4>
<p>I want to fix my earlier hacky solution of the instance priority in <code>to_additive</code>, but the file <code>Algebra.Group.OrderSynonym</code> fails with some very weird messages (see <a href="https://github.com/leanprover-community/mathlib4/actions/runs/3562129264/jobs/5983590994">https://github.com/leanprover-community/mathlib4/actions/runs/3562129264/jobs/5983590994</a> ). I've checked what my code is doing and it sets the correct priority, so I suspect there is yet another bug in <code>to_additive</code></p>



<a name="312564681"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312564681" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312564681">(Nov 28 2022 at 06:47)</a>:</h4>
<p>oh and there seems to be bug in <code>to_additive</code> that primed names cause issues (<code>@[to_additive OrderDual.SMul']</code> is not doing anything)</p>



<a name="312586099"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312586099" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312586099">(Nov 28 2022 at 09:33)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/765">mathlib4#765</a></p>



<a name="312600966"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312600966" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312600966">(Nov 28 2022 at 10:58)</a>:</h4>
<p>This is not a bug in <code>to_additive</code>, just a few errors with the usage of <code>to_additive</code> in relation to automatically generated <code>instance</code> names. I pushed a fix.</p>



<a name="312602493"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312602493" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312602493">(Nov 28 2022 at 11:05)</a>:</h4>
<p>I cannot reproduce your last bug. I think you were not seeing any output from <code>@[to_additive? ...]</code> since the declaration already exists.  Note: after <a href="https://github.com/leanprover-community/mathlib4/pull/718">mathlib4#718</a> <code>@[to_additive? ...]</code> should always give some output.</p>



<a name="312610235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312610235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312610235">(Nov 28 2022 at 11:52)</a>:</h4>
<p>thanks for looking into it - should be align the <code>to_additive</code> version as well?</p>



<a name="312610440"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312610440" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312610440">(Nov 28 2022 at 11:54)</a>:</h4>
<p>as for the primed variables: I've printf debugged <code>to_additive</code> to see whether the instance priority was set correctly and for the primed variables there was no output and hovering over the name in <code>to_additive</code> also gave nothing</p>



<a name="312624675"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312624675" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Floris van Doorn <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312624675">(Nov 28 2022 at 13:13)</a>:</h4>
<p><span class="user-mention silent" data-user-id="412682">Moritz Doll</span> <a href="#narrow/stream/287929-mathlib4/topic/to_additive.20instance.20priority/near/312610235">said</a>:</p>
<blockquote>
<p>thanks for looking into it - should be align the <code>to_additive</code> version as well?</p>
</blockquote>
<p>I don't know. It's never done, but I expect we indeed do need that as well (which means we're probably missing hundreds of <code>#align</code>'s)</p>



<a name="312624899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312624899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312624899">(Nov 28 2022 at 13:14)</a>:</h4>
<p>I've been aligning all the additive versions. It's definitely necessary if the non-additive version needed aligning.</p>



<a name="312625145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312625145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312625145">(Nov 28 2022 at 13:16)</a>:</h4>
<p>In what instances does one need to align the instance names? In general, most instances do not get referenced by name.</p>



<a name="312625646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/to_additive%20instance%20priority/near/312625646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/to_additive.20instance.20priority.html#312625646">(Nov 28 2022 at 13:19)</a>:</h4>
<p>I align instances that are manually named as well as parent projections for classes which extend other classes as these are most likely to be referenced by name.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>