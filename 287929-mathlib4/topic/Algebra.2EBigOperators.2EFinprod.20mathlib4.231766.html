---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html">Algebra.BigOperators.Finprod mathlib4#1766</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="322991933"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Algebra.BigOperators.Finprod%20mathlib4%231766/near/322991933" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lukas Miaskiwskyi <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html#322991933">(Jan 23 2023 at 11:05)</a>:</h4>
<p>Also a notational question: The statements of many theorems in this file contain expressions like <code>∏ᶠ i ∈ s, f i</code> and <code>(∏ᶠ (i) (_h : i = a), f i)</code> which I would like to port to lean4 notation syntax. The product in the BigOperators.Basic does not allow for such expressions currently, so I don't have that to guide me, and we probably don't want to refactor all the theorem statements at this point.</p>
<p>How would we like the lean4 syntax to be set up for this? For the first one, the <code>macro_rules</code> case</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">macro_rules</span> <span class="o">(</span><span class="n">kind</span> <span class="o">:=</span> <span class="n">bigfinprod</span><span class="o">)</span>
<span class="o">(</span><span class="bp">∏ᶠ</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span> <span class="bp">∈</span> <span class="bp">$</span><span class="n">s</span><span class="o">:</span><span class="n">ident</span><span class="o">,</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">x</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="o">(</span><span class="n">α</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">x</span> <span class="bp">∈</span> <span class="bp">$</span><span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="k">fun</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">p</span><span class="o">)))</span>
</code></pre></div>
<p>seems to reproduce the lean3 behavior, but I don't know if that's good design.</p>
<p>The second one I'm trying to match with</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="o">(</span><span class="n">name</span> <span class="o">:=</span> <span class="n">bigfinprod_condition</span><span class="o">)</span> <span class="s2">"∏ᶠ ("</span> <span class="n">extBinder</span> <span class="s2">") ("</span> <span class="n">extBinder</span> <span class="s2">"), "</span> <span class="n">term</span><span class="o">:</span><span class="mi">67</span> <span class="o">:</span> <span class="n">term</span>
<span class="n">macro_rules</span> <span class="o">(</span><span class="n">kind</span> <span class="o">:=</span> <span class="n">bigfinprod_condition</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">∏ᶠ</span> <span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">u</span><span class="o">:</span><span class="n">ident</span><span class="o">),</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">x</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="o">(</span><span class="n">α</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">u</span><span class="o">)</span> <span class="o">(</span><span class="k">fun</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">p</span><span class="o">)))</span>
</code></pre></div>
<p>But that throws a strange  <code>expected ')'</code> error at <code>(α := $u) </code>. Could be that I do not yet fully understand the syntax here.</p>



<a name="322992343"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Algebra.BigOperators.Finprod%20mathlib4%231766/near/322992343" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lukas Miaskiwskyi <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html#322992343">(Jan 23 2023 at 11:07)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="112680">@Johan Commelin</span> since he mentioned porting the notation to how BigOperators.Basic does it</p>



<a name="322993855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Algebra.BigOperators.Finprod%20mathlib4%231766/near/322993855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html#322993855">(Jan 23 2023 at 11:16)</a>:</h4>
<p>You should be able to build the notation in the same way as the <code>supᵢ</code> notation</p>



<a name="322999668"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Algebra.BigOperators.Finprod%20mathlib4%231766/near/322999668" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html#322999668">(Jan 23 2023 at 11:46)</a>:</h4>
<p>I thought we shouldn't have <code>supr</code> anymore</p>



<a name="323000158"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Algebra.BigOperators.Finprod%20mathlib4%231766/near/323000158" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html#323000158">(Jan 23 2023 at 11:49)</a>:</h4>
<p>Whoops, I removed the stray <code>r</code></p>



<a name="323020262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Algebra.BigOperators.Finprod%20mathlib4%231766/near/323020262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lukas Miaskiwskyi <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html#323020262">(Jan 23 2023 at 13:32)</a>:</h4>
<p>Thanks for the suggestion, Eric, that sent me on a painful journey of understanding the syntax. What seems to reproduce all the lean3-style notation in this file is:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">syntax</span> <span class="o">(</span><span class="n">name</span> <span class="o">:=</span> <span class="n">bigfinprod</span><span class="o">)</span> <span class="s2">"∏ᶠ "</span> <span class="n">extBinders</span> <span class="s2">", "</span> <span class="n">term</span><span class="o">:</span><span class="mi">67</span> <span class="o">:</span> <span class="n">term</span>
<span class="n">macro_rules</span> <span class="o">(</span><span class="n">kind</span> <span class="o">:=</span> <span class="n">bigfinprod</span><span class="o">)</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">∏ᶠ</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span><span class="o">,</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="o">(</span><span class="k">fun</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span> <span class="bp">↦</span> <span class="bp">$</span><span class="n">p</span><span class="o">))</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">∏ᶠ</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">t</span><span class="o">,</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="o">(</span><span class="k">fun</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">t</span> <span class="bp">↦</span> <span class="bp">$</span><span class="n">p</span><span class="o">))</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">∏ᶠ</span> <span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span> <span class="bp">$</span><span class="n">b</span><span class="o">:</span><span class="n">binderPred</span><span class="o">,</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span>
    <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">x</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="o">(</span><span class="n">α</span> <span class="o">:=</span> <span class="n">satisfies_binder_pred</span><span class="bp">%</span> <span class="bp">$</span><span class="n">x</span> <span class="bp">$</span><span class="n">b</span><span class="o">)</span> <span class="o">(</span><span class="k">fun</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">p</span><span class="o">)))</span>

  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">∏ᶠ</span> <span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">h</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">t</span><span class="o">),</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span>
      <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">finprod</span> <span class="o">(</span><span class="n">α</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="k">fun</span> <span class="bp">$</span><span class="n">h</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">p</span><span class="o">))</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">∏ᶠ</span> <span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">_</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">h</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">t</span><span class="o">),</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span>
      <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">finprod</span> <span class="o">(</span><span class="n">α</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="k">fun</span> <span class="bp">$</span><span class="n">h</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">p</span><span class="o">))</span>

  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">∏ᶠ</span> <span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">ident</span><span class="o">),</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span>
      <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">x</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">y</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">p</span><span class="o">))</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">∏ᶠ</span> <span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">h</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">t</span><span class="o">),</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span>
      <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">x</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">y</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="o">(</span><span class="n">α</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">t</span><span class="o">)</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">h</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">p</span><span class="o">)))</span>

  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">∏ᶠ</span> <span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">z</span><span class="o">:</span><span class="n">ident</span><span class="o">),</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span>
      <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">x</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">y</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">z</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">p</span><span class="o">)))</span>
  <span class="bp">|</span> <span class="bp">`</span><span class="o">(</span><span class="bp">∏ᶠ</span> <span class="o">(</span><span class="bp">$</span><span class="n">x</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">y</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">z</span><span class="o">:</span><span class="n">ident</span><span class="o">)</span> <span class="o">(</span><span class="bp">$</span><span class="n">h</span><span class="o">:</span><span class="n">ident</span> <span class="o">:</span> <span class="bp">$</span><span class="n">t</span><span class="o">),</span> <span class="bp">$</span><span class="n">p</span><span class="o">)</span> <span class="bp">=&gt;</span>
      <span class="bp">`</span><span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">x</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">y</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">z</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">finprod</span> <span class="o">(</span><span class="n">α</span> <span class="o">:=</span> <span class="bp">$</span><span class="n">t</span><span class="o">)</span> <span class="k">fun</span> <span class="bp">$</span><span class="n">h</span> <span class="bp">=&gt;</span> <span class="bp">$</span><span class="n">p</span><span class="o">))))</span>
</code></pre></div>
<p>And similar for finsum. But that's of course extremely fickle, since now the notation breaks if the user gives a typehint at an unconsidered place. And of course it would be nice to allow arbitrarily many arguments to take the product over, rather than just three. Any easy fixes?</p>



<a name="323060957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Algebra.BigOperators.Finprod%20mathlib4%231766/near/323060957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html#323060957">(Jan 23 2023 at 16:19)</a>:</h4>
<p>What did we do here for docs4#supᵢ?</p>



<a name="323061251"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Algebra.BigOperators.Finprod%20mathlib4%231766/near/323061251" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html#323061251">(Jan 23 2023 at 16:20)</a>:</h4>
<p>Why do we need anything different to what we had <a href="https://github.com/leanprover-community/mathlib4/blob/3fbdae49475528e1e4014189f98d217e67ece6da/Mathlib/Order/CompleteLattice.lean#LL99-L111C51">here</a>?</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">notation3</span> <span class="s2">"∏ᶠ "</span><span class="o">(</span><span class="bp">...</span><span class="o">)</span><span class="s2">", "</span><span class="n">r</span><span class="o">:(</span><span class="n">scoped</span> <span class="n">f</span> <span class="bp">=&gt;</span> <span class="n">finprod</span> <span class="n">f</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="n">r</span>
</code></pre></div>



<a name="323064801"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Algebra.BigOperators.Finprod%20mathlib4%231766/near/323064801" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Lukas Miaskiwskyi <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Algebra.2EBigOperators.2EFinprod.20mathlib4.231766.html#323064801">(Jan 23 2023 at 16:34)</a>:</h4>
<p>In the PR, Johan mentioned that using the macro_rules approach allows you to set operator precedence properly, which I suppose <code>notation3</code>doesn't. But other than that, the file works fine without it. And the macro_rules approach in supᵢ does not include iterated applications.  Chris &amp; Johan agreed to fix the notation at a later time, so it is now merged anyway.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>