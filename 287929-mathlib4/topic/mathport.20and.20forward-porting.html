---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html">mathport and forward-porting</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="319286008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319286008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319286008">(Jan 03 2023 at 21:53)</a>:</h4>
<p>This is very much not recommended. If you differ too much from mathport's output then later diffing is a lot harder</p>



<a name="319286372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319286372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319286372">(Jan 03 2023 at 21:55)</a>:</h4>
<p>I think the problem is:</p>
<ul>
<li>Our current "all mathlib3 PRs must have an open forward-ported PR" stance means that we can't rely on the mathport nightlies to do our work for us.</li>
<li>There is significant activation energy required to install mathport from the command line.</li>
<li>Even if everyone did have a mathport installation****, we don't have any tools to compute appropriate diffs</li>
</ul>



<a name="319286501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319286501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mauricio Collares <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319286501">(Jan 03 2023 at 21:57)</a>:</h4>
<p>Yaël only submitted synchronization PRs as far as I can tell, so maybe mathport was not particularly useful for them</p>



<a name="319286666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319286666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319286666">(Jan 03 2023 at 21:58)</a>:</h4>
<p>Right, but <span class="user-mention" data-user-id="387244">@Yaël Dillies</span> did not ask mathport to translate their new lemmas, and instead guessed the translation. I would imagine that probably they made good guesses, but that's not really the point; mathport should be making as many decisions as it can for us,</p>



<a name="319286774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319286774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319286774">(Jan 03 2023 at 21:59)</a>:</h4>
<p>Yes, I feel exactly as Eric on this issue.</p>



<a name="319286961"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319286961" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319286961">(Jan 03 2023 at 22:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>, can mathport be used incrementally? Can I start with mathport output from <code>$(git merge-base HEAD my_pr)</code>, and ask it to build the files on <code>my_pr</code> without touching the files with unchanged oleans?</p>



<a name="319287069"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319287069" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319287069">(Jan 03 2023 at 22:01)</a>:</h4>
<p>30 messages were moved here from <a class="stream-topic" data-stream-id="287929" href="/#narrow/stream/287929-mathlib4/topic/port.20progress">#mathlib4 &gt; port progress</a> by <span class="user-mention silent" data-user-id="310045">Eric Wieser</span>.</p>



<a name="319287736"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319287736" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319287736">(Jan 03 2023 at 22:04)</a>:</h4>
<p>Yes I think so. You would need to lean-3-build any files that you want to port (and their dependencies), and then you can call mathport on them</p>



<a name="319287918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319287918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319287918">(Jan 03 2023 at 22:05)</a>:</h4>
<p>So <code>lean --make $(filenames-changed)</code> and then <code>mathport $(filenames-changed)</code> would work?</p>



<a name="319288176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319288176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319288176">(Jan 03 2023 at 22:07)</a>:</h4>
<p>modulo finicky command line syntax, yes</p>



<a name="319288262"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319288262" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319288262">(Jan 03 2023 at 22:08)</a>:</h4>
<p>you also have to make sure you have the right versions of stuff checked out</p>



<a name="319288295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319288295" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319288295">(Jan 03 2023 at 22:08)</a>:</h4>
<p>it would be nice to have a makefile target or python program which automates this</p>



<a name="319289648"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319289648" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319289648">(Jan 03 2023 at 22:18)</a>:</h4>
<p>Yes, I'm asking these questions with a view of automating this</p>



<a name="319289741"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319289741" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319289741">(Jan 03 2023 at 22:19)</a>:</h4>
<blockquote>
<p>you also have to make sure you have the right versions of stuff checked out</p>
</blockquote>
<p>As in, you need <code>merge-base</code> to be a mathport-consumed commit?</p>



<a name="319289855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319289855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319289855">(Jan 03 2023 at 22:19)</a>:</h4>
<p>I think it might help if there was a "latest mathport" branch  in <code>leanprover-community/mathlib</code></p>



<a name="319308446"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319308446" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319308446">(Jan 04 2023 at 01:20)</a>:</h4>
<p>More specifically, the main compiler commands you need are:</p>
<ul>
<li><code>lean --make --recursive --ast --tlean $(filenames-changed)</code> (not entirely sure what <code>--recursive</code> does but it's in the makefile)</li>
<li><code>./build/bin/mathport --make config.json Leanbin::all Mathbin::$(filenames-changed) &gt;&gt; Logs/mathport.out 2&gt; &gt;(tee -a Logs/mathport.err &gt;&amp;2)</code></li>
</ul>



<a name="319308546"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319308546" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319308546">(Jan 04 2023 at 01:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/mathport.20and.20forward-porting/near/319289741">said</a>:</p>
<blockquote>
<blockquote>
<p>you also have to make sure you have the right versions of stuff checked out</p>
</blockquote>
<p>As in, you need <code>merge-base</code> to be a mathport-consumed commit?</p>
</blockquote>
<p>You need to have the <code>sources/lean</code> and <code>sources/mathlib</code> directories checked out in such a way that calling lean 3 doesn't cause the world to be recompiled</p>



<a name="319308629"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319308629" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319308629">(Jan 04 2023 at 01:22)</a>:</h4>
<p>it doesn't have to be any particular commit, but you need to have predata that isn't out of date relative to the source files or else lean will recompile</p>



<a name="319311259"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319311259" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319311259">(Jan 04 2023 at 01:55)</a>:</h4>
<blockquote>
<p>not entirely sure what --recursive does but it's in the makefile</p>
</blockquote>
<p><code>lean --recursive directory/</code> compiles all <code>*.lean</code> files inside <code>directory/</code>.  It doesn't have an effect if you're passing it files.</p>



<a name="319311329"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319311329" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319311329">(Jan 04 2023 at 01:56)</a>:</h4>
<blockquote>
<p><code>./build/bin/mathport --make config.json Leanbin::all Mathbin::$(filenames-changed) &gt;&gt; Logs/mathport.out 2&gt; &gt;(tee -a Logs/mathport.err &gt;&amp;2)</code></p>
</blockquote>
<p>That must be:<br>
<code>build/bin/mathport config.json Mathbin::$(lean3-modulenames-changed)</code></p>



<a name="319311344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20and%20forward-porting/near/319311344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20and.20forward-porting.html#319311344">(Jan 04 2023 at 01:56)</a>:</h4>
<p><code>mathport --make</code> will ignore all files that already have a Lean 4 olean.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>