---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html">Data.Int.Gcd - NormNum</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="316759733"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Int.Gcd%20-%20NormNum/near/316759733" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html#316759733">(Dec 19 2022 at 14:44)</a>:</h4>
<p>In <a href="https://github.com/leanprover-community/mathlib4/pull/981">#981</a> I am porting <code>data/int/gcd</code>. The only errors left are in the section relative to `NormNum. Can someone who knows tactic writing have a quick look? Thanks!</p>



<a name="316840231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Int.Gcd%20-%20NormNum/near/316840231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Heather Macbeth <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html#316840231">(Dec 19 2022 at 22:11)</a>:</h4>
<p>This is actually the <code>int.gcd</code> norm_num extension, so I guess it's not surprising that mathport produces garbage.  I guess this is a task for <span class="user-mention" data-user-id="110049">@Mario Carneiro</span> ?</p>



<a name="316840350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Int.Gcd%20-%20NormNum/near/316840350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html#316840350">(Dec 19 2022 at 22:12)</a>:</h4>
<p>yep, comment the section out completely and leave a TODO</p>



<a name="316990729"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Int.Gcd%20-%20NormNum/near/316990729" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html#316990729">(Dec 20 2022 at 16:37)</a>:</h4>
<p>There is a linter error I don't understand:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">The</span> <span class="bp">`</span><span class="n">unusedHavesSuffices</span><span class="bp">`</span> <span class="n">linter</span> <span class="n">reports</span><span class="o">:</span>
<span class="n">THE</span> <span class="n">FOLLOWING</span> <span class="n">DECLARATIONS</span> <span class="n">HAVE</span> <span class="n">INEFFECTUAL</span> <span class="n">TERM</span> <span class="n">MODE</span> <span class="n">HAVE</span><span class="bp">/</span><span class="n">SUFFICES</span> <span class="n">BLOCKS.</span> <span class="n">In</span> <span class="n">the</span> <span class="n">case</span> <span class="n">of</span> <span class="bp">`</span><span class="k">have</span><span class="bp">`</span> <span class="n">this</span> <span class="n">is</span> <span class="n">a</span> <span class="n">term</span> <span class="n">of</span> <span class="n">the</span> <span class="n">form</span> <span class="bp">`</span><span class="k">have</span> <span class="n">h</span> <span class="o">:=</span> <span class="n">foo</span><span class="o">,</span> <span class="n">bar</span><span class="bp">`</span> <span class="n">where</span> <span class="bp">`</span><span class="n">bar</span><span class="bp">`</span> <span class="n">does</span> <span class="n">not</span> <span class="n">refer</span> <span class="n">to</span> <span class="bp">`</span><span class="n">foo</span><span class="bp">`.</span> <span class="n">Such</span> <span class="n">statements</span> <span class="k">have</span> <span class="n">no</span> <span class="n">effect</span> <span class="n">on</span> <span class="n">the</span> <span class="n">generated</span> <span class="n">proof</span><span class="o">,</span> <span class="n">and</span> <span class="n">can</span> <span class="n">just</span> <span class="n">be</span> <span class="n">replaced</span> <span class="kd">by</span> <span class="bp">`</span><span class="n">bar</span><span class="bp">`</span><span class="o">,</span> <span class="k">in</span> <span class="n">addition</span> <span class="n">to</span> <span class="n">being</span> <span class="n">ineffectual</span><span class="o">,</span> <span class="n">they</span> <span class="n">may</span> <span class="n">make</span> <span class="n">unnecessary</span> <span class="n">assumptions</span> <span class="k">in</span> <span class="n">proofs</span> <span class="n">appear</span> <span class="n">as</span> <span class="k">if</span> <span class="n">they</span> <span class="n">are</span> <span class="n">used.</span> <span class="n">For</span> <span class="bp">`</span><span class="k">suffices</span><span class="bp">`</span> <span class="n">this</span> <span class="n">is</span> <span class="n">a</span> <span class="n">term</span> <span class="n">of</span> <span class="n">the</span> <span class="n">form</span> <span class="bp">`</span><span class="k">suffices</span> <span class="n">h</span> <span class="o">:</span> <span class="n">foo</span><span class="o">,</span> <span class="n">proof_of_goal</span><span class="o">,</span> <span class="n">proof_of_foo</span><span class="bp">`</span> <span class="n">where</span> <span class="bp">`</span><span class="n">proof_of_goal</span><span class="bp">`</span> <span class="n">does</span> <span class="n">not</span> <span class="n">refer</span> <span class="n">to</span> <span class="bp">`</span><span class="n">foo</span><span class="bp">`.</span> <span class="n">Such</span> <span class="n">statements</span> <span class="k">have</span> <span class="n">no</span> <span class="n">effect</span> <span class="n">on</span> <span class="n">the</span> <span class="n">generated</span> <span class="n">proof</span><span class="o">,</span> <span class="n">and</span> <span class="n">can</span> <span class="n">just</span> <span class="n">be</span> <span class="n">replaced</span> <span class="kd">by</span> <span class="bp">`</span><span class="n">proof_of_goal</span><span class="bp">`</span><span class="o">,</span> <span class="k">in</span> <span class="n">addition</span> <span class="n">to</span> <span class="n">being</span> <span class="n">ineffectual</span><span class="o">,</span> <span class="n">they</span> <span class="n">may</span> <span class="n">make</span> <span class="n">unnecessary</span> <span class="n">assumptions</span> <span class="k">in</span> <span class="n">proofs</span> <span class="n">appear</span> <span class="n">as</span> <span class="k">if</span> <span class="n">they</span> <span class="n">are</span> <span class="n">used.</span>  <span class="bp">-/</span>
<span class="k">#check</span> <span class="bp">@</span><span class="n">Nat.gcd_b_zero_right</span> <span class="c">/-</span><span class="cm"> unnecessary have this : 0 % Nat.succ n✝ &lt; Nat.succ n✝ -/</span>
</code></pre></div>
<p>where <code>gcd_b_zero_right</code> is</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span>
<span class="kd">theorem</span> <span class="n">gcd_b_zero_right</span> <span class="o">{</span><span class="n">s</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="n">s</span> <span class="bp">≠</span> <span class="mi">0</span><span class="o">)</span> <span class="o">:</span> <span class="n">gcdB</span> <span class="n">s</span> <span class="mi">0</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">unfold</span> <span class="n">gcdB</span> <span class="n">xgcd</span>
  <span class="n">induction</span> <span class="n">s</span>
  <span class="bp">·</span> <span class="n">exact</span> <span class="n">absurd</span> <span class="n">rfl</span> <span class="n">h</span>
  <span class="bp">·</span> <span class="n">simp</span> <span class="o">[</span><span class="n">xgcdAux</span><span class="o">]</span>
</code></pre></div>
<p>There is no <code>have</code> or <code>suffice</code>, so I don't really know what do to.</p>



<a name="316999311"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Int.Gcd%20-%20NormNum/near/316999311" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html#316999311">(Dec 20 2022 at 17:22)</a>:</h4>
<p>Ha ha, this is quite funny. I think the problem is here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Helper function for the extended GCD algorithm (`nat.xgcd`). -/</span>
<span class="kd">def</span> <span class="n">xgcdAux</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℤ</span> <span class="bp">×</span> <span class="n">ℤ</span>
  <span class="bp">|</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">r'</span><span class="o">,</span> <span class="n">s'</span><span class="o">,</span> <span class="n">t'</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">r'</span><span class="o">,</span> <span class="n">s'</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">succ</span> <span class="n">k</span><span class="o">,</span> <span class="n">s</span><span class="o">,</span> <span class="n">t</span><span class="o">,</span> <span class="n">r'</span><span class="o">,</span> <span class="n">s'</span><span class="o">,</span> <span class="n">t'</span> <span class="bp">=&gt;</span>
    <span class="k">have</span> <span class="o">:</span> <span class="n">r'</span> <span class="bp">%</span> <span class="n">succ</span> <span class="n">k</span> <span class="bp">&lt;</span> <span class="n">succ</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">mod_lt</span> <span class="n">_</span> <span class="bp">&lt;|</span> <span class="o">(</span><span class="n">succ_pos</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">gt</span>
    <span class="k">let</span> <span class="n">q</span> <span class="o">:=</span> <span class="n">r'</span> <span class="bp">/</span> <span class="n">succ</span> <span class="n">k</span>
    <span class="n">xgcdAux</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">%</span> <span class="n">succ</span> <span class="n">k</span><span class="o">)</span> <span class="o">(</span><span class="n">s'</span> <span class="bp">-</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">t'</span> <span class="bp">-</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">succ</span> <span class="n">k</span><span class="o">)</span> <span class="n">s</span> <span class="n">t</span>
</code></pre></div>
<p>There's a <code>have</code> there, which is necessary in general, and is presumably embedded in the term. But sometimes when the definition is being used, in the application the <code>have</code> is not necessary so the linter complains :-)</p>



<a name="317000421"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Int.Gcd%20-%20NormNum/near/317000421" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html#317000421">(Dec 20 2022 at 17:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum/near/316999311">said</a>:</p>
<blockquote>
<p>Ha ha, this is quite funny. I think the problem is here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="sd">/-- Helper function for the extended GCD algorithm (`nat.xgcd`). -/</span>
<span class="kd">def</span> <span class="n">xgcdAux</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">ℤ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">×</span> <span class="n">ℤ</span> <span class="bp">×</span> <span class="n">ℤ</span>
  <span class="bp">|</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">_</span><span class="o">,</span> <span class="n">r'</span><span class="o">,</span> <span class="n">s'</span><span class="o">,</span> <span class="n">t'</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">r'</span><span class="o">,</span> <span class="n">s'</span><span class="o">,</span> <span class="n">t'</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">succ</span> <span class="n">k</span><span class="o">,</span> <span class="n">s</span><span class="o">,</span> <span class="n">t</span><span class="o">,</span> <span class="n">r'</span><span class="o">,</span> <span class="n">s'</span><span class="o">,</span> <span class="n">t'</span> <span class="bp">=&gt;</span>
    <span class="k">have</span> <span class="o">:</span> <span class="n">r'</span> <span class="bp">%</span> <span class="n">succ</span> <span class="n">k</span> <span class="bp">&lt;</span> <span class="n">succ</span> <span class="n">k</span> <span class="o">:=</span> <span class="n">mod_lt</span> <span class="n">_</span> <span class="bp">&lt;|</span> <span class="o">(</span><span class="n">succ_pos</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">gt</span>
    <span class="k">let</span> <span class="n">q</span> <span class="o">:=</span> <span class="n">r'</span> <span class="bp">/</span> <span class="n">succ</span> <span class="n">k</span>
    <span class="n">xgcdAux</span> <span class="o">(</span><span class="n">r'</span> <span class="bp">%</span> <span class="n">succ</span> <span class="n">k</span><span class="o">)</span> <span class="o">(</span><span class="n">s'</span> <span class="bp">-</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">s</span><span class="o">)</span> <span class="o">(</span><span class="n">t'</span> <span class="bp">-</span> <span class="n">q</span> <span class="bp">*</span> <span class="n">t</span><span class="o">)</span> <span class="o">(</span><span class="n">succ</span> <span class="n">k</span><span class="o">)</span> <span class="n">s</span> <span class="n">t</span>
</code></pre></div>
<p>There's a <code>have</code> there, which is necessary in general, and is presumably embedded in the term. But sometimes when the definition is being used, in the application the <code>have</code> is not necessary so the linter complains :-)</p>
</blockquote>
<p><a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316991789">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316991789</a></p>



<a name="317000586"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Int.Gcd%20-%20NormNum/near/317000586" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html#317000586">(Dec 20 2022 at 17:28)</a>:</h4>
<p>In any case, how do we tell the linter that this is fine?</p>



<a name="317001902"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Int.Gcd%20-%20NormNum/near/317001902" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html#317001902">(Dec 20 2022 at 17:35)</a>:</h4>
<p>Well you can use the <code>nolint</code> attribute, but it might be worth running the example past the linter experts I guess?</p>



<a name="317002180"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Int.Gcd%20-%20NormNum/near/317002180" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum.html#317002180">(Dec 20 2022 at 17:36)</a>:</h4>
<p><a href="#narrow/stream/348111-std4/topic/spurious.20.60unusedHavesSuffices.60.20linter.20error.3F/near/317002149">https://leanprover.zulipchat.com/#narrow/stream/348111-std4/topic/spurious.20.60unusedHavesSuffices.60.20linter.20error.3F/near/317002149</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>