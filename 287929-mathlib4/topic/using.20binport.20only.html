---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/using.20binport.20only.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html">using binport only</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="289602739"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289602739" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289602739">(Jul 14 2022 at 14:55)</a>:</h4>
<p>I want to use the binported <code>.olean</code>s in a project of mine. I added </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">require</span> <span class="n">mathlib3port</span> <span class="k">from</span> <span class="n">git</span> <span class="s2">"https://github.com/leanprover-community/mathlib3port"</span>
</code></pre></div>
<p>to my lake file, and tried</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">Mathbin.AlgebraicGeometry.Scheme</span>

<span class="bp">#</span><span class="n">lookup3</span> <span class="n">algebraic_geometry.Scheme</span>
<span class="k">#check</span> <span class="n">AlgebraicGeometry.Scheme</span>
</code></pre></div>
<p>as recommended by the mathport readme, but all I get is a <code>unknown package 'Mathlib'</code> on the import and it doesn't seem to use the oleans but instead wants to load the synported files (?). What am I doing wrong?</p>



<a name="289604751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289604751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289604751">(Jul 14 2022 at 15:08)</a>:</h4>
<p>Try <code>import Mathbin</code> instead. See also our discussion here:<br>
<a href="#narrow/stream/270676-lean4/topic/unknown.20package.20Mathlib">https://leanprover.zulipchat.com/#narrow/stream/270676-lean4/topic/unknown.20package.20Mathlib</a></p>



<a name="289604886"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289604886" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289604886">(Jul 14 2022 at 15:10)</a>:</h4>
<p>I don't know if this should be fixed in the mathport readme or in lake. But one of them must be wrong I think :-)</p>



<a name="289604981"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289604981" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289604981">(Jul 14 2022 at 15:10)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span> <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span></p>



<a name="289605622"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289605622" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alexander Bentkamp <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289605622">(Jul 14 2022 at 15:15)</a>:</h4>
<p>Why do you think it's using the synported files? Maybe because when you click on the import you land in the synported files? I think that's intended and you are just being redirected there although internally the binport is used. That's what's happening for me at least.</p>



<a name="289612887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289612887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289612887">(Jul 14 2022 at 16:11)</a>:</h4>
<p>The binported oleans (e.g., <code>Mathbin.AlgebraicGeometry.Scheme</code>) import <code>Mathlib</code> and will thus break if Mathlib is not built and on the <code>LEAN_PATH</code>. The binported mathlib package (e.g., <code>mathlib3port</code>) does require <code>mathlib</code>, so Lake knows to add mathlib's olean directory to <code>LEAN_PATH</code>. However, Lake only builds modules on-demand. That is, when they are imported. Lake determines this by processing a module's header (i.e., the imports at the top of the file) to know what imports a given module  (e.g., your test code) makes. Since you only import <code>Mathbin.AlgebraicGeometry.Scheme</code>, that is all Lake ensures is built. And since that file only has an olean and no source file, Lake is unable to determine its imports to build them. Thus, <code>Mathlib</code> does not get built, which causes the error here. To fix this, you need to <code>import Mathlib</code> in your test file or import a file that syntatically imports <code>Mathlib</code> (e.g., <code>Mathbin</code>).</p>



<a name="289641663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289641663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289641663">(Jul 14 2022 at 19:58)</a>:</h4>
<p>Thanks! That should do it, I'll test it tomorrow</p>



<a name="289643128"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289643128" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289643128">(Jul 14 2022 at 20:10)</a>:</h4>
<p>Still the same errors... it also gives me <code>warning: </code>extraDepTarget<code> has been deprecated. Try to use a custom target or raise an issue about your use case.</code>, is that related?</p>



<a name="289643406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289643406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289643406">(Jul 14 2022 at 20:13)</a>:</h4>
<p>Oh it seems <code>Mathlib</code> just throws errors (on nightly 7-12)</p>



<a name="289644574"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289644574" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289644574">(Jul 14 2022 at 20:22)</a>:</h4>
<p>Ah no, the error message has changed, it's now <code>object file './lean_packages/mathlib/build/lib/Mathlib.olean' of module Mathlib does not exist</code>. <span aria-label="thinking" class="emoji emoji-1f914" role="img" title="thinking">:thinking:</span></p>



<a name="289645125"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289645125" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289645125">(Jul 14 2022 at 20:27)</a>:</h4>
<p>I'm confused. I can clone and build mathlib4 with nightly 7-12 without errors, but if I import it via lake with a toolchain bound to the same Lean version, it throws errors concerning <code>Syntax</code> vs <code>TSyntax</code> which suggests it uses the wrong Lean version</p>



<a name="289645705"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289645705" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289645705">(Jul 14 2022 at 20:32)</a>:</h4>
<p>Did you have a different version of the dependency already downloaded? In that case, try running <code>lake update</code></p>



<a name="289646498"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289646498" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289646498">(Jul 14 2022 at 20:38)</a>:</h4>
<p>I did try <code>lake update</code>...  Should I remove mathlib4 from my dependencies? They currently looked like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">require</span> <span class="n">mathlib</span> <span class="k">from</span> <span class="n">git</span> <span class="s2">"https://github.com/leanprover-community/mathlib4"</span>

<span class="n">require</span> <span class="n">mathlib3port</span> <span class="k">from</span> <span class="n">git</span> <span class="s2">"https://github.com/leanprover-community/mathlib3port"</span>
</code></pre></div>



<a name="289646687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289646687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289646687">(Jul 14 2022 at 20:40)</a>:</h4>
<p>Maybe I should try removing the <code>lake_packages</code> folder by hand</p>



<a name="289646898"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289646898" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289646898">(Jul 14 2022 at 20:42)</a>:</h4>
<p>Neither <code>lake update</code> nor removing <code>lake_packages</code> nor removing <code>mathlib</code> from the lake file helped <span aria-label="confused" class="emoji emoji-1f615" role="img" title="confused">:confused:</span></p>



<a name="289647076"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289647076" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289647076">(Jul 14 2022 at 20:44)</a>:</h4>
<p>If I open the mathlib file that throws the error it compiles just fine</p>



<a name="289647242"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289647242" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289647242">(Jul 14 2022 at 20:45)</a>:</h4>
<p>This is the full first error:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">info</span><span class="o">:</span> <span class="bp">&gt;</span> <span class="n">LEAN_PATH</span><span class="bp">=./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib3port</span><span class="bp">/</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="o">:</span><span class="bp">./</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="o">:</span><span class="bp">./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span><span class="o">:</span><span class="bp">./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">lean3port</span><span class="bp">/</span><span class="n">build</span><span class="bp">/</span><span class="n">lib</span> <span class="n">LD_LIBRARY_PATH</span><span class="bp">=/</span><span class="n">home</span><span class="bp">/</span><span class="n">javra</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-12/lib:./lean_packages/mathlib3port/build/lib:./build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./lean_packages/mathlib/build/lib /home/javra/.elan/toolchains/leanprover--lean4---nightly-2022-07-12/bin/lean ./lean_packages/mathlib/././Mathlib/Tactic/RestateAxiom.lean -R ./lean_packages/mathlib/./. -o ./lean_packages/mathlib/build/lib/Mathlib/Tactic/RestateAxiom.olean -i ./lean_packages/mathlib/build/lib/Mathlib/Tactic/RestateAxiom.ilean -c ./lean_packages/mathlib/build/ir/Mathlib/Tactic/RestateAxiom.c</span>
<span class="n">error</span><span class="o">:</span> <span class="n">stdout</span><span class="o">:</span>
<span class="bp">./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/././</span><span class="n">Mathlib</span><span class="bp">/</span><span class="n">Util</span><span class="bp">/</span><span class="n">LibraryNote.lean</span><span class="o">:</span><span class="mi">27</span><span class="o">:</span><span class="mi">40</span><span class="o">:</span> <span class="n">error</span><span class="o">:</span> <span class="n">invalid</span> <span class="n">field</span> <span class="bp">'</span><span class="n">isStrLit</span><span class="bp">?'</span><span class="o">,</span> <span class="n">the</span> <span class="n">environment</span> <span class="n">does</span> <span class="n">not</span> <span class="n">contain</span> <span class="bp">'</span><span class="n">Lean.TSyntax.isStrLit</span><span class="bp">?'</span>
  <span class="n">title</span>
<span class="n">has</span> <span class="n">type</span>
  <span class="n">TSyntax</span> <span class="bp">`</span><span class="n">str</span>
<span class="n">error</span><span class="o">:</span> <span class="n">external</span> <span class="n">command</span> <span class="bp">/</span><span class="n">home</span><span class="bp">/</span><span class="n">javra</span><span class="bp">/.</span><span class="n">elan</span><span class="bp">/</span><span class="n">toolchains</span><span class="bp">/</span><span class="n">leanprover</span><span class="c1">--lean4---nightly-2022-07-12/bin/lean exited with status 1</span>
</code></pre></div>



<a name="289650943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289650943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289650943">(Jul 14 2022 at 21:17)</a>:</h4>
<p>What are the dependencies of those packages? Are they all using the same toolchain?</p>



<a name="289655279"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289655279" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289655279">(Jul 14 2022 at 21:59)</a>:</h4>
<p>No, mathlib4 uses 07-12 and mathlib3port uses 06-13, so there might be some real incompatibility to the current lean <span aria-label="disappointed" class="emoji emoji-1f61e" role="img" title="disappointed">:disappointed:</span></p>



<a name="289658979"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289658979" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arthur Paulino <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289658979">(Jul 14 2022 at 22:35)</a>:</h4>
<p>You could try to find an older mathlib4 commit that uses that same toolchain, or something close enough to avoid conflicts</p>



<a name="289661724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289661724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289661724">(Jul 14 2022 at 23:02)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110789">Jakob von Raumer</span> <a href="#narrow/stream/287929-mathlib4/topic/using.20binport.20only/near/289655279">said</a>:</p>
<blockquote>
<p>No, mathlib4 uses 07-12 and mathlib3port uses 06-13, so there might be some real incompatibility to the current lean <span aria-label="disappointed" class="emoji emoji-1f61e" role="img" title="disappointed">:disappointed:</span></p>
</blockquote>
<p>Yeah, you should be using the 06-13 nightly if you want to use Mathbin</p>



<a name="289661856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289661856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289661856">(Jul 14 2022 at 23:04)</a>:</h4>
<p>You don't need to figure out what mathlib it requires, mathbin already specifies that. Simply <code>require</code>'ing <code>mathlib3port</code> and importing <code>Mathlib</code> should be enough.</p>



<a name="289694070"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289694070" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jakob von Raumer <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289694070">(Jul 15 2022 at 07:22)</a>:</h4>
<p>Rest of the project needs <code>TSyntax</code> unfortunately, so I'll have to wait for the lean version bump (or do it myself <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span> )</p>



<a name="289696238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/289696238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#289696238">(Jul 15 2022 at 07:54)</a>:</h4>
<p>Yes, the Lean version needs to match exactly.  The mathport releases contain the oleans after all.  It's already a wonder if the source code compiles with two different Lean versions, binary compatibility is pretty much a lost cause.</p>



<a name="300929618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300929618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300929618">(Sep 27 2022 at 02:47)</a>:</h4>
<p>I have the same goal (use just binported mathlib files in a lean 4 project) and I'm also running into a bit of a wall with this.  I've tried <code>lake update</code> and <code>lake build</code>, but upon having <code>import Mathlib</code> in my project, I get a very long error:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Long Error</p>
</div><div class="spoiler-content" aria-hidden="true">
<p><code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/bin/lake print-paths Init Mathlib</code> failed:</p>
<p>stderr:<br>
info: Building Mathlib.Tactic.Alias<br>
info: Building Mathlib.Tactic.Substs<br>
info: Building Mathlib.Tactic.RestateAxiom<br>
info: Building Std.Tactic.Lint.Simp<br>
error: &gt; LEAN_PATH=./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib DYLD_LIBRARY_PATH=/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/lib:./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib:./lean_packages/std/build/lib /Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/bin/lean -DwarningAsError=true -Dlinter.missingDocs=true ./lean_packages/std/././Std/Tactic/Lint/Simp.lean -R ./lean_packages/std/./. -o ./lean_packages/std/build/lib/Std/Tactic/Lint/Simp.olean -i ./lean_packages/std/build/lib/Std/Tactic/Lint/Simp.ilean -c ./lean_packages/std/build/ir/Std/Tactic/Lint/Simp.c<br>
error: stdout:<br>
./lean_packages/std/././Std/Tactic/Lint/Simp.lean:75:50: error: invalid dotted identifier notation, unknown identifier <code>Lean.Name.decl</code> from expected type<br>
  Name<br>
./lean_packages/std/././Std/Tactic/Lint/Simp.lean:95:30: error: unknown identifier 'Simp.UsedSimps'<br>
./lean_packages/std/././Std/Tactic/Lint/Simp.lean:98:2: error: failed to construct 'ForIn' instance for collection<br>
  ?m.27516 usedSimps env<br>
and monad<br>
  ReaderT Context (StateRefT' IO.RealWorld State CoreM)<br>
./lean_packages/std/././Std/Tactic/Lint/Simp.lean:115:8: error: type mismatch<br>
  (?m.28258, prf1_lems)<br>
has type<br>
  ?m.28256 × ?m.28252 : Type (max ?u.28255 ?u.28254)<br>
but is expected to have type<br>
  Simp.Result : Type<br>
error: external command <code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/bin/lean</code> exited with code 1<br>
error: &gt; LEAN_PATH=./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib DYLD_LIBRARY_PATH=/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/lib:./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib:./lean_packages/mathlib/build/lib /Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/bin/lean ./lean_packages/mathlib/././Mathlib/Tactic/Substs.lean -R ./lean_packages/mathlib/./. -o ./lean_packages/mathlib/build/lib/Mathlib/Tactic/Substs.olean -i ./lean_packages/mathlib/build/lib/Mathlib/Tactic/Substs.ilean -c ./lean_packages/mathlib/build/ir/Mathlib/Tactic/Substs.c<br>
error: stdout:<br>
./lean_packages/mathlib/././Mathlib/Tactic/Substs.lean:18:45: error: expected '(', ']', '_', 'decide', 'intro', 'match', 'native_decide', 'open', 'set_option', '{' or identifier<br>
error: external command <code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/bin/lean</code> exited with code 1<br>
error: &gt; LEAN_PATH=./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib DYLD_LIBRARY_PATH=/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/lib:./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib:./lean_packages/mathlib/build/lib /Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/bin/lean ./lean_packages/mathlib/././Mathlib/Tactic/RestateAxiom.lean -R ./lean_packages/mathlib/./. -o ./lean_packages/mathlib/build/lib/Mathlib/Tactic/RestateAxiom.olean -i ./lean_packages/mathlib/build/lib/Mathlib/Tactic/RestateAxiom.ilean -c ./lean_packages/mathlib/build/ir/Mathlib/Tactic/RestateAxiom.c<br>
error: stdout:<br>
./lean_packages/mathlib/././Mathlib/Tactic/RestateAxiom.lean:58:4: error: type mismatch<br>
  addAndCompile<br>
    (Declaration.defnDecl<br>
      { toConstantVal :=<br>
          { name := newName, levelParams := info.toConstantVal.levelParams, type := info.toConstantVal.type },<br>
        value := info.value, hints := info.hints, safety := <a href="http://info.safety">info.safety</a>, all := info.all })<br>
has type<br>
  CoreM Unit : Type<br>
but is expected to have type<br>
  CommandElabM Unit : Type<br>
error: external command <code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/bin/lean</code> exited with code 1<br>
error: &gt; LEAN_PATH=./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib DYLD_LIBRARY_PATH=/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/lib:./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib:./lean_packages/mathlib/build/lib /Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/bin/lean ./lean_packages/mathlib/././Mathlib/Tactic/Alias.lean -R ./lean_packages/mathlib/./. -o ./lean_packages/mathlib/build/lib/Mathlib/Tactic/Alias.olean -i ./lean_packages/mathlib/build/lib/Mathlib/Tactic/Alias.ilean -c ./lean_packages/mathlib/build/ir/Mathlib/Tactic/Alias.c<br>
error: stdout:<br>
./lean_packages/mathlib/././Mathlib/Tactic/Alias.lean:96:4: error: application type mismatch<br>
  bind (addDecl decl)<br>
argument<br>
  addDecl decl<br>
has type<br>
  CoreM Unit : Type<br>
but is expected to have type<br>
  Elab.Command.CommandElabM PUnit : Type<br>
./lean_packages/mathlib/././Mathlib/Tactic/Alias.lean:77:27: error: (kernel) declaration has metavariables 'Tactic.Alias.elabAlias'<br>
error: external command <code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/bin/lean</code> exited with code 1</p>
</div></div>
<p>Any idea what could be going on? I have <code>require mathlib3port from git
  "https://github.com/leanprover-community/mathlib3port"</code> in my lakefile, and <code>import Mathlib</code> at the top of my top-level project-named lean file. (I'm not sure if I'm structuring that correctly; just starting out with lean!)</p>
<p>And <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> , when you say the lean version needs to match, do you mean that the lean version specified in the <code>leanpkg.toml</code> file needs to match the version used by <code>mathlib3port</code>?</p>



<a name="300931362"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300931362" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300931362">(Sep 27 2022 at 03:14)</a>:</h4>
<p>Yeah that looks like a version mismatch.</p>



<a name="300932022"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300932022" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300932022">(Sep 27 2022 at 03:24)</a>:</h4>
<p>Ok, thanks! I'm actually having a bit of trouble fixing it, though. <a href="https://limperg.de/posts/2021-05-31-lean4-project.html">This</a> suggests I use <code>leanpkg configure</code>, but I get the following error:</p>
<p>error: toolchain 'leanprover/lean4:nightly-2022-09-25' does not have the binary <code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-25/bin/leanpkg</code></p>
<p>Perhaps I've chosen the wrong <code>lean_version</code> string (which I've naively set to <code>"leanprover/lean4:nightly-2022-09-13"</code>)...?</p>



<a name="300932549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300932549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300932549">(Sep 27 2022 at 03:32)</a>:</h4>
<p>Leanpkg is long obsolete. I'd try the following:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">rm</span> <span class="bp">-</span><span class="n">rf</span> <span class="n">lean_packages</span>
<span class="n">lake</span> <span class="n">update</span>
<span class="n">cp</span> <span class="n">lean_packages</span><span class="bp">/</span><span class="n">mathlib</span><span class="bp">/</span><span class="n">lean</span><span class="bp">-</span><span class="n">toolchain</span> <span class="bp">.</span>
</code></pre></div>



<a name="300933095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933095">(Sep 27 2022 at 03:41)</a>:</h4>
<p>Hmm, thanks, that definitely did something! Now, with <code>"leanprover/lean4:nightly-2022-09-13"</code> as my <code>lean_version</code>, I get an error starting with "<code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lake print-paths Init Mathlib</code> failed" instead, which I'll count as progress. Do you know how I might find the correct version to use here?</p>



<a name="300933173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933173">(Sep 27 2022 at 03:42)</a>:</h4>
<p>what is this <code>lean_version</code> field? AFAIK lake doesn't use that, it uses a <code>lean-toolchain</code> file at the root</p>



<a name="300933215"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933215" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933215">(Sep 27 2022 at 03:43)</a>:</h4>
<p>you should use the same <code>lean-toolchain</code> version present in the version of mathlib4 you are using</p>



<a name="300933321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933321">(Sep 27 2022 at 03:45)</a>:</h4>
<p>Oh, maybe that's my problem. The <code>lean_version</code> field is in <code>leanpkg.toml</code>. Is that whole file obselete/unneeded now? (I may have been following an out-of-date guide...)</p>



<a name="300933326"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933326" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933326">(Sep 27 2022 at 03:45)</a>:</h4>
<p>the whole file is unused</p>



<a name="300933331"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933331" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933331">(Sep 27 2022 at 03:45)</a>:</h4>
<p>gotcha, thanks!</p>



<a name="300933337"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933337" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933337">(Sep 27 2022 at 03:45)</a>:</h4>
<p>let's see if the <code>lean-toolchain</code> thing works...</p>



<a name="300933339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933339">(Sep 27 2022 at 03:45)</a>:</h4>
<p>lake gets its data from <code>lakefile.lean</code> and <code>lean-toolchain</code></p>



<a name="300933673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933673">(Sep 27 2022 at 03:51)</a>:</h4>
<p>Ok, it looks like my <code>leantoolchain</code> matches <code>mathlib3port</code>'s toolchain (<code>leanprover/lean4:nightly-2022-09-11</code>) but I'm still getting what seems to me to be basically the same message. Here it is again in case it's slightly different:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Long Error</p>
</div><div class="spoiler-content" aria-hidden="true">
<p><code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lake print-paths Init Mathlib</code> failed:</p>
<p>stderr:<br>
info: Building Std.Tactic.OpenPrivate<br>
info: Building Std.Tactic.GuardExpr<br>
info: Building Std.Tactic.ByCases<br>
info: Building Std.Lean.Meta<br>
info: Building Std.Lean.Tactic<br>
info: Building Std.Classes.Dvd<br>
info: Building Std.Util.TermUnsafe<br>
info: Building Std.Lean.NameMapAttribute<br>
info: Building Mathlib.Init.Data.Nat.Basic<br>
info: Building Std.Lean.Command<br>
info: Building Std.Tactic.HaveI<br>
info: Building Std.Data.List.Init.Lemmas<br>
info: Building Std.Tactic.RCases<br>
info: Building Std.Data.Option.Init.Lemmas<br>
info: Building Std.Util.ExtendedBinder<br>
info: Building Std.Lean.Parser<br>
info: Building Mathlib.Tactic.Alias<br>
info: Building Std.Tactic.CoeExt<br>
info: Building Std.Data.DList<br>
info: Building Std.Tactic.TryThis<br>
error: &gt; LEAN_PATH=./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib DYLD_LIBRARY_PATH=/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/lib:./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib:./lean_packages/std/build/lib /Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lean -DwarningAsError=true -Dlinter.missingDocs=true ./lean_packages/std/././Std/Tactic/ByCases.lean -R ./lean_packages/std/./. -o ./lean_packages/std/build/lib/Std/Tactic/ByCases.olean -i ./lean_packages/std/build/lib/Std/Tactic/ByCases.ilean -c ./lean_packages/std/build/ir/Std/Tactic/ByCases.c<br>
error: stdout:<br>
./lean_packages/std/././Std/Tactic/ByCases.lean:79:61: error: application type mismatch<br>
  h.raw<br>
argument<br>
  h<br>
has type<br>
  TSyntax <code>Lean.binderIdent : Type
but is expected to have type
  TSyntax </code>ident : Type<br>
error: external command <code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lean</code> exited with code 1<br>
info: Building Std.Util.LibraryNote<br>
info: Building Mathlib.Init.Data.Int.Notation<br>
error: &gt; LEAN_PATH=./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib DYLD_LIBRARY_PATH=/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/lib:./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib:./lean_packages/std/build/lib /Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lean -DwarningAsError=true -Dlinter.missingDocs=true ./lean_packages/std/././Std/Tactic/CoeExt.lean -R ./lean_packages/std/./. -o ./lean_packages/std/build/lib/Std/Tactic/CoeExt.olean -i ./lean_packages/std/build/lib/Std/Tactic/CoeExt.ilean -c ./lean_packages/std/build/ir/Std/Tactic/CoeExt.c<br>
error: stdout:<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:14:2: error: expected 'abbrev', 'add_decl_doc', 'axiom', 'builtin_initialize', 'class', 'declare_simp_like_tactic', 'declare_syntax_cat', 'def', 'elab', 'elab_rules', 'example', 'inductive', 'infix', 'infixl', 'infixr', 'initialize', 'instance', 'macro', 'macro_rules', 'notation', 'opaque', 'postfix', 'prefix', 'register_builtin_option', 'register_option', 'register_simp_attr', 'structure', 'syntax', 'theorem' or 'unif_hint'<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:16:2: error: expected 'abbrev', 'add_decl_doc', 'axiom', 'builtin_initialize', 'class', 'declare_simp_like_tactic', 'declare_syntax_cat', 'def', 'elab', 'elab_rules', 'example', 'inductive', 'infix', 'infixl', 'infixr', 'initialize', 'instance', 'macro', 'macro_rules', 'notation', 'opaque', 'postfix', 'prefix', 'register_builtin_option', 'register_option', 'register_simp_attr', 'structure', 'syntax', 'theorem' or 'unif_hint'<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:18:2: error: expected 'abbrev', 'add_decl_doc', 'axiom', 'builtin_initialize', 'class', 'declare_simp_like_tactic', 'declare_syntax_cat', 'def', 'elab', 'elab_rules', 'example', 'inductive', 'infix', 'infixl', 'infixr', 'initialize', 'instance', 'macro', 'macro_rules', 'notation', 'opaque', 'postfix', 'prefix', 'register_builtin_option', 'register_option', 'register_simp_attr', 'structure', 'syntax', 'theorem' or 'unif_hint'<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:19:11: error: expected 'instance'<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:24:23: error: unknown constant '_root_.coe'<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:25:26: error: unknown constant '_root_.coeFun'<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:26:27: error: unknown constant '_root_.coeSort'<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:25:4: error: redundant alternative<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:26:4: error: redundant alternative<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:36:11: error: failed to generate 'Inhabited' instance for 'Tactic.NormCast.CoeFnInfo'<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:42:0: error: failed to synthesize<br>
  Inhabited (SimpleScopedEnvExtension (Name × CoeFnInfo) (NameMap CoeFnInfo))<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:63:4: error: invalid pattern variable, must be atomic<br>
./lean_packages/std/././Std/Tactic/CoeExt.lean:97:79: error: invalid dotted identifier notation, unknown identifier <code>Tactic.NormCast.CoeFnType.coe</code> from expected type<br>
  CoeFnType<br>
error: external command <code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lean</code> exited with code 1<br>
info: Building Mathlib.Init.Zero<br>
info: Building Mathlib.Tactic.Spread<br>
info: Building Mathlib.Init.Function<br>
info: Building Mathlib.Init.Data.Option.Basic<br>
info: Building Mathlib.Init.Data.Option.Instances<br>
info: Building Mathlib.Lean.Expr.Basic<br>
info: Building Mathlib.Util.MemoFix<br>
info: Building Mathlib.Tactic.Coe<br>
info: Building Mathlib.Data.Char<br>
error: &gt; LEAN_PATH=./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib DYLD_LIBRARY_PATH=/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/lib:./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib:./lean_packages/std/build/lib /Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lean -DwarningAsError=true -Dlinter.missingDocs=true ./lean_packages/std/././Std/Tactic/GuardExpr.lean -R ./lean_packages/std/./. -o ./lean_packages/std/build/lib/Std/Tactic/GuardExpr.olean -i ./lean_packages/std/build/lib/Std/Tactic/GuardExpr.ilean -c ./lean_packages/std/build/ir/Std/Tactic/GuardExpr.c<br>
error: stdout:<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:19:0: error: expected 'abbrev', 'add_decl_doc', 'axiom', 'builtin_initialize', 'class', 'declare_simp_like_tactic', 'declare_syntax_cat', 'def', 'elab', 'elab_rules', 'example', 'inductive', 'infix', 'infixl', 'infixr', 'initialize', 'instance', 'macro', 'macro_rules', 'notation', 'opaque', 'postfix', 'prefix', 'register_builtin_option', 'register_option', 'register_simp_attr', 'structure', 'syntax', 'theorem' or 'unif_hint'<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:21:0: error: expected 'abbrev', 'add_decl_doc', 'axiom', 'builtin_initialize', 'class', 'declare_simp_like_tactic', 'declare_syntax_cat', 'def', 'elab', 'elab_rules', 'example', 'inductive', 'infix', 'infixl', 'infixr', 'initialize', 'instance', 'macro', 'macro_rules', 'notation', 'opaque', 'postfix', 'prefix', 'register_builtin_option', 'register_option', 'register_simp_attr', 'structure', 'syntax', 'theorem' or 'unif_hint'<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:23:0: error: expected 'abbrev', 'add_decl_doc', 'axiom', 'builtin_initialize', 'class', 'declare_simp_like_tactic', 'declare_syntax_cat', 'def', 'elab', 'elab_rules', 'example', 'inductive', 'infix', 'infixl', 'infixr', 'initialize', 'instance', 'macro', 'macro_rules', 'notation', 'opaque', 'postfix', 'prefix', 'register_builtin_option', 'register_option', 'register_simp_attr', 'structure', 'syntax', 'theorem' or 'unif_hint'<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:50:24: error: invalid dotted identifier notation, unknown identifier <code>Std.Tactic.GuardExpr.MatchKind.syntactic</code> from expected type<br>
  MatchKind<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:51:25: error: invalid dotted identifier notation, unknown identifier <code>Std.Tactic.GuardExpr.MatchKind.alphaEq</code> from expected type<br>
  MatchKind<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:56:27: error: invalid dotted identifier notation, unknown identifier <code>Std.Tactic.GuardExpr.MatchKind.syntactic</code> from expected type<br>
  MatchKind<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:57:28: error: invalid dotted identifier notation, unknown identifier <code>Std.Tactic.GuardExpr.MatchKind.alphaEq</code> from expected type<br>
  MatchKind<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:62:24: error: invalid dotted identifier notation, unknown identifier <code>Std.Tactic.GuardExpr.MatchKind.defEq</code> from expected type<br>
  MatchKind<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:63:25: error: invalid dotted identifier notation, unknown identifier <code>Std.Tactic.GuardExpr.MatchKind.syntactic</code> from expected type<br>
  MatchKind<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:64:25: error: invalid dotted identifier notation, unknown identifier <code>Std.Tactic.GuardExpr.MatchKind.alphaEq</code> from expected type<br>
  MatchKind<br>
./lean_packages/std/././Std/Tactic/GuardExpr.lean:69:4: error: invalid dotted identifier notation, unknown identifier <code>Std.Tactic.GuardExpr.MatchKind.syntactic</code> from expected type<br>
  MatchKind</p>
</div></div>



<a name="300933726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933726">(Sep 27 2022 at 03:52)</a>:</h4>
<p>Somehow the error got much longer, so that's just a sample. I suppose it must be a different error, on some level...</p>



<a name="300933783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933783">(Sep 27 2022 at 03:53)</a>:</h4>
<p>mathlib4, not mathlib3port</p>



<a name="300933802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933802">(Sep 27 2022 at 03:53)</a>:</h4>
<p>what's in your <code>lean_packages/manifest.json</code> file?</p>



<a name="300933868"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933868" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933868">(Sep 27 2022 at 03:54)</a>:</h4>
<p>Oh, ok, an earlier message suggested this: "simply <code>require</code>'ing mathlib3port and importing Mathlib should be enough" so that's what I was going off of!</p>



<a name="300933873"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933873" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933873">(Sep 27 2022 at 03:54)</a>:</h4>
<p>Let's find out...</p>



<a name="300933951"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300933951" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300933951">(Sep 27 2022 at 03:55)</a>:</h4>
<p>Here it is:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>manifest.json</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>{"version": 2,<br>
 "packages":<br>
 [{"url": "<a href="https://github.com/mhuisi/lean4-cli">https://github.com/mhuisi/lean4-cli</a>",<br>
   "rev": "112b35fc348a4a18d2111ac2c6586163330b4941",<br>
   "name": "Cli"},<br>
  {"url": "<a href="https://github.com/hargonix/LeanInk">https://github.com/hargonix/LeanInk</a>",<br>
   "rev": "439303af06465824588a486f5f9c023ca69979f3",<br>
   "name": "leanInk"},<br>
  {"url": "<a href="https://github.com/leanprover-community/mathlib3port">https://github.com/leanprover-community/mathlib3port</a>",<br>
   "rev": "9d2aa54216553f283e6efe011d4aa71cae0abd50",<br>
   "name": "mathlib3port"},<br>
  {"url": "<a href="https://github.com/leanprover/doc-gen4">https://github.com/leanprover/doc-gen4</a>",<br>
   "rev": "a2345380e861332fabecc61591cb274e61163a97",<br>
   "name": "doc-gen4",<br>
   "inputRev": "main"},<br>
  {"url": "<a href="https://github.com/xubaiw/Unicode.lean">https://github.com/xubaiw/Unicode.lean</a>",<br>
   "rev": "25b32ef69fd6d8ae34300d51dc0b9403ffb1fd29",<br>
   "name": "Unicode"},<br>
  {"url": "<a href="https://github.com/leanprover-community/mathlib4.git">https://github.com/leanprover-community/mathlib4.git</a>",<br>
   "rev": "dd1ecc5d3aefab6a83767079c7d020f4aa254a24",<br>
   "name": "mathlib",<br>
   "inputRev": "dd1ecc5d3aefab6a83767079c7d020f4aa254a24"},<br>
  {"url": "<a href="https://github.com/leanprover-community/lean3port.git">https://github.com/leanprover-community/lean3port.git</a>",<br>
   "rev": "b73dfeb9e288603ef280d4ccf8dd8d3af7b244fc",<br>
   "name": "lean3port",<br>
   "inputRev": "b73dfeb9e288603ef280d4ccf8dd8d3af7b244fc"},<br>
  {"url": "<a href="https://github.com/leanprover/std4">https://github.com/leanprover/std4</a>",<br>
   "rev": "52c2324923b7f83e4e9b82ca9c8284f7a86bd3e8",<br>
   "name": "std",<br>
   "inputRev": "main"},<br>
  {"url": "<a href="https://github.com/leanprover/lake">https://github.com/leanprover/lake</a>",<br>
   "rev": "6cfb4e3fd7ff700ace8c2cfdb85056d59f321920",<br>
   "name": "lake"},<br>
  {"url": "<a href="https://github.com/xubaiw/CMark.lean">https://github.com/xubaiw/CMark.lean</a>",<br>
   "rev": "8c0f9c1b16ee8047813f43b1f92de471782114ff",<br>
   "name": "CMark"}]}</p>
</div></div>



<a name="300934071"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934071" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934071">(Sep 27 2022 at 03:57)</a>:</h4>
<p>You have the latest commit of <code>std4</code> there, which is on 09-26, so I don't think it will play well with mathlib3port from 09-11</p>



<a name="300934132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934132">(Sep 27 2022 at 03:58)</a>:</h4>
<p>Hmm, that's strange. I did just <code>rm -rf</code> this.</p>



<a name="300934143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934143">(Sep 27 2022 at 03:58)</a>:</h4>
<p>well mathlib3port hasn't been released in a while</p>



<a name="300934149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934149">(Sep 27 2022 at 03:58)</a>:</h4>
<p>so it's probably not your fault</p>



<a name="300934252"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934252" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934252">(Sep 27 2022 at 04:00)</a>:</h4>
<p>Huh, ok. Is <code>std</code> coming...via <code>mathlip3port</code>, so to speak? Or from somewhere else? Is there any way to force it to play nice?</p>



<a name="300934281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934281">(Sep 27 2022 at 04:00)</a>:</h4>
<p>lean4 -&gt; std4 -&gt; mathlib4 -&gt; mathlib3port</p>



<a name="300934294"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934294" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934294">(Sep 27 2022 at 04:00)</a>:</h4>
<p>I see</p>



<a name="300934310"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934310" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934310">(Sep 27 2022 at 04:01)</a>:</h4>
<p>I think you are likely to have best results using the 09-26 nightly</p>



<a name="300934319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934319">(Sep 27 2022 at 04:01)</a>:</h4>
<p>I would have thought using a <code>2022-9-11</code> lean toolchain would have prevented that, though?</p>



<a name="300934321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934321">(Sep 27 2022 at 04:01)</a>:</h4>
<p>since mathlib3port doesn't make much use of lean features</p>



<a name="300934347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934347">(Sep 27 2022 at 04:02)</a>:</h4>
<p>Ok, that's what I started with—but then is there a way to make it work with mathlib binaries?</p>



<a name="300934368"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934368" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934368">(Sep 27 2022 at 04:02)</a>:</h4>
<p>building std4 on 09-11 is not going to work, it uses features from the future</p>



<a name="300934428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934428">(Sep 27 2022 at 04:02)</a>:</h4>
<p>the alternative is to check out an old version of the dependencies, that is, use whatever version there was on 09-11</p>



<a name="300934462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934462">(Sep 27 2022 at 04:03)</a>:</h4>
<p>I think that's what I'd like to do if it's the only way to use the mathlib binaries—if there's another way I'm all ears though</p>



<a name="300934521"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934521" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934521">(Sep 27 2022 at 04:04)</a>:</h4>
<p>std4 -&gt; 6488a2afeb62fb4c781d26d629796480c8270b2f<br>
mathlib4 -&gt; dd1ecc5d3aefab6a83767079c7d020f4aa254a24</p>



<a name="300934534"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934534" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934534">(Sep 27 2022 at 04:04)</a>:</h4>
<p>put those in your manifest</p>



<a name="300934563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934563">(Sep 27 2022 at 04:05)</a>:</h4>
<p>oo ok great! (Aside: I also would have naively thought specifying a toolchain date would have prevented using features from the future, though. my <code>lean-toolchain</code> is <code>leanprover/lean4:nightly-2022-09-11</code>, so I'd expect it to only use things from then or earlier in the "lean4 -&gt;" stage.)</p>



<a name="300934577"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934577" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934577">(Sep 27 2022 at 04:05)</a>:</h4>
<p>yeah, lake isn't very good at managing the lean toolchain version</p>



<a name="300934625"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934625" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934625">(Sep 27 2022 at 04:06)</a>:</h4>
<p>it just uses whatever you specify and hopes for the best</p>



<a name="300934636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934636">(Sep 27 2022 at 04:06)</a>:</h4>
<p>ah gotcha lol</p>



<a name="300934639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934639">(Sep 27 2022 at 04:06)</a>:</h4>
<p>Ok, is it <code>lake update</code> now?</p>



<a name="300934647"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934647" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934647">(Sep 27 2022 at 04:07)</a>:</h4>
<p>Asking for the versions to match exactly is also problematic though, because there's a new version every day and maintainers can't keep up with  that pace</p>



<a name="300934667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934667">(Sep 27 2022 at 04:07)</a>:</h4>
<p>most of the time whatever changes there were are not relevant to the library</p>



<a name="300934674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934674">(Sep 27 2022 at 04:07)</a>:</h4>
<p><code>lake update</code> will update the manifest to the latest version of everything, which will undo the work you just did</p>



<a name="300934724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300934724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300934724">(Sep 27 2022 at 04:08)</a>:</h4>
<p>ah! I understand now haha</p>



<a name="300935078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300935078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300935078">(Sep 27 2022 at 04:14)</a>:</h4>
<p>ok, I've tried deleting everything but the manifest and rebuilding, but now it doesn't like any of the imports in <code>lean_packages/std/Std.lean</code> either...hmmm</p>



<a name="300935183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300935183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300935183">(Sep 27 2022 at 04:16)</a>:</h4>
<p>hmm, the <code>lean_packages/std/lean-toolchain</code> is still the <code>9-26</code> nightly build</p>



<a name="300935241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300935241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300935241">(Sep 27 2022 at 04:18)</a>:</h4>
<p>(and as far as I can tell no update has taken place; <code>6488a2afeb62fb4c781d26d629796480c8270b2f</code> is still in the manifest)</p>



<a name="300935929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300935929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300935929">(Sep 27 2022 at 04:30)</a>:</h4>
<p>does <code>lake</code> actually <em>use</em> the manifest or is it meant to be more of a record? if it does use it, I'm not sure why this isn't working...hmmm. perhaps this can be fixed by fixing <code>lake</code> somehow...I'm going to investigate tomorrow :) (I also wonder if people would agree that this needs to be fixed in <code>lake</code>. my argument would be that the point of having versioned toolchains is to prevent breaking changes like this! :) )</p>



<a name="300936516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300936516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300936516">(Sep 27 2022 at 04:39)</a>:</h4>
<p>anyway thanks to both of you for all of your help so far! :) I’m not giving up…we’ll figure this out eventually!</p>



<a name="300937605"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300937605" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300937605">(Sep 27 2022 at 04:54)</a>:</h4>
<p>There is some ongoing discussion (<a href="#narrow/stream/270676-lean4/topic/.22Perfect.20world.22.20dependency.20management">here</a> and <a href="#narrow/stream/270676-lean4/topic/doc-gen4.20broken">here</a>) about precisely this issue... the answer isn't straightforward</p>



<a name="300937626"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300937626" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300937626">(Sep 27 2022 at 04:55)</a>:</h4>
<p>lake checks out the commit in the manifest first thing when you run <code>lake build</code>, at least in my experience</p>



<a name="300937690"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300937690" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300937690">(Sep 27 2022 at 04:55)</a>:</h4>
<p>but one way to be sure is to copy the manifest file, delete the <code>lean_packages</code> folder entirely, restore the manifest and call <code>lake build</code></p>



<a name="300937803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300937803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300937803">(Sep 27 2022 at 04:57)</a>:</h4>
<p>(that file should really not be in the <code>lean_packages</code> folder)</p>



<a name="300937809"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/300937809" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> James Gallicchio <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#300937809">(Sep 27 2022 at 04:57)</a>:</h4>
<p>I'm not even confident that's the case, given how I'm now observing <a href="#narrow/stream/270676-lean4/topic/lake.20build.20updating.20manifest.3F">lake changing my manifest without me asking it to</a>. Just haven't had time to investigate why</p>



<a name="301154813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301154813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301154813">(Sep 28 2022 at 03:53)</a>:</h4>
<blockquote>
<p>but one way to be sure is to copy the manifest file, delete the lean_packages folder entirely, restore the manifest and call lake build</p>
</blockquote>
<p>Hmm...I moved the modified <code>manifest.json</code> to the top level of the project and <code>rm -rf</code>'d <code>lean_packages</code> and <code>build</code>, then called <code>lake build</code>. This generated a new manifest inside the created <code>lean_packages</code>, and still used a <code>std</code> that had a <code>9-26</code> toolchain, unfortunately :/</p>



<a name="301155407"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155407" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155407">(Sep 28 2022 at 04:03)</a>:</h4>
<p>you have to restore the manifest before calling <code>lake build</code></p>



<a name="301155419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155419">(Sep 28 2022 at 04:03)</a>:</h4>
<p>what does it mean to restore a manifest?</p>



<a name="301155422"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155422" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155422">(Sep 28 2022 at 04:03)</a>:</h4>
<p>put the file you copied back where it was</p>



<a name="301155426"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155426" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155426">(Sep 28 2022 at 04:03)</a>:</h4>
<p>it was in <code>lean_packages</code>, though</p>



<a name="301155445"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155445" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155445">(Sep 28 2022 at 04:04)</a>:</h4>
<p>so that nuking the lean_packages folder doesn't also nuke your changes</p>



<a name="301155518"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155518" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155518">(Sep 28 2022 at 04:05)</a>:</h4>
<p>That is, you want to delete everything in <code>lean_packages</code> <em>except</em> the manifest that is the only record that you are interested in something other than the latest version</p>



<a name="301155585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155585">(Sep 28 2022 at 04:06)</a>:</h4>
<p>right, ok; I had tried that last night already, as it happens</p>



<a name="301155592"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155592" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155592">(Sep 28 2022 at 04:06)</a>:</h4>
<p>what I hadn't tried was keeping it outside the folder</p>



<a name="301155623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155623">(Sep 28 2022 at 04:07)</a>:</h4>
<p>if you run <code>lake build</code> with a <code>lean_packages</code> folder that only has the modified manifest in it and nothing else, in my experience lake will respect it and download the right versions</p>



<a name="301155624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155624">(Sep 28 2022 at 04:07)</a>:</h4>
<p>I did find something weird playing around (well, weird since I don't know what it means, lol): changing <code>inputRev</code> in the manifest seems to successfully change the <code>std</code> that gets cloned to one with a <code>9-11</code> toolchain</p>



<a name="301155639"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155639" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155639">(Sep 28 2022 at 04:07)</a>:</h4>
<p>gotcha; I just tried it again, and unfortunately deleting everything but the manifest in <code>lean_packages</code> didn't work :/</p>



<a name="301155710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155710">(Sep 28 2022 at 04:08)</a>:</h4>
<p>I usually update the <code>"rev"</code> field, this should make lake download the version</p>



<a name="301155721"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155721" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155721">(Sep 28 2022 at 04:09)</a>:</h4>
<p>Yeah, that's what I had been trying already</p>



<a name="301155731"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155731" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155731">(Sep 28 2022 at 04:09)</a>:</h4>
<p>(which wasn't working, so I tried changing the <code>inputRev</code> as well)</p>



<a name="301155732"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155732" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155732">(Sep 28 2022 at 04:09)</a>:</h4>
<p>and it's updating the rev?</p>



<a name="301155824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155824">(Sep 28 2022 at 04:10)</a>:</h4>
<p>so to be clear, if this is in my manifest</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="o">{</span><span class="s2">"url"</span><span class="o">:</span> <span class="s2">"https://github.com/leanprover/std4"</span><span class="o">,</span>
   <span class="s2">"rev"</span><span class="o">:</span> <span class="s2">"6488a2afeb62fb4c781d26d629796480c8270b2f"</span><span class="o">,</span>
   <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"std"</span><span class="o">,</span>
   <span class="s2">"inputRev"</span><span class="o">:</span> <span class="s2">"main"</span><span class="o">}</span>
</code></pre></div>
<p>it doesn't work; clones a version of <code>std</code> with <code>lean-toolchain</code> <code>leanprover/lean4:nightly-2022-09-26</code>, which isn't consistent with rev <code>6488a2afeb62fb4c781d26d629796480c8270b2f</code> of <code>std</code> on github.</p>



<a name="301155918"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155918" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155918">(Sep 28 2022 at 04:12)</a>:</h4>
<p>It is downloading <code>6488a2</code> though?</p>



<a name="301155935"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155935" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155935">(Sep 28 2022 at 04:13)</a>:</h4>
<p>no, it's not; if it were, the <code>lean-toolchain</code> in <code>std</code> ould be for <code>9-11</code></p>



<a name="301155943"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155943" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155943">(Sep 28 2022 at 04:13)</a>:</h4>
<p>what version is it?</p>



<a name="301155954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301155954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301155954">(Sep 28 2022 at 04:13)</a>:</h4>
<p>it says "downloading version XYZ" when it goes to github</p>



<a name="301156032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156032">(Sep 28 2022 at 04:14)</a>:</h4>
<p>hmm, do I need a verbose option for <code>lake build</code> or something? currently it just says <code>info: cloning https://github.com/leanprover/std4 to ./lean_packages/std</code></p>



<a name="301156049"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156049" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156049">(Sep 28 2022 at 04:15)</a>:</h4>
<p>specifically, I get a message like</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">info</span><span class="o">:</span> <span class="n">updating</span> <span class="bp">./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">std</span> <span class="n">to</span> <span class="n">revision</span> <span class="mi">6488</span><span class="n">a2afeb62fb4c781d26d629796480c8270b2f</span>
</code></pre></div>
<p>when I change the manifest and run <code>lake build</code></p>



<a name="301156055"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156055" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156055">(Sep 28 2022 at 04:15)</a>:</h4>
<p>actually, ok, something else very weird: it updates the manifest without me touching it</p>



<a name="301156091"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156091" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156091">(Sep 28 2022 at 04:15)</a>:</h4>
<p>and you have <code>"inputRev": "main"</code> as well?</p>



<a name="301156095"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156095" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156095">(Sep 28 2022 at 04:15)</a>:</h4>
<p>yes</p>



<a name="301156145"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156145" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156145">(Sep 28 2022 at 04:16)</a>:</h4>
<p>hmmmm</p>



<a name="301156198"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156198" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156198">(Sep 28 2022 at 04:17)</a>:</h4>
<p>oh, no when I delete the directory entirely it doesn't report the revision</p>



<a name="301156224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156224">(Sep 28 2022 at 04:18)</a>:</h4>
<p>but if you go inside <code>lean_packages/std/</code> and run <code>git rev-parse HEAD</code> it will report the revision</p>



<a name="301156289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156289">(Sep 28 2022 at 04:18)</a>:</h4>
<p>hmm yep, that gives me <code>52c2324923b7f83e4e9b82ca9c8284f7a86bd3e8</code></p>



<a name="301156321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156321">(Sep 28 2022 at 04:19)</a>:</h4>
<p>what happens if you <code>git checkout 6488a2afeb62fb4c781d26d629796480c8270b2f</code> and change the manifest to match?</p>



<a name="301156324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156324">(Sep 28 2022 at 04:19)</a>:</h4>
<p>this is really weird</p>



<a name="301156394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156394">(Sep 28 2022 at 04:20)</a>:</h4>
<p>ok VERY strange</p>



<a name="301156423"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156423" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156423">(Sep 28 2022 at 04:21)</a>:</h4>
<p>i successfully checked out:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Previous</span> <span class="n">HEAD</span> <span class="n">position</span> <span class="n">was</span> <span class="mi">52</span><span class="n">c2324</span> <span class="n">feat</span><span class="o">:</span> <span class="n">use</span> <span class="n">simp</span> <span class="n">trace</span> <span class="n">support</span> <span class="k">in</span> <span class="n">simpNF</span> <span class="n">linter</span>
<span class="n">HEAD</span> <span class="n">is</span> <span class="n">now</span> <span class="n">at</span> <span class="mi">6488</span><span class="n">a2a</span> <span class="n">chore</span><span class="o">:</span> <span class="n">update</span> <span class="n">nightly</span> <span class="mi">09</span><span class="bp">-</span><span class="mi">11</span> <span class="o">(</span><span class="bp">#</span><span class="mi">7</span><span class="o">)</span>
</code></pre></div>
<p><code>cd</code>'d back up to the project level, changed the <code>rev</code> in the manifest and made sure to save it; <code>lake build</code> then changed the manifest back as I watched <span aria-label="sweat smile" class="emoji emoji-1f605" role="img" title="sweat smile">:sweat_smile:</span></p>



<a name="301156483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156483">(Sep 28 2022 at 04:22)</a>:</h4>
<p>what's in the <code>lakefile.lean</code>?</p>



<a name="301156503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156503">(Sep 28 2022 at 04:22)</a>:</h4>
<div class="spoiler-block"><div class="spoiler-header">
<p>lakefile.lean</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>import Lake<br>
open Lake DSL</p>
<p>package moonshine</p>
<p>require mathlib3port from git<br>
  "<a href="https://github.com/leanprover-community/mathlib3port">https://github.com/leanprover-community/mathlib3port</a>"</p>
<p>lean_lib Moonshine {<br>
  -- add library configuration options here<br>
}</p>
<p>@[defaultTarget]<br>
lean_exe moonshine {<br>
  root := `Main<br>
}</p>
</div></div>



<a name="301156557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156557" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156557">(Sep 28 2022 at 04:23)</a>:</h4>
<p>(The only thing I changed/added was the <code>require</code> statement)</p>



<a name="301156637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156637">(Sep 28 2022 at 04:24)</a>:</h4>
<p>now, for whatever reason, if I change <code>inputRev</code> (and maybe this is obvious; I don't yet know what <code>inputRev</code> means) I get the messages</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">warning</span><span class="o">:</span> <span class="n">std</span><span class="o">:</span> <span class="n">revision</span> <span class="bp">`</span><span class="mi">6488</span><span class="n">a2afeb62fb4c781d26d629796480c8270b2f</span><span class="bp">`</span> <span class="n">listed</span> <span class="k">in</span> <span class="n">manifest</span> <span class="n">does</span> <span class="n">not</span> <span class="k">match</span> <span class="bp">`</span><span class="n">main</span><span class="bp">`</span> <span class="n">listed</span> <span class="k">in</span> <span class="n">the</span> <span class="n">configuration</span> <span class="n">file</span><span class="bp">;</span> <span class="n">you</span> <span class="n">may</span> <span class="n">wish</span> <span class="n">to</span> <span class="n">run</span> <span class="bp">`</span><span class="n">lake</span> <span class="n">update</span><span class="bp">`</span> <span class="n">to</span> <span class="n">update</span>
<span class="n">info</span><span class="o">:</span> <span class="n">updating</span> <span class="bp">./</span><span class="n">lean_packages</span><span class="bp">/</span><span class="n">std</span> <span class="n">to</span> <span class="n">revision</span> <span class="mi">6488</span><span class="n">a2afeb62fb4c781d26d629796480c8270b2f</span>
</code></pre></div>



<a name="301156832"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156832" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156832">(Sep 28 2022 at 04:25)</a>:</h4>
<p>and then indeed the revision is reported by <code>git rev-parse HEAD </code> as <code>6488a2afeb62fb4c781d26d629796480c8270b2f</code>. however, nothing works this time either, because of the mismatch between the configuration files</p>



<a name="301156916"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156916" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156916">(Sep 28 2022 at 04:26)</a>:</h4>
<p><code>inputRev</code> means the revision specified in the input i.e. in the lakefile</p>



<a name="301156956"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156956" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156956">(Sep 28 2022 at 04:27)</a>:</h4>
<p>because the only thing better than global mutable state is having that state in two places that have to match</p>



<a name="301156963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301156963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301156963">(Sep 28 2022 at 04:27)</a>:</h4>
<p>haha yes</p>



<a name="301157018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301157018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301157018">(Sep 28 2022 at 04:28)</a>:</h4>
<p>so I'm guessing something's up with how <code>lake</code> uses</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[defaultTarget]</span>
<span class="n">lean_exe</span> <span class="n">moonshine</span> <span class="o">{</span>
  <span class="n">root</span> <span class="o">:=</span> <span class="bp">`</span><span class="n">Main</span>
<span class="o">}</span>
</code></pre></div>
<p>?</p>



<a name="301157246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301157246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301157246">(Sep 28 2022 at 04:32)</a>:</h4>
<p>because if I sort of..."disconnect" <code>std</code>'s manifest entry from its <code>inputRev</code>, I don't get the weird behavior. so somehow I'm guessing...if <code>lake build</code> sees <code>main</code>, it decides to update the manifest entry and <code>std</code>, presumably in accordance with something determined by what it saw there, i.e. <code>main</code>?</p>



<a name="301157473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301157473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301157473">(Sep 28 2022 at 04:36)</a>:</h4>
<p>and for whatever it's worth, if i just straight up delete the <code>inputRev</code> key from the <code>std</code> entry in the manifest, I still get an error on <code>import Mathlib</code>, but it's this:</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>Long Error</p>
</div><div class="spoiler-content" aria-hidden="true">
<p><code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lake print-paths Init Mathlib</code> failed:</p>
<p>stderr:<br>
info: Building Mathlib.Init.Data.Nat.Basic<br>
info: Building Mathlib.Tactic.Alias<br>
info: Building Mathlib.Init.Zero<br>
info: Building Mathlib.Tactic.Spread<br>
info: Building Mathlib.Init.Data.Int.Notation<br>
info: Building Mathlib.Init.Function<br>
info: Building Mathlib.Init.Data.Option.Basic<br>
info: Building Mathlib.Init.Data.Option.Instances<br>
info: Building Mathlib.Lean.Expr.Basic<br>
info: Building Mathlib.Util.MemoFix<br>
info: Building Mathlib.Tactic.Coe<br>
info: Building Mathlib.Data.Char<br>
info: Building Mathlib.Lean.Exception<br>
info: Building Mathlib.Lean.LocalContext<br>
info: Building Mathlib.Logic.Equiv.MfldSimpsAttr<br>
info: Building Mathlib.Mathport.Attributes<br>
info: Building Mathlib.Mathport.Rename<br>
info: Building Mathlib.Tactic.Clear!<br>
info: Building Mathlib.Tactic.ClearExcept<br>
info: Building Mathlib.Tactic.Clear_<br>
info: Building Mathlib.Tactic.Inhabit<br>
info: Building Mathlib.Tactic.LeftRight<br>
info: Building Mathlib.Tactic.TryThis<br>
info: Building Mathlib.Tactic.SudoSetOption<br>
info: Building Mathlib.Tactic.Set<br>
info: Building Mathlib.Tactic.Simps<br>
info: Building Mathlib.Tactic.Substs<br>
info: Building Mathlib.Util.WithWeakNamespace<br>
info: Building Mathlib.Util.Syntax<br>
info: Building Mathlib.Tactic.Constructor<br>
info: Building Mathlib.Tactic.Expect<br>
info: Building Mathlib.Tactic.GuardGoalNums<br>
info: Building Mathlib.Tactic.GuardHypNums<br>
info: Building Mathlib.Tactic.IrreducibleDef<br>
info: Building Mathlib.Tactic.PrintPrefix<br>
info: Building Mathlib.Tactic.Rename<br>
info: Building Mathlib.Tactic.RestateAxiom<br>
info: Building Mathlib.Tactic.SeqFocus<br>
info: Building Mathlib.Tactic.SimpRw<br>
info: Building Mathlib.Tactic.TypeCheck<br>
info: Building Mathlib.Util.Export<br>
info: Building Mathlib.Tactic.Use<br>
info: Building Mathlib.Util.IncludeStr<br>
info: Building Mathlib.Util.Time<br>
info: Building Mathlib.Tactic.RunCmd<br>
info: Building Mathlib.Tactic.Trace<br>
info: Building Mathlib.Tactic.ApplyWith<br>
info: Building Mathlib.Util.Simp<br>
info: Building Mathlib.Mathport.SpecialNames<br>
info: Building Mathlib.Util.Tactic<br>
info: Building Mathlib.Tactic.HelpCmd<br>
info: Building Mathlib.Tactic.InferParam<br>
info: Building Mathlib.Lean.Expr.Traverse<br>
info: Building Mathlib.Tactic.ShowTerm<br>
info: Building Mathlib.Util.WhatsNew<br>
info: Building Mathlib.Logic.Nonempty<br>
info: Building Mathlib.Init.Set<br>
info: Building Mathlib.Data.Option.Defs<br>
info: Building Mathlib.Tactic.Conv<br>
info: Building Mathlib.Tactic.CommandQuote<br>
info: Building Mathlib.Tactic.SwapVar<br>
info: Building Mathlib.Tactic.RenameBVar<br>
info: Building Mathlib.Lean.Expr.ReplaceRec<br>
info: Building Mathlib.Tactic.Cache<br>
info: Building Mathlib.Tactic.Cases<br>
info: Building Mathlib.Tactic.PermuteGoals<br>
info: Building Std<br>
info: Building Mathlib.Lean.Expr<br>
info: Building Mathlib.Tactic.Basic<br>
info: Building Mathlib.Data.Array.Defs<br>
info: Building Mathlib.Tactic.Find<br>
info: Building Mathlib.Tactic.Recover<br>
info: Building Mathlib.Tactic.Core<br>
info: Building Mathlib.Tactic.Have<br>
info: Building Mathlib.Tactic.Simpa<br>
info: Building Mathlib.Tactic.SolveByElim<br>
info: Building Mathlib.Tactic.LibrarySearch<br>
info: Building Mathlib.Tactic.Existsi<br>
info: Building Mathlib.Init.Logic<br>
info: Building Mathlib.Tactic.Replace<br>
info: Building Mathlib.Init.Algebra.Order<br>
info: Building Mathlib.Logic.Equiv.LocalEquiv<br>
info: Building Mathlib.Logic.Basic<br>
info: Building Mathlib.Data.Option.Basic<br>
info: Building Mathlib.Init.Algebra.Functions<br>
info: Building Mathlib.Tactic.PushNeg<br>
info: Building Mathlib.Init.Data.Nat.Lemmas<br>
info: Building Mathlib.Data.Nat.Basic<br>
info: Building Mathlib.Logic.Function.Basic<br>
info: Building Mathlib.Tactic.ByContra<br>
info: Building Mathlib.Data.Equiv.Basic<br>
info: Building Mathlib.Data.Prod<br>
info: Building Mathlib.Data.Subtype<br>
info: Building Mathlib.Data.List.Basic<br>
info: Building Mathlib.Data.Equiv.Functor<br>
info: Building Mathlib.Order.Basic<br>
error: &gt; LEAN_PATH=./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib DYLD_LIBRARY_PATH=/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/lib:./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib:./lean_packages/mathlib/build/lib /Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lean ./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean -R ./lean_packages/mathlib/./. -o ./lean_packages/mathlib/build/lib/Mathlib/Data/List/Basic.olean -i ./lean_packages/mathlib/build/lib/Mathlib/Data/List/Basic.ilean -c ./lean_packages/mathlib/build/ir/Mathlib/Data/List/Basic.c<br>
error: stdout:<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:62:6: error: unknown constant 'length_pos'<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:103:1: error: invalid field notation, type is not of the form (C ...) where C is a constant<br>
  forall_mem_cons<br>
has type<br>
  ∀ (p : ?m.2849 → Prop) (a : ?m.2849) (l : List ?m.2849),<br>
    (∀ (x : ?m.2849), x ∈ a :: l → p x) ↔ p a ∧ ∀ (x : ?m.2849), x ∈ l → p x<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:111:0: error: invalid field notation, type is not of the form (C ...) where C is a constant<br>
  exists_mem_cons<br>
has type<br>
  ∀ (p : ?m.2982 → Prop) (a : ?m.2982) (l : List ?m.2982), (∃ x, x ∈ a :: l ∧ p x) ↔ p a ∨ ∃ x, x ∈ l ∧ p x<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:115:0: error: invalid field notation, type is not of the form (C ...) where C is a constant<br>
  exists_mem_cons<br>
has type<br>
  ∀ (p : ?m.3060 → Prop) (a : ?m.3060) (l : List ?m.3060), (∃ x, x ∈ a :: l ∧ p x) ↔ p a ∨ ∃ x, x ∈ l ∧ p x<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:159:2: error: invalid projection, structure expected<br>
  append_right_inj ?m.3424<br>
has type<br>
  ?m.3422 = ?m.3423<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:162:2: error: invalid projection, structure expected<br>
  append_left_inj ?m.3532<br>
has type<br>
  ?m.3529 = ?m.3530<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:247:55: error: function expected at<br>
  length_pos_of_ne_nil<br>
term has type<br>
  ?m.14283<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:250:20: error: unsolved goals<br>
α : Type u_1<br>
x<span aria-label="cross" class="emoji emoji-271d" role="img" title="cross">:cross:</span> : Sort u_2<br>
length_pos_of_ne_nil : x<span aria-label="cross" class="emoji emoji-271d" role="img" title="cross">:cross:</span><br>
a b : α<br>
l : List α<br>
h : a :: b :: l ≠ []<br>
⊢ Sort u_2</p>
<p>α : Type u_1<br>
x<span aria-label="cross" class="emoji emoji-271d" role="img" title="cross">:cross:</span> : Sort u_2<br>
length_pos_of_ne_nil : x<span aria-label="cross" class="emoji emoji-271d" role="img" title="cross">:cross:</span><br>
a b : α<br>
l : List α<br>
h : a :: b :: l ≠ []<br>
⊢ ?m.14656<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:257:75: error: unsolved goals<br>
α : Type u_1<br>
x : α<br>
xs : List α<br>
n : ℕ<br>
h : n = length xs<br>
⊢ Sort ?u.21182</p>
<p>α : Type u_1<br>
x : α<br>
xs : List α<br>
n : ℕ<br>
h : n = length xs<br>
⊢ ?m.21184<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:285:17: error: type mismatch<br>
  congr_arg (cons ?m.23440) (removeNth_eq_nth_tail ?m.23453 ?m.23454)<br>
has type<br>
  ?m.23440 :: removeNth ?m.23454 ?m.23453 = ?m.23440 :: modifyNthTail tail ?m.23453 ?m.23454 : Prop<br>
but is expected to have type<br>
  removeNth (a :: l) (n + 1) = modifyNthTail tail (n + 1) (a :: l) : Prop<br>
./lean_packages/mathlib/././Mathlib/Data/List/Basic.lean:411:61: error: type mismatch<br>
  rfl<br>
has type<br>
  erasep p (a :: l) = erasep p (a :: l) : Prop<br>
but is expected to have type<br>
  erasep p (a :: l) = bif p a then l else a :: erasep p l : Prop<br>
error: external command <code>/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lean</code> exited with code 1</p>
</div></div>



<a name="301157603"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301157603" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301157603">(Sep 28 2022 at 04:38)</a>:</h4>
<p>So <a href="https://github.com/leanprover/lake/blob/cabb1223b02c6bf799bf99b4329e6b666e2bbc9a/Lake/Load/Main.lean#L52-L59">this code</a> looks pretty suspicious</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>      <span class="k">let</span> <span class="n">shouldUpdate</span> <span class="o">:=</span>
        <span class="k">match</span> <span class="n">entry.inputRev</span><span class="bp">?</span><span class="o">,</span> <span class="n">depEntry.inputRev</span><span class="bp">?</span> <span class="k">with</span>
        <span class="bp">|</span> <span class="n">none</span><span class="o">,</span>     <span class="n">none</span>     <span class="bp">=&gt;</span> <span class="n">entry.rev</span> <span class="bp">!=</span> <span class="n">depEntry.rev</span>
        <span class="bp">|</span> <span class="n">none</span><span class="o">,</span>     <span class="n">some</span> <span class="n">_</span>   <span class="bp">=&gt;</span> <span class="n">false</span>
        <span class="bp">|</span> <span class="n">some</span> <span class="n">_</span><span class="o">,</span>   <span class="n">none</span>     <span class="bp">=&gt;</span> <span class="n">false</span>
        <span class="bp">|</span> <span class="n">some</span> <span class="n">rev</span><span class="o">,</span> <span class="n">some</span> <span class="n">dep</span> <span class="bp">=&gt;</span> <span class="n">rev</span> <span class="bp">=</span> <span class="n">dep</span> <span class="bp">∧</span> <span class="n">entry.rev</span> <span class="bp">≠</span> <span class="n">depEntry.rev</span>
      <span class="k">let</span> <span class="n">contributors</span> <span class="o">:=</span> <span class="n">entry.contributors.insert</span> <span class="n">depPkg.name</span> <span class="n">depEntry.toPersistentPackageEntry</span>
      <span class="n">modify</span> <span class="o">(</span><span class="bp">·.</span><span class="n">insert</span> <span class="o">{</span><span class="n">entry</span> <span class="k">with</span> <span class="n">contributors</span><span class="o">,</span> <span class="n">shouldUpdate</span><span class="o">})</span>
</code></pre></div>



<a name="301157610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301157610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301157610">(Sep 28 2022 at 04:38)</a>:</h4>
<p>oooo</p>



<a name="301157630"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301157630" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301157630">(Sep 28 2022 at 04:39)</a>:</h4>
<p>Note that the function there was passed a <code>shouldUpdate</code> flag which isn't being checked here</p>



<a name="301157645"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301157645" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301157645">(Sep 28 2022 at 04:39)</a>:</h4>
<p><code>shouldUpdate</code> is false when running <code>lake build</code></p>



<a name="301157742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301157742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301157742">(Sep 28 2022 at 04:40)</a>:</h4>
<p>From the looks of that match, it seems that it decides to update in response to a mismatch of <code>rev</code> fields in a dependency</p>



<a name="301157766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301157766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301157766">(Sep 28 2022 at 04:41)</a>:</h4>
<p>cc: <span class="user-mention" data-user-id="315577">@Mac</span></p>



<a name="301159203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301159203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301159203">(Sep 28 2022 at 05:05)</a>:</h4>
<p>just in case it helps debug things, here's verbose output (<code>lake -v build</code>) for one of the "weird" instances, where <code>inputRev</code> is <code>main</code>, and where the <code>rev</code> is mysteriously changed from <code>6488a2...</code> to <code>52c232...</code>. This started with only a modified <code>lean_packages/manifest.json</code> and no other files.</p>
<div class="spoiler-block"><div class="spoiler-header">
<p>verbose build</p>
</div><div class="spoiler-content" aria-hidden="true">
<p>info: cloning <a href="https://github.com/leanprover-community/mathlib3port">https://github.com/leanprover-community/mathlib3port</a> to ./lean_packages/mathlib3port<br>
info: &gt; git clone <a href="https://github.com/leanprover-community/mathlib3port">https://github.com/leanprover-community/mathlib3port</a> ./lean_packages/mathlib3port<br>
info: stderr:<br>
Cloning into './lean_packages/mathlib3port'...<br>
info: &gt; git checkout --detach 9d2aa54216553f283e6efe011d4aa71cae0abd50    # in directory ./lean_packages/mathlib3port<br>
info: stderr:<br>
HEAD is now at 9d2aa542 bump to nightly-2022-09-13<br>
info: cloning <a href="https://github.com/leanprover-community/lean3port.git">https://github.com/leanprover-community/lean3port.git</a> to ./lean_packages/lean3port<br>
info: &gt; git clone <a href="https://github.com/leanprover-community/lean3port.git">https://github.com/leanprover-community/lean3port.git</a> ./lean_packages/lean3port<br>
info: stderr:<br>
Cloning into './lean_packages/lean3port'...<br>
info: &gt; git checkout --detach b73dfeb9e288603ef280d4ccf8dd8d3af7b244fc    # in directory ./lean_packages/lean3port<br>
info: stderr:<br>
HEAD is now at b73dfeb bump to nightly-2022-09-13<br>
info: cloning <a href="https://github.com/leanprover-community/mathlib4.git">https://github.com/leanprover-community/mathlib4.git</a> to ./lean_packages/mathlib<br>
info: &gt; git clone <a href="https://github.com/leanprover-community/mathlib4.git">https://github.com/leanprover-community/mathlib4.git</a> ./lean_packages/mathlib<br>
info: stderr:<br>
Cloning into './lean_packages/mathlib'...<br>
info: &gt; git checkout --detach dd1ecc5d3aefab6a83767079c7d020f4aa254a24    # in directory ./lean_packages/mathlib<br>
info: stderr:<br>
HEAD is now at dd1ecc5 chore: bump to 2022-09-11 (<a href="https://github.com/leanprover-community/mathlib/pull/406">#406</a>)<br>
info: cloning <a href="https://github.com/leanprover/std4">https://github.com/leanprover/std4</a> to ./lean_packages/std<br>
info: &gt; git clone <a href="https://github.com/leanprover/std4">https://github.com/leanprover/std4</a> ./lean_packages/std<br>
info: stderr:<br>
Cloning into './lean_packages/std'...<br>
info: &gt; git checkout --detach 52c2324923b7f83e4e9b82ca9c8284f7a86bd3e8    # in directory ./lean_packages/std<br>
info: stderr:<br>
HEAD is now at 52c2324 feat: use simp trace support in simpNF linter<br>
info: Found dependency <code>Cli</code><br>
<code>mathlib3port</code> locked <code>master</code> at <code>112b35fc348a4a18d2111ac2c6586163330b4941</code><br>
<code>mathlib</code> locked <code>master</code> at <code>112b35fc348a4a18d2111ac2c6586163330b4941</code><br>
<code>lean3port</code> locked <code>master</code> at <code>112b35fc348a4a18d2111ac2c6586163330b4941</code><br>
Using <code>master</code> at <code>112b35fc348a4a18d2111ac2c6586163330b4941</code><br>
info: Found dependency <code>leanInk</code><br>
<code>mathlib3port</code> locked <code>master</code> at <code>439303af06465824588a486f5f9c023ca69979f3</code><br>
<code>mathlib</code> locked <code>master</code> at <code>439303af06465824588a486f5f9c023ca69979f3</code><br>
<code>lean3port</code> locked <code>master</code> at <code>439303af06465824588a486f5f9c023ca69979f3</code><br>
Using <code>master</code> at <code>439303af06465824588a486f5f9c023ca69979f3</code><br>
info: Found dependency <code>mathlib3port</code><br>
Using <code>master</code> at <code>9d2aa54216553f283e6efe011d4aa71cae0abd50</code><br>
info: Found dependency <code>doc-gen4</code><br>
<code>mathlib3port</code> locked <code>main</code> at <code>a2345380e861332fabecc61591cb274e61163a97</code><br>
<code>mathlib</code> locked <code>main</code> at <code>a2345380e861332fabecc61591cb274e61163a97</code><br>
<code>lean3port</code> locked <code>main</code> at <code>a2345380e861332fabecc61591cb274e61163a97</code><br>
Using <code>main</code> at <code>a2345380e861332fabecc61591cb274e61163a97</code><br>
info: Found dependency <code>Unicode</code><br>
<code>mathlib3port</code> locked <code>master</code> at <code>25b32ef69fd6d8ae34300d51dc0b9403ffb1fd29</code><br>
<code>mathlib</code> locked <code>master</code> at <code>25b32ef69fd6d8ae34300d51dc0b9403ffb1fd29</code><br>
<code>lean3port</code> locked <code>master</code> at <code>25b32ef69fd6d8ae34300d51dc0b9403ffb1fd29</code><br>
Using <code>master</code> at <code>25b32ef69fd6d8ae34300d51dc0b9403ffb1fd29</code><br>
info: Found dependency <code>mathlib</code><br>
<code>mathlib3port</code> locked <code>dd1ecc5d3aefab6a83767079c7d020f4aa254a24</code> at <code>dd1ecc5d3aefab6a83767079c7d020f4aa254a24</code><br>
<code>mathlib</code> locked <code>master</code> at <code>ecd37441047e490ff2ad339e16f45bb8b58591bd</code><br>
<code>lean3port</code> locked <code>dd1ecc5d3aefab6a83767079c7d020f4aa254a24</code> at <code>dd1ecc5d3aefab6a83767079c7d020f4aa254a24</code><br>
Using <code>dd1ecc5d3aefab6a83767079c7d020f4aa254a24</code> at <code>dd1ecc5d3aefab6a83767079c7d020f4aa254a24</code><br>
info: Found dependency <code>lean3port</code><br>
<code>mathlib3port</code> locked <code>b73dfeb9e288603ef280d4ccf8dd8d3af7b244fc</code> at <code>b73dfeb9e288603ef280d4ccf8dd8d3af7b244fc</code><br>
Using <code>b73dfeb9e288603ef280d4ccf8dd8d3af7b244fc</code> at <code>b73dfeb9e288603ef280d4ccf8dd8d3af7b244fc</code><br>
info: Found dependency <code>std</code><br>
<code>mathlib3port</code> locked <code>main</code> at <code>1f3f0630659a96756377610db656253b18a6a7ee</code><br>
<code>mathlib</code> locked <code>main</code> at <code>1fa9d80bc2991dec80cfa47d2053b45749d28497</code><br>
<code>lean3port</code> locked <code>main</code> at <code>1f3f0630659a96756377610db656253b18a6a7ee</code><br>
Using <code>main</code> at <code>52c2324923b7f83e4e9b82ca9c8284f7a86bd3e8</code><br>
info: Found dependency <code>lake</code><br>
<code>mathlib3port</code> locked <code>master</code> at <code>6cfb4e3fd7ff700ace8c2cfdb85056d59f321920</code><br>
<code>mathlib</code> locked <code>master</code> at <code>6cfb4e3fd7ff700ace8c2cfdb85056d59f321920</code><br>
<code>lean3port</code> locked <code>master</code> at <code>6cfb4e3fd7ff700ace8c2cfdb85056d59f321920</code><br>
Using <code>master</code> at <code>6cfb4e3fd7ff700ace8c2cfdb85056d59f321920</code><br>
info: Found dependency <code>CMark</code><br>
<code>mathlib3port</code> locked <code>master</code> at <code>8c0f9c1b16ee8047813f43b1f92de471782114ff</code><br>
<code>mathlib</code> locked <code>master</code> at <code>8c0f9c1b16ee8047813f43b1f92de471782114ff</code><br>
<code>lean3port</code> locked <code>master</code> at <code>8c0f9c1b16ee8047813f43b1f92de471782114ff</code><br>
Using <code>master</code> at <code>8c0f9c1b16ee8047813f43b1f92de471782114ff</code><br>
Fetching oleans for Leanbin</p>
<blockquote>
<p>curl -L -O <a href="https://github.com/leanprover-community/mathport/releases/download/nightly-2022-09-13/lean3-binport.tar.gz">https://github.com/leanprover-community/mathport/releases/download/nightly-2022-09-13/lean3-binport.tar.gz</a>    # in directory ./lean_packages/lean3port/build/lib<br>
stderr:<br>
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>
                                 Dload  Upload   Total   Spent    Left  Speed<br>
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0<br>
100 5246k  100 5246k    0     0  9690k      0 --:--:-- --:--:-- --:--:-- 9690k<br>
tar -xzf lean3-binport.tar.gz    # in directory ./lean_packages/lean3port/build/lib<br>
Fetching oleans for Mathbin<br>
curl -L -O <a href="https://github.com/leanprover-community/mathport/releases/download/nightly-2022-09-13/mathlib3-binport.tar.gz">https://github.com/leanprover-community/mathport/releases/download/nightly-2022-09-13/mathlib3-binport.tar.gz</a>    # in directory ./lean_packages/mathlib3port/build/lib<br>
stderr:<br>
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>
                                 Dload  Upload   Total   Spent    Left  Speed<br>
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0<br>
100  576M  100  576M    0     0  24.1M      0  0:00:23  0:00:23 --:--:-- 28.0M<br>
tar -xzf mathlib3-binport.tar.gz    # in directory ./lean_packages/mathlib3port/build/lib<br>
Building Moonshine<br>
LEAN_PATH=./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib DYLD_LIBRARY_PATH=/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/lib:./build/lib /Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lean ./././Moonshine.lean -R ././. -o ./build/lib/Moonshine.olean -i ./build/lib/Moonshine.ilean -c ./build/ir/Moonshine.c<br>
Compiling Moonshine<br>
Building Main<br>
LEAN_PATH=./lean_packages/mathlib3port/build/lib:./lean_packages/mathlib/build/lib:./lean_packages/lean3port/build/lib:./build/lib:./lean_packages/std/build/lib DYLD_LIBRARY_PATH=/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/lib:./build/lib /Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/lean ./././Main.lean -R ././. -o ./build/lib/Main.olean -i ./build/lib/Main.ilean -c ./build/ir/Main.c<br>
Compiling Main<br>
/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/leanc -c -o ./build/ir/Moonshine.o ./build/ir/Moonshine.c -O3 -DNDEBUG<br>
/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/leanc -c -o ./build/ir/Main.o ./build/ir/Main.c -O3 -DNDEBUG<br>
Linking moonshine<br>
/Users/thomas/.elan/toolchains/leanprover--lean4---nightly-2022-09-11/bin/leanc -o ./build/bin/moonshine ./build/ir/Main.o ./build/ir/Moonshine.o<br>
stderr:<br>
ld64.lld: warning: /usr/lib/system/libsystem_kernel.dylib has version 12.6.0, which is newer than target minimum of 12.0.0<br>
ld64.lld: warning: /usr/lib/system/libsystem_platform.dylib has version 12.6.0, which is newer than target minimum of 12.0.0<br>
ld64.lld: warning: /usr/lib/system/libsystem_pthread.dylib has version 12.6.0, which is newer than target minimum of 12.0.0</p>
</blockquote>
</div></div>



<a name="301302579"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301302579" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Thomas Murrills <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301302579">(Sep 28 2022 at 18:40)</a>:</h4>
<p>One thing I'm noticing: each of the generated <code>lean3port</code>, <code>mathlib</code>, <code>mathlib3port</code> directories within <code>lean_packages</code> have their <em>own</em> <code>lean_packages</code> directories within them, containing nothing but a <code>manifest.json</code> file. Should the <code>rev</code>s in this manifest be reflected at the top level as well? They seem to use rev <code>1f3f0630659a96756377610db656253b18a6a7ee</code> of <code>std</code>, instead of either of the two that have been tried so far.</p>



<a name="301317427"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301317427" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301317427">(Sep 28 2022 at 20:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/using.20binport.20only/near/301157742">said</a>:</p>
<blockquote>
<p>From the looks of that match, it seems that it decides to update in response to a mismatch of <code>rev</code> fields in a dependency</p>
</blockquote>
<p>Yes, that is the goal. See this <a href="#narrow/stream/287929-mathlib4/topic/using.20binport.20only/near/301157766">comment</a> on <a href="https://github.com/leanprover-community/lake/pull/120">lake#120</a> for more information. I think the underlying problem is actually the one mentioned in <a href="https://github.com/leanprover-community/lake/pull/119">lake#119</a> <a href="https://github.com/leanprover/lake/issues/119#issuecomment-1249383122">here</a>.</p>



<a name="301318131"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301318131" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301318131">(Sep 28 2022 at 20:12)</a>:</h4>
<p><span class="user-mention" data-user-id="315577">@Mac</span> I don't suppose the lake dependency resolution algorithm could be documented somewhere in plain text in the documentation? It seems worth an RFC in case it's not actually doing what we want. Currently I have difficulty reading the code because I know neither what it is supposed to do nor what the invariants of the internal data structures are when processing all the dependencies.</p>



<a name="301318610"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301318610" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301318610">(Sep 28 2022 at 20:15)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Yeah, this is a good idea. I definitely think that I now need to fix these bugs ASAP (hopefully by this weekend).  While doing so, I can also write-up some doc on how I see it working. Feel free to also create issue requesting the docs on GitHub with anything you want to make sure I include. I can tell you the current approach is a bit haphazard as it has been mostly developed from me addressing <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> 's feature requests.</p>



<a name="301318890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301318890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301318890">(Sep 28 2022 at 20:16)</a>:</h4>
<p>Quick question in regards to something I brought up above: why does the <code>inputRev</code> field exist? The input revision should presumably be in the lakefile.</p>



<a name="301319008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/using%20binport%20only/near/301319008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mac <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/using.20binport.20only.html#301319008">(Sep 28 2022 at 20:17)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <a href="https://github.com/leanprover-community/lake/pull/85">lake#85</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>