---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/Auto-implicits.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html">Auto-implicits</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="314070118"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314070118" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314070118">(Dec 05 2022 at 16:16)</a>:</h4>
<p>Is turning off auto-implicits mathlib-wide on the table? I just had a very confusing error because I used <code>npow_rec</code>, which created an auto-implicit called <code>npow_rec</code>, while had they been disabled I wouldn't have spent 15min to see that I meant <code>npowRec</code>.</p>



<a name="314070319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314070319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314070319">(Dec 05 2022 at 16:17)</a>:</h4>
<p><span class="user-mention" data-user-id="110038">@Kevin Buzzard</span> has mentioned that he has as part of his workflow to put a set_option at the top of the file and then remove it when he is done</p>



<a name="314070480"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314070480" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314070480">(Dec 05 2022 at 16:18)</a>:</h4>
<p>I think it is a useful feature and don't want to remove it for <em>new</em> code, but for porting it's generally better to disable auto-implicits</p>



<a name="314070932"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314070932" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314070932">(Dec 05 2022 at 16:20)</a>:</h4>
<p>I would be happy if I could remove it locally <em>without touching code</em> (I don't think asking people to write <code>set_option AutoImplicit False</code> at the top of each file they edit is a viable solution), because I can see this problem repeating over and over again.</p>



<a name="314071090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071090">(Dec 05 2022 at 16:21)</a>:</h4>
<p>Better error messages would help too. In my case, the error was a cryptic and <strong>uninspectable</strong></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">invalid</span> <span class="n">default</span> <span class="n">value</span> <span class="n">for</span> <span class="n">field</span><span class="o">,</span> <span class="n">it</span> <span class="n">contains</span> <span class="n">metavariables</span>
  <span class="n">zsmulRec</span> <span class="n">nsmul</span>
</code></pre></div>



<a name="314071328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071328">(Dec 05 2022 at 16:22)</a>:</h4>
<p>(or rather inspectable, but didn't give me the crucial info)</p>



<a name="314071428"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071428" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071428">(Dec 05 2022 at 16:22)</a>:</h4>
<p>mathport could add the set_option line</p>



<a name="314071463"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071463" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071463">(Dec 05 2022 at 16:22)</a>:</h4>
<p>I have no idea what you want to do about the error message</p>



<a name="314071516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071516">(Dec 05 2022 at 16:23)</a>:</h4>
<p>Sure, but that doesn't help with writing new code.</p>



<a name="314071566"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071566" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071566">(Dec 05 2022 at 16:23)</a>:</h4>
<p>for new code the option shouldn't be disabled</p>



<a name="314071607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Marc Huisinga <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071607">(Dec 05 2022 at 16:23)</a>:</h4>
<p>Maybe the error message could point it out if auto-implicits are involved?</p>



<a name="314071611"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071611" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071611">(Dec 05 2022 at 16:23)</a>:</h4>
<p>that's what I just said above</p>



<a name="314071660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071660">(Dec 05 2022 at 16:23)</a>:</h4>
<p>Well, <em>I</em> want it disabled for me <span aria-label="stuck out tongue closed eyes" class="emoji emoji-1f61d" role="img" title="stuck out tongue closed eyes">:stuck_out_tongue_closed_eyes:</span></p>



<a name="314071738"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071738" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071738">(Dec 05 2022 at 16:24)</a>:</h4>
<p>The error message never told me what the metavariable was.</p>



<a name="314071744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071744">(Dec 05 2022 at 16:24)</a>:</h4>
<p>You can do that by modifying the lakefile</p>



<a name="314071813"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071813" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071813">(Dec 05 2022 at 16:24)</a>:</h4>
<p>you can add set_options that apply globally there</p>



<a name="314071895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071895">(Dec 05 2022 at 16:24)</a>:</h4>
<p>and if you don't push the lakefile changes then you can work with a different set of options than everyone else</p>



<a name="314071954"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071954" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314071954">(Dec 05 2022 at 16:25)</a>:</h4>
<p>That doesn't really work with my setup, though. I'm working on fresh gitpods every time.</p>



<a name="314072089"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314072089" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314072089">(Dec 05 2022 at 16:26)</a>:</h4>
<p>okay... if you have no personal configuration then I'm not sure how you expect to persist personal changes</p>



<a name="314072271"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314072271" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314072271">(Dec 05 2022 at 16:26)</a>:</h4>
<p>Those auto-implicits definitely break the principle of least surprise, which I why I would like to consider disabling them mathlib-wise, given that mathlib is mostly targeted towards mathematicians.</p>



<a name="314072385"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314072385" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314072385">(Dec 05 2022 at 16:27)</a>:</h4>
<p>I think you just aren't used to them yet. The syntax highlighting is very good for spotting auto-implicits</p>



<a name="314072434"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314072434" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314072434">(Dec 05 2022 at 16:27)</a>:</h4>
<p>Auto-implicits don't show up in <code>#where</code> either, right?</p>



<a name="314072490"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314072490" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314072490">(Dec 05 2022 at 16:27)</a>:</h4>
<p>that wouldn't make any sense?</p>



<a name="314072667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314072667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314072667">(Dec 05 2022 at 16:28)</a>:</h4>
<p>Well, <code>variable {f : α → α}</code> now makes sense, so I sure hope my question does make sense.</p>



<a name="314072770"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314072770" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314072770">(Dec 05 2022 at 16:29)</a>:</h4>
<p>I have found that it is much easier to get the types right with auto implicits instead of long-scoped <code>variable</code> lines</p>



<a name="314073121"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314073121" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314073121">(Dec 05 2022 at 16:30)</a>:</h4>
<p>Often you can just avoid needing <code>variable</code> lines at all, and then you don't need to use <code>#where</code> all the time either</p>



<a name="314073824"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314073824" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314073824">(Dec 05 2022 at 16:33)</a>:</h4>
<p>All the files I've structured use long-scoped <code>variable</code> lines, sorted by increasing typeclass assumptions, and very short lemma statements.</p>



<a name="314074032"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314074032" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314074032">(Dec 05 2022 at 16:34)</a>:</h4>
<p>I'm not sure how you would achieve short statements with auto-implicits in topology or algebra.</p>



<a name="314074265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314074265" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314074265">(Dec 05 2022 at 16:35)</a>:</h4>
<p>It depends on the theorem, but if the statement already implies the necessary typeclass assumptions then you don't need any <code>variable</code> lines</p>



<a name="314074382"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314074382" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314074382">(Dec 05 2022 at 16:36)</a>:</h4>
<p>you just have the same short statement without the <code>variable</code> line</p>



<a name="314141891"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314141891" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Moritz Doll <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314141891">(Dec 05 2022 at 23:02)</a>:</h4>
<p>Yael, the experience is completely different between porting existing code and writing new code. At first I thought it was nonsense as well (I have <code>coe</code> being a type), but it is so nice, when you remove all the boilerplate that is just defining types.</p>



<a name="314143260"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314143260" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314143260">(Dec 05 2022 at 23:12)</a>:</h4>
<p>Yes this autoImplicit thing is very much a porting only technique. It's brilliant not to have to define various variables because the system just guesses them correctly.</p>



<a name="314164698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314164698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314164698">(Dec 06 2022 at 03:32)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071744">said</a>:</p>
<blockquote>
<p>You can do that by modifying the lakefile</p>
</blockquote>
<p>I did not realise this. I get bitten by <code>auto_implicit</code> often enough that it is probably worth doing this for my code, and even more so for code on which students depend.</p>



<a name="314199289"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314199289" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jon Eugster <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314199289">(Dec 06 2022 at 09:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314071813">said</a>:</p>
<blockquote>
<p>you can add set_options that apply globally there</p>
</blockquote>
<p>I didn't quite get this to work, I just added some lines</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">set_option</span> <span class="n">autoImplicit</span> <span class="n">false</span>
<span class="kd">set_option</span> <span class="bp">......</span> <span class="n">false</span>
</code></pre></div>
<p>anywhere in the <code>lakefile.lean</code>, but it does not seem like they're globally set. Is there a documentation of that feature?</p>



<a name="314203654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314203654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Alex J. Best <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314203654">(Dec 06 2022 at 10:07)</a>:</h4>
<p>You can add <code>-D autoImplicit=false</code> as an extra Lean 4 server arg in your vscode settings, this should persist acrosss instances of gitpod if set up properly</p>



<a name="314219273"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Auto-implicits/near/314219273" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Sebastian Ullrich <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Auto-implicits.html#314219273">(Dec 06 2022 at 11:44)</a>:</h4>
<p>We could also (optionally) display auto implicits as LSP <em>inlay hints</em> (specially highlighted text that is not actually part of the editor) as in <code>... {α} ...</code>. Except that as usual the API is not really made for the incremental processing of a theorem prover.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>