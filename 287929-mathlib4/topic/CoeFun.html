---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/CoeFun.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html">CoeFun</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="317644350"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/317644350" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#317644350">(Dec 23 2022 at 21:35)</a>:</h4>
<p>I started porting <code>group_theory.subsemigroup.operations</code>. It turns out that coercion of an <code>order_iso</code> to a function yields</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="bp">↑</span><span class="o">(</span><span class="n">RelIso.toRelEmbedding</span> <span class="n">e</span><span class="o">)</span><span class="bp">.</span><span class="n">toEmbedding</span>
</code></pre></div>
<p>where the outer <code>↑</code> is <code>FunLike.coe</code>.</p>



<a name="317644510"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/317644510" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#317644510">(Dec 23 2022 at 21:37)</a>:</h4>
<p>Why does it happen? What is the proper fix?</p>



<a name="317653502"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/317653502" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#317653502">(Dec 23 2022 at 23:06)</a>:</h4>
<p>It means there is a shortcut instance that needs removing, I think</p>



<a name="317653529"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/317653529" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#317653529">(Dec 23 2022 at 23:06)</a>:</h4>
<p>(deleted)</p>



<a name="317655773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/317655773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#317655773">(Dec 23 2022 at 23:34)</a>:</h4>
<p>Should I remove most of <code>CoeFun</code> instances?</p>



<a name="317690576"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/317690576" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#317690576">(Dec 24 2022 at 08:55)</a>:</h4>
<p>I can't find the one causing the problem now</p>



<a name="317742890"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/317742890" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#317742890">(Dec 24 2022 at 15:51)</a>:</h4>
<p>I found it, fixing.</p>



<a name="319996484"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/319996484" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#319996484">(Jan 07 2023 at 18:57)</a>:</h4>
<p>What are our plans about <code>CoeFun</code>? I can update <a href="https://github.com/leanprover-community/mathlib4/pull/1219">https://github.com/leanprover-community/mathlib4/pull/1219</a> to work with <code>master</code> but I don't want to spend time on this if it won't get merged.</p>



<a name="319996556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/319996556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#319996556">(Jan 07 2023 at 18:58)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> <span class="user-mention" data-user-id="310045">@Eric Wieser</span> <span aria-label="up" class="emoji emoji-2b06" role="img" title="up">:up:</span></p>



<a name="320000977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320000977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320000977">(Jan 07 2023 at 19:51)</a>:</h4>
<p>That patch looks generally like the right thing to do to me</p>



<a name="320007816"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320007816" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320007816">(Jan 07 2023 at 21:27)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  was not happy about it, so I'm waiting for him. Also, we didn't hear from <span class="user-mention" data-user-id="110043">@Gabriel Ebner</span>  about this.</p>



<a name="320350728"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320350728" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320350728">(Jan 09 2023 at 23:27)</a>:</h4>
<p>Happy new year!  I think <span class="user-mention" data-user-id="214703">@Yury G. Kudryashov</span> is doing the right thing here.  If we want <code>FunLike</code>, then we need to use <code>FunLike.coe</code> everywhere.</p>



<a name="320786278"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320786278" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320786278">(Jan 11 2023 at 19:59)</a>:</h4>
<p><span class="user-mention" data-user-id="110043">@Gabriel Ebner</span> Happy new year! Why exactly Lean 4 doesn't unfold <code>FunLike.coe</code>? It seems that Lean unfolds it for a <code>MulEquiv</code>.</p>



<a name="320786447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320786447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320786447">(Jan 11 2023 at 20:00)</a>:</h4>
<p>If it gets unfolded then it must be because of a <code>CoeFun</code> instance.</p>



<a name="320787365"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320787365" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320787365">(Jan 11 2023 at 20:05)</a>:</h4>
<p>Could you please have a look at <a href="https://github.com/leanprover-community/mathlib4/tree/YK-coe-fn">https://github.com/leanprover-community/mathlib4/tree/YK-coe-fn</a> ? I can't find any relevant <code>CoeFun</code> instance.</p>



<a name="320787564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320787564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320787564">(Jan 11 2023 at 20:06)</a>:</h4>
<p>But RHS of <code>MulEquiv.coe_toMulHom</code> unfolds to <code>f.toEquiv.toFun</code></p>



<a name="320811974"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320811974" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320811974">(Jan 11 2023 at 22:46)</a>:</h4>
<p>Should we drop all the custom <code>to*Hom</code> functions in favor of one generic <code>*Hom.of [*HomClass F M N]</code> per <code>*Hom</code>?</p>



<a name="320828713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320828713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320828713">(Jan 12 2023 at 01:33)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/287929-mathlib4/topic/CoeFun/near/320787564">said</a>:</p>
<blockquote>
<p>But RHS of <code>MulEquiv.coe_toMulHom</code> unfolds to <code>f.toEquiv.toFun</code></p>
</blockquote>
<p>I'm not sure I can repro that.  <code>coe_toMulHome</code> has <code>FunLike.coe</code> on both sides for me.</p>



<a name="320828800"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320828800" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320828800">(Jan 12 2023 at 01:34)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/287929-mathlib4/topic/CoeFun/near/320811974">said</a>:</p>
<blockquote>
<p>Should we drop all the custom <code>to*Hom</code> functions in favor of one generic <code>*Hom.of [*HomClass F M N]</code> per <code>*Hom</code>?</p>
</blockquote>
<p>That is an interesting refactoring.  But we should probably wait until after the port with that.</p>



<a name="320830793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320830793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320830793">(Jan 12 2023 at 02:03)</a>:</h4>
<p>We can't drop the <code>to*Hom</code> functions, can we? They're generated by the <code>structure</code> keyword</p>



<a name="320830864"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320830864" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320830864">(Jan 12 2023 at 02:04)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/287929-mathlib4/topic/CoeFun/near/320787564">said</a>:</p>
<blockquote>
<p>But RHS of <code>MulEquiv.coe_toMulHom</code> unfolds to <code>f.toEquiv.toFun</code></p>
</blockquote>
<p>I would guess that this is a transitive coercion kicking in, that we probably don't want</p>



<a name="320831021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320831021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320831021">(Jan 12 2023 at 02:06)</a>:</h4>
<p><span class="user-mention silent" data-user-id="214703">Yury G. Kudryashov</span> <a href="#narrow/stream/287929-mathlib4/topic/CoeFun/near/320811974">said</a>:</p>
<blockquote>
<p>one generic <code>*Hom.of [*HomClass F M N]</code> per <code>*Hom</code>?</p>
</blockquote>
<p>This already exists, it's <a href="https://leanprover-community.github.io/mathlib_docs/find/add_hom.has_coe_t">docs#add_hom.has_coe_t</a> etc</p>



<a name="320831046"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320831046" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320831046">(Jan 12 2023 at 02:06)</a>:</h4>
<p>But to make Lean4 happy we probably need to give those functions new names thare aren't just <code>coe</code></p>



<a name="320831115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320831115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320831115">(Jan 12 2023 at 02:07)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/CoeFun/near/320830793">said</a>:</p>
<blockquote>
<p>We can't drop the <code>to*Hom</code> functions, can we? They're generated by the <code>structure</code> keyword</p>
</blockquote>
<p>Ah, you're right.  And they probably appear in structure instances without us being able to do anything about that.</p>



<a name="320833053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320833053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Gabriel Ebner <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320833053">(Jan 12 2023 at 02:37)</a>:</h4>
<p>Hmm, I looked at two files, <code>Algebra.Group.WithOne.Basic</code> and <code>Data.Real.CauSeq</code> and they both built with minor (non-coe related) fixes.  Not sure what the issue here is.</p>



<a name="320856567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/CoeFun/near/320856567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yury G. Kudryashov <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/CoeFun.html#320856567">(Jan 12 2023 at 05:15)</a>:</h4>
<p>Probably, there was a problem with cached oleans.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>