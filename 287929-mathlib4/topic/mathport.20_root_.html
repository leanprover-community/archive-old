---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/mathport.20_root_.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html">mathport _root_</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="312413814"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/312413814" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Winston Yin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#312413814">(Nov 27 2022 at 01:27)</a>:</h4>
<p>I've noticed that mathport generates incorrect <code>#align</code> when a theorem uses the <code>_root_</code> namespace. For example, it tries to do <code>is_unit._root_.is_unit_map_of_left_inverse</code> when it should be <code>is_unit_map_of_left_inverse</code>. What would be the right place to submit an issue for this?</p>



<a name="312414837"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/312414837" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#312414837">(Nov 27 2022 at 01:45)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathport/">https://github.com/leanprover-community/mathport/</a></p>



<a name="312414960"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/312414960" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#312414960">(Nov 27 2022 at 01:47)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathport/blob/f071992a732b95d49b75111dfbdd9cdd9cd371dc/Mathport/Syntax/Translate/Command.lean#L240">https://github.com/leanprover-community/mathport/blob/f071992a732b95d49b75111dfbdd9cdd9cd371dc/Mathport/Syntax/Translate/Command.lean#L240</a></p>



<a name="323092803"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323092803" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323092803">(Jan 23 2023 at 18:48)</a>:</h4>
<p>I also notice this.</p>



<a name="323092847"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323092847" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323092847">(Jan 23 2023 at 18:48)</a>:</h4>
<p>Does mathport understand _root_ at all?</p>



<a name="323095929"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323095929" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323095929">(Jan 23 2023 at 19:03)</a>:</h4>
<p>I see more and more lemmas that used <code>lemma _root_.foo</code> in mathlib 3, that got translated into <code>lemma foo</code> in mathlib 4</p>



<a name="323096008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323096008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323096008">(Jan 23 2023 at 19:03)</a>:</h4>
<p>It's probably not a huge deal but it would be more correct to preserve it</p>



<a name="323096344"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323096344" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323096344">(Jan 23 2023 at 19:05)</a>:</h4>
<p>we could calculate whether <code>_root_</code> is needed and use it only then, but I worry that this will cause a huge disruption if it happens to get a namespace declaration wrong</p>



<a name="323096751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323096751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323096751">(Jan 23 2023 at 19:06)</a>:</h4>
<p>Then again, you can already see the result of mathport's perspective of what the namespace is in the generated <code>#align</code> statements, and I don't think those need bulk modification that often</p>



<a name="323103149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323103149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323103149">(Jan 23 2023 at 19:40)</a>:</h4>
<p>hmm, is the idea that mathport doesn't know what name the user actually wrote in a <code>def</code> in mathlib 3, and it has to reverse engineer it from the new constant?</p>



<a name="323106826"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323106826" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323106826">(Jan 23 2023 at 20:00)</a>:</h4>
<p>No, mathport also knows what the user wrote and so an alternative would be to preserve the <code>_root_</code>ness of the original definition instead of resolving and unresolving the name</p>



<a name="323107004"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323107004" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323107004">(Jan 23 2023 at 20:01)</a>:</h4>
<p>If we can do it correctly, I think it would be better to just use it when necessary. We don't preserve lean 3 parentheses either</p>



<a name="323107160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323107160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323107160">(Jan 23 2023 at 20:02)</a>:</h4>
<p>I'm sort of guessing at what is happening because I saw some names that were (inadvertently?) moved into whatever namespace was open at the time, but I didn't look into how that happened. Certainly, there are many other names that do use <code>_root_</code></p>



<a name="323107419"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323107419" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323107419">(Jan 23 2023 at 20:03)</a>:</h4>
<p>an example where it would make a difference is if the lean 3 file had</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">foo</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">_root_.bar</span> <span class="o">:=</span> <span class="mi">2</span>
<span class="kn">namespace</span> <span class="n">A</span>
<span class="kd">def</span> <span class="n">a</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">_root_.b</span> <span class="o">:=</span> <span class="mi">2</span>
<span class="kd">def</span> <span class="n">_root_.A.c</span> <span class="o">:=</span> <span class="mi">3</span>
<span class="kd">end</span> <span class="n">A</span>
</code></pre></div>
<p>then the translated version would be</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">foo</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">bar</span> <span class="o">:=</span> <span class="mi">2</span>
<span class="kn">namespace</span> <span class="n">A</span>
<span class="kd">def</span> <span class="n">a</span> <span class="o">:=</span> <span class="mi">1</span>
<span class="kd">def</span> <span class="n">_root_.b</span> <span class="o">:=</span> <span class="mi">2</span>
<span class="kd">def</span> <span class="n">c</span> <span class="o">:=</span> <span class="mi">3</span>
<span class="kd">end</span> <span class="n">A</span>
</code></pre></div>
<p>if we reconstruct <code>_root_</code>ness</p>



<a name="323107713"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323107713" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323107713">(Jan 23 2023 at 20:05)</a>:</h4>
<p>Right now mathport just never uses <code>_root_</code>, which is definitely wrong</p>



<a name="323107963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323107963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323107963">(Jan 23 2023 at 20:06)</a>:</h4>
<p>it has a heuristic for aligning short names that involves removing the same number of namespaces on both fully qualified names, which can have weird behavior if the lean 3 name is in an unrelated namespace because of use of <code>_root_</code></p>



<a name="323108352"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/mathport%20_root_/near/323108352" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/mathport.20_root_.html#323108352">(Jan 23 2023 at 20:08)</a>:</h4>
<p>OK that might explain some of what I saw</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>