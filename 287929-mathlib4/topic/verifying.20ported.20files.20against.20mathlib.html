---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html">verifying ported files against mathlib</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="310300616"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310300616" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310300616">(Nov 15 2022 at 21:58)</a>:</h4>
<p>What exactly is involved in verifying a ported file against a commit in mathlib? The <code>port-status</code> script says that a bunch of files haven't yet been verified. Is this verification process something the author of the ported file needs to do, or should it be anyone? I'm happy to go around verifying ports.</p>



<a name="310314983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310314983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310314983">(Nov 15 2022 at 23:48)</a>:</h4>
<p>That would be amazing.</p>



<a name="310315003"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310315003" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310315003">(Nov 15 2022 at 23:49)</a>:</h4>
<p>Currently there is no process, because no one has ever done it. :-)</p>



<a name="310315020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310315020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310315020">(Nov 15 2022 at 23:49)</a>:</h4>
<p>But the idea could be:</p>



<a name="310315183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310315183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310315183">(Nov 15 2022 at 23:50)</a>:</h4>
<ul>
<li>open up mathlib at today's master</li>
<li>open up a fully ported file in mathlib4 in a side by side window</li>
<li>scroll through the two, making sure nothing has been missed, or at least that any significant changes are marked with <code>-- Porting note: ...</code></li>
<li>if you find anything bad, either make a mathlib4 PR to fix it, or raise it here</li>
<li>if you don't find anything bad, edit the <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">#port-status</a> wiki to add the git sha for today's mathlib master</li>
</ul>



<a name="310315571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310315571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310315571">(Nov 15 2022 at 23:54)</a>:</h4>
<p>The process just described sounds almost as hard as doing the port in the first place. I think we should instead review the diff between the mathlib version that was ported, and the latest version, and look for equivalents of new things in mathlib4</p>



<a name="310315637"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310315637" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310315637">(Nov 15 2022 at 23:55)</a>:</h4>
<p>The problem is that for now we have no record of the mathlib version that was ported. :-(</p>



<a name="310315670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310315670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310315670">(Nov 15 2022 at 23:55)</a>:</h4>
<p>You can make some inferences from the date that the file was ported</p>



<a name="310315773"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310315773" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310315773">(Nov 15 2022 at 23:56)</a>:</h4>
<p>Sounds good. It will definitely be a bit approximate, but I agree it's too painful to do "properly".</p>



<a name="310315804"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310315804" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310315804">(Nov 15 2022 at 23:56)</a>:</h4>
<p>it's not trivial to diff mathlib and mathlib4 directly because theorems might be entirely gone (having been upstreamed)</p>



<a name="310315856"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310315856" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310315856">(Nov 15 2022 at 23:57)</a>:</h4>
<p>How about we try to fill in best guesses of git sha's today-ish, and then we'll be ready to write some automation that reports changes in mathlib after those sha's.</p>



<a name="310315975"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310315975" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310315975">(Nov 15 2022 at 23:58)</a>:</h4>
<p>one thing that is a bit closer to a diff (in the "set subtraction" sense) of mathlib  - mathlib4 is the post-port contents of the mathport file</p>



<a name="310316061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310316061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310316061">(Nov 15 2022 at 23:59)</a>:</h4>
<p>So how about this as an imperfect-but-doable-today plan:</p>
<ul>
<li>for each ported file in <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">#port-status</a> with a mathlib4 PR number, but no sha</li>
<li>look up the date that PR was opened</li>
<li>take the first mathlib sha from that date, and put it in <a href="https://github.com/leanprover-community/mathlib/wiki/mathlib4-port-status">#port-status</a></li>
<li>decide that any discrepancies that slipped in will come out in wash as we continue porting</li>
</ul>



<a name="310319381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310319381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310319381">(Nov 16 2022 at 00:31)</a>:</h4>
<p>Okay, I can do that tonight.</p>



<a name="310324879"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310324879" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310324879">(Nov 16 2022 at 01:37)</a>:</h4>
<p>When I was finishing up porting a file, I went to mathlib3, looked at the history of the relevant file, checked that I'd ported the last one or two PRs to that file, and then just said that I'd ported the version of the file corresponding to the last commit which touched that file.</p>



<a name="310336676"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310336676" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310336676">(Nov 16 2022 at 04:24)</a>:</h4>
<p>Okay, I've added all the SHAs. Unfortunately, now the <code>port-status</code> script says that all these files have been modified since the commit at which they were verified (presumably because of adding the mathlib4 synchronization label in almost all cases).</p>



<a name="310337286"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310337286" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310337286">(Nov 16 2022 at 04:30)</a>:</h4>
<p>Okay, but now we just need to script that shows the diffs in mathlib3 between the recorded commit and master.</p>



<a name="310337309"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310337309" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310337309">(Nov 16 2022 at 04:30)</a>:</h4>
<p>And that will let us quickly verify that we haven't really missed anything.</p>



<a name="310337431"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310337431" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310337431">(Nov 16 2022 at 04:32)</a>:</h4>
<p>Sure, but presumably we don't want it continually bugging us and making it look like there's things that have changed when they haven't changed meaningfully.</p>



<a name="310337591"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310337591" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310337591">(Nov 16 2022 at 04:35)</a>:</h4>
<p>yeah, the bot needs to detect synchronized message changes (which is one of the reasons I don't like the message, you have to syncronize the synchronization)</p>



<a name="310337660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310337660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310337660">(Nov 16 2022 at 04:36)</a>:</h4>
<p>it could be organized by a tag, or by just ignoring lines with specific content</p>



<a name="310337698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310337698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310337698">(Nov 16 2022 at 04:37)</a>:</h4>
<p>A real hack that could potentially cause false negatives is to just see if the diff is smaller than 5 lines.</p>



<a name="310337715"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310337715" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310337715">(Nov 16 2022 at 04:38)</a>:</h4>
<p>yeah no</p>



<a name="310337764"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310337764" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310337764">(Nov 16 2022 at 04:38)</a>:</h4>
<p>checking if the diff contains <code>SYNCHRONIZED</code> is probably less likely to have a false negative</p>



<a name="310338216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/verifying%20ported%20files%20against%20mathlib/near/310338216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/verifying.20ported.20files.20against.20mathlib.html#310338216">(Nov 16 2022 at 04:45)</a>:</h4>
<p>The conjunction of those two conditions is probably sufficient to guarantee no false negatives.</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>