---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html">Data.Fin.Basic (mathlib4#1084)</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="319680855"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319680855" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319680855">(Jan 05 2023 at 22:03)</a>:</h4>
<p>We could stick that on <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=instOfNat#doc">docs4#instOfNat</a> I guess</p>



<a name="319681021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319681021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319681021">(Jan 05 2023 at 22:05)</a>:</h4>
<p>Unfortunately <code>Data.Fin.Basic</code> is now full of workarounds for what we had before, so it's a bit tricky for me to test out my change</p>



<a name="319683008"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319683008" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319683008">(Jan 05 2023 at 22:20)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/317450264">said</a>:</p>
<blockquote>
<p>Is that true? Lean 3 didn't use mod here so it was irrelevant how it was defined</p>
</blockquote>
<p>I misdiagnosed this; the cause is that in Lean3, this is true:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">:</span> <span class="n">nat.mod</span> <span class="mi">0</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>
<p>but in Lean4, it's not</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">example</span> <span class="o">:</span> <span class="n">Nat.mod</span> <span class="mi">0</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">0</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>
<p>What prevents us using the Lean3 definition of mod here?</p>



<a name="319683088"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319683088" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319683088">(Jan 05 2023 at 22:21)</a>:</h4>
<p>For comparison, the two definitions are (<a href="https://leanprover-community.github.io/mathlib_docs/find/nat.mod">docs#nat.mod</a>)</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">protected</span> <span class="kd">def</span> <span class="n">mod_core</span> <span class="o">(</span><span class="n">y</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">ℕ</span>
<span class="bp">|</span> <span class="mi">0</span> <span class="n">x</span> <span class="o">:=</span> <span class="n">x</span>
<span class="bp">|</span> <span class="o">(</span><span class="n">fuel</span><span class="bp">+</span><span class="mi">1</span><span class="o">)</span> <span class="n">x</span> <span class="o">:=</span> <span class="k">if</span> <span class="n">h</span> <span class="o">:</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">y</span> <span class="bp">∧</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">x</span> <span class="k">then</span> <span class="n">mod_core</span> <span class="n">fuel</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="k">else</span> <span class="n">x</span>

<span class="kn">protected</span> <span class="kd">def</span> <span class="n">mod</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="o">:=</span>
<span class="n">nat.mod_core</span> <span class="n">y</span> <span class="n">x</span> <span class="n">x</span>
</code></pre></div>
<p>and <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.mod#doc">docs4#Nat.mod</a></p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">protected</span> <span class="kd">def</span> <span class="n">mod</span> <span class="o">(</span><span class="n">x</span> <span class="n">y</span> <span class="o">:</span> <span class="bp">@&amp;</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat</span> <span class="o">:=</span>
  <span class="k">if</span> <span class="mi">0</span> <span class="bp">&lt;</span> <span class="n">y</span> <span class="bp">∧</span> <span class="n">y</span> <span class="bp">≤</span> <span class="n">x</span> <span class="k">then</span>
    <span class="n">Nat.mod</span> <span class="o">(</span><span class="n">x</span> <span class="bp">-</span> <span class="n">y</span><span class="o">)</span> <span class="n">y</span>
  <span class="k">else</span>
    <span class="n">x</span>
<span class="n">decreasing_by</span> <span class="n">apply</span> <span class="n">div_rec_lemma</span><span class="bp">;</span> <span class="n">assumption</span>
</code></pre></div>



<a name="319683360"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319683360" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319683360">(Jan 05 2023 at 22:23)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.mod#doc">docs4#Nat.mod</a> -- bleurgh it's in core</p>



<a name="319683557"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319683557" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319683557">(Jan 05 2023 at 22:24)</a>:</h4>
<p>Yeah, so I guess my question should have been "would MSR care if we pushed for the definition we used to have?"</p>



<a name="319683619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319683619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319683619">(Jan 05 2023 at 22:24)</a>:</h4>
<p>Because if we have the old definition, then <code>Fin.val 0 = 0</code> is true by rfl</p>



<a name="319684674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319684674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319684674">(Jan 05 2023 at 22:32)</a>:</h4>
<p>Actually we used to have the lean 4 definition in lean 3 (definition by well founded recursion), it was refactored in community lean because the fuel based definition evaluates by rfl and in decidable instances</p>



<a name="319684775"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319684775" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319684775">(Jan 05 2023 at 22:33)</a>:</h4>
<p>Is that an argument for doing the same in Lean4, or is the claim that Lean4 achieves those goals without the refactor?</p>



<a name="319684896"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319684896" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319684896">(Jan 05 2023 at 22:34)</a>:</h4>
<p>lean4 does not achieve those goals without the refactor, but also refactoring everything to avoid well founded recursion is not a sustainable solution</p>



<a name="319684957"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319684957" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319684957">(Jan 05 2023 at 22:34)</a>:</h4>
<p>div/mod just happen to be especially important definitions</p>



<a name="319685028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319685028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319685028">(Jan 05 2023 at 22:35)</a>:</h4>
<p>I think we would rather have a solution which allows well founded recursions to compute by rfl, without unfolding proofs</p>



<a name="319685065"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319685065" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319685065">(Jan 05 2023 at 22:35)</a>:</h4>
<p>Is there any disadvantage to the Lean3 spelling?</p>



<a name="319685162"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319685162" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319685162">(Jan 05 2023 at 22:36)</a>:</h4>
<p>it's not as good for the compiler, although in this particular case that's probably not a problem since the definition is overridden anyway</p>



<a name="319685175"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319685175" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319685175">(Jan 05 2023 at 22:36)</a>:</h4>
<p>right now the main disadvantage seems to be that it's not the same as the lean 4 spelling. What is the motivation behind changing the definition?</p>



<a name="319685182"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319685182" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319685182">(Jan 05 2023 at 22:36)</a>:</h4>
<p>you don't want the compiled code to actually have a fuel variable</p>



<a name="319685210"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319685210" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319685210">(Jan 05 2023 at 22:36)</a>:</h4>
<p>Kevin, are you asking what my motivation is for changing it back or Leo's for the version that's different from Lean3?</p>



<a name="319685340"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319685340" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319685340">(Jan 05 2023 at 22:38)</a>:</h4>
<p>I guess I'm asking why Leo changed it but I guess actually he didn't change it, we changed it.</p>



<a name="319686081"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319686081" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319686081">(Jan 05 2023 at 22:42)</a>:</h4>
<p>I think the only difficulty in changing the definition In Lean4 to match Lean3 is we have to reprove <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.mod_eq#doc">docs4#Nat.mod_eq</a>; and that's only difficult because I've never written a Lean4 proof before</p>



<a name="319686408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319686408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319686408">(Jan 05 2023 at 22:45)</a>:</h4>
<p>What does the <code>@&amp; Nat</code> mean in the definition? Is this to do with <code>@[extern]</code>?</p>



<a name="319686471"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319686471" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319686471">(Jan 05 2023 at 22:45)</a>:</h4>
<p>it's a borrow annotation, these are only relevant for <code>@[extern]</code>s</p>



<a name="319686553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319686553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Henrik Böving <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319686553">(Jan 05 2023 at 22:46)</a>:</h4>
<p>It does not make any type theoretic difference, it's just meta data in an Expr tree</p>



<a name="319686805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319686805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319686805">(Jan 05 2023 at 22:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/319686081">said</a>:</p>
<blockquote>
<p>I think the only difficulty in changing the definition In Lean4 to match Lean3 is we have to reprove <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.mod_eq#doc">docs4#Nat.mod_eq</a>; and that's only difficult because I've never written a Lean4 proof before</p>
</blockquote>
<p>Isn't that proof in lean 3 already? You should be able to use the mathported lean 3 proof</p>



<a name="319686821"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319686821" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319686821">(Jan 05 2023 at 22:48)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/nat.mod_eq">docs#nat.mod_eq</a> doesn't exist</p>



<a name="319686877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319686877" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319686877">(Jan 05 2023 at 22:48)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/nat.mod_def">docs#nat.mod_def</a></p>



<a name="319687023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319687023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319687023">(Jan 05 2023 at 22:49)</a>:</h4>
<p>I wonder if we can make a <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Nat.mod_eq#doc">align#nat.mod_def</a> linkifier</p>



<a name="319687144"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319687144" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319687144">(Jan 05 2023 at 22:50)</a>:</h4>
<p>How can I find the mathport output? Based on what you said in the meeting, mathport removes its own output once someone ports it</p>



<a name="319687189"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319687189" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319687189">(Jan 05 2023 at 22:50)</a>:</h4>
<p>it's in the <a href="https://github.com/leanprover-community/mathlib3port">mathlib3port</a> repo</p>



<a name="319687228"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319687228" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319687228">(Jan 05 2023 at 22:51)</a>:</h4>
<p>Do I have to go back to an old commit?</p>



<a name="319687276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319687276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319687276">(Jan 05 2023 at 22:51)</a>:</h4>
<p>Or does "mathport output" not mean the same thing as "stuff in mathlib3port"?</p>



<a name="319687395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319687395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319687395">(Jan 05 2023 at 22:52)</a>:</h4>
<p>I'm confused by the question. mathport output means stuff in mathlib3port, but you will see the <code>#print</code>s in new (post-port) commits, not old ones</p>



<a name="319687698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319687698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319687698">(Jan 05 2023 at 22:54)</a>:</h4>
<p>Either way, I found the code at <a href="https://github.com/leanprover-community/lean3port/blob/master/Leanbin/Init/Data/Nat/Lemmas.lean#L1318-L1345">https://github.com/leanprover-community/lean3port/blob/master/Leanbin/Init/Data/Nat/Lemmas.lean#L1318-L1345</a></p>



<a name="319687768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319687768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319687768">(Jan 05 2023 at 22:54)</a>:</h4>
<p>The <code>·</code> syntax is unfortunately causing trouble</p>



<a name="319688104"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319688104" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319688104">(Jan 05 2023 at 22:57)</a>:</h4>
<p>what trouble?</p>



<a name="319688334"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319688334" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319688334">(Jan 05 2023 at 22:58)</a>:</h4>
<p>I get "expected command" if  I paste that output in the file in coer</p>



<a name="319688347"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319688347" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319688347">(Jan 05 2023 at 22:58)</a>:</h4>
<p>I would guess it's using syntax that isn't available yet there</p>



<a name="319688745"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319688745" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319688745">(Jan 05 2023 at 23:01)</a>:</h4>
<p>the dot syntax is available in core, but <code>induction'</code> isn't</p>



<a name="319688798"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319688798" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319688798">(Jan 05 2023 at 23:01)</a>:</h4>
<p>everything else looks ok</p>



<a name="319695132"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319695132" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319695132">(Jan 05 2023 at 23:54)</a>:</h4>
<p>24 messages were moved from this topic to <a class="stream-topic" data-stream-id="287929" href="/#narrow/stream/287929-mathlib4/topic/Nat.2Emod.200.20n.20.3D.200.20no.20longer.20true.20by.20rfl">#mathlib4 &gt; Nat.mod 0 n = 0 no longer true by rfl</a> by <span class="user-mention silent" data-user-id="310045">Eric Wieser</span>.</p>



<a name="319754712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319754712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319754712">(Jan 06 2023 at 10:38)</a>:</h4>
<p>This file is now error free, except for the last 10 lines:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- Note that here we are disabling the "safety" of reflected, to allow us to reuse `nat.mk_numeral`.</span>
<span class="c1">-- The usual way to provide the required `reflected` instance would be via rewriting to prove that</span>
<span class="c1">-- the expression we use here is equivalent.</span>
<span class="kn">attribute</span> <span class="o">[</span><span class="kn">local</span> <span class="n">semireducible</span><span class="o">]</span> <span class="n">reflected</span>

<span class="n">unsafe</span> <span class="kd">instance</span> <span class="n">reflect</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">n</span><span class="o">,</span> <span class="n">has_reflect</span> <span class="o">(</span><span class="n">Fin</span> <span class="n">n</span><span class="o">)</span>
  <span class="bp">|</span> <span class="mi">0</span> <span class="bp">=&gt;</span> <span class="n">finZeroElim</span>
  <span class="bp">|</span> <span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span> <span class="bp">=&gt;</span>
    <span class="n">nat.mk_numeral</span> <span class="n">q</span><span class="o">(</span><span class="n">Fin</span> <span class="n">n.succ</span><span class="o">)</span> <span class="n">q</span><span class="o">((</span><span class="kd">by</span> <span class="n">infer_instance</span> <span class="o">:</span> <span class="n">Zero</span> <span class="o">(</span><span class="n">Fin</span> <span class="n">n.succ</span><span class="o">)))</span>
        <span class="n">q</span><span class="o">((</span><span class="kd">by</span> <span class="n">infer_instance</span> <span class="o">:</span> <span class="n">One</span> <span class="o">(</span><span class="n">Fin</span> <span class="n">n.succ</span><span class="o">)))</span> <span class="n">q</span><span class="o">((</span><span class="kd">by</span> <span class="n">infer_instance</span> <span class="o">:</span> <span class="n">Add</span> <span class="o">(</span><span class="n">Fin</span> <span class="n">n.succ</span><span class="o">)))</span> <span class="bp">∘</span>
      <span class="n">Fin.val</span>
<span class="bp">#</span><span class="n">align</span> <span class="n">fin.reflect</span> <span class="n">fin.reflect</span>
</code></pre></div>



<a name="319754754"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319754754" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319754754">(Jan 06 2023 at 10:38)</a>:</h4>
<p><code>#lookup3 has_reflect</code> doesn't give me output. What is the Lean 4 equivalent of <code>has_reflect</code>?</p>



<a name="319754930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319754930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319754930">(Jan 06 2023 at 10:40)</a>:</h4>
<p>meta code = ignore</p>



<a name="319754980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319754980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319754980">(Jan 06 2023 at 10:40)</a>:</h4>
<p>just remove it</p>



<a name="319755061"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319755061" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319755061">(Jan 06 2023 at 10:41)</a>:</h4>
<p>(we should <code>#noalign has_reflect</code> to make this clearer)</p>



<a name="319755369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319755369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319755369">(Jan 06 2023 at 10:43)</a>:</h4>
<p>Where should we <code>#noalign</code> ?</p>



<a name="319755545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319755545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319755545">(Jan 06 2023 at 10:44)</a>:</h4>
<p>same place as the lean 3 definition</p>



<a name="319755597"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319755597" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319755597">(Jan 06 2023 at 10:44)</a>:</h4>
<p>which is core, I guess?</p>



<a name="319755654"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319755654" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319755654">(Jan 06 2023 at 10:44)</a>:</h4>
<p>Somehow <code>Mathlib.Init</code> is really hard for people to discover</p>



<a name="319755753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319755753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319755753">(Jan 06 2023 at 10:45)</a>:</h4>
<p>actually it's probably in the meta code in init so there is probably a heading for it in <code>Mathlib.Init.Align</code></p>



<a name="319756111"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319756111" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319756111">(Jan 06 2023 at 10:47)</a>:</h4>
<p>Is the convention to <code>#noalign</code> <code>Fin.reflect</code> too?</p>



<a name="319756536"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319756536" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319756536">(Jan 06 2023 at 10:50)</a>:</h4>
<p>instances are usually not aligned unless they are referred to by name in lean 3</p>



<a name="319757168"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319757168" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319757168">(Jan 06 2023 at 10:54)</a>:</h4>
<p>The <code>reflect</code> instances seem to always be given explicit names</p>



<a name="319757240"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319757240" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319757240">(Jan 06 2023 at 10:55)</a>:</h4>
<p>If we don't align instances, doesn't that mean we can't use mathport to check if we ported them?</p>



<a name="319757845"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319757845" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319757845">(Jan 06 2023 at 10:58)</a>:</h4>
<p>mathport currently can't provide <code>#align</code> statements for instances even if it wanted to because it doesn't know the instance naming convention</p>



<a name="319758452"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319758452" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319758452">(Jan 06 2023 at 11:02)</a>:</h4>
<p>Doesn't understand the mathlib3 or mathlib4 conventions?</p>



<a name="319758482"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319758482" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319758482">(Jan 06 2023 at 11:02)</a>:</h4>
<p>Presumably it has access to the mathlib3 name by inspection?</p>



<a name="319758652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319758652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319758652">(Jan 06 2023 at 11:03)</a>:</h4>
<p>it doesn't</p>



<a name="319758802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319758802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319758802">(Jan 06 2023 at 11:04)</a>:</h4>
<p>it's part of a general class of issues due to the fact that we don't know for a given syntax which declarations correspond to it, unless we have something like an identifier <code>foo</code> in <code>def foo</code> to give us a hint where to look</p>



<a name="319758907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319758907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319758907">(Jan 06 2023 at 11:05)</a>:</h4>
<p>I'd like to fix this by adding some landmarks in the tlean file corresponding to the beginning of a new command</p>



<a name="319759057"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319759057" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319759057">(Jan 06 2023 at 11:06)</a>:</h4>
<p>so that we can say that everything between one landmark and the next is "owned" by that command and synport can combine that with the AST info to list all the <code>#align</code> commands needed</p>



<a name="319759108"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319759108" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319759108">(Jan 06 2023 at 11:06)</a>:</h4>
<p>that will fix <code>to_additive</code>, <code>simps</code>, <code>alias</code> and lots of other commands that add declarations in a weird way</p>



<a name="319762501"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319762501" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319762501">(Jan 06 2023 at 11:28)</a>:</h4>
<p>There are four simpNF linting errors left.</p>



<a name="319762563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319762563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319762563">(Jan 06 2023 at 11:29)</a>:</h4>
<p>With two, the linter claimes <code>simp can prove this</code>. But if you try <code>by simp</code> then it actually fails.</p>



<a name="319763019"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319763019" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319763019">(Jan 06 2023 at 11:32)</a>:</h4>
<p>Can we minimise and open a std4 issue if there is not already an issue? I remember writing one at some point but then not tracking it</p>



<a name="319763878"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319763878" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319763878">(Jan 06 2023 at 11:37)</a>:</h4>
<p>I dunno how to do that. If some expert can take a look at these final four errors, that would be great.</p>



<a name="319797667"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319797667" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319797667">(Jan 06 2023 at 14:57)</a>:</h4>
<p>Is there any reason to keep the AdHoc version around:<br>
<a href="https://github.com/leanprover-community/mathlib4/pull/1084/files#diff-c18192a96f99c01756605bb84a74796b3842d271b2afed5aa23f62a241853dc9">https://github.com/leanprover-community/mathlib4/pull/1084/files#diff-c18192a96f99c01756605bb84a74796b3842d271b2afed5aa23f62a241853dc9</a></p>



<a name="319797691"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319797691" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319797691">(Jan 06 2023 at 14:57)</a>:</h4>
<p>I would be happy to ditch it.</p>



<a name="319798039"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319798039" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319798039">(Jan 06 2023 at 14:59)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="307953">@Ruben Van de Velde</span> <span class="user-mention" data-user-id="110049">@Mario Carneiro</span></p>



<a name="319798874"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319798874" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319798874">(Jan 06 2023 at 15:02)</a>:</h4>
<p>I have no opinion</p>



<a name="319798944"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319798944" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319798944">(Jan 06 2023 at 15:02)</a>:</h4>
<p>I think you created the file. So if you don't care, let's remove it.</p>



<a name="319800105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319800105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319800105">(Jan 06 2023 at 15:09)</a>:</h4>
<p>Looks like it dates back to <a href="https://github.com/leanprover-community/mathlib4/pull/84">mathlib4#84</a>, but Scott moved some things there in my <a href="https://github.com/leanprover-community/mathlib4/pull/729">mathlib4#729</a></p>



<a name="319800261"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319800261" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319800261">(Jan 06 2023 at 15:10)</a>:</h4>
<p>Well, if someone needs it, we know where to find it.</p>



<a name="319800335"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319800335" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319800335">(Jan 06 2023 at 15:10)</a>:</h4>
<p>There's a weird CI build failure: <a href="https://github.com/leanprover-community/mathlib4/actions/runs/3856247402/jobs/6572230703">https://github.com/leanprover-community/mathlib4/actions/runs/3856247402/jobs/6572230703</a></p>
<p>I can't reproduce it locally</p>



<a name="319800623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319800623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319800623">(Jan 06 2023 at 15:12)</a>:</h4>
<p>Ooh, actually I can reproduce. But I'm very surprised by the fact that this PR breaks <code> Mathlib.Testing.SlimCheck.Sampleable</code></p>



<a name="319800950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319800950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319800950">(Jan 06 2023 at 15:14)</a>:</h4>
<p>Maybe that depended on the ad hoc port?</p>



<a name="319800983"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319800983" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319800983">(Jan 06 2023 at 15:14)</a>:</h4>
<p>In a pretty bad way, if that's the case</p>



<a name="319801339"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319801339" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319801339">(Jan 06 2023 at 15:16)</a>:</h4>
<p><code>Mathlib.Mathport.Syntax</code> is also broken, it seems</p>



<a name="319801772"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319801772" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319801772">(Jan 06 2023 at 15:18)</a>:</h4>
<p>Ooh, maybe it isn't, and the output in the logs was just garbled up</p>



<a name="319805661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319805661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319805661">(Jan 06 2023 at 15:40)</a>:</h4>
<p>I have to stop for a bit. If someone else wants to fix these, that would be great.</p>



<a name="319805783"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319805783" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319805783">(Jan 06 2023 at 15:41)</a>:</h4>
<p>The broken files seem to be</p>
<ul>
<li><code>Mathlib.Testing.SlimCheck.Sampleable</code></li>
<li><code>Mathlib.Data.UInt</code></li>
</ul>



<a name="319926027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319926027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319926027">(Jan 07 2023 at 09:28)</a>:</h4>
<p>The AdHoc port contains</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">variables</span> <span class="o">[</span><span class="n">Nonempty</span> <span class="o">(</span><span class="n">Fin</span> <span class="n">n</span><span class="o">)]</span>

<span class="kd">instance</span> <span class="o">:</span> <span class="n">AddMonoidWithOne</span> <span class="o">(</span><span class="n">Fin</span> <span class="n">n</span><span class="o">)</span> <span class="n">where</span>
  <span class="n">__</span> <span class="o">:=</span> <span class="n">inferInstanceAs</span> <span class="o">(</span><span class="n">AddCommMonoid</span> <span class="o">(</span><span class="n">Fin</span> <span class="n">n</span><span class="o">))</span>
  <span class="n">natCast</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">Fin.ofNat'</span> <span class="n">n</span> <span class="n">Fin.size_positive'</span>
  <span class="n">natCast_zero</span> <span class="o">:=</span> <span class="n">rfl</span>
  <span class="n">natCast_succ</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">Fin.ofNat'_succ</span>
</code></pre></div>
<p>whereas the ported files has</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="o">:</span> <span class="n">AddMonoidWithOne</span> <span class="o">(</span><span class="n">Fin</span> <span class="o">(</span><span class="n">n</span> <span class="bp">+</span> <span class="mi">1</span><span class="o">))</span> <span class="o">:=</span>
  <span class="o">{</span> <span class="n">Fin.addCommMonoid</span> <span class="n">n</span> <span class="k">with</span>
    <span class="n">one</span> <span class="o">:=</span> <span class="mi">1</span>
    <span class="n">natCast</span> <span class="o">:=</span> <span class="n">Fin.ofNat</span>
    <span class="n">natCast_zero</span> <span class="o">:=</span> <span class="n">rfl</span>
    <span class="n">natCast_succ</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="bp">=&gt;</span> <span class="n">eq_of_veq</span> <span class="o">(</span><span class="n">add_mod</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span> <span class="o">}</span>
</code></pre></div>



<a name="319926047"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319926047" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319926047">(Jan 07 2023 at 09:28)</a>:</h4>
<p>This causes trouble in <code>Mathlib.Data.UInt</code>.</p>



<a name="319926054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319926054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319926054">(Jan 07 2023 at 09:28)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> <span class="user-mention" data-user-id="110087">@Scott Morrison</span> what do we do?</p>



<a name="319926116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319926116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319926116">(Jan 07 2023 at 09:29)</a>:</h4>
<p>Didn't the ad hoc port mention this in a comment?</p>



<a name="319926160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319926160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319926160">(Jan 07 2023 at 09:29)</a>:</h4>
<p>Ooh, maybe it did...</p>



<a name="319926244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319926244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319926244">(Jan 07 2023 at 09:30)</a>:</h4>
<p>the adhoc port version seems more flexible. Don't we have something like this in <code>data.zmod</code>?</p>



<a name="319926275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319926275" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319926275">(Jan 07 2023 at 09:30)</a>:</h4>
<p>could we maybe try a backport?</p>



<a name="319926313"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319926313" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319926313">(Jan 07 2023 at 09:31)</a>:</h4>
<p>Alternatively, do we need the uint code right now?</p>



<a name="319926425"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319926425" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319926425">(Jan 07 2023 at 09:32)</a>:</h4>
<p>We don't (for mathlib), but it is likely to move to std so we should try not to make any decisions mutually exclusive with it</p>



<a name="319926469"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319926469" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319926469">(Jan 07 2023 at 09:32)</a>:</h4>
<p>Ok, I'll switch to the nonempty instance and add a porting note.</p>



<a name="319929475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319929475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319929475">(Jan 07 2023 at 09:58)</a>:</h4>
<p>I've pulled in some of the stuff from the AdHoc port</p>



<a name="319929513"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319929513" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319929513">(Jan 07 2023 at 09:59)</a>:</h4>
<p>But <code>Data.UInt</code> still has errors</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">genIntDeclars</span> <span class="n">UInt8</span>
<span class="n">genIntDeclars</span> <span class="n">UInt16</span>
<span class="n">genIntDeclars</span> <span class="n">UInt32</span>
<span class="n">genIntDeclars</span> <span class="n">UInt64</span>
<span class="n">genIntDeclars</span> <span class="n">USize</span>
</code></pre></div>



<a name="319929555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319929555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319929555">(Jan 07 2023 at 09:59)</a>:</h4>
<p>This is some macro with pretty mysterious error reporting.</p>



<a name="319929742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319929742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319929742">(Jan 07 2023 at 10:00)</a>:</h4>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Could you please take a look? I have no clue at all what we want this file to look like.</p>



<a name="319930105"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319930105" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319930105">(Jan 07 2023 at 10:02)</a>:</h4>
<p>I believe the macro is just a fancy copy-paste which proves the same theorems for each size of integer</p>



<a name="319930475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319930475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319930475">(Jan 07 2023 at 10:05)</a>:</h4>
<p>a trick to get better error messages is to find/replace <code>$typeName</code> with <code>UInt8</code> and then remove the syntax quotation and macro declaration to make it just a bunch of regular definitions</p>



<a name="319930953"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319930953" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319930953">(Jan 07 2023 at 10:09)</a>:</h4>
<p>I can't really help with the error message without more context though:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- set_option hygiene false</span>
<span class="c1">-- /-- `genIntDeclars UInt8` generates a `CommRing UInt8` instance.  -/</span>
<span class="c1">-- local macro "genIntDeclars" typeName:ident : command =&gt; do</span>
<span class="c1">--   `(</span>
    <span class="kn">namespace</span> <span class="n">UInt8</span>
      <span class="kd">instance</span> <span class="o">:</span> <span class="n">Inhabited</span> <span class="o">(</span><span class="n">Fin</span> <span class="n">size</span><span class="o">)</span> <span class="n">where</span>
        <span class="n">default</span> <span class="o">:=</span> <span class="n">Fin.ofNat'</span> <span class="mi">0</span> <span class="n">size_positive</span>

      <span class="kd">instance</span> <span class="o">:</span> <span class="n">AddSemigroup</span> <span class="n">UInt8</span> <span class="n">where</span>
        <span class="n">add_assoc</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">↦</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">AddSemigroup.add_assoc</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">]</span>

      <span class="kd">instance</span> <span class="o">:</span> <span class="n">AddCommSemigroup</span> <span class="n">UInt8</span> <span class="n">where</span>
        <span class="n">add_comm</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">↦</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">AddCommSemigroup.add_comm</span> <span class="n">_</span> <span class="n">_</span><span class="o">]</span>

      <span class="kd">instance</span> <span class="o">:</span> <span class="n">Semigroup</span> <span class="n">UInt8</span> <span class="n">where</span>
        <span class="n">mul_assoc</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">↦</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">Semigroup.mul_assoc</span> <span class="n">_</span> <span class="n">_</span> <span class="n">_</span><span class="o">]</span>
</code></pre></div>
<p>we get some errors here saying it can't find <code>?a + ?b + ?c</code>, I guess some typeclasses have been redefined or something</p>



<a name="319932481"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319932481" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319932481">(Jan 07 2023 at 10:21)</a>:</h4>
<p>I got everything working by using a less weird proof for those instances, the only thing that is still broken is here:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code>      <span class="kd">instance</span> <span class="o">:</span> <span class="n">Ring</span> <span class="n">UInt8</span> <span class="n">where</span>
        <span class="n">sub_eq_add_neg</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">↦</span> <span class="n">congrArg</span> <span class="n">mk</span> <span class="o">(</span><span class="n">sub_eq_add_neg</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span>
        <span class="n">add_left_neg</span> <span class="o">:=</span> <span class="k">fun</span> <span class="n">a</span> <span class="bp">↦</span> <span class="kd">by</span> <span class="n">apply</span> <span class="n">eq_of_val_eq</span><span class="bp">;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">neg_def</span><span class="o">,</span> <span class="n">add_def</span><span class="o">,</span> <span class="n">zero_def</span><span class="o">]</span>
        <span class="n">intCast</span> <span class="n">n</span> <span class="o">:=</span> <span class="o">⟨</span><span class="n">Int.cast</span> <span class="n">n</span><span class="o">⟩</span>
        <span class="n">intCast_ofNat</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">rfl</span>
        <span class="n">intCast_negSucc</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">rfl</span>
</code></pre></div>
<p>the <code>⟨Int.cast n⟩</code> doesn't work because it is looking for <code>IntCast (Fin size)</code> where <code>size</code> is <code>UInt8.size</code>, i.e. 256</p>



<a name="319932585"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319932585" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319932585">(Jan 07 2023 at 10:22)</a>:</h4>
<p>Previously this worked because of a previous instance of <code>Inhabited (Fin size)</code> together with the instance you mentioned above</p>



<a name="319932590"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319932590" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319932590">(Jan 07 2023 at 10:22)</a>:</h4>
<p>So maybe we need to grab even more from the AdHoc port?</p>



<a name="319932669"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319932669" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319932669">(Jan 07 2023 at 10:22)</a>:</h4>
<p>I'm not sure what you did exactly to the instances, but we need to know that <code>Fin n</code> is a ring when <code>n &gt; 0</code></p>



<a name="319932758"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319932758" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319932758">(Jan 07 2023 at 10:23)</a>:</h4>
<p>we need to spell <code>n &gt; 0</code> somehow but it can't be <code>n := n' + 1</code> because we want to use things like <code>UInt8.size</code> which are not syntactically of that form</p>



<a name="319932823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319932823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319932823">(Jan 07 2023 at 10:24)</a>:</h4>
<p>The way that was used in the adhoc file was <code>Nonempty (Fin n)</code></p>



<a name="319932838"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319932838" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319932838">(Jan 07 2023 at 10:24)</a>:</h4>
<p>we can also use <code>Fact (0 &lt; n)</code> once that is ported</p>



<a name="319932928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319932928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319932928">(Jan 07 2023 at 10:25)</a>:</h4>
<p>I think I did <code>CommSemiRing</code></p>



<a name="319932941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319932941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319932941">(Jan 07 2023 at 10:25)</a>:</h4>
<p>So that will explain the failure.</p>



<a name="319933178"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319933178" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319933178">(Jan 07 2023 at 10:27)</a>:</h4>
<p>I pushed my fixes for everything other than the missing <code>Ring (Fin n)</code> instance</p>



<a name="319933266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319933266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Bailey <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319933266">(Jan 07 2023 at 10:28)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/319929742">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> Could you please take a look? I have no clue at all what we want this file to look like.</p>
</blockquote>
<p>I added the macro after doing the original version of <code>Fin</code> some time ago when a lot of things were still in the experimentation phase. The convenience factor was that you wouldn't have to track down every integer size when there was a change/experiment implicating one of the items in the macro or its dependencies.</p>
<p>FWIW I agree with Mario that once you guys are relatively happy with the interface for the UInt types, the UX is probably nicer if there are individual non-macro definitions. Rust left these kinds of macro invocations in the source and it is frustrating sometimes to be directed to that in the docs.</p>



<a name="319933441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319933441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319933441">(Jan 07 2023 at 10:29)</a>:</h4>
<p>I was thinking the macro could be improved by doing it all in one command, something like <code>run_cmd for typeName in [`UInt8, ...] do elabCommand `(...)</code> since I think the error messages will go to the right place in that case</p>



<a name="319933564"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319933564" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319933564">(Jan 07 2023 at 10:30)</a>:</h4>
<p>or we can declare a fancier macro-macro to fix the error messages</p>



<a name="319933646"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319933646" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319933646">(Jan 07 2023 at 10:30)</a>:</h4>
<p>in principle there isn't anything stopping this kind of pattern from being just as usable as any other command</p>



<a name="319933805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319933805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319933805">(Jan 07 2023 at 10:32)</a>:</h4>
<p>it's just not worth investing too much on a macro that is used only once</p>



<a name="319933858"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319933858" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Bailey <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319933858">(Jan 07 2023 at 10:32)</a>:</h4>
<p>I'll look into improving the macro.</p>



<a name="319934470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319934470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319934470">(Jan 07 2023 at 10:37)</a>:</h4>
<p>Another related work is <code>@[to_additive]</code>, which is also doing a similar copy paste job. We could have a version of <code>to_additive</code> which replaces <code>UInt8</code> stuff by <code>UIntN</code></p>



<a name="319935012"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319935012" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319935012">(Jan 07 2023 at 10:42)</a>:</h4>
<p>Hurray! Errors are gone</p>



<a name="319944461"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319944461" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319944461">(Jan 07 2023 at 11:53)</a>:</h4>
<p>CI gives a green <span aria-label="check" class="emoji emoji-2705" role="img" title="check">:check:</span></p>



<a name="319945660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319945660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319945660">(Jan 07 2023 at 12:02)</a>:</h4>
<p>Does that adhoc port AddMonoidWirhOne instance create a diamond with the OfNat instance in core?</p>



<a name="319957005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/319957005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#319957005">(Jan 07 2023 at 13:28)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> I have absolutely no clue.</p>



<a name="320021923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320021923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320021923">(Jan 08 2023 at 00:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/319926275">said</a>:</p>
<blockquote>
<p>could we maybe try a backport?</p>
</blockquote>
<p>I really think we should do this, rather than doing the refactor in the port and hoping that it won't cause us trouble later. If we do all the hard work refactoring in Lean3, then mathport will do all the lean4 work for us. If we do the refactoring in Lean4, we won't know whether it works everywhere until the port is done</p>



<a name="320041644"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320041644" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320041644">(Jan 08 2023 at 06:29)</a>:</h4>
<p>I'm not yet convinced that we should switch to <code>Nonempty (Fin n)</code> in the first place.<br>
<span class="user-mention" data-user-id="110049">@Mario Carneiro</span> Why is the ad hoc port of <code>Data/UInt.lean</code> doing something different from the Lean 3 version of the file?</p>



<a name="320041661"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320041661" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320041661">(Jan 08 2023 at 06:29)</a>:</h4>
<p>again, if we only have an instance of <code>Fin (n + 1)</code> then <code>Fin size</code> doesn't work</p>



<a name="320041666"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320041666" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320041666">(Jan 08 2023 at 06:29)</a>:</h4>
<p><code>Data.UInt</code> is a new file, not a port</p>



<a name="320041722"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320041722" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320041722">(Jan 08 2023 at 06:30)</a>:</h4>
<p><code>UInt8</code> didn't exist in lean 3</p>



<a name="320041853"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320041853" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320041853">(Jan 08 2023 at 06:32)</a>:</h4>
<p>I'm not saying we need to use <code>Nonempty (Fin n)</code>, but we need something isomorphic to it: <code>Inhabited (Fin n)</code>, <code>Fact (0 &lt; n)</code>, <code>NeZero n</code> are all possible alternatives</p>



<a name="320041866"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320041866" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320041866">(Jan 08 2023 at 06:32)</a>:</h4>
<p>that is, a typeclass on <code>n</code> that says it is not zero</p>



<a name="320041990"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320041990" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320041990">(Jan 08 2023 at 06:35)</a>:</h4>
<p>otherwise you get things like this (using the lean 4 core instance, which is defined for <code>Fin (n+1)</code>):</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">Fin</span> <span class="n">UInt8.size</span><span class="o">)</span>
<span class="c1">-- failed to synthesize instance</span>
<span class="c1">--   OfNat (Fin UInt8.size) 1</span>

<span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">UInt8</span><span class="o">)</span> <span class="bp">=</span> <span class="o">⟨</span><span class="mi">1</span><span class="o">⟩</span> <span class="o">:=</span> <span class="n">rfl</span>
<span class="c1">-- failed to synthesize instance</span>
<span class="c1">--   OfNat (Fin UInt8.size) 1</span>
</code></pre></div>



<a name="320056946"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320056946" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320056946">(Jan 08 2023 at 10:09)</a>:</h4>
<p>Can we delete <code>UInt</code> and add it back (along with the needed refactor) after the port? It sounds like the ad hoc stuff just gets in the way of porting here</p>



<a name="320057871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320057871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320057871">(Jan 08 2023 at 10:20)</a>:</h4>
<p>I don't think this is a constructive approach to new lean 4 features. This is like saying we can't be bothered to implement <code>ByteString</code> theorems because it wasn't there in lean 3</p>



<a name="320057969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320057969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320057969">(Jan 08 2023 at 10:21)</a>:</h4>
<p>If anything, the file is a candidate to move to std, but that doesn't solve any of the problems you are talking about and I don't want mathlib to make it impossible to have this file</p>



<a name="320058018"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320058018" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320058018">(Jan 08 2023 at 10:22)</a>:</h4>
<p>this is not an ad hoc port, it is a new file</p>



<a name="320058823"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320058823" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320058823">(Jan 08 2023 at 10:32)</a>:</h4>
<p>I don't think we should spend any time thinking about ByteString theorems until the port is done</p>



<a name="320059247"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320059247" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320059247">(Jan 08 2023 at 10:37)</a>:</h4>
<p>I don't think it is mathlib's call to say what other projects are doing</p>



<a name="320059336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320059336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320059336">(Jan 08 2023 at 10:38)</a>:</h4>
<p>you are talking about restricting not just mathlib but also core/std here</p>



<a name="320059408"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320059408" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320059408">(Jan 08 2023 at 10:39)</a>:</h4>
<p>you may as well say lean 4 itself is getting in the way of the port. Which I suppose is true but overcoming those hurdles is exactly the point of porting</p>



<a name="320059547"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320059547" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320059547">(Jan 08 2023 at 10:41)</a>:</h4>
<p>We have new primitives now. We need to deal with it</p>



<a name="320062791"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320062791" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320062791">(Jan 08 2023 at 11:17)</a>:</h4>
<p>I think the thing that I don't get here is why mathlib4 <em>during its porting stage</em> needs to provide any theorems about <code>UintXX</code></p>



<a name="320062880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320062880" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320062880">(Jan 08 2023 at 11:18)</a>:</h4>
<p>Generalizing things in a way that works with new Lean4 primitives (from core / std) is great, but if those primitives aren't used anywhere in mathlib then why bother solving that before the port is done?</p>



<a name="320072092"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320072092" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320072092">(Jan 08 2023 at 12:49)</a>:</h4>
<p>I am totally fine with moving this file out of mathlib. But if it moves to std we'll have the same theorems and the same instances causing the same problems. Maybe it will be easier to handle the problem if it is considered "out of our hands" in that way, but it's mostly just a shell game. But I don't want us to drop the theorems without replacement or moving them somewhere upstream, and I don't want std picking up said theorems to make it incompatible with mathlib, so in the end we still have to deal with the fallout.</p>



<a name="320073945"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320073945" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320073945">(Jan 08 2023 at 13:06)</a>:</h4>
<blockquote>
<p>in the end we still have to deal with the fallout.</p>
</blockquote>
<p>I completely agree; I just think mid-port is not the time to do this because it risks creating fallout for the &gt;80% of mathlib that we haven't tried to port yet</p>



<a name="320172598"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320172598" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320172598">(Jan 09 2023 at 08:46)</a>:</h4>
<p>Is there anyone who has the time and energy to attempt to backport this refactor of <code>Fin n</code> to mathlib3?</p>



<a name="320173412"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320173412" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320173412">(Jan 09 2023 at 08:51)</a>:</h4>
<p>I'll give it a go. What do I have to do?</p>



<a name="320176462"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320176462" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320176462">(Jan 09 2023 at 09:08)</a>:</h4>
<p>The instances for <code>Fin n</code> being a ring or having numerals etc should depend on an instance of <code>ne_zero n</code>, rather than being hard-coded to <code>Fin (n+1)</code></p>



<a name="320176556"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320176556" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320176556">(Jan 09 2023 at 09:09)</a>:</h4>
<p>I think the relevant code is partly in core which is one of the reasons it wasn't refactored earlier</p>



<a name="320177281"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320177281" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320177281">(Jan 09 2023 at 09:14)</a>:</h4>
<p>Since <code>ne_zero</code> is not available in core, I think we can also use <code>nonempty (fin n)</code>.</p>



<a name="320177319"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320177319" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320177319">(Jan 09 2023 at 09:14)</a>:</h4>
<p>That shouldn't make too much of a difference.</p>



<a name="320177614"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320177614" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320177614">(Jan 09 2023 at 09:16)</a>:</h4>
<p>One thing to note is that the it sounds like in Lean 4 we're going to end up with a <code>Fin n.succ</code> instance in core, and a <code>Fin n</code> instance in mathlib</p>



<a name="320177684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320177684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320177684">(Jan 09 2023 at 09:17)</a>:</h4>
<p>I think they'll be defeq so this isn't an issue</p>



<a name="320177712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320177712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320177712">(Jan 09 2023 at 09:17)</a>:</h4>
<p>But it means that we don't need to backport to lean 3 core, only to mathlib 3</p>



<a name="320179673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320179673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320179673">(Jan 09 2023 at 09:28)</a>:</h4>
<p>Could I just add the <code>ne_zero</code> instance in mathlib and make sure it's defeq?</p>



<a name="320179692"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320179692" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320179692">(Jan 09 2023 at 09:28)</a>:</h4>
<p>And leave core alone?</p>



<a name="320180296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320180296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320180296">(Jan 09 2023 at 09:32)</a>:</h4>
<p>I think that's what Eric is suggesting.</p>



<a name="320188915"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320188915" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320188915">(Jan 09 2023 at 10:17)</a>:</h4>
<p>The only slight downside of that approach is that the lemmas in core like <a href="https://leanprover-community.github.io/mathlib_docs/find/fin.val_zero">docs#fin.val_zero</a> refer to the weaker instance. I think we ignore those lemmas anyway though.</p>



<a name="320198224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320198224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320198224">(Jan 09 2023 at 11:05)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/18107">https://github.com/leanprover-community/mathlib/pull/18107</a></p>



<a name="320198714"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320198714" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320198714">(Jan 09 2023 at 11:08)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> Thanks a lot! Did you already test locally whether it compiles?</p>



<a name="320198737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320198737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320198737">(Jan 09 2023 at 11:08)</a>:</h4>
<p>No</p>



<a name="320198753"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320198753" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320198753">(Jan 09 2023 at 11:08)</a>:</h4>
<p>Also, can't you golf <code>one_mul</code> using <code>mul_comm</code>?</p>



<a name="320198828"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320198828" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320198828">(Jan 09 2023 at 11:09)</a>:</h4>
<p>I know the data/fin folder compiles though</p>



<a name="320214473"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320214473" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yakov Pechersky <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320214473">(Jan 09 2023 at 12:32)</a>:</h4>
<p>A while back, I started this refactor, <a href="https://github.com/leanprover-community/mathlib/tree/pechersky/fin-nontrivial">branch#pechersky/fin-nontrivial</a></p>



<a name="320226044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320226044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320226044">(Jan 09 2023 at 13:31)</a>:</h4>
<p>The PR now builds locally</p>



<a name="320227244"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320227244" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320227244">(Jan 09 2023 at 13:37)</a>:</h4>
<p><span class="user-mention silent" data-user-id="308899">Yakov Pechersky</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/320214473">said</a>:</p>
<blockquote>
<p>A while back, I started this refactor, <a href="https://github.com/leanprover-community/mathlib/tree/pechersky/fin-nontrivial">branch#pechersky/fin-nontrivial</a></p>
</blockquote>
<p><a href="#narrow/stream/113488-general/topic/Generalizing.20fin.20away.20from.20.28n.20.2B.201.29/near/292340551">Here's</a> the previous discussion</p>



<a name="320227632"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320227632" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320227632">(Jan 09 2023 at 13:38)</a>:</h4>
<p>I had vague recollections of objections, but it seems that all of them are resolved by <a href="https://leanprover-community.github.io/mathlib_docs/find/ne_zero">docs#ne_zero</a> now existing</p>



<a name="320258684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320258684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320258684">(Jan 09 2023 at 15:46)</a>:</h4>
<p>I've almost fixed <code>norm_num</code> to fix the tests that are breaking <a href="https://github.com/leanprover-community/mathlib/pull/18107">#18107</a>. However one of the tests uses <code>guard_target</code> which tests alpha equivalence of expressions so it is a very tough test to pass because all the instances have to be equal up to alpha equivalence. Is there a more sensible version of <code>guard_target</code>?</p>



<a name="320261658"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320261658" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320261658">(Jan 09 2023 at 15:58)</a>:</h4>
<p>Would de-instancing the core instances (either in <code>data/fin/basic.lean</code> or in the test) help with that?</p>



<a name="320263663"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320263663" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320263663">(Jan 09 2023 at 16:06)</a>:</h4>
<p>Not really. There was a difference in the <code>ne_zero</code> instance for some numeral as well.</p>



<a name="320263734"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320263734" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320263734">(Jan 09 2023 at 16:07)</a>:</h4>
<p>I just made a <code>guard_target\_2</code> that unfolded reducibles.</p>



<a name="320274483"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320274483" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320274483">(Jan 09 2023 at 16:49)</a>:</h4>
<p><code>guard_target</code> is configurable to use either syntactic equality, alpha equiv, reducible defeq, or regular defeq. If it is not reasonable to ask for alpha equiv then you should just downgrade the test to whnfR</p>



<a name="320274726"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320274726" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320274726">(Jan 09 2023 at 16:50)</a>:</h4>
<p>(Oh, is this lean 3 you are talking about? In lean 3 there are other variants of <code>guard_target</code> which offer these different matching behaviors)</p>



<a name="320283751"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320283751" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320283751">(Jan 09 2023 at 17:31)</a>:</h4>
<p>I couldn't find the one with the behaviour I wanted</p>



<a name="320284665"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320284665" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320284665">(Jan 09 2023 at 17:35)</a>:</h4>
<p>You probably want either <code>guard_target_mod_implicit</code> or <code>guard_target'</code></p>



<a name="320285959"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320285959" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320285959">(Jan 09 2023 at 17:41)</a>:</h4>
<p>I think <code>guard_target_mod_implicit</code> is the closest I guess.</p>



<a name="320286204"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320286204" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320286204">(Jan 09 2023 at 17:43)</a>:</h4>
<p>By the way, how does expression matching work on instances. Will it match if it's a different path to the same instance as long as its defeq or something close to that?</p>



<a name="320286254"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320286254" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320286254">(Jan 09 2023 at 17:43)</a>:</h4>
<p>IIRC expression matching matches the exact term</p>



<a name="320286264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320286264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320286264">(Jan 09 2023 at 17:43)</a>:</h4>
<p>Or they can be unified I suppose</p>



<a name="320286283"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320286283" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320286283">(Jan 09 2023 at 17:43)</a>:</h4>
<p>So instances are never something you should match on</p>



<a name="320286321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320286321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320286321">(Jan 09 2023 at 17:43)</a>:</h4>
<p>Then this <code>norm_fin</code> is kind of flaky</p>



<a name="320286503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320286503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320286503">(Jan 09 2023 at 17:44)</a>:</h4>
<p>What I'd recommend is matching with a wildcard <code>%%inst</code>, then <a href="https://leanprover-community.github.io/mathlib_docs/find/unify">docs#unify</a> <code>inst</code> with the expected instance to check it's a sensible one</p>



<a name="320286595"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320286595" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320286595">(Jan 09 2023 at 17:44)</a>:</h4>
<p>(or maybe <a href="https://leanprover-community.github.io/mathlib_docs/find/is_defeq">docs#is_defeq</a>, I don't remember the difference)</p>



<a name="320287034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320287034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320287034">(Jan 09 2023 at 17:46)</a>:</h4>
<p>In lean 3 there are a fair number of tactics that match on instances, to decide whether to do the nat thing or the int thing. I'm not sure it's worth changing them at this point</p>



<a name="320287093"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320287093" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320287093">(Jan 09 2023 at 17:47)</a>:</h4>
<p>Can you point to one?</p>



<a name="320287499"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320287499" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320287499">(Jan 09 2023 at 17:49)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.norm_fin.match_fin/src">src#tactic.norm_fin.match_fin</a> is probably what Chris is talking about</p>



<a name="320287716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320287716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320287716">(Jan 09 2023 at 17:50)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/tactic.norm_num.eval_cast/src">src#tactic.norm_num.eval_cast</a></p>



<a name="320287727"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320287727" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320287727">(Jan 09 2023 at 17:50)</a>:</h4>
<p>That's going to fail if the term is instead <code>fin.add_monoid_with_one.to_has_one</code>, right?</p>



<a name="320287768"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320287768" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320287768">(Jan 09 2023 at 17:50)</a>:</h4>
<p>Or does <code>norm_num</code> canonize the instances first?</p>



<a name="320287999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320287999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320287999">(Jan 09 2023 at 17:51)</a>:</h4>
<p>yes, it will fail</p>



<a name="320288203"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320288203" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320288203">(Jan 09 2023 at 17:52)</a>:</h4>
<p>I'm not saying this is great, I'm saying that lean 4 fixes this issue so let's just not worry about it as long as mathlib isn't broken</p>



<a name="320288682"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320288682" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320288682">(Jan 09 2023 at 17:54)</a>:</h4>
<p>Yep, here's a repro:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kn">import</span> <span class="n">tactic.norm_fin</span>
<span class="kn">import</span> <span class="n">data.zmod.defs</span>

<span class="kd">def</span> <span class="n">foo</span> <span class="o">(</span><span class="n">α</span><span class="o">)</span> <span class="o">[</span><span class="n">has_lt</span> <span class="n">α</span><span class="o">]</span> <span class="o">[</span><span class="n">add_comm_monoid_with_one</span> <span class="n">α</span><span class="o">]</span> <span class="o">:=</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">α</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">2</span>

<span class="kd">example</span> <span class="o">:</span> <span class="n">foo</span> <span class="o">(</span><span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">rw</span> <span class="n">foo</span><span class="o">,</span>
  <span class="n">norm_num</span> <span class="c1">-- fail</span>
<span class="kd">end</span>

<span class="kd">example</span> <span class="o">:</span> <span class="o">(</span><span class="mi">1</span> <span class="o">:</span> <span class="n">fin</span> <span class="mi">3</span><span class="o">)</span> <span class="bp">&lt;</span> <span class="mi">2</span> <span class="o">:=</span>
<span class="kd">by</span> <span class="n">norm_num</span> <span class="c1">-- ok</span>
</code></pre></div>



<a name="320387078"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320387078" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320387078">(Jan 10 2023 at 07:04)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/pull/18107">#18107</a> is now broken by a deterministic timeout in <code>ring_theory/adjoin_root</code></p>



<a name="320412757"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320412757" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yuyang Zhao <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320412757">(Jan 10 2023 at 09:58)</a>:</h4>
<p>Seems <code>@[simps]</code> of <a href="https://leanprover-community.github.io/mathlib_docs/find/adjoin_root.power_basis_aux'">docs#adjoin_root.power_basis_aux'</a> should be removed.</p>



<a name="320413264"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320413264" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320413264">(Jan 10 2023 at 10:01)</a>:</h4>
<p>Seems like a legit use of <code>simps</code> to me? But you determined that it is causing the timeout?</p>



<a name="320413276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320413276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320413276">(Jan 10 2023 at 10:01)</a>:</h4>
<p>cc <span class="user-mention" data-user-id="110044">@Chris Hughes</span></p>



<a name="320413742"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320413742" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yuyang Zhao <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320413742">(Jan 10 2023 at 10:04)</a>:</h4>
<p>There is no <code>@[simps]</code> for <a href="https://leanprover-community.github.io/mathlib_docs/find/adjoin_root.power_basis_aux">docs#adjoin_root.power_basis_aux</a>.</p>



<a name="320413910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320413910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320413910">(Jan 10 2023 at 10:05)</a>:</h4>
<p>Yeah, but looking at the definition, it doesn't look like it would create nice simp-lemmas.</p>



<a name="320413984"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320413984" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320413984">(Jan 10 2023 at 10:05)</a>:</h4>
<p>So to me it seems reasonable that one has <code>simps</code> and the other does not.</p>



<a name="320416441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320416441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yuyang Zhao <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320416441">(Jan 10 2023 at 10:19)</a>:</h4>
<p>It does cause the timeout and seems the generated lemmas are not used, however.  I'm not sure if there is a better solution.</p>



<a name="320416687"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320416687" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320416687">(Jan 10 2023 at 10:20)</a>:</h4>
<p>Chris moves the <code>simps</code> to after the defn. Let's see if that helps.</p>



<a name="320417938"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320417938" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yuyang Zhao <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320417938">(Jan 10 2023 at 10:26)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib/compare/fin_refactor...fin_refactor2?expand=1">https://github.com/leanprover-community/mathlib/compare/fin_refactor...fin_refactor2?expand=1</a><br>
Also I tried to use <code>ne_zero n</code> for <code>fin.last</code> as well, but seems it may not a good idea. <code>fin.last</code> is used a lot in mathlib. I'm not sure if this change helps.</p>



<a name="320420190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320420190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Rodriguez <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320420190">(Jan 10 2023 at 10:39)</a>:</h4>
<p>The power_basis simps can be quite slow, I've sometimes written them by hand instead of using simps for this sad reason :/</p>



<a name="320430470"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320430470" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320430470">(Jan 10 2023 at 11:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="455791">Yuyang Zhao</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/320417938">said</a>:</p>
<blockquote>
<p><a href="https://github.com/leanprover-community/mathlib/compare/fin_refactor...fin_refactor2?expand=1">https://github.com/leanprover-community/mathlib/compare/fin_refactor...fin_refactor2?expand=1</a><br>
Also I tried to use <code>ne_zero n</code> for <code>fin.last</code> as well, but seems it may not a good idea. <code>fin.last</code> is used a lot in mathlib. I'm not sure if this change helps.</p>
</blockquote>
<p>I don't think this is a clear win; <code>coe (fin last n) = n</code> is currently true by rfl, which is nice</p>



<a name="320430538"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320430538" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320430538">(Jan 10 2023 at 11:40)</a>:</h4>
<p>We can always revisit it after the port</p>



<a name="320693467"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320693467" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320693467">(Jan 11 2023 at 12:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/320287034">said</a>:</p>
<blockquote>
<p>In lean 3 there are a fair number of tactics that match on instances, to decide whether to do the nat thing or the int thing. I'm not sure it's worth changing them at this point</p>
</blockquote>
<p>Fixed in <a href="https://github.com/leanprover-community/mathlib/pull/18129">#18129</a> for <code>norm_num</code> and <code>abel</code>.</p>



<a name="320929572"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320929572" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320929572">(Jan 12 2023 at 12:50)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> bumped this PR to match the backports that he did in mathlib 3.</p>



<a name="320929660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320929660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320929660">(Jan 12 2023 at 12:50)</a>:</h4>
<p>Who wants to review it? (I worked on this PR quite a bit, so I think I shouldn't be the main reviewer.)</p>



<a name="320929670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320929670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320929670">(Jan 12 2023 at 12:50)</a>:</h4>
<p>The one issue is a breakage in Data.UInt</p>



<a name="320929811"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320929811" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320929811">(Jan 12 2023 at 12:51)</a>:</h4>
<p>There were changed to this file in master and the PR branch, so I accepted the changes in master but this broke everything. Maybe someone who understands this file can have a look, or I'll have a proper go after lunch</p>



<a name="320948150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320948150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320948150">(Jan 12 2023 at 14:15)</a>:</h4>
<p>I think this should be ready now</p>



<a name="320948718"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320948718" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320948718">(Jan 12 2023 at 14:17)</a>:</h4>
<p>I've added a dummy commit so that we can compare again with the mathport output</p>



<a name="320952171"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320952171" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320952171">(Jan 12 2023 at 14:32)</a>:</h4>
<p>Does it makes sense to temporarily change the base commit such that review can be against that diff?</p>



<a name="320952634"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320952634" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320952634">(Jan 12 2023 at 14:34)</a>:</h4>
<p>We're reviewing it right now.</p>



<a name="320952710"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320952710" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320952710">(Jan 12 2023 at 14:34)</a>:</h4>
<p>Let's do a final review against your dummy commit after that.</p>



<a name="320956582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320956582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320956582">(Jan 12 2023 at 14:50)</a>:</h4>
<p>I just finished a review with a bunch of naming fixes, now lgtm (though I haven't been following this thread closely)</p>



<a name="320957200"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320957200" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320957200">(Jan 12 2023 at 14:52)</a>:</h4>
<p>We're heading to some seminar. So if someone else wants to do the final review, please go ahead.</p>



<a name="320962673"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320962673" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jihoon Hyun <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320962673">(Jan 12 2023 at 15:15)</a>:</h4>
<p>There are some <code>fin</code> which should be modified to <code>Fin</code> in comments.</p>



<a name="320963465"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320963465" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jihoon Hyun <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320963465">(Jan 12 2023 at 15:18)</a>:</h4>
<p>I will directly fix those and give a commit if nobody's working on it</p>



<a name="320966659"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320966659" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320966659">(Jan 12 2023 at 15:30)</a>:</h4>
<p>Yes please go ahead.</p>



<a name="320967031"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320967031" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jihoon Hyun <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320967031">(Jan 12 2023 at 15:32)</a>:</h4>
<p>Actually I already committed the fix. Now comment looks good to me, except at line 35 I missed one <code>nat</code>..</p>



<a name="320968005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320968005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320968005">(Jan 12 2023 at 15:36)</a>:</h4>
<p>I fixed that one and some other occurrences of <code>nat</code>.</p>



<a name="320968372"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320968372" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jihoon Hyun <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320968372">(Jan 12 2023 at 15:38)</a>:</h4>
<p>Should <code>cast_nat_eq_last</code> be <code>cast_Nat_eq_last</code>?</p>



<a name="320969068"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320969068" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320969068">(Jan 12 2023 at 15:40)</a>:</h4>
<p>No, in a <code>snake_case_name</code>, the individual components always start with a lowercase letter</p>



<a name="320969224"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320969224" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jihoon Hyun <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320969224">(Jan 12 2023 at 15:41)</a>:</h4>
<p>Then I guess the comments are now all good!</p>



<a name="320969284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320969284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320969284">(Jan 12 2023 at 15:42)</a>:</h4>
<p>I'll have another look over the diff with mathport</p>



<a name="320969453"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320969453" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320969453">(Jan 12 2023 at 15:42)</a>:</h4>
<p>Are we ready to swap the diffbase so that we can more accurately review against that?</p>



<a name="320969937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320969937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320969937">(Jan 12 2023 at 15:44)</a>:</h4>
<p>I'm going to assume yes, based on <span class="user-mention" data-user-id="112680">@Johan Commelin</span>'s comment above. Hopefully it's easy to switch back anyway.</p>



<a name="320973417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320973417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320973417">(Jan 12 2023 at 15:59)</a>:</h4>
<p>Yes, I think you can</p>



<a name="320973464"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320973464" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320973464">(Jan 12 2023 at 15:59)</a>:</h4>
<p>Done already and left some comments</p>



<a name="320973689"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320973689" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320973689">(Jan 12 2023 at 16:00)</a>:</h4>
<p>The add hoc port seems to have made a bunch of other refactors re moving lemmas around, and I think we should probably discard them to avoid more confusion in docstream files</p>



<a name="320973884"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320973884" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320973884">(Jan 12 2023 at 16:01)</a>:</h4>
<p>For instance, <a href="https://leanprover-community.github.io/mathlib_docs/find/fin.comm_semiring">docs#fin.comm_semiring</a> lives in <code>data.zmod.defs</code> in mathlib, but in <code>data.fin.basic</code> in the ad-hoc port</p>



<a name="320994559"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320994559" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320994559">(Jan 12 2023 at 17:34)</a>:</h4>
<p>I've spotted another ad-hoc refactor that we should probably backport</p>



<a name="320994618"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/320994618" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#320994618">(Jan 12 2023 at 17:34)</a>:</h4>
<p>The adhoc <a href="https://leanprover-community.github.io/mathlib_docs/find/fin.add_comm_monoid">docs#fin.add_comm_monoid</a> implements a custom <code>nsmul</code> that is not defeq to the one in mathlib3</p>



<a name="321007409"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321007409" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321007409">(Jan 12 2023 at 18:35)</a>:</h4>
<p>That's probably easier to fix on the mathlib4 side, right?</p>



<a name="321007567"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321007567" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321007567">(Jan 12 2023 at 18:36)</a>:</h4>
<p>Also, we can move the port of <code>fin.comm_semiring</code> out of <code>Data.Fin.Basic</code> into <code>Data.Zmod.AdHocDefs</code>, and then import that file in <code>Data.UInt</code>.</p>



<a name="321007621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321007621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321007621">(Jan 12 2023 at 18:36)</a>:</h4>
<p>That way we don't have to change mathlib3 <em>right now</em>.</p>



<a name="321008074"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321008074" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321008074">(Jan 12 2023 at 18:39)</a>:</h4>
<p>I'm done pushing <a href="https://github.com/leanprover-community/mathlib4/pull/1084/files/46242de060dee20a69e0c8da062b7cf6899d9b9d..7e76bca0b9d9bd35385d7ce6c8a756fd853d8249">changes</a> for now</p>



<a name="321008116"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321008116" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321008116">(Jan 12 2023 at 18:39)</a>:</h4>
<blockquote>
<p>That's probably easier to fix on the mathlib4 side, right?</p>
</blockquote>
<p>You mean the nsmul change? Yes, we can almost certainly just revert it</p>



<a name="321008216"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321008216" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321008216">(Jan 12 2023 at 18:40)</a>:</h4>
<p>I imagine a lot of ad-hoc things diverge from mathlib3 because someone said "I have a clean slate, let's try something different"</p>



<a name="321008328"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321008328" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321008328">(Jan 12 2023 at 18:40)</a>:</h4>
<p>Which was fine when mathlib4 was ad-hoc, but is in my opinion a bad idea now we're trying to faithfully port mathlib3.</p>



<a name="321008435"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321008435" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321008435">(Jan 12 2023 at 18:41)</a>:</h4>
<p>So I'd be very tempted to just rename all ad-hoc files to <code>Some/FileAdHoc.lean</code> so that this doesn't happen with other files, assuming there are still adhoc ports left</p>



<a name="321009369"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321009369" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321009369">(Jan 12 2023 at 18:45)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/321007567">said</a>:</p>
<blockquote>
<p>Also, we can move the port of <code>fin.comm_semiring</code> out of <code>Data.Fin.Basic</code> into <code>Data.Zmod.AdHocDefs</code>, and then import that file in <code>Data.UInt</code>.</p>
</blockquote>
<p>I moved these<del>, but then discovered <code>Data.UInt</code> doesn't even use these instances! Should we rewrite <code>Data.Uint</code> so that it does, write a TODO comment, or just drop them?</del></p>



<a name="321012695"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321012695" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321012695">(Jan 12 2023 at 19:03)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> So, do you think it is merge-ready now?</p>



<a name="321012839"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321012839" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321012839">(Jan 12 2023 at 19:03)</a>:</h4>
<p>Was the verdict that I should revert the ad-hoc nsmul refactor, rather than ask someone to backport it?</p>



<a name="321012977"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321012977" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321012977">(Jan 12 2023 at 19:04)</a>:</h4>
<p>Yes, that sounds good to me</p>



<a name="321013020"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321013020" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321013020">(Jan 12 2023 at 19:04)</a>:</h4>
<p>(note also that we definitely should not merge without first switching the base branch back!)</p>



<a name="321014895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321014895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321014895">(Jan 12 2023 at 19:16)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/321012977">said</a>:</p>
<blockquote>
<p>Yes, that sounds good to me</p>
</blockquote>
<p>Done</p>



<a name="321015027"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321015027" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321015027">(Jan 12 2023 at 19:17)</a>:</h4>
<p>Just <a href="https://github.com/leanprover-community/mathlib4/pull/1084#discussion_r1068470154">this comment</a> left of mine to resolve</p>



<a name="321015218"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321015218" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321015218">(Jan 12 2023 at 19:18)</a>:</h4>
<p>I think someone else should:</p>
<ul>
<li>Do a final pass over the diff looking for accidental changes (implicit/explicit arguments, switches from <code>n.succ</code> to <code>n+1</code>). This would be a lot easier if someone could run <code>mathport</code>'s oneshot.</li>
<li>change the base commit</li>
<li>merge</li>
</ul>



<a name="321017277"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321017277" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321017277">(Jan 12 2023 at 19:28)</a>:</h4>
<p>Can we just rewrite history, and make your current base commit part of the history of the original PR?</p>



<a name="321017370"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321017370" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321017370">(Jan 12 2023 at 19:29)</a>:</h4>
<p>I think it makes a lot of sense to preserve that as part of the PR history</p>



<a name="321018276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321018276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321018276">(Jan 12 2023 at 19:33)</a>:</h4>
<p>Changing the base doesn't change the history</p>



<a name="321018300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321018300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321018300">(Jan 12 2023 at 19:33)</a>:</h4>
<p>And the current base commit is already in the history</p>



<a name="321018563"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321018563" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321018563">(Jan 12 2023 at 19:34)</a>:</h4>
<p>Github is happy to show a diff, as in <a href="https://github.com/leanprover-community/mathlib4/pull/1084#issuecomment-1374574000">this comment</a>; it's just not possible to comment on that diff, which is why I wanted to change the base. We could put that link the PR header</p>



<a name="321018925"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321018925" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321018925">(Jan 12 2023 at 19:36)</a>:</h4>
<p><span class="user-mention silent" data-user-id="112680">Johan Commelin</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/321017370">said</a>:</p>
<blockquote>
<p>I think it makes a lot of sense to preserve that as part of the PR history</p>
</blockquote>
<p>I do wonder if we want a mechanism such that we can do this for all PRs easily</p>



<a name="321020394"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321020394" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321020394">(Jan 12 2023 at 19:44)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20.28mathlib4.231084.29/near/321015027">said</a>:</p>
<blockquote>
<p>Just <a href="https://github.com/leanprover-community/mathlib4/pull/1084#discussion_r1068470154">this comment</a> left of mine to resolve</p>
</blockquote>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> If this comment needs action, I'll make a seperate PR to fix it.</p>



<a name="321020415"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321020415" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321020415">(Jan 12 2023 at 19:44)</a>:</h4>
<p>I've kicked the PR on the queue</p>



<a name="321020558"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321020558" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321020558">(Jan 12 2023 at 19:45)</a>:</h4>
<p>Ooh snap. We need to update <code>Mathlib.lean</code></p>



<a name="321021516"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321021516" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321021516">(Jan 12 2023 at 19:50)</a>:</h4>
<p>There was also <a href="https://github.com/leanprover-community/mathlib4/pull/1084#discussion_r1064035754">this comment</a> but it's minor</p>



<a name="321092684"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fin.Basic%20%28mathlib4%231084%29/near/321092684" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFin.2EBasic.20(mathlib4.231084).html#321092684">(Jan 13 2023 at 06:56)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/1521">mathlib4#1521</a> fixes the <code>ofNat</code> thing</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>