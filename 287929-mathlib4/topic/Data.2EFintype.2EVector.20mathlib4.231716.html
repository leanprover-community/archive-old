---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html">Data.Fintype.Vector mathlib4#1716</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="322513787"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322513787" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322513787">(Jan 20 2023 at 13:33)</a>:</h4>
<p>On</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">instance</span> <span class="n">Vector.fintype</span> <span class="o">[</span><span class="n">Fintype</span> <span class="n">α</span><span class="o">]</span> <span class="o">{</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">}</span> <span class="o">:</span> <span class="n">Fintype</span> <span class="o">(</span><span class="n">Vector</span> <span class="n">α</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
  <span class="n">Fintype.ofEquiv</span> <span class="n">_</span> <span class="o">(</span><span class="n">Equiv.vectorEquivFin</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">symm</span>
</code></pre></div>
<p>I get</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">IR</span> <span class="n">check</span> <span class="n">failed</span> <span class="n">at</span> <span class="bp">'</span><span class="n">Fintype.ofBijective._at.Vector.fintype._spec_2._rarg'</span><span class="o">,</span> <span class="n">error</span><span class="o">:</span> <span class="n">unknown</span> <span class="n">declaration</span> <span class="bp">'</span><span class="k">Pi</span><span class="bp">.</span><span class="n">fintype'</span>
</code></pre></div>



<a name="322513843"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322513843" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322513843">(Jan 20 2023 at 13:33)</a>:</h4>
<p>Making it noncomputable of course fixes the issue. But I imagine that's not what we want.</p>



<a name="322513880"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322513880" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322513880">(Jan 20 2023 at 13:33)</a>:</h4>
<p><code>Pi.fintype</code> definitely does exist, as <code>#check</code> confirms.</p>



<a name="322514712"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322514712" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322514712">(Jan 20 2023 at 13:37)</a>:</h4>
<p>Aha. <code>Pi.fintype</code> is noncomputable!</p>



<a name="322515090"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322515090" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322515090">(Jan 20 2023 at 13:38)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mathlib_docs/find/pi.fintype">docs#pi.fintype</a>, <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Pi.fintype#doc">docs4#Pi.fintype</a></p>



<a name="322515192"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322515192" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322515192">(Jan 20 2023 at 13:39)</a>:</h4>
<p>It was computable in mathlib3</p>



<a name="322515197"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322515197" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322515197">(Jan 20 2023 at 13:39)</a>:</h4>
<p>What changed?</p>



<a name="322515245"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322515245" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322515245">(Jan 20 2023 at 13:39)</a>:</h4>
<p>The Lean version?</p>



<a name="322515300"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322515300" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322515300">(Jan 20 2023 at 13:39)</a>:</h4>
<p>I've regularly had lean4 claim things needed to be noncomputable when they weren't in lean3. I haven't looked into why</p>



<a name="322515913"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322515913" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322515913">(Jan 20 2023 at 13:42)</a>:</h4>
<p>Ah, this is because <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Multiset.recOn#doc">docs4#Multiset.recOn</a> is noncomputable</p>



<a name="322515930"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322515930" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322515930">(Jan 20 2023 at 13:42)</a>:</h4>
<p>Like all other recursors</p>



<a name="322516033"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322516033" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322516033">(Jan 20 2023 at 13:43)</a>:</h4>
<p><del>Perhaps the thing to do is to write a <code>recOn'</code> with pattern matching</del></p>



<a name="322516376"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322516376" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322516376">(Jan 20 2023 at 13:44)</a>:</h4>
<p>Actually, this comes down to computability of <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=Multiset.rec#doc">docs4#Multiset.rec</a> which in turn goes down to <code>List.rec</code></p>



<a name="322519044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322519044" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322519044">(Jan 20 2023 at 13:57)</a>:</h4>
<p>All is fixed. Ready for review</p>



<a name="322519115"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322519115" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322519115">(Jan 20 2023 at 13:57)</a>:</h4>
<p>Modulo removing the noncomputable once <code>List.rec</code> is fixed, of course.</p>



<a name="322519737"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322519737" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322519737">(Jan 20 2023 at 14:00)</a>:</h4>
<p>I wonder why <a href="#narrow/stream/270676-lean4/topic/csimp.20on.20recursors/near/322520199"><code>csimp</code> doesn't work on <code>List.rec</code>...</a></p>



<a name="322522152"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322522152" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322522152">(Jan 20 2023 at 14:10)</a>:</h4>
<p><span class="user-mention" data-user-id="310045">@Eric Wieser</span> I'm not sure, but in case you want to work on making these fintypes computable, here's a computable <code>Multiset.rec</code>:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">rec_aux</span> <span class="o">(</span><span class="n">C_0</span> <span class="o">:</span> <span class="n">C</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">C_cons</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">m</span><span class="o">,</span> <span class="n">C</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span><span class="bp">ₘ</span> <span class="n">m</span><span class="o">))</span>
    <span class="o">(</span><span class="n">C_cons_heq</span> <span class="o">:</span>
      <span class="bp">∀</span> <span class="n">a</span> <span class="n">a'</span> <span class="n">m</span> <span class="n">b</span><span class="o">,</span> <span class="n">HEq</span> <span class="o">(</span><span class="n">C_cons</span> <span class="n">a</span> <span class="o">(</span><span class="n">a'</span> <span class="o">::</span><span class="bp">ₘ</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">C_cons</span> <span class="n">a'</span> <span class="n">m</span> <span class="n">b</span><span class="o">))</span> <span class="o">(</span><span class="n">C_cons</span> <span class="n">a'</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span><span class="bp">ₘ</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">C_cons</span> <span class="n">a</span> <span class="n">m</span> <span class="n">b</span><span class="o">)))</span> <span class="o">:</span>
    <span class="o">(</span><span class="n">l</span> <span class="o">:</span> <span class="n">List</span> <span class="n">α</span><span class="o">)</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">Quotient.mk</span> <span class="o">(</span><span class="n">isSetoid</span> <span class="n">α</span><span class="o">)</span> <span class="n">l</span><span class="o">)</span>
<span class="bp">|</span> <span class="o">[]</span> <span class="bp">=&gt;</span> <span class="n">C_0</span>
<span class="bp">|</span> <span class="n">a</span><span class="o">::</span><span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">C_cons</span> <span class="n">a</span> <span class="bp">⟦</span><span class="n">l</span><span class="bp">⟧</span> <span class="o">(</span><span class="n">rec_aux</span> <span class="n">C_0</span> <span class="n">C_cons</span> <span class="n">C_cons_heq</span> <span class="n">l</span><span class="o">)</span>

<span class="kd">theorem</span> <span class="n">rec_aux_eq</span> <span class="o">:</span>
    <span class="n">rec_aux</span> <span class="n">C_0</span> <span class="n">C_cons</span> <span class="n">C_cons_heq</span> <span class="bp">=</span> <span class="bp">@</span><span class="n">List.rec</span> <span class="n">α</span> <span class="o">(</span><span class="k">fun</span> <span class="n">l</span> <span class="bp">=&gt;</span> <span class="n">C</span> <span class="bp">⟦</span><span class="n">l</span><span class="bp">⟧</span><span class="o">)</span> <span class="n">C_0</span> <span class="k">fun</span> <span class="n">a</span> <span class="n">l</span> <span class="n">b</span> <span class="bp">=&gt;</span> <span class="n">C_cons</span> <span class="n">a</span> <span class="bp">⟦</span><span class="n">l</span><span class="bp">⟧</span> <span class="n">b</span> <span class="o">:=</span>
<span class="kd">by</span>
  <span class="n">ext</span> <span class="n">l</span>
  <span class="n">induction</span> <span class="n">l</span> <span class="k">with</span>
  <span class="bp">|</span> <span class="n">nil</span> <span class="bp">=&gt;</span> <span class="n">rfl</span>
  <span class="bp">|</span> <span class="n">cons</span> <span class="n">a</span> <span class="n">l</span> <span class="n">ih</span> <span class="bp">=&gt;</span> <span class="n">simp</span> <span class="o">[</span><span class="n">rec_aux</span><span class="o">,</span> <span class="n">ih</span><span class="o">]</span>

<span class="sd">/-- Dependent recursor on multisets.</span>
<span class="sd">TODO: should be @[recursor 6], but then the definition of `Multiset.pi` fails with a stack</span>
<span class="sd">overflow in `whnf`.</span>
<span class="sd">-/</span>
<span class="kn">protected</span>
<span class="kd">def</span> <span class="n">rec</span> <span class="o">(</span><span class="n">C_0</span> <span class="o">:</span> <span class="n">C</span> <span class="mi">0</span><span class="o">)</span> <span class="o">(</span><span class="n">C_cons</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">a</span> <span class="n">m</span><span class="o">,</span> <span class="n">C</span> <span class="n">m</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span><span class="bp">ₘ</span> <span class="n">m</span><span class="o">))</span>
    <span class="o">(</span><span class="n">C_cons_heq</span> <span class="o">:</span>
      <span class="bp">∀</span> <span class="n">a</span> <span class="n">a'</span> <span class="n">m</span> <span class="n">b</span><span class="o">,</span> <span class="n">HEq</span> <span class="o">(</span><span class="n">C_cons</span> <span class="n">a</span> <span class="o">(</span><span class="n">a'</span> <span class="o">::</span><span class="bp">ₘ</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">C_cons</span> <span class="n">a'</span> <span class="n">m</span> <span class="n">b</span><span class="o">))</span> <span class="o">(</span><span class="n">C_cons</span> <span class="n">a'</span> <span class="o">(</span><span class="n">a</span> <span class="o">::</span><span class="bp">ₘ</span> <span class="n">m</span><span class="o">)</span> <span class="o">(</span><span class="n">C_cons</span> <span class="n">a</span> <span class="n">m</span> <span class="n">b</span><span class="o">)))</span>
    <span class="o">(</span><span class="n">m</span> <span class="o">:</span> <span class="n">Multiset</span> <span class="n">α</span><span class="o">)</span> <span class="o">:</span> <span class="n">C</span> <span class="n">m</span> <span class="o">:=</span>
  <span class="n">Quotient.hrecOn</span> <span class="n">m</span> <span class="o">(</span><span class="n">rec_aux</span> <span class="n">C_0</span> <span class="n">C_cons</span> <span class="n">C_cons_heq</span><span class="o">)</span> <span class="k">fun</span> <span class="n">l</span> <span class="n">l'</span> <span class="n">h</span> <span class="bp">=&gt;</span> <span class="kd">by</span>
    <span class="n">rw</span> <span class="o">[</span><span class="n">rec_aux_eq</span><span class="o">]</span>
    <span class="n">exact</span> <span class="n">h.rec_heq</span>
      <span class="o">(</span><span class="k">fun</span> <span class="n">hl</span> <span class="n">_</span> <span class="bp">↦</span> <span class="kd">by</span> <span class="n">congr</span> <span class="mi">1</span><span class="bp">;</span> <span class="n">exact</span> <span class="n">Quot.sound</span> <span class="n">hl</span><span class="o">)</span>
      <span class="o">(</span><span class="n">C_cons_heq</span> <span class="n">_</span> <span class="n">_</span> <span class="bp">⟦</span><span class="n">_</span><span class="bp">⟧</span> <span class="n">_</span><span class="o">)</span>
</code></pre></div>



<a name="322522304"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322522304" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322522304">(Jan 20 2023 at 14:11)</a>:</h4>
<p>I'd argue it would be easier to just write a computable <code>list.rec</code> and swap that in everywhere; I think all the derived types end up comptuable automatically</p>



<a name="322522940"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322522940" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kyle Miller <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322522940">(Jan 20 2023 at 14:14)</a>:</h4>
<p>I think using recursors for computation is "wrong" though, since Lean eagerly evaluates arguments. I'm pretty sure it's not that <code>List.rec</code> is noncomputable, but rather that the Lean compiler is by design pushing the user away from using it for computations.</p>



<a name="322523371"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322523371" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322523371">(Jan 20 2023 at 14:16)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#eval</span> <span class="o">(</span><span class="n">List.rec</span> <span class="mi">0</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">xs</span> <span class="n">ih</span> <span class="bp">=&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">([]</span> <span class="o">:</span> <span class="n">List</span> <span class="n">Nat</span><span class="o">)</span> <span class="o">:</span> <span class="n">Nat</span><span class="o">)</span>
</code></pre></div>
<p>gives (emphasis mine)</p>
<blockquote>
<p>code generator does not support recursor 'List.rec' <strong>yet</strong>, consider using 'match ... with' and/or structural recursion</p>
</blockquote>
<p>which suggests this is not by design but by it not being prioritized</p>



<a name="322526176"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322526176" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Notification Bot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322526176">(Jan 20 2023 at 14:28)</a>:</h4>
<p>2 messages were moved from this topic to <a class="stream-topic" data-stream-id="270676" href="/#narrow/stream/270676-lean4/topic/csimp.20on.20recursors">#lean4 &gt; csimp on recursors</a> by <span class="user-mention silent" data-user-id="310045">Eric Wieser</span>.</p>



<a name="322531406"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322531406" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322531406">(Jan 20 2023 at 14:50)</a>:</h4>
<p>It's still arguably suboptimal to use List.rec because (as Kyle alluded to) you have to evaluate the empty list case even when the list is not empty</p>



<a name="322532321"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322532321" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322532321">(Jan 20 2023 at 14:54)</a>:</h4>
<p>Of course it doesn't matter if you only care about "does Lean complain about <code>noncomputable</code>"</p>



<a name="322532652"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322532652" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322532652">(Jan 20 2023 at 14:55)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/1720">mathlib4#1720</a> makes a very large number of things computable by adding those <code>csimp</code> lemmas</p>



<a name="322532740"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322532740" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322532740">(Jan 20 2023 at 14:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716/near/322531406">said</a>:</p>
<blockquote>
<p>It's still arguably suboptimal to use List.rec because (as Kyle alluded to) you have to evaluate the empty list case even when the list is not empty</p>
</blockquote>
<p>I would guess that in almost all cases the empty list case is entirely trivial anyway, so evaluation costs very little</p>



<a name="322533336"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322533336" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322533336">(Jan 20 2023 at 14:58)</a>:</h4>
<p>It should also be noted (as usual) that this "computability" is not the same as being able to reduce things</p>



<a name="322533991"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322533991" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322533991">(Jan 20 2023 at 15:00)</a>:</h4>
<p>Presumably both <code>List.rec</code> and <code>Nat.rec</code> already reduce correctly</p>



<a name="322545612"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322545612" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322545612">(Jan 20 2023 at 15:47)</a>:</h4>
<p>On the other hand this "computability" will make porting easier, with fewer confusing errors.</p>



<a name="322546221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322546221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322546221">(Jan 20 2023 at 15:50)</a>:</h4>
<p>Notably there are some <code>Decidable</code> instances that describe some algorithms on lists. It's pretty silly to say "oh, this algorithm is just as noncomputable as using <code>choice</code> would be".</p>



<a name="322549972"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322549972" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322549972">(Jan 20 2023 at 16:05)</a>:</h4>
<p><a href="https://github.com/leanprover-community/mathlib4/pull/1728">https://github.com/leanprover-community/mathlib4/pull/1728</a></p>



<a name="322550324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322550324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322550324">(Jan 20 2023 at 16:06)</a>:</h4>
<p>I made this on a fork because I wasn't planning on PRing it, but maybe I should PR from a branch of leanprover-community for CI</p>



<a name="322552417"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322552417" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Chris Hughes <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322552417">(Jan 20 2023 at 16:16)</a>:</h4>
<p>CI seems to have kicked in now so I'll leave it</p>



<a name="322552876"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322552876" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322552876">(Jan 20 2023 at 16:18)</a>:</h4>
<p><span class="user-mention" data-user-id="110044">@Chris Hughes</span> Can you also fix <code>Data.Fintype.Vector</code> please?</p>



<a name="322552955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322552955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322552955">(Jan 20 2023 at 16:18)</a>:</h4>
<p>does Lean 4 still give an error when you mark something <code>noncomputable</code> that's computable?</p>



<a name="322553173"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322553173" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322553173">(Jan 20 2023 at 16:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716/near/322546221">said</a>:</p>
<blockquote>
<p>Notably there are some <code>Decidable</code> instances that describe some algorithms on lists. It's pretty silly to say "oh, this algorithm is just as noncomputable as using <code>choice</code> would be".</p>
</blockquote>
<p>AFAIK we don't ever evaluate <code>Decidable</code> instances (that's not how <code>dec_trivial</code> works)</p>



<a name="322554238"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322554238" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322554238">(Jan 20 2023 at 16:24)</a>:</h4>
<p>This <code>rg noncomputable | rg orting</code> gives</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Multiset</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="kd">noncomputable</span> <span class="c1">-- Porting note: added</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Multiset</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="kd">noncomputable</span> <span class="c1">-- Porting note: added</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Multiset</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="kd">noncomputable</span> <span class="c1">-- Porting note: added</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Multiset</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="kd">noncomputable</span> <span class="c1">-- Porting note: added</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Multiset</span><span class="bp">/</span><span class="n">Sections.lean</span><span class="o">:</span><span class="c1">-- Porting note: `Sections` depends on `recOn` which is noncomputable.</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Multiset</span><span class="bp">/</span><span class="k">Pi</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="c1">--Porting note: Added noncomputable</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Finset</span><span class="bp">/</span><span class="k">Pi</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="c1">--Porting note: marked noncomputable</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Fin</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="c1">--Porting note: marked noncomputable</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Fin</span><span class="bp">/</span><span class="n">Tuple</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="c1">-- Porting note: I made this noncomputable because Lean seemed to think it should be</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Vector</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="c1">-- porting notes: requires noncomputable</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Vector</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="c1">-- porting notes: requires noncomputable</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Vector</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="c1">-- porting notes: requires noncomputable</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">PNat</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="c1">-- Porting note: added `noncomputable` because of</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Fintype</span><span class="bp">/</span><span class="k">Pi</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="c1">--Porting note: added noncomputable</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Fintype</span><span class="bp">/</span><span class="k">Pi</span><span class="bp">.</span><span class="n">lean</span><span class="o">:</span><span class="c1">--Porting note: added noncomputable</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Data</span><span class="bp">/</span><span class="n">Set</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="c1">-- Porting note: remove `noncomputable` later</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Algebra</span><span class="bp">/</span><span class="n">Group</span><span class="bp">/</span><span class="n">Units.lean</span><span class="o">:</span><span class="c1">-- Porting note: `to_additive` doesn't carry over `noncomputable` so we make an explicit defn</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Algebra</span><span class="bp">/</span><span class="n">FreeMonoid</span><span class="bp">/</span><span class="n">Basic.lean</span><span class="o">:</span><span class="c1">-- Porting note: added noncomputable</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Order</span><span class="bp">/</span><span class="n">RelClasses.lean</span><span class="o">:</span><span class="c1">-- Porting note: WellFounded.fix is noncomputable, at 2022-10-29 lean</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Order</span><span class="bp">/</span><span class="n">RelClasses.lean</span><span class="o">:</span><span class="c1">-- Porting note: WellFounded.fix is noncomputable, at 2022-10-29 lean</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Order</span><span class="bp">/</span><span class="n">RelClasses.lean</span><span class="o">:</span><span class="c1">-- Porting note: WellFounded.fix is noncomputable, at 2022-10-29 lean</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Control</span><span class="bp">/</span><span class="n">Fix.lean</span><span class="o">:</span><span class="c1">-- porting note: added noncomputable, because WellFounded.fix is noncomputable (for now?)</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Control</span><span class="bp">/</span><span class="n">Fix.lean</span><span class="o">:</span><span class="c1">-- porting note: added noncomputable, because WellFounded.fix is noncomputable (for now?)</span>
<span class="n">Mathlib</span><span class="bp">/</span><span class="n">Control</span><span class="bp">/</span><span class="n">Fix.lean</span><span class="o">:</span><span class="c1">-- porting note: added noncomputable, because WellFounded.fix is noncomputable (for now?)</span>
</code></pre></div>



<a name="322554396"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322554396" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322554396">(Jan 20 2023 at 16:25)</a>:</h4>
<p>I'm on a train, so this was on an ancient master (from 12 hrs ago, or so)</p>



<a name="322561149"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322561149" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322561149">(Jan 20 2023 at 16:55)</a>:</h4>
<p>I think I have most of those removed my PR</p>



<a name="322578780"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322578780" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322578780">(Jan 20 2023 at 17:48)</a>:</h4>
<p>I think it's just the <code>WellFounded.fix</code> things that remain noncomputable</p>



<a name="322578982"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322578982" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322578982">(Jan 20 2023 at 17:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110032">Reid Barton</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716/near/322553173">said</a>:</p>
<blockquote>
<p>AFAIK we don't ever evaluate <code>Decidable</code> instances (that's not how <code>dec_trivial</code> works)</p>
</blockquote>
<p>Oh, that's a very good point. I guess it's still nice for metaprograms, but the application is admittedly niche.</p>



<a name="322587053"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322587053" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322587053">(Jan 20 2023 at 18:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="310045">Eric Wieser</span> <a href="#narrow/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716/near/322578780">said</a>:</p>
<blockquote>
<p>I think it's just the <code>WellFounded.fix</code> things that remain noncomputable</p>
</blockquote>
<p>I recall early in the ad-hoc phase I did something similar to your <code>List.recC</code> for <code>WellFounded.fix</code> - you can just add a csimp lemma and then anything using <code>WellFounded.fix</code> will be computable</p>



<a name="322587788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/Data.Fintype.Vector%20mathlib4%231716/near/322587788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/Data.2EFintype.2EVector.20mathlib4.231716.html#322587788">(Jan 20 2023 at 18:29)</a>:</h4>
<p>Oh, I wasn't aware it was possible to write one</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>