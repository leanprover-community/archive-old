---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/auto-fix.20comments.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html">auto-fix comments</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="322461233"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/auto-fix%20comments/near/322461233" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html#322461233">(Jan 20 2023 at 09:15)</a>:</h4>
<p>Reid and I wrote a script that will interactively try to fix names in comments, using <code>#align</code> mappings:<br>
<a href="https://github.com/leanprover-community/mathlib4/pull/1710">https://github.com/leanprover-community/mathlib4/pull/1710</a></p>



<a name="322461861"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/auto-fix%20comments/near/322461861" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html#322461861">(Jan 20 2023 at 09:18)</a>:</h4>
<p>It is somewhat tested. The way we had in mind to use this is:</p>
<ul>
<li>start your port with <code>start_port.sh</code></li>
<li>manually fix errors (red stuff), including names of declarations and <code>#align</code> statements</li>
<li>run <code>./scripts/fix-lints.py FILENAME</code> to fix a whole lot of warnings</li>
<li>run <code>./scripts/fix-comments.py FILENAME</code> (this script) to fix names in comments</li>
<li>manually fix whatever remains to be done</li>
</ul>



<a name="322466549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/auto-fix%20comments/near/322466549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html#322466549">(Jan 20 2023 at 09:42)</a>:</h4>
<p>One caveat is that many lean 3 definitions from the core library are missing <code>#align</code>s (unless they were added since yesterday), e.g. <code>fin</code>, <code>group</code></p>



<a name="322466688"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/auto-fix%20comments/near/322466688" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Patrick Massot <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html#322466688">(Jan 20 2023 at 09:43)</a>:</h4>
<p>I think you can add those anywhere in mathlib4</p>



<a name="322500606"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/auto-fix%20comments/near/322500606" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html#322500606">(Jan 20 2023 at 12:32)</a>:</h4>
<p>Another catch: the tool does not yet fix docstrings in <code>@[to_additive "some additive docstring goes here"]</code></p>



<a name="322530660"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/auto-fix%20comments/near/322530660" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Reid Barton <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html#322530660">(Jan 20 2023 at 14:48)</a>:</h4>
<p>Another caveat is that the tool doesn't guess what namespace the comments are supposed to be referring to</p>



<a name="323043901"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/auto-fix%20comments/near/323043901" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html#323043901">(Jan 23 2023 at 15:08)</a>:</h4>
<p>@ porters: this script has been merged</p>



<a name="323043937"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/auto-fix%20comments/near/323043937" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html#323043937">(Jan 23 2023 at 15:08)</a>:</h4>
<p>Please report any issues</p>



<a name="323045541"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/auto-fix%20comments/near/323045541" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html#323045541">(Jan 23 2023 at 15:14)</a>:</h4>
<p>Issue: I pushed a fix at the same time it was put on the queue, so actually, it hasn't been merged yet</p>



<a name="323045987"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/auto-fix%20comments/near/323045987" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Eric Wieser <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/auto-fix.20comments.html#323045987">(Jan 23 2023 at 15:16)</a>:</h4>
<p>(and now <code>lake exe cache get</code> is failing with network errors so bors refuses to merge it)</p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>