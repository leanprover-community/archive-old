---
layout: archive
title: Zulip Chat Archive
permalink: /stream/287929-mathlib4/topic/data.2Enat.2Ebits.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/index.html">mathlib4</a></h2>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html">data.nat.bits</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com/">

<head><link href="/style.css" rel="stylesheet"></head>

{% raw %}

<a name="314084324"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/314084324" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#314084324">(Dec 05 2022 at 17:21)</a>:</h4>
<p>Hi, I noticed that <code>data.nat.bits</code> is ready for porting and I would like to port it. In the [linked message] (<a href="#narrow/stream/287929-mathlib4/topic/data.2Eset.2Ebasic/near/314081134">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.2Eset.2Ebasic/near/314081134</a>) <span class="user-mention" data-user-id="492774">@Sky Wilshaw</span> mentions that there are some changes between lean 3 and 4 regarding <code>bit0</code> and <code>bit1</code>. I would be grateful for any help with knowing what these changes are and how this affects the port. Thanks in advance.</p>



<a name="314088923"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/314088923" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#314088923">(Dec 05 2022 at 17:45)</a>:</h4>
<p>Additionally, I can't seem to follow step 4  of the porting process of claiming the file (no permission to edit wiki). Is it absolutely essential that I do this?</p>



<a name="314112248"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/314112248" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#314112248">(Dec 05 2022 at 19:49)</a>:</h4>
<p><code>bit0</code> and <code>bit1</code> are now deprecated and this file is being ignored. It will probably end up in core/std and I'm not sure it's used too much in mathlib. If you tell us your github userid and ping <code>@maintainers</code> without the quotes then someone will give you push access to the wiki file. Sorry for the confusion. Right now most porters are mathlib3 contributors! Thanks for joining us!</p>



<a name="316286195"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316286195" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316286195">(Dec 16 2022 at 14:55)</a>:</h4>
<p>Hi everyone,<br>
So after the discussion in port progress (see : <a href="#narrow/stream/287929-mathlib4/topic/port.20progress/near/316239933">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/port.20progress/near/316239933</a>), I started porting <code>data.nat.bits</code>. The following happened in sequence.</p>
<ol>
<li>I opened <code>data.nat.bits</code> and after correcting mathbin to mathlib, I found a number of identifiers such as <code>bodd</code>, <code>bit _ _ </code>, <code>bodd_bit</code> etc that lean couldn't find definitions for.</li>
<li>I looked at the corresponding mathlib3 file and documentations and traced these identifiers to <a href="https://github.com/leanprover-community/lean/blob/53e8520d8964c7632989880372d91ba0cecbaf00/library/init/data/nat/bitwise.lean#L24">init.data.nat.bitwise</a> </li>
<li>I looked for the corresponding lean 4 file <a href="https://github.com/leanprover/lean4/blob/master/src/Init/Data/Nat/Bitwise.lean">Init.Data.Nat.Bitwise</a>. This file looks completely different from the lean3 file. </li>
</ol>
<p>Now I can think of a few different ways, to fix this:</p>
<ol>
<li>Write replacement definitions myself. </li>
<li>Try replacing them with the new definitions in <code>Init.Data.Nat.Div</code>. </li>
</ol>
<p>From a porting perspective, it seems to make sense to just add new <code>def</code>s for  these missing names, and leave the existing declarations of <code>data.nat.bits</code> untouched. If this is to be done, where should these new <code>def</code>s be added. </p>
<p>Is there a simpler fix?</p>



<a name="316287999"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316287999" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316287999">(Dec 16 2022 at 15:04)</a>:</h4>
<p>Definitions that were removed from the lean core should be added to <code>Mathlib/Init/Data/Nat/Div</code>. They are in <code>lean3port</code> (partly broken as in <code>mathlib3port</code>)</p>



<a name="316288246"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316288246" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316288246">(Dec 16 2022 at 15:04)</a>:</h4>
<p>So one has to port partly from <code>lean3port</code> and partly from <code>mathlib3port</code>.</p>



<a name="316289549"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316289549" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316289549">(Dec 16 2022 at 15:11)</a>:</h4>
<p>Okay, in this case, I will have to add <code>init.data.nat.bitwise</code> and see if there are still dependencies on <code>init.data.nat.div</code></p>



<a name="316294862"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316294862" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316294862">(Dec 16 2022 at 15:33)</a>:</h4>
<p>In this file I see a lot of <code>tt</code> and <code>ff</code>, are these in any way distinct from <code>true</code> and <code>false</code>?</p>



<a name="316295531"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316295531" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316295531">(Dec 16 2022 at 15:36)</a>:</h4>
<p>The problem is they produce redundant case distinctions as far as lean 4 goes.</p>



<a name="316296670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316296670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316296670">(Dec 16 2022 at 15:40)</a>:</h4>
<p><code>tt</code> is lean3 syntax for <code>true</code></p>



<a name="316297241"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316297241" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316297241">(Dec 16 2022 at 15:43)</a>:</h4>
<p>ah okay. that makes a lot of sense now. lean3port appears to have left many of these untouched for very good reasons.</p>



<a name="316320716"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316320716" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316320716">(Dec 16 2022 at 17:28)</a>:</h4>
<p>what is the xor operator for <code>Bool</code> in lean 4? Currently xor defaults to Nat.xor (because there is such an instance in <code>Init.Data.Nat.Bitwise</code> (the one not inside mathlib4)</p>



<a name="316320870"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316320870" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316320870">(Dec 16 2022 at 17:29)</a>:</h4>
<p>In Lean 3, it's <a href="https://leanprover-community.github.io/mathlib_docs/find/bxor">docs#bxor</a>. Does <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=BXor#doc">docs4#BXor</a> hit anything?</p>



<a name="316320950"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316320950" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316320950">(Dec 16 2022 at 17:29)</a>:</h4>
<p>unfortunately no.</p>



<a name="316321475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316321475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316321475">(Dec 16 2022 at 17:32)</a>:</h4>
<p>My best bet right now  seems to be to define my own Boolean Xor.   Quite a few identifiers there are undefined. My next issue is going to be with <code>bit0</code> and <code>bit1</code>.</p>



<a name="316321602"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316321602" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316321602">(Dec 16 2022 at 17:32)</a>:</h4>
<p>But from a library design standpoint, and language consistency standpoint, this is not ideal</p>



<a name="316321926"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316321926" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316321926">(Dec 16 2022 at 17:34)</a>:</h4>
<p>I remember now why I'm getting a déjà vu feeling about your questions... We moved the xor stuff to <code>data.nat.bits</code> because I didn't figure out how to port them in <a href="https://github.com/leanprover-community/mathlib4/pull/729">mathlib4#729</a> :)</p>



<a name="316322395"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316322395" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316322395">(Dec 16 2022 at 17:36)</a>:</h4>
<p>If we put the boolean xor in <code>data.nat.bits</code> :</p>
<ol>
<li>We will have a circular dependency between <code>data.nat.bits</code> and <code>Init.Data.Nat.Bitwise</code></li>
<li>We have inconsistent naming. Why should operations for <code>Bool</code> be hidden inside a <code>Nat</code> related file</li>
</ol>



<a name="316323636"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316323636" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316323636">(Dec 16 2022 at 17:43)</a>:</h4>
<p>What is the suggested fix? Should I define the boolean xor  inside <code>Init.Data.Nat.Bitwise</code>?</p>



<a name="316323802"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316323802" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316323802">(Dec 16 2022 at 17:43)</a>:</h4>
<p>Is there no <code>Bool.defs</code> file?</p>



<a name="316324239"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316324239" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316324239">(Dec 16 2022 at 17:46)</a>:</h4>
<p>Found an <code>xor</code> inside <code>Bool.Basic</code></p>



<a name="316324540"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316324540" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316324540">(Dec 16 2022 at 17:47)</a>:</h4>
<p>Is there a way to make a qualified import so that  I can use it instead of <code>Nat.xor</code>?</p>



<a name="316325016"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316325016" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316325016">(Dec 16 2022 at 17:49)</a>:</h4>
<p>more specifically, is <code>abbrev bxor = xor</code> which seems to do the trick okay? Should the name be hidden somehow?</p>



<a name="316325381"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316325381" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316325381">(Dec 16 2022 at 17:51)</a>:</h4>
<p><a href="#narrow/stream/287929-mathlib4/topic/status.20of.20data.2Enat.2Ebits/near/313758405">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/status.20of.20data.2Enat.2Ebits/near/313758405</a></p>



<a name="316325619"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316325619" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316325619">(Dec 16 2022 at 17:52)</a>:</h4>
<p><span class="user-mention silent" data-user-id="542196">Arien Malec</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316325381">said</a>:</p>
<blockquote>
<p><a href="#narrow/stream/287929-mathlib4/topic/status.20of.20data.2Enat.2Ebits/near/313758405">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/status.20of.20data.2Enat.2Ebits/near/313758405</a></p>
</blockquote>
<p>There was an update to this : <a href="#narrow/stream/287929-mathlib4/topic/port.20progress/near/316239933">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/port.20progress/near/316239933</a></p>



<a name="316326624"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316326624" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316326624">(Dec 16 2022 at 17:56)</a>:</h4>
<p>Hmm. I didn't see <span class="user-mention" data-user-id="110049">@Mario Carneiro</span>  weigh in there... My understanding is that the reason <code>bit0</code>/<code>bit1</code> appear all over <code>mathlib</code> is because they are central to binary representation in Lean 3, but bitwise operations are going to be done differently in Lean 4</p>



<a name="316326939"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316326939" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316326939">(Dec 16 2022 at 17:57)</a>:</h4>
<p>And otherwise <code>bit0</code>/<code>bit1</code> are incomplete ways of spelling <code>even</code> and <code>odd</code> which will get ported in <code>algebra.parity</code></p>



<a name="316326963"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316326963" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316326963">(Dec 16 2022 at 17:57)</a>:</h4>
<p><span class="user-mention silent" data-user-id="542196">Arien Malec</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316326624">said</a>:</p>
<blockquote>
<p>Hmm. I didn't see <span class="user-mention silent" data-user-id="110049">Mario Carneiro</span>  weigh in there... My understanding is that the reason <code>bit0</code>/<code>bit1</code> appear all over <code>mathlib</code> is because they are central to binary representation in Lean 3, but bitwise operations are going to be done differently in Lean 4</p>
</blockquote>
<p>My understanding is that this is holding up the port process. It makes sense to separate the porting process from these fixes. Avoids all sorts of deadlocks. The file can be deprecated or perhaps some renaming done as soon as the necessary changes to <code>std</code> are made.</p>



<a name="316327143"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316327143" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Arien Malec <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316327143">(Dec 16 2022 at 17:58)</a>:</h4>
<p>fair enough....</p>



<a name="316327674"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316327674" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316327674">(Dec 16 2022 at 18:00)</a>:</h4>
<p>For now I think defining abbreviations </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">abbrev</span> <span class="n">bit0</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="n">abbrev</span> <span class="n">bit1</span> <span class="o">:=</span><span class="mi">1</span>
</code></pre></div>
<p>is the quickest fix</p>



<a name="316327805"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316327805" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316327805">(Dec 16 2022 at 18:01)</a>:</h4>
<p>@experts : Is this acceptable for now?</p>



<a name="316328357"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316328357" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316328357">(Dec 16 2022 at 18:03)</a>:</h4>
<p>Then, in order to meet this requirement (<a href="#narrow/stream/287929-mathlib4/topic/port.20progress/near/316275723">https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/port.20progress/near/316275723</a>) <br>
I manually change occurrences of <code>bit0</code> and <code>bit1</code> to <code>0</code> and <code>1</code> respectively, in all statements (but not proofs)</p>



<a name="316328542"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316328542" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316328542">(Dec 16 2022 at 18:04)</a>:</h4>
<p>I don't understand. That means you will be writing a bunch of useless lemmas that don't have mathlib counterparts.</p>



<a name="316328607"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316328607" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316328607">(Dec 16 2022 at 18:05)</a>:</h4>
<p>Why don't you just keep the current meaning of <code>bit0</code> and <code>bit1</code>?</p>



<a name="316329172"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316329172" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316329172">(Dec 16 2022 at 18:07)</a>:</h4>
<p>Currently <code>bit0</code> and <code>bit1</code> have no meaning in <code>lean4</code>.  Giving them the same meaning would mean writing all these instances here : <br>
<a href="https://leanprover-community.github.io/mathlib_docs/init/core.html#bit0">https://leanprover-community.github.io/mathlib_docs/init/core.html#bit0</a></p>



<a name="316329389"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316329389" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316329389">(Dec 16 2022 at 18:08)</a>:</h4>
<p>What instances do you mean? I see none in there.</p>



<a name="316329486"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316329486" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316329486">(Dec 16 2022 at 18:09)</a>:</h4>
<p>Oh, you mean typeclass arguments?</p>



<a name="316329553"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316329553" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316329553">(Dec 16 2022 at 18:09)</a>:</h4>
<p><span class="user-mention silent" data-user-id="387244">Yaël Dillies</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316329389">said</a>:</p>
<blockquote>
<p>What instances do you mean? I see none in there.</p>
</blockquote>
<p>Yes</p>



<a name="316329834"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316329834" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Yaël Dillies <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316329834">(Dec 16 2022 at 18:10)</a>:</h4>
<p>Then please do.</p>



<a name="316330276"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316330276" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316330276">(Dec 16 2022 at 18:13)</a>:</h4>
<p>Okay, I'll do that. I just realised my abbrevs wont work on some of them anyway. This will go inside <code>Init.Data.Nat.Bitwise</code></p>



<a name="316334909"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316334909" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316334909">(Dec 16 2022 at 18:35)</a>:</h4>
<p>Found <code>bit0</code> and <code>bit1</code> in <code>Mathlib.Init.ZeroOne</code></p>



<a name="316343160"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316343160" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316343160">(Dec 16 2022 at 19:20)</a>:</h4>
<p>A good way to find everything is <code>import Mathlib</code>.</p>



<a name="316343418"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316343418" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316343418">(Dec 16 2022 at 19:22)</a>:</h4>
<p>or <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=bit0#doc">docs4#bit0</a> and <a href="https://leanprover-community.github.io/mathlib4_docs/find/?pattern=bit1#doc">docs4#bit1</a>.</p>



<a name="316343545"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316343545" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316343545">(Dec 16 2022 at 19:23)</a>:</h4>
<p>(and you can send messages to yourself on Zulip if you want to experiment with other docs4# stuff)</p>



<a name="316343569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316343569" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Jireh Loreaux <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316343569">(Dec 16 2022 at 19:23)</a>:</h4>
<p><span class="user-mention" data-user-id="466334">@Shreyas Srinivas</span> I'm confused about what you wrote:<br>
<span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316327674">said</a>:</p>
<blockquote>
<p>For now I think defining abbreviations </p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">abbrev</span> <span class="n">bit0</span> <span class="o">:=</span> <span class="mi">0</span>
<span class="n">abbrev</span> <span class="n">bit1</span> <span class="o">:=</span> <span class="mi">1</span>
</code></pre></div>
<p>is the quickest fix</p>
</blockquote>
<p>Do you realize that this isn't what <code>bit0</code> and <code>bit1</code> mean? <code>bit0 x = x + x</code></p>



<a name="316343664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316343664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316343664">(Dec 16 2022 at 19:24)</a>:</h4>
<p>Consider that canceled</p>



<a name="316343744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316343744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316343744">(Dec 16 2022 at 19:24)</a>:</h4>
<p>I said that two seconds before I read the definition</p>



<a name="316343778"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316343778" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Johan Commelin <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316343778">(Dec 16 2022 at 19:24)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110038">Kevin Buzzard</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316343545">said</a>:</p>
<blockquote>
<p>(and you can send messages to yourself on Zulip if you want to experiment with other docs4# stuff)</p>
</blockquote>
<p>Talking to yourself on zulip is one of those things that's much more helpful than you'd think <span aria-label="grinning" class="emoji emoji-1f600" role="img" title="grinning">:grinning:</span></p>



<a name="316343836"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316343836" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316343836">(Dec 16 2022 at 19:25)</a>:</h4>
<p>(deleted)</p>



<a name="316343887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316343887" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316343887">(Dec 16 2022 at 19:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316334909">said</a>:</p>
<blockquote>
<p>Found <code>bit0</code> and <code>bit1</code> in <code>Mathlib.Init.ZeroOne</code></p>
</blockquote>
<p>Using this now</p>



<a name="316347514"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316347514" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316347514">(Dec 16 2022 at 19:48)</a>:</h4>
<p>I am encountering a number of errors with the <code>cases</code> tactic in <code>Init.data.nat.bitwise</code> . The documentation says that the tactic basically expands objects of an inductive type along each of its constructors, in order to a case-by-case analysis. By that definition the proofs look like they ought to work. Basically lean complains that the definition is not really inductive on objects of the <code>Bool</code> type</p>
<p>Before I individually tackle these proofs and fix them, is there a known issue? Are there standard fixes?</p>



<a name="316348724"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316348724" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316348724">(Dec 16 2022 at 19:55)</a>:</h4>
<p>Can you give a mwe?</p>



<a name="316348859"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316348859" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316348859">(Dec 16 2022 at 19:56)</a>:</h4>
<p>mwe?</p>



<a name="316349005"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316349005" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316349005">(Dec 16 2022 at 19:57)</a>:</h4>
<p><a href="https://leanprover-community.github.io/mwe.html">#mwe</a> . That's the best way to ask a question on this site.</p>



<a name="316349621"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316349621" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316349621">(Dec 16 2022 at 20:00)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">abbrev</span> <span class="n">ℕ</span> <span class="o">:=</span> <span class="n">Nat</span>
<span class="kn">open</span> <span class="n">Nat</span>
<span class="kd">def</span> <span class="n">boddDiv2</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="n">Bool</span> <span class="bp">×</span> <span class="n">ℕ</span>
  <span class="bp">|</span> <span class="mi">0</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">false</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
  <span class="bp">|</span> <span class="n">succ</span> <span class="n">n</span> <span class="bp">=&gt;</span>
    <span class="k">match</span> <span class="n">boddDiv2</span> <span class="n">n</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="o">(</span><span class="n">false</span><span class="o">,</span> <span class="n">m</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">true</span><span class="o">,</span> <span class="n">m</span><span class="o">)</span>
    <span class="bp">|</span> <span class="o">(</span><span class="n">true</span><span class="o">,</span> <span class="n">m</span><span class="o">)</span> <span class="bp">=&gt;</span> <span class="o">(</span><span class="n">false</span><span class="o">,</span> <span class="n">succ</span> <span class="n">m</span><span class="o">)</span>


<span class="kd">def</span> <span class="n">div2</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">boddDiv2</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="mi">2</span>

<span class="kd">def</span> <span class="n">bodd</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">Bool</span> <span class="o">:=</span>
  <span class="o">(</span><span class="n">boddDiv2</span> <span class="n">n</span><span class="o">)</span><span class="bp">.</span><span class="mi">1</span>


<span class="kd">@[simp]</span>
<span class="kd">theorem</span> <span class="n">bodd_succ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">bodd</span> <span class="o">(</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">not</span> <span class="o">(</span><span class="n">bodd</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">unfold</span> <span class="n">bodd</span> <span class="bp">&lt;;&gt;</span> <span class="n">unfold</span> <span class="n">boddDiv2</span> <span class="bp">&lt;;&gt;</span> <span class="n">cases</span> <span class="n">boddDiv2</span> <span class="n">n</span> <span class="bp">&lt;;&gt;</span> <span class="n">cases</span> <span class="n">fst</span> <span class="bp">&lt;;&gt;</span> <span class="n">rfl</span>
</code></pre></div>



<a name="316349702"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316349702" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316349702">(Dec 16 2022 at 20:00)</a>:</h4>
<p>fails at <code>cases fst</code>. This is directly from the library with <code>abbrev \N = Nat</code> and <code>open Nat</code></p>



<a name="316350571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316350571" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316350571">(Dec 16 2022 at 20:05)</a>:</h4>
<p>There is no <code>fst</code>. There is a <code>fst✝</code> but that is inaccessible.</p>



<a name="316350708"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316350708" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316350708">(Dec 16 2022 at 20:06)</a>:</h4>
<p>But why does it work in lean 3 (from where, modulo lean3port, the code came)? and what's the typical fix?</p>



<a name="316351150"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316351150" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316351150">(Dec 16 2022 at 20:08)</a>:</h4>
<p>Does <code>cases' fst with fst fst</code> work?</p>



<a name="316351217"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316351217" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316351217">(Dec 16 2022 at 20:09)</a>:</h4>
<p>In Lean 3 there were no inaccessible terms. You are using the code generated by the porting program, right? <code>mathlib3port</code> and <code>lean3port</code>?</p>



<a name="316351284"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316351284" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Ruben Van de Velde <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316351284">(Dec 16 2022 at 20:09)</a>:</h4>
<p>Lean 3 introduced more (accessible) names automatically</p>



<a name="316351296"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316351296" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316351296">(Dec 16 2022 at 20:10)</a>:</h4>
<p>yeah</p>



<a name="316351670"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316351670" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316351670">(Dec 16 2022 at 20:12)</a>:</h4>
<p><span class="user-mention silent" data-user-id="307953">Ruben Van de Velde</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316351150">said</a>:</p>
<blockquote>
<p>Does <code>cases' fst with fst fst</code> work?</p>
</blockquote>
<p><code>cases'</code> is an unknown tactic (playground link : <a href="https://lean.math.hhu.de/#code=import%20Mathlib%0A%0Aabbrev%20%E2%84%95%20%3A%3D%20Nat%0Aopen%20Nat%0Adef%20boddDiv2%20%3A%20%E2%84%95%20%E2%86%92%20Bool%20%C3%97%20%E2%84%95%0A%20%20%7C%200%20%3D%3E%20(false%2C%200)%0A%20%20%7C%20succ%20n%20%3D%3E%0A%20%20%20%20match%20boddDiv2%20n%20with%0A%20%20%20%20%7C%20(false%2C%20m)%20%3D%3E%20(true%2C%20m)%0A%20%20%20%20%7C%20(true%2C%20m)%20%3D%3E%20(false%2C%20succ%20m)%0A%0A%0Adef%20div2%20(n%20%3A%20%E2%84%95)%20%3A%20%E2%84%95%20%3A%3D%0A%20%20(boddDiv2%20n).2%0A%0Adef%20bodd%20(n%20%3A%20%E2%84%95)%20%3A%20Bool%20%3A%3D%0A%20%20(boddDiv2%20n).1%0A%0A%0A%40%5Bsimp%5D%0Atheorem%20bodd_succ%20(n%20%3A%20%E2%84%95)%20%3A%20bodd%20(succ%20n)%20%3D%20not%20(bodd%20n)%20%3A%3D%20by%0A%20%20unfold%20bodd%20%3C%3B%3E%20unfold%20boddDiv2%20%3C%3B%3E%20cases%20boddDiv2%20n%20%3C%3B%3E%20cases'%20fst%20with%20fst%20fst%20%3C%3B%3E%20rfl%0A">https://lean.math.hhu.de/#code=import%20Mathlib%0A%0Aabbrev%20%E2%84%95%20%3A%3D%20Nat%0Aopen%20Nat%0Adef%20boddDiv2%20%3A%20%E2%84%95%20%E2%86%92%20Bool%20%C3%97%20%E2%84%95%0A%20%20%7C%200%20%3D%3E%20(false%2C%200)%0A%20%20%7C%20succ%20n%20%3D%3E%0A%20%20%20%20match%20boddDiv2%20n%20with%0A%20%20%20%20%7C%20(false%2C%20m)%20%3D%3E%20(true%2C%20m)%0A%20%20%20%20%7C%20(true%2C%20m)%20%3D%3E%20(false%2C%20succ%20m)%0A%0A%0Adef%20div2%20(n%20%3A%20%E2%84%95)%20%3A%20%E2%84%95%20%3A%3D%0A%20%20(boddDiv2%20n).2%0A%0Adef%20bodd%20(n%20%3A%20%E2%84%95)%20%3A%20Bool%20%3A%3D%0A%20%20(boddDiv2%20n).1%0A%0A%0A%40%5Bsimp%5D%0Atheorem%20bodd_succ%20(n%20%3A%20%E2%84%95)%20%3A%20bodd%20(succ%20n)%20%3D%20not%20(bodd%20n)%20%3A%3D%20by%0A%20%20unfold%20bodd%20%3C%3B%3E%20unfold%20boddDiv2%20%3C%3B%3E%20cases%20boddDiv2%20n%20%3C%3B%3E%20cases'%20fst%20with%20fst%20fst%20%3C%3B%3E%20rfl%0A</a>)</p>



<a name="316352519"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316352519" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316352519">(Dec 16 2022 at 20:18)</a>:</h4>
<p>You can get it with <code>import Mathlib.Tactic.Cases</code>. The problem seems to be that the definitions of <code>boddDiv2</code> generated by the equation compilers in Lean 3 and Lean 4 are different.</p>



<a name="316353148"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316353148" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316353148">(Dec 16 2022 at 20:22)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- lean 3</span>
<span class="kn">import</span> <span class="n">logic.basic</span>

<span class="kn">open</span> <span class="n">nat</span>

<span class="kd">@[simp]</span> <span class="kd">lemma</span> <span class="n">bodd_succ'</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">bodd</span> <span class="o">(</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">bnot</span> <span class="o">(</span><span class="n">bodd</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span>
<span class="kd">begin</span>
  <span class="n">unfold</span> <span class="n">bodd</span> <span class="n">bodd_div2</span><span class="o">,</span>
  <span class="n">cases</span> <span class="n">bodd_div2</span> <span class="n">n</span><span class="o">,</span>
  <span class="c">/-</span><span class="cm"></span>
<span class="cm">  ⊢ (bodd_div2._match_1 (fst, snd)).fst = bnot (fst, snd).fst -/</span>
  <span class="n">cases</span> <span class="n">fst</span><span class="bp">;</span>
  <span class="n">refl</span>
<span class="kd">end</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="c1">-- lean 4</span>

<span class="c1">-- ... your code omitted</span>

<span class="kd">@[simp]</span>
<span class="kd">theorem</span> <span class="n">bodd_succ</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span> <span class="n">bodd</span> <span class="o">(</span><span class="n">succ</span> <span class="n">n</span><span class="o">)</span> <span class="bp">=</span> <span class="n">not</span> <span class="o">(</span><span class="n">bodd</span> <span class="n">n</span><span class="o">)</span> <span class="o">:=</span> <span class="kd">by</span>
  <span class="n">unfold</span> <span class="n">bodd</span>
  <span class="n">unfold</span> <span class="n">boddDiv2</span>
  <span class="n">cases</span> <span class="n">boddDiv2</span> <span class="n">n</span> <span class="k">with</span>
  <span class="c">/-</span><span class="cm"></span>
<span class="cm">  ⊢ (match x✝ with</span>
<span class="cm">    | (false, m) =&gt; (true, m)</span>
<span class="cm">    | (true, m) =&gt; (false, succ m)).fst =</span>
<span class="cm">  !(match n with</span>
<span class="cm">      | 0 =&gt; (false, 0)</span>
<span class="cm">      | succ n =&gt;</span>
<span class="cm">        match boddDiv2 n with</span>
<span class="cm">        | (false, m) =&gt; (true, m)</span>
<span class="cm">        | (true, m) =&gt; (false, succ m)).fst</span>
<span class="cm">        -/</span>
  <span class="bp">|</span> <span class="n">mk</span> <span class="n">fst</span> <span class="n">snd</span> <span class="bp">=&gt;</span>
    <span class="n">cases</span> <span class="n">fst</span> <span class="k">with</span>
    <span class="bp">|</span> <span class="n">true</span> <span class="bp">=&gt;</span> <span class="gr">sorry</span>
    <span class="bp">|</span> <span class="n">false</span> <span class="bp">=&gt;</span> <span class="gr">sorry</span>
</code></pre></div>



<a name="316353910"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316353910" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316353910">(Dec 16 2022 at 20:27)</a>:</h4>
<p>Thanks. it is interesting that one can use a match inside a tactic like that</p>



<a name="316354190"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316354190" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316354190">(Dec 16 2022 at 20:29)</a>:</h4>
<p>also, in many of the induction proofs. the <code>cases</code> clause seems unnecessary where <code>simp</code> is used for the base case of the induction</p>



<a name="316354205"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316354205" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316354205">(Dec 16 2022 at 20:29)</a>:</h4>
<p>This is very interesting</p>



<a name="316533766"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316533766" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316533766">(Dec 18 2022 at 02:22)</a>:</h4>
<p>An update:  <br>
I am still manually weeding out errors in <code>Init.Data.Nat.Bitwise</code> of which there were a considerable number in the beginning. </p>
<ol>
<li>A number of errors can be traced to inaccessible variables. I have removed those with <code>rename_i</code>.</li>
<li>A number of errors arise from the <code>rw</code> tactic. Some are removed by applying <code>simp</code> instead. Others get removed when I introduce that part of the proof in a have statement. My goal tomorrow is to identify more of these cases and narrow them down</li>
<li>I would be grateful for any help with <code>binaryRec</code>, <code>theorem bodd_succ</code> and <code>theorem div2_succ</code>.</li>
</ol>
<p>You can see the current state on the latest commit in <a href="https://github.com/leanprover-community/mathlib4/pull/1075">mathlib4#1075</a>.</p>



<a name="316533895"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316533895" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316533895">(Dec 18 2022 at 02:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span>  I saw your comment on the issue. I will do this tomorrow. Is there a simple way to move the PR or is a fresh one required?</p>



<a name="316534793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316534793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316534793">(Dec 18 2022 at 02:42)</a>:</h4>
<p>In addition, <code>Data.Nat.Bits</code> is less than half the size of <code>Bitwise</code> and has tiny proofs for the most part. So hopefully once this file is done, <code>data.nat.bits</code> will follow soon.</p>



<a name="316544221"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316544221" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Siddhartha Gadgil <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316544221">(Dec 18 2022 at 05:33)</a>:</h4>
<p><span class="user-mention" data-user-id="466334">@Shreyas Srinivas</span> <br>
One way to make a PR from a branch is to merge your PR (which is into a mathlib4 branch) and then make a PR from there. But after that it is better to just push to the branch on mathlib4 by changing the git remote (or checking it out) otherwise changes made by others will cause a mess.</p>



<a name="316581555"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316581555" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316581555">(Dec 18 2022 at 12:35)</a>:</h4>
<p>New PR <a href="https://github.com/leanprover-community/mathlib4/pull/1095">mathlib4#1095</a></p>



<a name="316643623"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316643623" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316643623">(Dec 18 2022 at 22:27)</a>:</h4>
<p>Need some help with tactics:<br>
I have the following tactic state:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">C</span><span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u</span>
<span class="n">z</span><span class="o">:</span> <span class="n">C</span> <span class="mi">0</span>
<span class="n">f</span><span class="o">:</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">Bool</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">bit</span> <span class="n">b</span> <span class="n">n</span><span class="o">)</span>
<span class="n">h'</span><span class="o">:</span> <span class="n">f</span> <span class="n">false</span> <span class="mi">0</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">z</span>
<span class="n">b</span><span class="o">:</span> <span class="n">Bool</span>
<span class="n">n</span><span class="o">:</span> <span class="n">ℕ</span>
<span class="n">h</span><span class="o">:</span> <span class="n">bit</span> <span class="n">b</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="n">bf</span><span class="o">:</span> <span class="n">false</span> <span class="bp">=</span> <span class="n">b</span>
<span class="n">n0</span><span class="o">:</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">n</span>
<span class="n">e</span><span class="bp">✝</span><span class="o">:</span> <span class="n">C</span> <span class="o">(</span><span class="n">bit</span> <span class="n">false</span> <span class="mi">0</span><span class="o">)</span>
<span class="n">e</span><span class="o">:</span> <span class="n">C</span> <span class="mi">0</span>
<span class="bp">⊢</span> <span class="n">e</span><span class="bp">✝</span> <span class="bp">=</span> <span class="n">z</span>
</code></pre></div>
<p>For context, there is a theorem <code>bit_zero</code> that says <code>bit false 0 = 0</code>. I applied <code>rw</code> on <code>e^{\dagger}</code> to get <code>e</code>. I was under the impression that I could use proof irrelevance to show the goal. How do I get there?</p>



<a name="316644969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316644969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316644969">(Dec 18 2022 at 22:46)</a>:</h4>
<p>Is there such a way?</p>



<a name="316646140"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316646140" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316646140">(Dec 18 2022 at 23:02)</a>:</h4>
<p>Your goal shouldn't contain inaccessible terms, they're inaccessible. How did the dagger term appear? You should have named it when it did</p>



<a name="316646270"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316646270" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316646270">(Dec 18 2022 at 23:04)</a>:</h4>
<p>The goal looked like this:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="n">C</span><span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u</span>
<span class="n">z</span><span class="o">:</span> <span class="n">C</span> <span class="mi">0</span>
<span class="n">f</span><span class="o">:</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">Bool</span><span class="o">)</span> <span class="bp">→</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="bp">→</span> <span class="n">C</span> <span class="n">n</span> <span class="bp">→</span> <span class="n">C</span> <span class="o">(</span><span class="n">bit</span> <span class="n">b</span> <span class="n">n</span><span class="o">)</span>
<span class="n">h'</span><span class="o">:</span> <span class="n">f</span> <span class="n">false</span> <span class="mi">0</span> <span class="n">z</span> <span class="bp">=</span> <span class="n">z</span>
<span class="n">b</span><span class="o">:</span> <span class="n">Bool</span>
<span class="n">n</span><span class="o">:</span> <span class="n">ℕ</span>
<span class="n">h</span><span class="o">:</span> <span class="n">bit</span> <span class="n">b</span> <span class="n">n</span> <span class="bp">=</span> <span class="mi">0</span>
<span class="n">bf</span><span class="o">:</span> <span class="n">false</span> <span class="bp">=</span> <span class="n">b</span>
<span class="n">n0</span><span class="o">:</span> <span class="mi">0</span> <span class="bp">=</span> <span class="n">n</span>
<span class="n">e</span><span class="o">:</span> <span class="n">C</span> <span class="o">(</span><span class="n">bit</span> <span class="n">false</span> <span class="mi">0</span><span class="o">)</span>
<span class="bp">⊢</span> <span class="n">e</span> <span class="bp">=</span> <span class="n">z</span>
</code></pre></div>
<p>Then I applied<br>
<code>rw [bit_zero] at e</code><br>
This gave the goal you see there</p>



<a name="316646976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316646976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316646976">(Dec 18 2022 at 23:15)</a>:</h4>
<p>Okay, I think I found the mistake. <code>C</code> does not return a value of type <code>Prop</code></p>



<a name="316648023"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316648023" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316648023">(Dec 18 2022 at 23:30)</a>:</h4>
<p>are there limits on how deep <code>rw</code> can look and replace terms in lean4? I see instances where <code>rw</code> should work per the basic idea that it takes equalities and replaces instances of LHS with RHS, but it doesn't do so.</p>



<a name="316648235"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316648235" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316648235">(Dec 18 2022 at 23:34)</a>:</h4>
<p>The lean3port version of the proof makes it clear that the same <code>rw</code>'s actually work in lean3</p>



<a name="316864788"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316864788" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316864788">(Dec 20 2022 at 02:11)</a>:</h4>
<p>Update + Help Needed:</p>
<ol>
<li>Update : I have reduced the errors in <code>Init.Data.Nat.Bitwise</code> to about 5 theorems.</li>
<li>Help needed : I need help with the proof of <code>test_bit_bitwise</code>. Producing an <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> is next to impossible because of the dependency chain. </li>
</ol>
<p>Specifically : in commit <a href="https://github.com/leanprover-community/mathlib4/pull/1095/commits/b1cac6a15b860e7e4420fa021de72dfc596caf06">https://github.com/leanprover-community/mathlib4/pull/1095/commits/b1cac6a15b860e7e4420fa021de72dfc596caf06</a><br>
(This is the top commit on this branch <code>data_nat_bits</code> right now ). </p>
<p>In lines <strong>544</strong> and <strong>540</strong>, I have reduced the goal to <code>testBit (succ n) (succ k) = true</code> and <code>testBit (succ n) (succ k) = false </code> respectively.<br>
These are the cases I generated using the line <code>cases testBit (succ n) (succ k)</code> (line <strong>534</strong>)  in the first place, so it seems that trivially these goals should be true (by the case distinction). I am not sure how to make this claim a proof</p>



<a name="316865460"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316865460" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316865460">(Dec 20 2022 at 02:20)</a>:</h4>
<p>A screenshot if it helps :<br>
<a href="/user_uploads/3121/sV7dR4Rq8VbXxZYcc0LhsGOM/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/3121/sV7dR4Rq8VbXxZYcc0LhsGOM/image.png" title="image.png"><img src="/user_uploads/3121/sV7dR4Rq8VbXxZYcc0LhsGOM/image.png"></a></div>



<a name="316876042"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316876042" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anand Rao <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316876042">(Dec 20 2022 at 05:00)</a>:</h4>
<p><span class="user-mention" data-user-id="466334">@Shreyas Srinivas</span> Just to clarify, is the proof also supposed to have a <code>succ.succ</code> case?</p>



<a name="316877349"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316877349" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anand Rao <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316877349">(Dec 20 2022 at 05:19)</a>:</h4>
<p>Here is the code: <a href="https://github.com/leanprover-community/mathlib4/pull/1095/commits/feedbe3a84e06d4a190d3289420a664926c97981">https://github.com/leanprover-community/mathlib4/pull/1095/commits/feedbe3a84e06d4a190d3289420a664926c97981</a></p>



<a name="316883955"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316883955" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316883955">(Dec 20 2022 at 06:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="303675">Anand Rao</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316876042">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> I have pushed a fix for <code>test_bit_bitwise</code>, following <a href="https://github.com/leanprover-community/lean/blob/53e8520d8964c7632989880372d91ba0cecbaf00/library/init/data/nat/bitwise.lean#L273">this Lean3 proof</a>.</p>
</blockquote>
<p>That is where is started. It seemed it wouldn't work, which is how I ended up with the long proof.</p>



<a name="316886575"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316886575" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316886575">(Dec 20 2022 at 07:07)</a>:</h4>
<p>It works thanks</p>



<a name="316916451"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316916451" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316916451">(Dec 20 2022 at 10:23)</a>:</h4>
<p><span class="user-mention" data-user-id="466334">@Shreyas Srinivas</span>,  <span class="user-mention" data-user-id="303675">@Anand Rao</span>, anyone else working on <code>Data.Nat.Bits</code>.</p>
<p>I don't think it was a good idea to start translating proofs that were about mathlib3's <code>bitwise</code> into proofs about Lean 4's <code>bitwise</code>. </p>
<p>We just don't care, for the purpose of getting the port done, what Lean 4 thinks <code>bitwise</code> means. We just copy across the mathlib3 bitwise, call it <code>bitwise'</code> to avoid a name collision, and get on with it.</p>
<p>I've done this, and removed all the errors in <code>Mathlib.Init.Dat.Nat.Bitwise</code>.</p>
<p>What I want to do next is to change all the theorems you've written in terms of (Lean 4's) <code>bitwise</code> back into theorems about (mathlib3's) <code>bitwise'</code>. This will obviate the need for the sorried <code>bitwise_eq_bitwise'</code> I added, because nothing in this file will mention <code>bitwise</code> itself.</p>
<p>However doing so seems like if might be reverting a bunch of your work, so I wanted to discuss this first.</p>



<a name="316916883"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316916883" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316916883">(Dec 20 2022 at 10:26)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110087">Scott Morrison</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316916451">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span>,  <span class="user-mention silent" data-user-id="303675">Anand Rao</span>, anyone else working on <code>Data.Nat.Bits</code>.</p>
<p>I don't think it was a good idea to start translating proofs that were about mathlib3's <code>bitwise</code> into proofs about Lean 4's <code>bitwise</code>. </p>
<p>We just don't care, for the purpose of getting the port done, what Lean 4 thinks <code>bitwise</code> means. We just copy across the mathlib3 bitwise, call it <code>bitwise'</code> to avoid a name collision, and get on with it.</p>
<p>I've done this, and removed all the errors in <code>Mathlib.Init.Dat.Nat.Bitwise</code>.</p>
<p>What I want to do next is to change all the theorems you've written in terms of (Lean 4's) <code>bitwise</code> back into theorems about (mathlib3's) <code>bitwise'</code>. This will obviate the need for the sorried <code>bitwise_eq_bitwise'</code> I added, because nothing in this file will mention <code>bitwise</code> itself.</p>
<p>However doing so seems like if might be reverting a bunch of your work, so I wanted to discuss this first.</p>
</blockquote>
<p>I had to undo a substantial number of errors arising from rw, simp, cases etc. Undoing all that work might mean starting with 70 odd errors again (took me 3.5 days to bring it all down)</p>



<a name="316917048"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316917048" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316917048">(Dec 20 2022 at 10:27)</a>:</h4>
<p>So I would like to understand what this entails</p>



<a name="316917062"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316917062" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316917062">(Dec 20 2022 at 10:27)</a>:</h4>
<p>In terms of errors that might creep back in</p>



<a name="316917266"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316917266" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316917266">(Dec 20 2022 at 10:28)</a>:</h4>
<p>Hopefully just:</p>
<ol>
<li>comment out <code>bitwise_eq_bitwise'</code></li>
<li>see which theorems break</li>
<li>change their statements to being about <code>bitwise'</code> rather than <code>bitwise</code></li>
<li>replace your new proofs with the proofs that mathport provides in <code>lean3port</code></li>
</ol>



<a name="316917375"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316917375" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316917375">(Dec 20 2022 at 10:29)</a>:</h4>
<p>I think step two is only <code>bitwise_zero_left</code> and <code>bitwise_zero_right</code>.</p>



<a name="316917849"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316917849" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316917849">(Dec 20 2022 at 10:32)</a>:</h4>
<p>Further, if it indeed doesn't matter and you have fixed all the errors (as I recall, there were errors in 4 or 5 theorems as of 9 hours ago), is there a reason to change it now?</p>



<a name="316918338"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316918338" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316918338">(Dec 20 2022 at 10:35)</a>:</h4>
<p>What's the trade off between making this change vs proving bitiwise_eq_bitwise'</p>



<a name="316918441"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316918441" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316918441">(Dec 20 2022 at 10:36)</a>:</h4>
<p>My change fixed all the errors, at the expense of one sorry, namely <code>bitwise_eq_bitwise'</code></p>



<a name="316918503"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316918503" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316918503">(Dec 20 2022 at 10:36)</a>:</h4>
<p>I just pushed another change that postpones that later in the file, and it only needed to make the definitions of <code>lor</code> and <code>land</code> match up.</p>



<a name="316918677"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316918677" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316918677">(Dec 20 2022 at 10:38)</a>:</h4>
<p>I don't really want this to hold up other stuff. I propose we just define <code>lor'</code> and <code>land'</code> the mathlib3 way too. These are barely used later in mathlib.</p>



<a name="316918928"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316918928" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316918928">(Dec 20 2022 at 10:39)</a>:</h4>
<p>Okay. As a beginner, I guess I am okay with changes as long as I don't have to redo the error fixing for several hours more</p>



<a name="316919367"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316919367" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316919367">(Dec 20 2022 at 10:41)</a>:</h4>
<p>Hopefully this does not require significant refactoring downstream. All the occurrences of <code>bitwise</code> might have to be replaced with <code>bitwise'</code>. Is this something that should be recorded on the port wiki?</p>



<a name="316919725"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316919725" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316919725">(Dec 20 2022 at 10:43)</a>:</h4>
<p>All done.</p>



<a name="316919744"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316919744" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316919744">(Dec 20 2022 at 10:43)</a>:</h4>
<p>No, we don't have to record this at all.</p>



<a name="316919774"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316919774" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316919774">(Dec 20 2022 at 10:44)</a>:</h4>
<p>The <code>#align nat.bitwise Nat.bitwise'</code> will do the translation automatically in all downstream files.</p>



<a name="316919920"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316919920" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316919920">(Dec 20 2022 at 10:44)</a>:</h4>
<p>Okay. I will get started on <code>data.nat.bits</code> then</p>



<a name="316919941"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316919941" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316919941">(Dec 20 2022 at 10:44)</a>:</h4>
<p><code>Mathlib.Init.Data.Nat.Bitwise</code> is error and sorry free (but all in terms of mathlib3 definitions, no contact at all with Lean 4's <code>bitwise</code>.)</p>



<a name="316920011"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316920011" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316920011">(Dec 20 2022 at 10:45)</a>:</h4>
<p>I left a <code>-- Porting note</code> explaining that if one wants to merge these, you should start with the theorem <code>bitwise_eq_bitwise'</code>, which I stated, but left commented out.</p>



<a name="316920468"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316920468" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anand Rao <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316920468">(Dec 20 2022 at 10:47)</a>:</h4>
<p>Should I change the name of the theorem <code>bitwise_bit_aux</code> to <code>bitwise'_bit_aux</code>?</p>



<a name="316920794"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316920794" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316920794">(Dec 20 2022 at 10:49)</a>:</h4>
<p>So I will leave that untouched for now and use the file as is. I guess as long as it is error free bitwise_bit_aux needs no further changes?</p>



<a name="316921496"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316921496" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Anand Rao <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316921496">(Dec 20 2022 at 10:53)</a>:</h4>
<p>Yes, <code>bitwise_bit_aux</code> does not need any changes. I was only suggesting the renaming to keep it consistent with the rest of the file.</p>



<a name="316921786"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316921786" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316921786">(Dec 20 2022 at 10:55)</a>:</h4>
<p>Ah okay. I'll take care of that, once I get to my office</p>



<a name="316926411"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316926411" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316926411">(Dec 20 2022 at 11:19)</a>:</h4>
<p><span class="user-mention silent" data-user-id="466334">Shreyas Srinivas</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316864788">said</a>:</p>
<blockquote>
<p>Update + Help Needed:</p>
<ol>
<li>Update : I have reduced the errors in <code>Init.Data.Nat.Bitwise</code> to about 5 theorems.</li>
<li>Help needed : I need help with the proof of <code>test_bit_bitwise</code>. Producing an <a href="https://leanprover-community.github.io/mwe.html">#mwe</a> is next to impossible because of the dependency chain. </li>
</ol>
<p>Specifically : in commit <a href="https://github.com/leanprover-community/mathlib4/pull/1095/commits/b1cac6a15b860e7e4420fa021de72dfc596caf06">https://github.com/leanprover-community/mathlib4/pull/1095/commits/b1cac6a15b860e7e4420fa021de72dfc596caf06</a><br>
(This is the top commit on this branch <code>data_nat_bits</code> right now ). </p>
<p>In lines <strong>544</strong> and <strong>540</strong>, I have reduced the goal to <code>testBit (succ n) (succ k) = true</code> and <code>testBit (succ n) (succ k) = false </code> respectively.<br>
These are the cases I generated using the line <code>cases testBit (succ n) (succ k)</code> (line <strong>534</strong>)  in the first place, so it seems that trivially these goals should be true (by the case distinction). I am not sure how to make this claim a proof</p>
</blockquote>
<p>For port purposes, this question got resolved. But I am curious about this: if you use <code>cases x</code> on some bool <code>x</code>, then presumably you have one case for <code>x</code> being <code>true</code> and another for <code>x </code> being <code>false</code>. So how do you show a goal like  <code>x = true</code> and <code>x=false</code> in the respective cases. <code>rfl</code> did not work for me, but I can guess that this was because of the absence of an explicit hypothesis to this effect. What's the solution then?</p>



<a name="316926793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316926793" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316926793">(Dec 20 2022 at 11:21)</a>:</h4>
<p>Can you give a <a href="https://leanprover-community.github.io/mwe.html">#mwe</a>? Usually in this case I would expect such a goal to be replaced by <code>true = true</code>!</p>



<a name="316926907"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316926907" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316926907">(Dec 20 2022 at 11:22)</a>:</h4>
<p>You may be looking for <code>cases h : x</code> or <code>cases' h : x</code>. Read the doc-strings for those two tactics.</p>



<a name="316926976"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316926976" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316926976">(Dec 20 2022 at 11:22)</a>:</h4>
<p><code>Data.Nat.Bits</code> is down to one annoying error about casts, where I'm forgetting how to use <code>HEq</code>, as usual.</p>



<a name="316927447"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316927447" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316927447">(Dec 20 2022 at 11:25)</a>:</h4>
<p>do you want help with the proof? what's the theorem / goal?</p>



<a name="316927561"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316927561" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316927561">(Dec 20 2022 at 11:25)</a>:</h4>
<p><span class="user-mention silent" data-user-id="110049">Mario Carneiro</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316927447">said</a>:</p>
<blockquote>
<p>do you want help with the proof? what's the theorem / goal?</p>
</blockquote>
<p><span class="user-mention" data-user-id="110049">@Mario Carneiro</span> : directed to me or <span class="user-mention" data-user-id="110087">@Scott Morrison</span> ?</p>



<a name="316927582"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316927582" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316927582">(Dec 20 2022 at 11:26)</a>:</h4>
<p><span class="user-mention" data-user-id="110087">@Scott Morrison</span></p>



<a name="316927664"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316927664" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316927664">(Dec 20 2022 at 11:26)</a>:</h4>
<p>I think scott already gave you the clue for your issue</p>



<a name="316927698"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316927698" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316927698">(Dec 20 2022 at 11:26)</a>:</h4>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">@[simp]</span>
<span class="kd">theorem</span> <span class="n">bitCasesOn_bit</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">ℕ</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">H</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">b</span> <span class="n">n</span><span class="o">,</span> <span class="n">C</span> <span class="o">(</span><span class="n">bit</span> <span class="n">b</span> <span class="n">n</span><span class="o">))</span> <span class="o">(</span><span class="n">b</span> <span class="o">:</span> <span class="n">Bool</span><span class="o">)</span> <span class="o">(</span><span class="n">n</span> <span class="o">:</span> <span class="n">ℕ</span><span class="o">)</span> <span class="o">:</span>
    <span class="n">bitCasesOn</span> <span class="o">(</span><span class="n">bit</span> <span class="n">b</span> <span class="n">n</span><span class="o">)</span> <span class="n">H</span> <span class="bp">=</span> <span class="n">H</span> <span class="n">b</span> <span class="n">n</span> <span class="o">:=</span>
  <span class="n">eq_of_heq</span> <span class="bp">&lt;|</span> <span class="o">(</span><span class="n">eq_rec_heq</span> <span class="n">_</span> <span class="n">_</span><span class="o">)</span><span class="bp">.</span><span class="n">trans</span> <span class="bp">&lt;|</span> <span class="kd">by</span> <span class="n">rw</span> <span class="o">[</span><span class="n">bodd_bit</span><span class="o">,</span> <span class="n">div2_bit</span><span class="o">]</span>
</code></pre></div>
<p>is the last sorry.</p>



<a name="316927717"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316927717" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316927717">(Dec 20 2022 at 11:26)</a>:</h4>
<p>The <code>eq_rec_heq</code> is giving a dud goal full of mvars.</p>



<a name="316927871"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316927871" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316927871">(Dec 20 2022 at 11:27)</a>:</h4>
<p>Presumably because bitCasesOn, <del>defined via pattern matching</del>, has changed slightly, and Lean can't see an <code>eq.rec</code>.</p>



<a name="316927993"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316927993" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316927993">(Dec 20 2022 at 11:28)</a>:</h4>
<p>if I'm reading the proof correctly it first introduces an HEq and then turns it into an equality with eq.rec of stuff</p>



<a name="316928021"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316928021" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316928021">(Dec 20 2022 at 11:28)</a>:</h4>
<p>Maybe we just need to give the motive for the <code>eq_rec_heq</code>?</p>



<a name="316928054"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316928054" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316928054">(Dec 20 2022 at 11:28)</a>:</h4>
<p>Do you have a mathlib-free mwe?</p>



<a name="316928094"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316928094" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316928094">(Dec 20 2022 at 11:29)</a>:</h4>
<p>I assume bitCasesOn is the only new thing here</p>



<a name="316928119"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316928119" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316928119">(Dec 20 2022 at 11:29)</a>:</h4>
<p>oh and <code>bit</code></p>



<a name="316928169"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316928169" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316928169">(Dec 20 2022 at 11:29)</a>:</h4>
<p>This is in <code>Mathlib.Data.Nat.Bits</code></p>



<a name="316928179"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316928179" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316928179">(Dec 20 2022 at 11:29)</a>:</h4>
<p>on branch <code>data_nat_bits</code></p>



<a name="316928231"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316928231" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316928231">(Dec 20 2022 at 11:30)</a>:</h4>
<p>yes but that will take 10 minutes ;)</p>



<a name="316930980"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316930980" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316930980">(Dec 20 2022 at 11:45)</a>:</h4>
<p><code>eq_of_heq &lt;| (eq_rec_heq (φ := fun x =&gt; x) _ _).trans</code></p>



<a name="316931028"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316931028" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316931028">(Dec 20 2022 at 11:45)</a>:</h4>
<p>I guess it took 10 minutes anyway</p>



<a name="316931383"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316931383" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316931383">(Dec 20 2022 at 11:47)</a>:</h4>
<p>Okay, can you explain how the <code>phi := </code> is helping?</p>



<a name="316931475"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316931475" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316931475">(Dec 20 2022 at 11:48)</a>:</h4>
<p>I suggest you change the definition of <code>bitCasesOn</code> to</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">def</span> <span class="n">bitCasesOn</span> <span class="o">{</span><span class="n">C</span> <span class="o">:</span> <span class="n">Nat</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">∀</span> <span class="n">b</span> <span class="n">n</span><span class="o">,</span> <span class="n">C</span> <span class="o">(</span><span class="n">bit</span> <span class="n">b</span> <span class="n">n</span><span class="o">))</span> <span class="o">:</span> <span class="n">C</span> <span class="n">n</span> <span class="o">:=</span> <span class="n">bit_decomp</span> <span class="n">n</span> <span class="bp">▸</span> <span class="n">h</span> <span class="bp">..</span>
</code></pre></div>
<p>though if the proof is going to depend on how it's written</p>



<a name="316931522"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316931522" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316931522">(Dec 20 2022 at 11:48)</a>:</h4>
<p>as a bonus, you don't need to specify the motive in that case</p>



<a name="316931810"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316931810" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316931810">(Dec 20 2022 at 11:49)</a>:</h4>
<p>Nice! I still don't understand, though. :-)</p>



<a name="316931822"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316931822" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316931822">(Dec 20 2022 at 11:50)</a>:</h4>
<p>But perhaps I should sleep, in any case.</p>



<a name="316931833"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316931833" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316931833">(Dec 20 2022 at 11:50)</a>:</h4>
<p>it's what you suspected: lean can't figure out the motive here, because <code>eq_rec_heq</code> isn't stated for arbitrary motive (which would be solved by unification), it is actually a lambda which drops one of the arguments:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">set_option</span> <span class="n">pp.explicit</span> <span class="n">true</span> <span class="k">in</span>
<span class="k">#print</span> <span class="n">eq_rec_heq</span>
</code></pre></div>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="kd">theorem</span> <span class="n">eq_rec_heq.</span><span class="o">{</span><span class="n">u</span><span class="o">,</span> <span class="n">v</span><span class="o">}</span> <span class="o">:</span> <span class="bp">∀</span> <span class="o">{</span><span class="n">α</span> <span class="o">:</span> <span class="kt">Sort</span> <span class="n">u</span><span class="o">}</span> <span class="o">{</span><span class="n">φ</span> <span class="o">:</span> <span class="n">α</span> <span class="bp">→</span> <span class="kt">Sort</span> <span class="n">v</span><span class="o">}</span> <span class="o">{</span><span class="n">a</span> <span class="n">a'</span> <span class="o">:</span> <span class="n">α</span><span class="o">}</span> <span class="o">(</span><span class="n">h</span> <span class="o">:</span> <span class="bp">@</span><span class="n">Eq</span> <span class="n">α</span> <span class="n">a</span> <span class="n">a'</span><span class="o">)</span> <span class="o">(</span><span class="n">p</span> <span class="o">:</span> <span class="n">φ</span> <span class="n">a</span><span class="o">),</span>
  <span class="bp">@</span><span class="n">HEq</span> <span class="o">((</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">↦</span> <span class="n">φ</span> <span class="n">x</span><span class="o">)</span> <span class="n">a'</span> <span class="n">h</span><span class="o">)</span> <span class="o">(</span><span class="bp">@</span><span class="n">Eq.recOn</span> <span class="n">α</span> <span class="n">a</span> <span class="o">(</span><span class="k">fun</span> <span class="n">x</span> <span class="n">x_1</span> <span class="bp">↦</span> <span class="n">φ</span> <span class="n">x</span><span class="o">)</span> <span class="n">a'</span> <span class="n">h</span> <span class="n">p</span><span class="o">)</span> <span class="o">(</span><span class="n">φ</span> <span class="n">a</span><span class="o">)</span> <span class="n">p</span> <span class="o">:=</span>
<span class="bp">@</span><span class="n">eqRec_heq</span>
</code></pre></div>



<a name="316932034"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316932034" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316932034">(Dec 20 2022 at 11:51)</a>:</h4>
<p>Ah, I saw that <code>(fun x x_1 ↦ φ x)</code> at one point, and thought it was weird, but didn't follow it up.</p>



<a name="316932109"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316932109" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Mario Carneiro <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316932109">(Dec 20 2022 at 11:51)</a>:</h4>
<p>coupled with the fact that <code>bitCasesOn</code> doesn't use <code>Eq.recOn</code>, it uses <code>Eq.mpr</code>, I suspect it's throwing lean into confusion</p>



<a name="316959947"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316959947" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316959947">(Dec 20 2022 at 14:14)</a>:</h4>
<p>(deleted)</p>



<a name="316960164"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316960164" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316960164">(Dec 20 2022 at 14:15)</a>:</h4>
<p>What are the rules for writing documentation strings? At the moment there are 21 linting errors in <code>Init...Bitwise</code> alone of the form <br>
<code>/- definition missing documentation string -/</code></p>



<a name="316960704"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316960704" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316960704">(Dec 20 2022 at 14:17)</a>:</h4>
<p>Please try to write docstrings as best you can. My guess is that this was a file from core Lean 3 if the mathlib4 name starts <code>Init</code>, and core Lean 3 was not being linted for docstrings (so the linter is only picking up on this now), but docstrings are invaluable. A simple sentence suffices. If you're not sure what to write then please ask for help.</p>



<a name="316960922"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316960922" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316960922">(Dec 20 2022 at 14:18)</a>:</h4>
<p>And there is one linter error that complains that <code>simp</code> can prove this lemma using <code>simp only ....</code>. Of course the original proofs are not using <code>simp</code> but <code>unfold</code>s and <code>rw</code>s</p>



<a name="316961183"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316961183" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Kevin Buzzard <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316961183">(Dec 20 2022 at 14:19)</a>:</h4>
<p>Lean 4 <code>simp</code> is sometimes better than Lean 3. If the linter is telling you that <code>simp</code> can prove it then you don't have to change the proof to <code>by simp</code> but please remove the <code>@[simp]</code> attribute and make a porting note saying that in mathlib3 this was <code>simp</code>. That should placate the linter.</p>



<a name="316990743"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316990743" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316990743">(Dec 20 2022 at 16:37)</a>:</h4>
<p>One last linter error. Lean is complaining about some unused <code>have</code> that I can't see anywhere.<br>
More specifics:</p>
<div class="codehilite" data-code-language="Lean"><pre><span></span><code><span class="k">#check</span> <span class="bp">@</span><span class="n">Nat.binary_rec_zero</span> <span class="c">/-</span><span class="cm"> unnecessary have this : n' &lt; 0 -/</span>
<span class="k">#check</span> <span class="bp">@</span><span class="n">Nat.binary_rec_eq</span> <span class="c">/-</span><span class="cm"> unnecessary have this : n' &lt; Nat.bit b n -/</span>
</code></pre></div>
<p>Unfortunately, there doesn't seem to be such <code>have</code>s anywhere. What would cause this? I have searched across the file for such patterns.</p>



<a name="316990934"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316990934" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316990934">(Dec 20 2022 at 16:38)</a>:</h4>
<p>I just encountered the same error in another file.</p>



<a name="316990969"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316990969" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Riccardo Brasca <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316990969">(Dec 20 2022 at 16:38)</a>:</h4>
<p><a href="#narrow/stream/287929-mathlib4/topic/Data.2EInt.2EGcd.20-.20NormNum/near/316990729">here</a></p>



<a name="316991789"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/316991789" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Shreyas Srinivas <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#316991789">(Dec 20 2022 at 16:42)</a>:</h4>
<p><span class="user-mention silent" data-user-id="130384">Riccardo Brasca</span> <a href="#narrow/stream/287929-mathlib4/topic/data.2Enat.2Ebits/near/316990934">said</a>:</p>
<blockquote>
<p>I just encountered the same error in another file.</p>
</blockquote>
<p>I checked if it might be happening because of a tactic unfolding a definition which contains <code>have</code>s that are unnecessary for some particular instantiation. But this does not seem to be the case, otherwise the file-wide pattern search would have returned something</p>



<a name="317052899"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/287929-mathlib4/topic/data.nat.bits/near/317052899" class="zl"><img src="https://leanprover-community.github.io/archive/assets/img/zulip2.png" alt="view this post on Zulip"></a> Scott Morrison <a href="https://leanprover-community.github.io/archive/stream/287929-mathlib4/topic/data.2Enat.2Ebits.html#317052899">(Dec 20 2022 at 22:39)</a>:</h4>
<p>I've resolved this now, see discussion at <a href="#narrow/stream/348111-std4/topic/spurious.20.60unusedHavesSuffices.60.20linter.20error.3F">https://leanprover.zulipchat.com/#narrow/stream/348111-std4/topic/spurious.20.60unusedHavesSuffices.60.20linter.20error.3F</a></p>



{% endraw %}

<hr><p>Last updated: Jan 25 2023 at 00:06 UTC</p>